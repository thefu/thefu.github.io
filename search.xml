<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ADB(androidè°ƒè¯•æ¡¥)</title>
    <url>/2022/10/15/ADB-android%E8%B0%83%E8%AF%95%E6%A1%A5/</url>
    <content><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>androidè°ƒè¯•æ¡¥ï¼ˆadbï¼‰æ˜¯ä¸€ç§åŠŸèƒ½å¤šæ ·çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯è®©æ‚¨ä¸è®¾å¤‡è¿›è¡Œé€šä¿¡ã€‚adbå‘½ä»¤å¯ç”¨äºæ‰§è¡Œå„ç§è®¾å¤‡æ“ä½œï¼ˆä¾‹å¦‚å®‰è£…å’Œè°ƒè¯•åº”ç”¨ï¼‰,å¹¶æä¾›å¯¹Unix shellï¼ˆå¯ç”¨æ¥åœ¨è®¾å¤‡å•†è¿è¡Œå„ç§å‘½ä»¤ï¼‰çš„è®¿é—®æƒé™ã€‚å®ƒæ˜¯ä¸€ç§å®¢æˆ·ç«¯-æœåŠ¡å™¨ç¨‹åºï¼ŒåŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªç»„ä»¶ï¼š<br>å®¢æˆ·ç«¯ï¼šç”¨äºå‘é€å‘½ä»¤ã€‚å®¢æˆ·ç«¯åœ¨å¼€å‘æœºå™¨ä¸Šè¿è¡Œã€‚æ‚¨å¯ä»¥é€šè¿‡å‘å‡ºadbå‘½ä»¤ä»å‘½ä»¤è¡Œç»ˆç«¯è°ƒç”¨å®¢æˆ·ç«¯ã€‚<br>å®ˆæŠ¤ç¨‹åºï¼ˆadbdï¼‰ï¼šç”¨äºåœ¨è®¾å¤‡å•†è¿è¡Œå‘½ä»¤ã€‚å®ˆæŠ¤ç¨‹åºåœ¨æ¯ä¸ªè®¾å¤‡ä¸Šä½œä¸ºåå°è¿›ç¨‹è¿è¡Œã€‚<br>æœåŠ¡å™¨ï¼šç”¨äºç®¡ç†å®¢æˆ·ç«¯ä¸å®ˆæŠ¤ç¨‹åºä¹‹é—´çš„é€šä¿¡ã€‚æœåŠ¡å™¨åœ¨å¼€å‘æœºå™¨ä¸Šä½œä¸ºåå°è¿›ç¨‹è¿è¡Œã€‚</p>
<span id="more"></span>
<h2 id="å¸¸ç”¨çš„å‘½ä»¤ï¼š"><a href="#å¸¸ç”¨çš„å‘½ä»¤ï¼š" class="headerlink" title="å¸¸ç”¨çš„å‘½ä»¤ï¼š"></a>å¸¸ç”¨çš„å‘½ä»¤ï¼š</h2><h3 id="æŸ¥è¯¢è®¾å¤‡"><a href="#æŸ¥è¯¢è®¾å¤‡" class="headerlink" title="æŸ¥è¯¢è®¾å¤‡"></a>æŸ¥è¯¢è®¾å¤‡</h3><p>åœ¨å‘å‡ºadbå‘½ä»¤ä¹‹å‰ï¼Œäº†è§£å“ªäº›è®¾å¤‡å®ä¾‹å·²ç»äº†è§£åˆ°adbæœåŠ¡å™¨ä¼šå¾ˆæœ‰å¸®åŠ©<br>adb devices -l</p>
<h3 id="å°†å‘½ä»¤å‘é€è‡³ç‰¹å®šè®¾å¤‡"><a href="#å°†å‘½ä»¤å‘é€è‡³ç‰¹å®šè®¾å¤‡" class="headerlink" title="å°†å‘½ä»¤å‘é€è‡³ç‰¹å®šè®¾å¤‡"></a>å°†å‘½ä»¤å‘é€è‡³ç‰¹å®šè®¾å¤‡</h3><p>å¦‚æœæœ‰å¤šä¸ªå‘½ä»¤æ­£åœ¨è¿è¡Œï¼Œå‘å‡ºadbå‘½ä»¤æ—¶å¿…é¡»æŒ‡å®šç›®æ ‡è®¾å¤‡ã€‚ä¸ºæ­¤ï¼Œè¯·ä½¿ç”¨deviceså‘½ä»¤è·å–ç›®æ ‡è®¾å¤‡çš„åºåˆ—å·ã€‚è·å¾—åºåˆ—å·æ—¶ï¼Œè¯·ç»“åˆ-sé€‰é¡¹å’Œadbå‘½ä»¤æ¥æŒ‡å®šåºåˆ—å·ã€‚<br>adb -s xxxxxxxxx installl helloworld.apk</p>
<h3 id="å®‰è£…åº”ç”¨"><a href="#å®‰è£…åº”ç”¨" class="headerlink" title="å®‰è£…åº”ç”¨"></a>å®‰è£…åº”ç”¨</h3><p>ä½¿ç”¨adbçš„installå‘½ä»¤åœ¨æ¨¡æ‹Ÿå™¨æˆ–é“¾æ¥çš„è®¾å¤‡ä¸Šå®‰è£…APK<br>adb install path_to_apk</p>
<h3 id="è®¾ç½®ç«¯å£è½¬å‘"><a href="#è®¾ç½®ç«¯å£è½¬å‘" class="headerlink" title="è®¾ç½®ç«¯å£è½¬å‘"></a>è®¾ç½®ç«¯å£è½¬å‘</h3><p>å¯ä»¥ä½¿ç”¨forwardå‘½ä»¤è®¾ç½®ä»»æ„ç«¯å£è½¬å‘ï¼Œå°†ç‰¹å®šä¸»æœºç«¯å£ä¸Šçš„è¯·æ±‚è½¬å‘åˆ°è®¾å¤‡ä¸Šå…¶ä»–ç«¯å£ã€‚ä»¥ä¸‹å®ä¾‹è®¾ç½®äº†ä¸»æœºç«¯å£6100åˆ°è®¾å¤‡ç«¯å£7100çš„è½¬å‘ï¼š<br>adb forward tcp:6100 tcp:7100</p>
<h3 id="å°†æ–‡ä»¶å¤åˆ¶åˆ°è®¾å¤‡-x2F-ä»è®¾å¤‡å¤åˆ¶æ–‡ä»¶"><a href="#å°†æ–‡ä»¶å¤åˆ¶åˆ°è®¾å¤‡-x2F-ä»è®¾å¤‡å¤åˆ¶æ–‡ä»¶" class="headerlink" title="å°†æ–‡ä»¶å¤åˆ¶åˆ°è®¾å¤‡&#x2F;ä»è®¾å¤‡å¤åˆ¶æ–‡ä»¶"></a>å°†æ–‡ä»¶å¤åˆ¶åˆ°è®¾å¤‡&#x2F;ä»è®¾å¤‡å¤åˆ¶æ–‡ä»¶</h3><p>å¯ä»¥ä½¿ç”¨pullå’Œpushå‘½ä»¤å°†æ–‡ä»¶å¤åˆ¶åˆ°è®¾å¤‡æˆ–ä»è®¾å¤‡å¤åˆ¶æ–‡ä»¶ã€‚ä¸installå‘½ä»¤ï¼ˆä»…å°†apkæ–‡ä»¶å¤åˆ¶åˆ°ç‰¹å®šä½ç½®ï¼‰ä¸åŒï¼Œä½¿ç”¨pullå’Œpushå‘½ä»¤å¯å°†ä»»æ„ç›®å½•å’Œæ–‡ä»¶å¤åˆ¶åˆ°è®¾å¤‡ä¸­ä»»ä½•ä½ç½®ã€‚<br>ä»è®¾å¤‡ä¸­å¤åˆ¶æŸä¸ªæ–‡ä»¶æˆ–ç›®å½•ï¼ˆåŠå…¶å­ç›®å½•ï¼‰,ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š<br>Adb pull remote local<br>å¦‚éœ€å°†æŸä¸ªæ–‡ä»¶æˆ–ç›®å½•å¤åˆ¶åˆ°è®¾å¤‡ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š<br>Adb push local remote<br>å°†localå’Œremoteæ›¿æ¢ä¸ºå¼€å‘æœºå™¨ï¼ˆæœ¬åœ°ï¼‰å’Œè®¾å¤‡ï¼ˆè¿œç¨‹ï¼‰ä¸Šçš„ç›®æ ‡æ–‡ä»¶&#x2F;ç›®å½•çš„è·¯å¾„ï¼š<br>Adb push foo.txt &#x2F;sdcard&#x2F;foo.txt</p>
<h3 id="åœæ­¢adbæœåŠ¡å™¨"><a href="#åœæ­¢adbæœåŠ¡å™¨" class="headerlink" title="åœæ­¢adbæœåŠ¡å™¨"></a>åœæ­¢adbæœåŠ¡å™¨</h3><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½éœ€è¦ç»ˆæ­¢adbæœåŠ¡å™¨è¿›ç¨‹ï¼Œç„¶åé‡å¯ä»¥è§£å†³é—®é¢˜ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœadbä¸å“åº”å‘½ä»¤ï¼‰ã€‚<br>å¦‚éœ€åœæ­¢adbæœåŠ¡å™¨ï¼Œè¯·ä½¿ç”¨adb kill-serverå‘½ä»¤ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥é€šè¿‡å‘å‡ºå…¶ä»–ä»»ä½•adbå‘½ä»¤æ¥é‡å¯æœåŠ¡å™¨ã€‚</p>
<h3 id="å‘å‡ºadbå‘½ä»¤"><a href="#å‘å‡ºadbå‘½ä»¤" class="headerlink" title="å‘å‡ºadbå‘½ä»¤"></a>å‘å‡ºadbå‘½ä»¤</h3><p>å¯ä»¥ä»å¼€å‘æœºå™¨ä¸Šçš„å‘½ä»¤è¡Œå‘å‡ºadbå‘½ä»¤ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è„šæœ¬å‘å‡ºï¼Œç”¨æ³•å¦‚ä¸‹ï¼š<br>adb [-d | -e | -s  serial_number] command<br>å¦‚æœåªæœ‰ä¸€ä¸ªæ¨¡æ‹Ÿå™¨åœ¨è¿è¡Œæˆ–è€…åªè¿æ¥äº†ä¸€ä¸ªè®¾å¤‡ï¼Œç³»ç»Ÿä¼šé»˜è®¤å°†adbå‘½ä»¤å‘é€åˆ°è¯¥è®¾å¤‡ï¼Œå¦‚æœæœ‰å¤šä¸ªæ¨¡æ‹Ÿå™¨åœ¨è¿è¡Œå¹¶ä¸”&#x2F;æˆ–è€…è¿æ¥äº†å¤šä¸ªè®¾å¤‡ï¼Œæ‚¨éœ€è¦ä½¿ç”¨-dã€-eã€-sé€‰é¡¹æŒ‡å®šåº”å‘å…¶å‘é€å‘½ä»¤çš„ç›®æ ‡è®¾å¤‡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹æ‰€æœ‰æ”¯æŒçš„adbå‘½ä»¤çš„è¯¦ç»†åˆ—è¡¨ï¼š<br>adb â€“help</p>
<h3 id="å‘å‡ºshellå‘½ä»¤"><a href="#å‘å‡ºshellå‘½ä»¤" class="headerlink" title="å‘å‡ºshellå‘½ä»¤"></a>å‘å‡ºshellå‘½ä»¤</h3><p>å¯ä»¥ä½¿ç”¨shellå‘½ä»¤é€šè¿‡adbå‘å‡ºè®¾å¤‡å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥å¯äº¤äº’å¼shellã€‚å¦‚éœ€å‘å‡ºå•ä¸ªå‘½ä»¤ï¼Œè¯·ä½¿ç”¨shellå‘½ä»¤ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br>adb shell shell_command<br>è¦åœ¨è®¾å¤‡ä¸Šå¯åŠ¨äº¤äº’å¼shellï¼Œè¯·ä½¿ç”¨shellå‘½ä»¤ï¼Œå¦‚ä¸‹ï¼š<br>adb shell<br>è¦é€€å‡ºäº¤äº’å¼shellï¼ŒæŒ‰åˆcrtl+Dæˆ–è€…è¾“å…¥exit</p>
<h3 id="ä»æ‰‹æœºä¸Šå¯¼å‡ºåº”ç”¨è½¯ä»¶apkæ–‡ä»¶"><a href="#ä»æ‰‹æœºä¸Šå¯¼å‡ºåº”ç”¨è½¯ä»¶apkæ–‡ä»¶" class="headerlink" title="ä»æ‰‹æœºä¸Šå¯¼å‡ºåº”ç”¨è½¯ä»¶apkæ–‡ä»¶"></a>ä»æ‰‹æœºä¸Šå¯¼å‡ºåº”ç”¨è½¯ä»¶apkæ–‡ä»¶</h3><p>ç¬¬ä¸€æ­¥ï¼šæŸ¥çœ‹appåŒ…å<br>adb shell ammonitor<br>è¿™ä¸ªæ—¶å€™ç‚¹å‡»è¿è¡Œæ‰‹æœºä¸Šè¦çœ‹çš„åŒ…åçš„appï¼Œå°±å¯ä»¥çœ‹åˆ°å¯åŠ¨çš„åŒ…åäº†<br>ç¬¬äºŒæ­¥ï¼šæŸ¥çœ‹åŒ…å­˜æ”¾çš„è·¯å¾„<br>adb shell pm path com.eda.abcd<br>è¿™ä¸ªæ—¶å€™å°±å¯ä»¥çœ‹åˆ°è¯¥åº”ç”¨ç¨‹åºçš„åŒ…å­˜æ”¾è·¯å¾„<br>ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨adb pull + åŒ…å­˜æ”¾è·¯å¾„<br>å°†apkå¯¼å‡ºåˆ°ç”µè„‘</p>
]]></content>
      <categories>
        <category>android</category>
      </categories>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android developer å¿…å¤‡çš„å‡ ä¸ªèµ„æº</title>
    <url>/2023/02/22/Android-developer-%E5%BF%85%E5%A4%87%E7%9A%84%E5%87%A0%E4%B8%AA%E8%B5%84%E6%BA%90/</url>
    <content><![CDATA[<p>ä½œä¸ºä¸€ååˆæ ¼çš„ Android Coderï¼Œé™¤äº†è®¤çœŸå·¥ä½œï¼Œå†™å‡ºä¼˜ç§€ä»£ç å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨æ—¥æ–°æœˆå¼‚çš„æŠ€æœ¯æ ˆä¸­æ‰¾åˆ°æœ‰ç”¨çš„èµ„æºï¼Œæ¥è£…å¤‡è‡ªå·±ï¼Œå¼€é˜”è§†é‡ã€‚å¸Œæœ›ä»¥ä¸‹çš„èµ„æºå¯¹å¤§å®¶æœ‰ç”¨ã€‚</p>
<span id="more"></span>

<h2 id="1-å®˜æ–¹èµ„æº"><a href="#1-å®˜æ–¹èµ„æº" class="headerlink" title="1.å®˜æ–¹èµ„æº"></a>1.å®˜æ–¹èµ„æº</h2><p>ä¸€æ‰‹ã€æœ€æ–°ã€æœ€å…¨çš„èµ„æ–™ã€‚<br><a href="https://imgse.com/i/p9ZShM8"><img src="https://s1.ax1x.com/2023/04/22/p9ZShM8.png" alt="p9ZShM8.png"></a><br>åŒ…å« Android Platformã€Android Studioã€Jetpackã€Kotlin ç­‰ä¸€åˆ‡è·Ÿ Android å¼€å‘ç›¸å…³çš„æŒ‡å¯¼ã€ä¾‹å­Sample ç­‰ã€‚å¤§éƒ¨åˆ†äººè‚¯å®šéƒ½çŸ¥é“ã€‚<br>å»ºè®®æ¯éš”ä¸€æ®µæ—¶é—´ä¸Šå»çœ‹çœ‹ï¼Œç»å¸¸æ›´æ–°ï¼Œæ¯”å¦‚æœ€è¿‘å¢åŠ äº†æ¨¡å—åŒ–çš„æŒ‡å¯¼ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå…¶ä»–æ¶æ„ç›¸å…³çš„å†…å®¹ï¼Œä¸ç®¡æ˜¯åˆå­¦è€…è¿˜æ˜¯åˆå­¦è€…ï¼Œ<br>éƒ½æœ‰å¾ˆå¤šæŒ‡å¯¼ã€å­¦ä¹ çš„æ„ä¹‰ã€‚</p>
<p>å…¶ä»–å®˜æ–¹èµ„æºï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>Android Developers on Medium <a href="https://medium.com/androiddevelopers">https://medium.com/androiddevelopers</a></li>
<li>Android Developers on YouTube <a href="https://www.youtube.com/@AndroidDevelopers">https://www.youtube.com/@AndroidDevelopers</a></li>
<li>Google Codelabs <a href="https://codelabs.developers.google.com/?product=android">https://codelabs.developers.google.com/?product=android</a></li>
</ul>
<p>ç½‘å€ï¼š<a href="https://developer.android.com/docs">https://developer.android.com/docs</a></p>
<h2 id="2-Android-Weekly"><a href="#2-Android-Weekly" class="headerlink" title="2.Android Weekly"></a>2.Android Weekly</h2><p><a href="https://imgse.com/i/p9ZprlV"><img src="https://s1.ax1x.com/2023/04/22/p9ZprlV.png" alt="p9ZprlV.png"></a><br>èšåˆäº†æœ€è¿‘ã€æœ€æ–°çš„ Android ç›¸å…³çš„æ–‡ç« ã€å¼€æºé¡¹ç›®ã€è§†é¢‘&amp;æ’­å®¢ã€æ–°é—»ç­‰ï¼Œæ¯å‘¨ä¸€æ›´æ–°ï¼Œä¸å®¹é”™è¿‡ã€‚</p>
<p>ç½‘å€ï¼š<a href="https://androidweekly.net/">https://androidweekly.net/</a></p>
<h2 id="3-kotlin-Weekly"><a href="#3-kotlin-Weekly" class="headerlink" title="3.kotlin Weekly"></a>3.kotlin Weekly</h2><p><a href="https://imgse.com/i/p9Zpgw4"><img src="https://s1.ax1x.com/2023/04/22/p9Zpgw4.png" alt="p9Zpgw4.png"></a><br>ç±»ä¼¼äºä¸Šé¢çš„ Android Weeklyï¼Œä¸»è¦æä¾›ä¸€äº› kotlin ç›¸å…³æŠ€æœ¯æ ˆæ›´æ–°ã€æ–‡ç« ã€æ–°ç‰¹æ€§ç­‰ï¼Œä¹ŸåŒ…æ‹¬äº†ä¸€äº› Android ç›¸å…³çš„å†…å®¹ã€‚</p>
<p>ç½‘å€ï¼š<a href="http://www.kotlinweekly.net/">http://www.kotlinweekly.net/</a></p>
<h2 id="4-ProAndroidDev"><a href="#4-ProAndroidDev" class="headerlink" title="4.ProAndroidDev"></a>4.ProAndroidDev</h2><p><a href="https://imgse.com/i/p9Zphf1"><img src="https://s1.ax1x.com/2023/04/22/p9Zphf1.png" alt="p9Zphf1.png"></a><br>Mediumï¼ˆå›½å¤–çš„ç®€ä¹¦ï¼‰ä¸Šçš„ä¸€ä¸ªç»„ç»‡ï¼Œéƒ½æ˜¯ Androidä¸“å®¶å’Œå¤§ç‰›ï¼ˆGoogle Developer Expertsï¼‰å†™çš„ä¸€äº›æ˜“æ‡‚ã€ç®€æ´çš„æ–‡ç« ï¼Œè´¨é‡ä¸é”™ã€‚è€Œä¸”ï¼Œå¦‚æœä½ è¦åœ¨è¯¥ä¸“æ å‘å¸ƒæ–‡ç« çš„è¯ï¼Œéœ€è¦ä¸“å®¶ review æ‰èƒ½å‘å‡ºæ¥ã€‚</p>
<p>ç½‘å€ï¼š<a href="https://proandroiddev.com/">https://proandroiddev.com/</a></p>
<h2 id="5-Github"><a href="#5-Github" class="headerlink" title="5.Github"></a>5.Github</h2><p>è¿™ä¸ªåº”è¯¥éƒ½çŸ¥é“å§ï¼Œæœ€å¤§çš„åŸºå‹äº¤æµç¤¾åŒºï¼Œå…¨ä¸–ç•Œçš„ä»£ç ä»“åº“é›†ä¸­åœ°ã€‚<br>æ¯”å¦‚ Android å®˜æ–¹çš„ä»“åº“ï¼Œ<a href="https://github.com/android%EF%BC%8C%E5%8C%85%E5%90%AB%E5%BE%88%E5%A4%9A%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%EF%BC%8C%E6%AF%94%E5%A6%82">https://github.com/androidï¼ŒåŒ…å«å¾ˆå¤šæœ€ä½³å®è·µï¼Œæ¯”å¦‚</a> Now In Android, architecture-samples,  sunflower ç­‰ã€‚<br>ä¹Ÿå¯ä»¥é€šè¿‡ GitHub Trending page æ¥æŸ¥çœ‹æœ€è¿‘çƒ­é—¨çš„ä»“åº“ï¼Œç±»ä¼¼å¾®åšçƒ­æœğŸ”¥ ï¼ˆç­›é€‰ kotlin è¯­è¨€ï¼Œå‰å‡ ä¸ªå°±æ˜¯ android ç›¸å…³çš„é¡¹ç›®ï¼‰<br>é¡ºä¾¿æ¨èä¸€ä¸ª android-developer-roadmap é¡¹ç›®ï¼ŒåŒ…å«äº†ä¸€äº› Android å¼€å‘çš„èµ„æºï¼š<br><a href="https://imgse.com/i/p9Zpo6K"><img src="https://s1.ax1x.com/2023/04/22/p9Zpo6K.png" alt="p9Zpo6K.png"></a></p>
<h2 id="6-Google-Developer-Library"><a href="#6-Google-Developer-Library" class="headerlink" title="6.Google Developer Library"></a>6.Google Developer Library</h2><p>åˆæ˜¯ä¸€ä¸ªå®è—èµ„æºåº“ï¼<br>è°·æ­Œå®˜æ–¹çš„èµ„æºåº“ï¼ŒåŒ…å«äº† Androidã€Flutterã€Firebase å’Œ Machine Learning ç­‰èµ„æºï¼Œå…‰ Android æ–¹é¢å°±æœ‰ä¸€å¤§å †ï¼Œæ‰“å¼€æ…¢æ…¢çœ‹å§<br><a href="https://imgse.com/i/p9ZpOkd"><img src="https://s1.ax1x.com/2023/04/22/p9ZpOkd.png" alt="p9ZpOkd.png"></a></p>
<h2 id="7-Android-Arsenal"><a href="#7-Android-Arsenal" class="headerlink" title="7.Android Arsenal"></a>7.Android Arsenal</h2><p>å®‰å“å†›ç«åº“ï¼Œèšé›†äº†å¤§é‡çš„å¼€æºåº“ï¼Œå·¥å…·ç­‰ï¼Œæ”¯æŒåˆ†ç±»æŸ¥æ‰¾ã€‚<br>ä¹Ÿå¯ä»¥æäº¤è‡ªå·±çš„å¼€æºåº“ï¼Œé€šè¿‡å®¡æ ¸å°±å¯ä»¥å±•ç¤ºå‡ºæ¥ï¼Œä¾›åˆ«äººä½¿ç”¨ã€‚<br>å…³æ³¨å®ƒçš„æ¨ç‰¹ï¼ŒåŠæ—¶è·å–æœ€æ–°çš„å¼€æºé¡¹ç›®ã€‚</p>
<p>ç½‘å€ï¼š<a href="https://android-arsenal.com/">https://android-arsenal.com/</a></p>
]]></content>
      <categories>
        <category>android</category>
      </categories>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android å¼€å‘è°ƒç”¨C++åº“</title>
    <url>/2023/01/15/Android-%E5%BC%80%E5%8F%91%E8%B0%83%E7%94%A8C++%E5%BA%93/</url>
    <content><![CDATA[<p>èƒŒæ™¯ï¼šå®é™…é¡¹ç›®ä¸­çš„ç®—æ³•åº“å¾ˆå¤šéƒ½æ˜¯C++ä»£ç ç¼–å†™çš„ï¼Œè€ŒAndroidå¼€å‘æ˜¯ä½¿ç”¨kotlinæˆ–è€…javaè¯­è¨€å®ç°çš„ï¼Œå¦‚æœé‡åˆ°ä¸€ä¸ªAPPéœ€è¦è°ƒç”¨ç®—æ³•åº“ï¼Œ<br>ä¸åŒè¯­è¨€æœ‰ä¸åŒçš„ä¹¦å†™è§„èŒƒï¼Œç›´æ¥å¼•ç”¨å½“ç„¶ä¸å¯èƒ½ç¼–è¯‘æˆåŠŸï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡ä¸­é—´å±‚ï¼ˆJNIç¼–ç¨‹ï¼‰æ¥æ­å»ºjavaè¯­è¨€å’ŒC++è¯­è¨€æ²Ÿé€šçš„æ¡¥æ¢ã€‚</p>
<span id="more"></span>

<h2 id="ä¸€ã€æ–°å»ºä½¿ç”¨JNIç¼–ç¨‹çš„å·¥ç¨‹"><a href="#ä¸€ã€æ–°å»ºä½¿ç”¨JNIç¼–ç¨‹çš„å·¥ç¨‹" class="headerlink" title="ä¸€ã€æ–°å»ºä½¿ç”¨JNIç¼–ç¨‹çš„å·¥ç¨‹"></a>ä¸€ã€æ–°å»ºä½¿ç”¨JNIç¼–ç¨‹çš„å·¥ç¨‹</h2><p>åœ¨android studioä¸­ï¼Œæ–°å»ºä¸€ä¸ªnative C++çš„å·¥ç¨‹<br><a href="https://imgse.com/i/p9VvgP0"><img src="https://s1.ax1x.com/2023/04/22/p9VvgP0.png" alt="p9VvgP0.png"></a><br>è®¾ç½®é¡¹ç›®å’ŒåŒ…çš„åç§°ï¼ˆåŒ…çš„åç§°éœ€è¦å’Œä½ è‡ªå·±å®é™…ä½¿ç”¨çš„é¡¹ç›®åŒ…åä¸€è‡´ï¼Œå¦åˆ™å°±åªèƒ½é€šè¿‡æ¨¡å—çš„æ–¹å¼å»è°ƒç”¨ï¼‰<br><a href="https://imgse.com/i/p9VvR2T"><img src="https://s1.ax1x.com/2023/04/22/p9VvR2T.png" alt="p9VvR2T.png"></a></p>
<h2 id="äºŒã€ä¸‹è½½JNIå¼€å‘æ‰€éœ€çš„NKDï¼ŒLLDBï¼ŒCMakeå·¥å…·åŒ…"><a href="#äºŒã€ä¸‹è½½JNIå¼€å‘æ‰€éœ€çš„NKDï¼ŒLLDBï¼ŒCMakeå·¥å…·åŒ…" class="headerlink" title="äºŒã€ä¸‹è½½JNIå¼€å‘æ‰€éœ€çš„NKDï¼ŒLLDBï¼ŒCMakeå·¥å…·åŒ…"></a>äºŒã€ä¸‹è½½JNIå¼€å‘æ‰€éœ€çš„NKDï¼ŒLLDBï¼ŒCMakeå·¥å…·åŒ…</h2><p>æ‰“å¼€Androidstudio -&gt; Preferences -&gt; Android SDK<br><a href="https://imgse.com/i/p9VvhMF"><img src="https://s1.ax1x.com/2023/04/22/p9VvhMF.png" alt="p9VvhMF.png"></a><br>JNIï¼šJava Native Interfaceï¼ˆjavaæœ¬åœ°ç¼–ç¨‹æ¥å£ï¼‰ï¼Œä¸€å¥—ç¼–ç¨‹è§„èŒƒï¼Œå®ƒæä¾›äº†è‹¥å¹²çš„APIï¼Œå®ç°äº†Javaå’Œå…¶ä»–è¯­è¨€çš„é€šä¿¡ï¼ˆä¸»è¦æ˜¯C&#x2F;C++ï¼‰<br>NDKï¼šNative Development Kitï¼ˆæœ¬åœ°å¼€å‘å·¥å…·ï¼‰ï¼Œä¸€ç³»åˆ—å·¥å…·çš„é›†åˆï¼Œè¿™å¥—å·¥å…·å…è®¸ä½ åœ¨Androidå¼€å‘ä¸­ä½¿ç”¨Cå’ŒC++ä»£ç <br>CMakeï¼šè·¨å¹³å°ç¼–è¯‘å·¥å…·<br>LLDBï¼šä¸€ç§è°ƒè¯•ç¨‹åºï¼ŒAndroid Studioä½¿ç”¨å®ƒæ¥è°ƒè¯•åŸç”Ÿä»£ç </p>
<h2 id="ä¸‰ã€åœ¨cppæ–‡ä»¶å¤¹ä¸‹é˜²æ­¢éœ€è¢«æ‰“åŒ…çš„C-x2F-C-æºç ï¼ŒCMakeListsé‡Œæ·»åŠ æ‰€æœ‰C-x2F-C-ä»£ç å’Œnative-lib-cppï¼šå¦‚å›¾ï¼Œincé‡Œæ”¾ç½®å¤´æ–‡ä»¶ï¼Œsrcé‡Œæ”¾ç½®-c-x2F-cppæ–‡ä»¶ï¼ˆæ³¨æ„ä¿®æ”¹å¼•ç”¨è·¯å¾„ï¼‰"><a href="#ä¸‰ã€åœ¨cppæ–‡ä»¶å¤¹ä¸‹é˜²æ­¢éœ€è¢«æ‰“åŒ…çš„C-x2F-C-æºç ï¼ŒCMakeListsé‡Œæ·»åŠ æ‰€æœ‰C-x2F-C-ä»£ç å’Œnative-lib-cppï¼šå¦‚å›¾ï¼Œincé‡Œæ”¾ç½®å¤´æ–‡ä»¶ï¼Œsrcé‡Œæ”¾ç½®-c-x2F-cppæ–‡ä»¶ï¼ˆæ³¨æ„ä¿®æ”¹å¼•ç”¨è·¯å¾„ï¼‰" class="headerlink" title="ä¸‰ã€åœ¨cppæ–‡ä»¶å¤¹ä¸‹é˜²æ­¢éœ€è¢«æ‰“åŒ…çš„C&#x2F;C++æºç ï¼ŒCMakeListsé‡Œæ·»åŠ æ‰€æœ‰C&#x2F;C++ä»£ç å’Œnative-lib.cppï¼šå¦‚å›¾ï¼Œincé‡Œæ”¾ç½®å¤´æ–‡ä»¶ï¼Œsrcé‡Œæ”¾ç½®.c&#x2F;.cppæ–‡ä»¶ï¼ˆæ³¨æ„ä¿®æ”¹å¼•ç”¨è·¯å¾„ï¼‰"></a>ä¸‰ã€åœ¨cppæ–‡ä»¶å¤¹ä¸‹é˜²æ­¢éœ€è¢«æ‰“åŒ…çš„C&#x2F;C++æºç ï¼ŒCMakeListsé‡Œæ·»åŠ æ‰€æœ‰C&#x2F;C++ä»£ç å’Œnative-lib.cppï¼šå¦‚å›¾ï¼Œincé‡Œæ”¾ç½®å¤´æ–‡ä»¶ï¼Œsrcé‡Œæ”¾ç½®.c&#x2F;.cppæ–‡ä»¶ï¼ˆæ³¨æ„ä¿®æ”¹å¼•ç”¨è·¯å¾„ï¼‰</h2><p><a href="https://imgse.com/i/p9VvoZ9"><img src="https://s1.ax1x.com/2023/04/22/p9VvoZ9.png" alt="p9VvoZ9.png"></a></p>
<h2 id="å››ã€æ–°å»ºä¸€ä¸ªå·¥å…·ç±»ï¼Œåœ¨ç±»ä¸­å£°æ˜éœ€è¦è°ƒç”¨çš„æ–¹æ³•ã€‚ï¼ˆè¿™ä¸€æ­¥è®¾è®¡ç±»å‹è½¬æ¢C-gt-JNI-gt-JAVAï¼‰"><a href="#å››ã€æ–°å»ºä¸€ä¸ªå·¥å…·ç±»ï¼Œåœ¨ç±»ä¸­å£°æ˜éœ€è¦è°ƒç”¨çš„æ–¹æ³•ã€‚ï¼ˆè¿™ä¸€æ­¥è®¾è®¡ç±»å‹è½¬æ¢C-gt-JNI-gt-JAVAï¼‰" class="headerlink" title="å››ã€æ–°å»ºä¸€ä¸ªå·¥å…·ç±»ï¼Œåœ¨ç±»ä¸­å£°æ˜éœ€è¦è°ƒç”¨çš„æ–¹æ³•ã€‚ï¼ˆè¿™ä¸€æ­¥è®¾è®¡ç±»å‹è½¬æ¢C++ -&gt; JNI -&gt; JAVAï¼‰"></a>å››ã€æ–°å»ºä¸€ä¸ªå·¥å…·ç±»ï¼Œåœ¨ç±»ä¸­å£°æ˜éœ€è¦è°ƒç”¨çš„æ–¹æ³•ã€‚ï¼ˆè¿™ä¸€æ­¥è®¾è®¡ç±»å‹è½¬æ¢C++ -&gt; JNI -&gt; JAVAï¼‰</h2><p><a href="https://imgse.com/i/p9Vv7I1"><img src="https://s1.ax1x.com/2023/04/22/p9Vv7I1.png" alt="p9Vv7I1.png"></a></p>
<h2 id="äº”ã€åœ¨native-lib-cppé‡Œå®ç°æ–¹æ³•ä»C-åˆ°JNIçš„è½¬æ¢"><a href="#äº”ã€åœ¨native-lib-cppé‡Œå®ç°æ–¹æ³•ä»C-åˆ°JNIçš„è½¬æ¢" class="headerlink" title="äº”ã€åœ¨native-lib.cppé‡Œå®ç°æ–¹æ³•ä»C++åˆ°JNIçš„è½¬æ¢"></a>äº”ã€åœ¨native-lib.cppé‡Œå®ç°æ–¹æ³•ä»C++åˆ°JNIçš„è½¬æ¢</h2><p><a href="https://imgse.com/i/p9VxFRf"><img src="https://s1.ax1x.com/2023/04/22/p9VxFRf.png" alt="p9VxFRf.png"></a></p>
<h2 id="å…­ã€æ‰§è¡ŒBuild-gt-Make-Projectï¼Œå¯å¾—åˆ°-soæ–‡ä»¶"><a href="#å…­ã€æ‰§è¡ŒBuild-gt-Make-Projectï¼Œå¯å¾—åˆ°-soæ–‡ä»¶" class="headerlink" title="å…­ã€æ‰§è¡ŒBuild -&gt; Make Projectï¼Œå¯å¾—åˆ°.soæ–‡ä»¶"></a>å…­ã€æ‰§è¡ŒBuild -&gt; Make Projectï¼Œå¯å¾—åˆ°.soæ–‡ä»¶</h2><p><a href="https://imgse.com/i/p9Vxkz8"><img src="https://s1.ax1x.com/2023/04/22/p9Vxkz8.png" alt="p9Vxkz8.png"></a></p>
<h2 id="ä¸ƒã€æŠŠ-soåº“æ”¾å…¥éœ€è¦ç®—æ³•åº“çš„å·¥ç¨‹ä¸‹"><a href="#ä¸ƒã€æŠŠ-soåº“æ”¾å…¥éœ€è¦ç®—æ³•åº“çš„å·¥ç¨‹ä¸‹" class="headerlink" title="ä¸ƒã€æŠŠ.soåº“æ”¾å…¥éœ€è¦ç®—æ³•åº“çš„å·¥ç¨‹ä¸‹"></a>ä¸ƒã€æŠŠ.soåº“æ”¾å…¥éœ€è¦ç®—æ³•åº“çš„å·¥ç¨‹ä¸‹</h2><p><a href="https://imgse.com/i/p9VxmZj"><img src="https://s1.ax1x.com/2023/04/22/p9VxmZj.png" alt="p9VxmZj.png"></a></p>
<h2 id="å…«ã€åœ¨æ–°å·¥ç¨‹ä¸­ï¼ŒåŒä¸€æŠ¥åç›®å½•ä¸‹æ–°å»ºåå­—ç›¸åŒçš„ç±»ï¼Œå¤å†™åŠ è½½å’Œå£°æ˜å‡½æ•°"><a href="#å…«ã€åœ¨æ–°å·¥ç¨‹ä¸­ï¼ŒåŒä¸€æŠ¥åç›®å½•ä¸‹æ–°å»ºåå­—ç›¸åŒçš„ç±»ï¼Œå¤å†™åŠ è½½å’Œå£°æ˜å‡½æ•°" class="headerlink" title="å…«ã€åœ¨æ–°å·¥ç¨‹ä¸­ï¼ŒåŒä¸€æŠ¥åç›®å½•ä¸‹æ–°å»ºåå­—ç›¸åŒçš„ç±»ï¼Œå¤å†™åŠ è½½å’Œå£°æ˜å‡½æ•°"></a>å…«ã€åœ¨æ–°å·¥ç¨‹ä¸­ï¼ŒåŒä¸€æŠ¥åç›®å½•ä¸‹æ–°å»ºåå­—ç›¸åŒçš„ç±»ï¼Œå¤å†™åŠ è½½å’Œå£°æ˜å‡½æ•°</h2><p><a href="https://imgse.com/i/p9Vxo6S"><img src="https://s1.ax1x.com/2023/04/22/p9Vxo6S.png" alt="p9Vxo6S.png"></a></p>
]]></content>
      <categories>
        <category>android</category>
      </categories>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Androidä¸­viewçš„ç†è§£</title>
    <url>/2022/09/25/Android%E4%B8%ADview%E7%9A%84%E7%90%86%E8%A7%A3/</url>
    <content><![CDATA[<h3 id="Viewæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Viewæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Viewæ˜¯ä»€ä¹ˆï¼Ÿ"></a>Viewæ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>Viewæ˜¯å±å¹•ä¸Šçš„ä¸€å—çŸ©å½¢åŒºåŸŸï¼Œå®ƒè´Ÿè´£ç”¨æ¥æ˜¾ç¤ºä¸€ä¸ªåŒºåŸŸï¼Œå¹¶ä¸”å“åº”è¿™ä¸ªåŒºåŸŸå†…çš„äº‹ä»¶ã€‚å¯ä»¥è¯´ï¼Œæ‰‹æœºå±å¹•ä¸Šçš„ä»»æ„ä¸€éƒ¨åˆ†çœ‹å¾—è§çš„åœ°æ–¹éƒ½æ˜¯viewï¼Œå®ƒå¾ˆå¸¸è§ï¼Œæ¯”å¦‚TextViewã€imageviewã€buttonã€ä»¥åŠlinearLayoutã€relativelayoutéƒ½æ˜¯ç»§æ‰¿äºviewçš„ã€‚<br>å¯¹äºactivityæ¥è¯´ï¼Œæˆ‘ä»¬é€šè¿‡setContentViewæ·»åŠ çš„å¸ƒå±€åˆ°activityä¸Šï¼Œå®é™…ä¸Šéƒ½æ˜¯æ·»åŠ åˆ°äº†activityå†…éƒ¨çš„decorviewä¸Šé¢ï¼Œè¿™ä¸ªDecorViewï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªFrameLayoutï¼Œå› æ­¤å®é™…ä¸Šï¼Œæˆ‘ä»¬çš„å¸ƒå±€æ˜¯æ·»åŠ åˆ°äº†FrameLayouté‡Œé¢ã€‚</p>
<h2 id="Viewç»˜åˆ¶çš„ä¸‰ä¸ªæµç¨‹"><a href="#Viewç»˜åˆ¶çš„ä¸‰ä¸ªæµç¨‹" class="headerlink" title="Viewç»˜åˆ¶çš„ä¸‰ä¸ªæµç¨‹"></a>Viewç»˜åˆ¶çš„ä¸‰ä¸ªæµç¨‹</h2><p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨è‡ªå®šä¹‰viewçš„æ—¶å€™ä¸€èˆ¬éœ€è¦é‡å†™çˆ¶ç±»çš„onMeasure()ã€onLayout()ã€onDraw()ä¸‰ä¸ªæ–¹æ³•ï¼Œæ¥å®Œæˆè§†å›¾çš„å±•ç¤ºè¿‡ç¨‹ã€‚å½“ç„¶ï¼Œè¿™ä¸‰ä¸ªæš´éœ²ç»™å¼€å‘è€…é‡å†™çš„æ–¹æ³•åªä¸è¿‡æ˜¯æ•´ä¸ªç»˜åˆ¶æµç¨‹çš„å†°å±±ä¸€è§’ï¼Œæ›´å¤šå¤æ‚çš„å¹•åå·¥ä½œï¼Œéƒ½è®©ç³»ç»Ÿç»™ä»£åŠ³äº†ï¼Œä¸€ä¸ªå®Œæ•´çš„ç»˜åˆ¶æµç¨‹åŒ…æ‹¬measureã€layoutã€drawä¸‰ä¸ªæ­¥éª¤ï¼Œå…¶ä¸­ï¼š<br>measureï¼šæµ‹é‡ã€‚ç³»ç»Ÿä¼šç°æ ¹æ®xmlå¸ƒå±€æ–‡ä»¶å’Œä»£ç ä¸­å¯¹æ§ä»¶å±æ€§çš„è®¾ç½®ï¼Œæ¥è·å–æˆ–è€…è®¡ç®—å‡ºæ¯ä¸ªviewå’Œviewgroupçš„å°ºå¯¸ï¼Œå¹¶å°†è¿™äº›å°ºå¯¸ä¿å­˜ä¸‹æ¥ã€‚<br>layoutï¼šå¸ƒå±€ã€‚æ ¹æ®æµ‹é‡å‡ºçš„ç»“æœä»¥åŠå¯¹åº”çš„å‚æ•°ï¼Œæ¥ç¡®å®šæ¯ä¸€ä¸ªæ§ä»¶åº”è¯¥æ˜¾ç¤ºçš„ä½ç½®ã€‚<br>drawï¼šç»˜åˆ¶ã€‚ç¡®å®šå¥½ä½ç½®åï¼Œå°±å°†è¿™äº›æ§ä»¶ç»˜åˆ¶åˆ°å±å¹•ä¸Šã€‚</p>
<h2 id="Androidè§†å›¾å±‚æ¬¡ç»“æœç®€ä»‹"><a href="#Androidè§†å›¾å±‚æ¬¡ç»“æœç®€ä»‹" class="headerlink" title="Androidè§†å›¾å±‚æ¬¡ç»“æœç®€ä»‹"></a>Androidè§†å›¾å±‚æ¬¡ç»“æœç®€ä»‹</h2><p>åœ¨ä»‹ç»viewç»˜åˆ¶æµç¨‹ä¹‹é—´ï¼Œå’±ä»¬å…ˆæ¥å•ä»‹ç»ä¸€ä¸‹Androidè§†å›¾å±‚æ¬¡ç»“æœä»¥åŠDecorViewå› ä¸ºviewçš„ç»˜åˆ¶æµç¨‹çš„å…¥å£å’ŒDecorViewæœ‰ç€å¯†åˆ‡çš„è”ç³»ã€‚</p>
<p>å’±ä»¬å¹³æ—¶çœ‹åˆ°çš„è§†å›¾ï¼Œå…¶å®å­˜åœ¨å¦‚ä¸Šçš„åµŒå¥—å…³ç³»ã€‚ä¸Šå›¾æ˜¯é’ˆå¯¹æ¯”è¾ƒè€çš„Androidç³»ç»Ÿç‰ˆæœ¬ä¸­åˆ¶ä½œçš„ï¼Œæ–°çš„ç‰ˆæœ¬ä¸­ä¼šç•¥æœ‰å‡ºå…¥ï¼Œè¿˜æœ‰ä¸€ä¸ªçŠ¶æ€æ ï¼Œä½†æ•´ä½“ä¸Šæ²¡å˜ã€‚æˆ‘ä»¬å¹³æ—¶åœ¨activityä¸­setContentView(â€¦)ä¸­å¯¹åº”layoutå†…å®¹ï¼Œå¯¹åº”çš„æ˜¯ä¸Šå›¾ä¸­viewgropçš„æ ‘çŠ¶ç»“æ„ï¼Œå®é™…ä¸Šæ·»åŠ åˆ°ç³»ç»Ÿä¸­æ—¶ï¼Œä¼šå†è£¹ä¸Šä¸€å±‚FrameLayoutï¼Œå°±æ˜¯ä¸Šå›¾ä¸­æœ€é‡Œé¢çš„æµ…è“è‰²éƒ¨åˆ†ã€‚<br>è¿™é‡Œå’±ä»¬å†é€šè¿‡ä¸€ä¸ªå®ä¾‹æ¥ç»§ç»­æŸ¥çœ‹ã€‚Androidstudioå·¥å…·ä¸­æä¾›äº†ä¸€ä¸ªå¸ƒå±€è§‚å¯ŸæœŸå·¥å…·ï¼Œé€šè¿‡Tools &gt; android &gt; layout Inspectorå¯ä»¥æŸ¥çœ‹å…·ä½“æŸä¸ªactivityçš„å¸ƒå±€æƒ…å†µã€‚ä¸‹å›¾ä¸­ï¼Œå·¦è¾¹æ ‘çŠ¶ç»“æœå¯¹åº”äº†å³è¾¹çš„å¯è§†å›¾ï¼Œå¯è§DecorViewå°±æ˜¯æ•´ä¸ªç•Œé¢çš„æ ¹è§†å›¾ï¼Œå¯¹åº”å³è¾¹çš„çº¢è‰²æ¡†ï¼Œæ˜¯æ•´ä¸ªå±å¹•çš„å¤§å°ã€‚é»„è‰²è¾¹æ¡†ä¸ºçŠ¶æ€æ éƒ¨åˆ†ï¼›é‚£ä¸ªç»¿è‰²è¾¹æ¡†ä¸­æœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ªæ˜¯ç™½æ¡†ä¸­çš„actionBarï¼Œå¯¹åº”äº†ä¸Šå›¾ä¸­ç´«è‰²éƒ¨åˆ†çš„TitleActionBaréƒ¨åˆ†ï¼Œå³æ ‡é¢˜æ ï¼Œå¹³æ—¶å’±ä»¬å¯ä»¥åœ¨activityä¸­å°†å…¶éšè—æ‰ï¼›å¦å¤–ä¸€ä¸ªè“è‰²è¾¹æ¡†éƒ¨åˆ†ï¼Œå¯¹åº”ä¸Šå›¾ä¸­æœ€é‡Œé¢çš„è“è‰²éƒ¨åˆ†ï¼Œå³contentviewéƒ¨åˆ†ï¼Œä¸‹å›¾ä¸­å·¦è¾¹æœ‰ä¸¤ä¸ªè“è‰²æ¡†ï¼Œä¸Šé¢é‚£ä¸ªä¸­æœ‰ä¸ªå¸ƒå±€â€content_layoutâ€ï¼Œå’±ä»¬èƒ½é€šè¿‡layoutå¸ƒå±€æ–‡ä»¶ç›´æ¥å®Œå…¨æ“ä½œçš„ä¹Ÿå°±æ˜¯è¿™ä¸€å—ï¼Œå½“å…¶è¢«addåˆ°è§†å›¾ç³»ç»Ÿä¸­æ—¶ï¼Œä¼šè¢«è¿‡ä¸ŠcontentFramelayoutï¼ˆæ˜¾ç„¶æ˜¯FrameLayoutçš„å­ç±»ï¼‰ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæ·»åŠ åˆ°layout.xmlè§†å›¾çš„æ–¹æ³•å«setContentView()è€Œä¸å«setView()çš„åŸå› äº†ã€‚</p>
<h2 id="æ•…äº‹å¼€å§‹çš„åœ°æ–¹"><a href="#æ•…äº‹å¼€å§‹çš„åœ°æ–¹" class="headerlink" title="æ•…äº‹å¼€å§‹çš„åœ°æ–¹"></a>æ•…äº‹å¼€å§‹çš„åœ°æ–¹</h2><p>å¦‚æœå¯¹activityçš„å¯åŠ¨æµç¨‹æœ‰ä¸€å®šçš„äº†è§£çš„è¯ï¼Œåº”è¯¥çŸ¥é“è¿™ä¸ªå¯åŠ¨ä¼šåœ¨activityThread.javaç±»ä¸­å®Œæˆï¼Œåœ¨å¯åŠ¨activityçš„è¿‡ç¨‹ä¸­ï¼Œä¼šè°ƒç”¨handleResumeActivity()æ–¹æ³•ï¼Œå…³äºè§†å›¾çš„ç»˜åˆ¶è¿‡ç¨‹æœ€åˆå°±æ˜¯ä»è¿™ä¸ªæ–¹æ³•å¼€å§‹çš„ã€‚</p>
<h3 id="1-viewç»˜åˆ¶èµ·æºUMLæ—¶åºå›¾"><a href="#1-viewç»˜åˆ¶èµ·æºUMLæ—¶åºå›¾" class="headerlink" title="1.viewç»˜åˆ¶èµ·æºUMLæ—¶åºå›¾"></a>1.viewç»˜åˆ¶èµ·æºUMLæ—¶åºå›¾</h3><p>æ•´ä¸ªè°ƒç”¨é“¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒçŸ¥é“ViewRootImplç±»ä¸­çš„performTraversals()ä¸­ï¼Œæ‰æ­£å¼å¼€å§‹ç»˜åˆ¶æµç¨‹äº†ï¼Œæ‰€ä»¥ä¸€èˆ¬éƒ½æ˜¯ä»¥è¯¥æ–¹æ³•ä½œä¸ºæ­£å¼ç»˜åˆ¶çš„æºå¤´ã€‚</p>
<h3 id="2-handResumeActivity-æ–¹æ³•"><a href="#2-handResumeActivity-æ–¹æ³•" class="headerlink" title="2.handResumeActivity()æ–¹æ³•"></a>2.handResumeActivity()æ–¹æ³•</h3><p>åœ¨è¿™å…ˆå¤§è‡´çœ‹ä¸€ä¸‹ActivityThreadç±»ä¸­çš„handleResumeActivityæ–¹æ³•ï¼Œå’±ä»¬è¿™é‡Œåªè´´å‡ºå…³é”®ä»£ç ï¼š<br><code>//===========ActivityThread.java========== final void handleResumeActivity(...) &#123;     ......     //è·Ÿè¸ªä»£ç åå‘ç°å…¶åˆå§‹èµ‹å€¼ä¸ºmWindow = new PhoneWindow(this, window, activityConfigCallback);     r.window = r.activity.getWindow();        //ä»PhoneWindowå®ä¾‹ä¸­è·å–DecorView     View decor = r.window.getDecorView();     ......     //è·Ÿè¸ªä»£ç åå‘ç°ï¼Œvmå€¼ä¸ºä¸Šè¿°PhoneWindowå®ä¾‹ä¸­è·å–çš„WindowManagerã€‚     ViewManager wm = a.getWindowManager();     ......     //å½“å‰windowçš„å±æ€§ï¼Œä»ä»£ç è·Ÿè¸ªæ¥çœ‹æ˜¯PhoneWindowçª—å£çš„å±æ€§     WindowManager.LayoutParams l = r.window.getAttributes();     ......     wm.addView(decor, l);     ...... &#125;</code><br>ä¸Šè¿°ä»£ç ç¬¬å…«è¡Œä¸­ï¼ŒViewManageræ˜¯ä¸€ä¸ªæ¥å£ï¼ŒaddViewæ˜¯å…¶ä¸­å®šä¹‰ä¸€ä¸ªç©ºæ–¹æ³•ï¼ŒWindowManageræ˜¯å…¶å­ç±»ï¼ŒWindowManagerImplæ˜¯WindowManagerçš„å®ç°ç±»ï¼Œåœ¨ç¬¬å››è¡Œä»£ç ä¸­çš„r.windowçš„å€¼å¯ä»¥æ ¹æ®Activity.javaçš„å¦‚ä¸‹ä»£ç å¾—çŸ¥ï¼Œå…¶å€¼ä¸ºPhoneWindowå®ä¾‹ã€‚<br>&#96;&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;Activity.java&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>private Window mWindow;<br>public Window getWindow() {<br>   return mWindow;<br>}</p>
<p>final void attach(â€¦){<br>   â€¦â€¦<br>   mWindow &#x3D; new PhoneWindow(this, window, activityConfigCallback);<br>   â€¦â€¦<br>}&#96;</p>
<h3 id="3-ä¸¤ä¸ªé‡è¦å‚æ•°åˆ†æ"><a href="#3-ä¸¤ä¸ªé‡è¦å‚æ•°åˆ†æ" class="headerlink" title="3.ä¸¤ä¸ªé‡è¦å‚æ•°åˆ†æ"></a>3.ä¸¤ä¸ªé‡è¦å‚æ•°åˆ†æ</h3><p>ä¹‹æ‰€ä»¥è¦åœ¨è¿™é‡Œç‰¹æ„åˆ†æhandleResumeActivity()æ–¹æ³•ï¼Œé™¤äº†å› ä¸ºå®ƒæ˜¯æ•´ä¸ªç»˜åˆ¶æµç¨‹çš„æœ€åˆæºå¤´å¤–ï¼Œè¿˜æœ‰å°±æ˜¯addViewçš„ä¸¤ä¸ªå‚æ•°æ¯”è¾ƒé‡è¦ï¼Œå®ƒä»¬ç»è¿‡ä¸€å±‚ä¸€å±‚ä¼ é€’åè¿›å…¥åˆ°ViewRootImplä¸­ï¼Œåœ¨åé¢åˆ†æç»˜åˆ¶ä¸­è¦ç”¨åˆ°ã€‚è¿™é‡Œå†çœ‹çœ‹è¿™ä¸¤ä¸ªå‚æ•°çš„ç›¸å…³ä¿¡æ¯ï¼š<br>ï¼ˆ1ï¼‰å‚æ•°dector<br>&#96;&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;Activity.java&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>private Window mWindow;<br>public Window getWindow() {<br>   return mWindow;<br>}</p>
<p>final void attach(â€¦){<br>   â€¦â€¦<br>   mWindow &#x3D; new PhoneWindow(this, window, activityConfigCallback);<br>   â€¦â€¦<br>}<code>å¯è§decorå‚æ•°è¡¨ç¤ºçš„æ˜¯DecorViewå®ä¾‹ï¼Œæ³¨é‡Šä¸­ä¹Ÿæœ‰è¯´æ˜ï¼šè¿™æ˜¯windowçš„é¡¶çº§è§†å›¾ï¼ŒåŒ…å«äº†windowçš„decor ï¼ˆ2ï¼‰å‚æ•°l</code>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;Window.java&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>&#x2F;&#x2F;The current window attributes.<br>    private final WindowManager.LayoutParams mWindowAttributes &#x3D;<br>        new WindowManager.LayoutParams();<br>â€¦â€¦<br>public final WindowManager.LayoutParams getAttributes() {<br>        return mWindowAttributes;<br>    }<br>â€¦â€¦</p>
<p>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;WindowManager.javaçš„å†…éƒ¨ç±»LayoutParams extends ViewGroup.LayoutParams&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>public LayoutParams() {<br>            super(LayoutParams.MATCH_PARENT, LayoutParams.MATCH_PARENT);<br>            â€¦â€¦<br>        }</p>
<p>&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;ViewGroup.javaå†…éƒ¨ç±»LayoutParams&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>public LayoutParams(int width, int height) {<br>            this.width &#x3D; width;<br>            this.height &#x3D; height;<br>        }&#96;<br>è¯¥å‚æ•°è¡¨ç¤ºçš„æ˜¯PhoneWindowçš„LayoutParamså±æ€§ï¼Œå…¶widthå’Œheightå€¼å‡ä¸ºLayoutParmas.MATCH_PARENTã€‚<br>åœ¨æºç ä¸­ï¼ŒWindowPhoneå’ŒDecorViewé€šè¿‡ç»„åˆæ–¹æ³•è”ç³»åœ¨ä¸€èµ·çš„ï¼Œè€ŒDecorViewæ˜¯æ•´ä¸ªViewä½“ç³»çš„æ ¹Viewã€‚åœ¨å‰é¢handleResumeActivity()æ–¹æ³•ä»£ç ç‰‡æ®µä¸­ï¼Œå½“Activityå¯åŠ¨åï¼Œå°±é€šè¿‡ç¬¬14è¡Œçš„addViewæ–¹æ³•ï¼Œæ¥é—´æ¥è°ƒç”¨ViewRootImplç±»ä¸­çš„performTraversals()ï¼Œä»è€Œå®ç°è§†å›¾çš„ç»˜åˆ¶ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>APPæ€§èƒ½ä¼˜åŒ–çš„ä¸€äº›å»ºè®®</title>
    <url>/2022/10/15/APP%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E4%B8%80%E4%BA%9B%E5%BB%BA%E8%AE%AE/</url>
    <content><![CDATA[<p>é™¤äº†åˆ©ç”¨æ€§èƒ½æµ‹è¯•å·¥å…·åˆ†ææ€§èƒ½åº”ç”¨ï¼Œå¯»æ‰¾ä¼˜åŒ–æ§ä»¶ï¼Œå¼€å‘è€…åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå°±åº”è¯¥æ³¨æ„ä¸€äº›æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼Œå…»æˆè‰¯å¥½çš„å¼€å‘ä¹ æƒ¯ï¼Œå‡è½»æ€§èƒ½ä¼˜åŒ–çš„è´Ÿæ‹…ã€‚ä¸‹é¢æ˜¯ä¸€äº›ä¼˜åŒ–å»ºè®®ï¼š</p>
<span id="more"></span>
<p>1.åœ¨LinearLayoutå’ŒRelativeLayoutéƒ½å¯ä»¥å®Œæˆå¸ƒå±€çš„æƒ…å†µä¸‹ä¼˜å…ˆé€‰æ‹©LinearLayoutï¼Œå¯ä»¥å‡å°‘Viewçš„å±‚çº§ï¼Œä½†æ˜¯æ³¨æ„ç›¸åŒç»„ä»¶å¯èƒ½RelativeLayoutç»˜åˆ¶æ—¶é—´é•¿<br>2.onDrawä¸­ä¸è¦åˆ›å»ºæ–°çš„å±€éƒ¨å¯¹è±¡ï¼ŒonDrawæ–¹æ³•ä¸­ä¸è¦åšè€—æ—¶çš„ä»»åŠ¡<br>3.ä¸è¦åœ¨ä¸»çº¿ç¨‹è¿›è¡Œç½‘ç»œè®¿é—®&#x2F;å¤§æ–‡ä»¶çš„IOæ“ä½œ<br>4.ç»˜åˆ¶UIæ—¶ï¼Œå°½é‡å‡å°‘ç»˜åˆ¶UIå±‚æ¬¡ï¼›å‡å°‘ä¸å¿…è¦çš„viewåµŒå¥—<br>5.å½“æˆ‘ä»¬çš„å¸ƒå±€æ˜¯ç”¨çš„FrameLayoutçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒæ”¹æˆmergeï¼Œå¯ä»¥é¿å…è‡ªå·±çš„å¸§å¸ƒå±€å’Œç³»ç»Ÿçš„ContentFrameLayoutå¸§å¸ƒå±€é‡å é€ æˆé‡å¤è®¡ç®—ï¼ˆmeasureå’Œlayoutï¼‰<br>6.åœ¨viewå±‚çº§ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œå°½é‡ä½¿ç”¨LinearLayoutè€Œä¸æ˜¯RelativeLayoutï¼›å› ä¸ºRelativeLayoutåœ¨æµ‹é‡çš„æ—¶å€™ä¼šæµ‹é‡ä¸¤æ¬¡ï¼Œè€ŒLinearLayoutæµ‹é‡ä¸€æ¬¡<br>7.åˆ é™¤æ§ä»¶ä¸­æ— ç”¨çš„å±æ€§<br>8.å¸ƒå±€å¤ç”¨ï¼Œæ¯”å¦‚listviewå¸ƒå±€å¤ç”¨<br>9.å°½é‡é¿å…è¿‡åº¦ç»˜åˆ¶ï¼ˆoverdrawï¼‰æ¯”å¦‚ï¼šèƒŒæ™¯ç»å¸¸å®¹æ˜“é€ æˆè¿‡åº¦ç»˜åˆ¶ï¼Œç”±äºæˆ‘ä»¬å¸ƒå±€è®¾ç½®äº†èƒŒæ™¯ï¼Œæº¶èš€ç”¨åˆ°MaterialDesignçš„ä¸»é¢˜ä¼šé»˜è®¤ç»™ä¸€ä¸ªèƒŒæ™¯ã€‚è¿™æ—¶åº”è¯¥æŠŠä¸»é¢˜æ·»åŠ çš„èƒŒæ™¯å»æ‰ï¼›è¿˜æœ‰ç§»é™¤XMLä¸­éå¿…é¡»çš„èƒŒæ™¯<br>10.è‡ªå®šä¹‰viewä¼˜åŒ–ï¼Œä½¿ç”¨canvas.clipRect()æ¥å¸®åŠ©ç³»ç»Ÿè¯†åˆ«é‚£äº›å¯è§çš„åŒºåŸŸï¼Œåªæœ‰åœ¨è¿™ä¸ªåŒºåŸŸå†…æ‰ä¼šè¢«ç»˜åˆ¶ã€‚ä¹Ÿæ˜¯é¿å…è¿‡åº¦ç»˜åˆ¶ã€‚<br>11.å¯åŠ¨ä¼˜åŒ–ï¼Œå¯åŠ¨é€Ÿåº¦çš„ç›‘æ§ï¼Œå‘ç°å½±å“å¯åŠ¨é€Ÿåº¦çš„é—®é¢˜æ‰€åœ¨ï¼Œä¼˜åŒ–å¯åŠ¨é€»è¾‘ï¼Œæé«˜åº”ç”¨çš„å¯åŠ¨é€Ÿåº¦ã€‚æ¯”å¦‚é—ªå±é¡µé¢ï¼Œåˆç†ä¼˜åŒ–å¸ƒå±€ï¼ŒåŠ è½½é€»è¾‘ä¼˜åŒ–ï¼Œæ•°æ®å‡†å¤‡ã€‚<br>12.åˆç†çš„åˆ·æ–°æœºåˆ¶ï¼Œå°½é‡å‡å°‘åˆ·æ–°æ¬¡æ•°ï¼Œå°½é‡é¿å…åå°æœ‰é«˜çš„CPUçº¿ç¨‹è¿è¡Œï¼Œç¼©å°åˆ·æ–°åŒºåŸŸã€‚</p>
]]></content>
      <categories>
        <category>android</category>
      </categories>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Androidä¹‹ç¢ç‰‡Fragment</title>
    <url>/2022/12/11/Android%E4%B9%8B%E7%A2%8E%E7%89%87Fragment/</url>
    <content><![CDATA[<p>å®‰å“è‡ª3.0å¼€å§‹å¼•å…¥Fragmentçš„æ¦‚å¿µï¼Œä¸»è¦æ˜¯ä¸ºäº†èƒ½åœ¨ä¸åŒåˆ†è¾¨ç‡çš„å±å¹•ä¸Šè¿›è¡Œæ›´ä¸ºåŠ¨æ€å’Œçµæ´»çš„UIè®¾è®¡ï¼Œè®©ç¨‹åºæ›´åŠ åˆç†å’Œå……åˆ†åˆ©ç”¨å¤§å±å¹•ç©ºé—´ã€‚</p>
<span id="more"></span>
<p>æœ¬ç¯‡å°†å­¦ä¹ Fragmentä»¥ä¸‹å‡ ä¸ªçŸ¥è¯†ç‚¹ï¼š<br>Fragmentæ¦‚è¦<br>Fragmentç”Ÿå‘½å‘¨æœŸ<br>åŠ è½½Fragmentæ–¹æ³•</p>
<pre><code>é™æ€åŠ è½½
åŠ¨æ€åŠ è½½
</code></pre>
<p>Fragmentä¸Activityä¹‹é—´é€šä¿¡</p>
<h3 id="1-Fragmentæ¦‚è¦"><a href="#1-Fragmentæ¦‚è¦" class="headerlink" title="1.Fragmentæ¦‚è¦"></a>1.Fragmentæ¦‚è¦</h3><p>å­¦ä¹ Fragmentçš„æ—¶å€™å¯ä»¥è”ç³»ä¹‹å‰å­¦ä¹ è¿‡çš„Activityï¼Œå› ä¸ºå®ƒä»¬æœ‰å¾ˆå¤šç›¸ä¼¼ç‚¹ï¼šéƒ½å¯åŒ…å«å¸ƒå±€ï¼Œæœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼ŒFragmentå¯çœ‹ä¼¼è¿·ä½ æ´»åŠ¨ã€‚æ­£å¦‚Fragmentçš„åå­—ä¸€æ ·â€“ç¢ç‰‡ï¼Œå®ƒçš„å‡ºç°æ˜¯ä¸ºäº†è§£å†³Androidç¢ç‰‡åŒ–ï¼Œå®ƒå¯ä»¥ä½œä¸ºActivityç•Œé¢çš„ç»„æˆéƒ¨åˆ†ï¼Œå¯åœ¨Activityè¿è¡Œä¸­å®ç°åŠ¨æ€åœ°åŠ å…¥ã€ç§»é™¤å’Œäº¤æ¢ã€‚ä¸€ä¸ªActivityä¸­å¯åŒæ—¶å‡ºç°å¤šä¸ªFragmentï¼Œä¸€ä¸ªFragmentä¹Ÿå¯åœ¨å¤šä¸ªActivityä¸­ä½¿ç”¨ã€‚æ´»åŠ¨å’Œç¢ç‰‡åƒæäº†å¤«å¦»ï¼Œè™½ç„¶ç´§å¯†è”ç³»ä½†æ˜¯åˆæœ‰ç‹¬ç«‹ç©ºé—´ï¼Œåœ¨ä¸€èµ·è®©å½¼æ­¤å˜å¾—æ›´å¥½ã€‚<br><a href="https://imgse.com/i/zhthRK"><img src="https://s1.ax1x.com/2022/12/11/zhthRK.jpg" alt="zhthRK.jpg"></a></p>
<h3 id="2-Fragmentç”Ÿå‘½å‘¨æœŸ"><a href="#2-Fragmentç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="2.Fragmentç”Ÿå‘½å‘¨æœŸ"></a>2.Fragmentç”Ÿå‘½å‘¨æœŸ</h3><p><a href="https://imgse.com/i/zhtose"><img src="https://s1.ax1x.com/2022/12/11/zhtose.jpg" alt="zhtose.jpg"></a><br>æ˜¯ä¸æ˜¯å‘ç°Fragmentå’ŒActivityçš„ç”Ÿå‘½å‘¨æœŸå¤ªç›¸ä¼¼äº†ï¼Œç°åœ¨åªéœ€è¦å†ä»‹ç»å‡ ä¸ªActivityä¸­æ²¡è®²è¿‡çš„å‡ ä¸ªæ–°æ–¹æ³•ï¼š<br>onAttach()ï¼šå½“Fragmentå’ŒActivityå»ºç«‹å…³è”æ—¶è°ƒç”¨<br>onCreateView()ï¼šå½“Fragmentåˆ›å»ºè§†å›¾çš„æ—¶å€™è°ƒç”¨<br>onActivityCreated()ï¼šå½“ä¸Fragmentç›¸å…³è”çš„Activityå®ŒæˆonCreate()ä¹‹åè°ƒç”¨<br>onDestoryView()ï¼šå½“Fragmentä¸­çš„å¸ƒå±€è¢«ç§»é™¤çš„æ—¶å€™è°ƒç”¨<br>onDetach()ï¼šå½“Fragmentå’ŒActivityè§£é™¤å…³è”æ—¶è°ƒç”¨</p>
<p>åœ¨ä¸Šå›¾ä¸­ç”»äº†å‡ æ¡çº¿ï¼Œå¯ä»¥çœ‹åˆ°Fragmentå‘¨æœŸä¸­çš„çŠ¶æ€å‡ ä¹éƒ½æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œæ‰€ä»¥ä¸éš¾ç†è§£ä¸‹å›¾å‡ ç§å˜åŒ–ä¸‹Fragmentç”Ÿå‘½å‘¨æœŸæ–¹æ³•çš„è°ƒç”¨é¡ºåºäº†ã€‚<br><a href="https://imgse.com/i/zhNion"><img src="https://s1.ax1x.com/2022/12/11/zhNion.jpg" alt="zhNion.jpg"></a></p>
<p>åŠ è½½åˆ°Activityä¸­Fragmentåœ¨å„ç§å˜åŒ–ä¸‹æ–¹æ³•çš„è°ƒç”¨é¡ºåºæ›´å€¼å¾—æ³¨æ„ã€‚éœ€è¦æä¸€å¥çš„æ˜¯ï¼ŒActivityçš„FragmentManagerè´Ÿè´£è°ƒç”¨é˜Ÿåˆ—ä¸­Fragmentçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œåªè¦Fragmentçš„çŠ¶æ€ä¸Activityçš„çŠ¶æ€ä¿æŒäº†åŒæ­¥ï¼Œæ‰˜ç®¡Activityçš„Fragmentä¾¿ä¼šç»§ç»­è°ƒç”¨å…¶ä»–ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä»¥ç»§ç»­ä¿æŒFragmentä¸Activityçš„çŠ¶æ€ä¸€è‡´<br><a href="https://imgse.com/i/zhjBs1"><img src="https://s1.ax1x.com/2022/12/12/zhjBs1.jpg" alt="zhjBs1.jpg"></a><br>Fragmentç”Ÿå‘½å‘¨æœŸä¸Activityç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªå…³é”®å°±åœ¨äºï¼ŒFragmentçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æ˜¯ç”±æ‰˜ç®¡Activityè€Œä¸æ˜¯æ“ä½œç³»ç»Ÿè°ƒç”¨çš„ã€‚Activityä¸­ç”Ÿå‘½å‘¨æœŸéƒ½æ˜¯protectedï¼Œè€ŒFragmentéƒ½æ˜¯publicï¼Œä¹Ÿèƒ½å°è¯è¿™ä¸€ç‚¹ï¼Œå› ä¸ºActivityéœ€è¦è°ƒç”¨Fragmenté‚£äº›æ–¹æ³•å¹¶ç®¡ç†å®ƒ</p>
<h3 id="3-åŠ è½½Fragmentæ–¹æ³•"><a href="#3-åŠ è½½Fragmentæ–¹æ³•" class="headerlink" title="3.åŠ è½½Fragmentæ–¹æ³•"></a>3.åŠ è½½Fragmentæ–¹æ³•</h3><p>ç°åœ¨æ¥å­¦ä¹ å¦‚ä½•åœ¨Activityä¸­åŠ è½½Fragment<br>é™æ€åŠ è½½Fragmentå¤§è‡´è¿‡ç¨‹å¦‚å›¾ï¼Œåˆ†æˆå››æ­¥ï¼š<br><a href="https://imgse.com/i/zhvASJ"><img src="https://s1.ax1x.com/2022/12/12/zhvASJ.jpg" alt="zhvASJ.jpg"></a><br>ä¸‹é¢é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ„Ÿå—Fragmenté™æ€åŠ è½½åˆ°Activityçš„è¿‡ç¨‹ã€‚<br>ç¬¬ä¸€æ­¥ï¼šæ–°å»ºfrag_layout.xmlï¼Œä¸ºFragmentæŒ‡å®šä¸€ä¸ªå¸ƒå±€ï¼Œè¿™é‡Œç®€å•çš„æ”¾ä¸€ä¸ªTextviewå’Œä¸€ä¸ªButtonã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    tools:context=&quot;.MyFragment&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/text&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;è¿™æ˜¯ä¸€ä¸ªFragment&quot;</span><br><span class="line">        android:textSize=&quot;20sp&quot;</span><br><span class="line">        android:textColor=&quot;#000000&quot;</span><br><span class="line">        android:gravity=&quot;center&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:id=&quot;@+id/frg_btn&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;ç‚¹å‡»&quot;</span><br><span class="line">        android:textSize=&quot;20sp&quot; /&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒæ­¥ï¼šæ–°å»ºä¸€ä¸ªMyFragmentç±»å¹¶ç»§æ‰¿Fragmentï¼Œè¿™é‡Œå¼•ç”¨Android.appåŒ…ä¸‹çš„å°±å¯ä»¥ï¼Œå¦ä¸€ä¸ªåŒ…ä¸‹ä¸»è¦ç”¨äºå…¼å®¹ä½ç‰ˆæœ¬çš„å®‰å“ç³»ç»Ÿã€‚ç„¶åé‡å†™onCreateView()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•é‡Œé€šè¿‡LayoutInflaterçš„inflate()æ–¹æ³•å°†åˆšåˆšå®šä¹‰çš„frag_layoutå¸ƒå±€åŠ è½½è¿›æ¥å¹¶å¾—åˆ°ä¸€ä¸ªViewï¼Œå†returnè¿™ä¸ªViewã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class MyFragment extends Fragment &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public View onCreateView(LayoutInflater inflater, ViewGroup container,</span><br><span class="line">                             Bundle savedInstanceState) &#123;</span><br><span class="line">        /**</span><br><span class="line">         * resourceï¼šfragmentéœ€è¦åŠ è½½çš„å¸ƒå±€æ”¯æŒ</span><br><span class="line">         * rootï¼šåŠ è½½layoutçš„çˆ¶ViewGroup</span><br><span class="line">         * attachGroupï¼šfalseè¡¨ç¤ºä¸åæ‚”çˆ¶ViewGroup</span><br><span class="line">         */</span><br><span class="line">        return inflater.inflate(R.layout.fragment_my, container, false);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸‰æ­¥ï¼šæ–°å»ºmain.xmlï¼Œä½œä¸ºActivityçš„å¸ƒå±€ï¼Œä½¿ç”¨&lt;fragment&gt;æ ‡ç­¾æ·»åŠ ç¢ç‰‡ï¼Œå¹¶ä¸”ä¸€å®šè¦æœ‰android:nameå±æ€§ä¸”å€¼ä¸ºè¢«åŠ è½½çš„Fragmentç±»çš„åŒ…å.ç±»åå®Œæ•´å½¢å¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    tools:context=&quot;.FragmentActivity&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:id=&quot;@+id/layout&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:orientation=&quot;horizontal&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--è¿™æ˜¯é™æ€è°ƒç”¨çš„æ–¹å¼--&gt;</span><br><span class="line">        &lt;fragment</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:id=&quot;@+id/fragment&quot;</span><br><span class="line">            android:name=&quot;com.thefu.androidstudyproject.MyFragment&quot; /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>

<p>ç¬¬å››æ­¥ï¼šå†MainActivityä¸­åŠ è½½mainå¸ƒå±€ï¼Œç°åœ¨MyFragmentå°±å®Œæˆäº†é™æ€åŠ è½½åˆ°MainActivityä¸­ï¼Œè¿™æ—¶ç¢ç‰‡é‡Œçš„æ§ä»¶è‡ªç„¶ä¹Ÿæ˜¯æ´»åŠ¨çš„ä¸€ä¸ªéƒ¨åˆ†ï¼Œå¯ç›´æ¥å†æ´»åŠ¨ä¸­è·å–åˆ°Buttonçš„å®ä¾‹ï¼Œæ¥æ³¨å†Œç‚¹å‡»äº‹ä»¶äº†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">private Button frag_btn;</span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        //é™æ€åŠ è½½</span><br><span class="line">        setContentView(R.layout.activity_ftagment);</span><br><span class="line">        frag_btn = findViewById(R.id.frg_btn);</span><br><span class="line">        frag_btn.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View view) &#123;</span><br><span class="line">                Toast.makeText(FragmentActivity.this, &quot;æ‚¨ç‚¹å‡»äº†æŒ‰é’®&quot;, Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<h2 id="ï¼ˆ2ï¼‰åŠ¨æ€åŠ è½½ï¼šåœ¨æ‰˜ç®¡Activityé€šè¿‡ä»£ç åŠ¨æ€æ·»åŠ "><a href="#ï¼ˆ2ï¼‰åŠ¨æ€åŠ è½½ï¼šåœ¨æ‰˜ç®¡Activityé€šè¿‡ä»£ç åŠ¨æ€æ·»åŠ " class="headerlink" title="ï¼ˆ2ï¼‰åŠ¨æ€åŠ è½½ï¼šåœ¨æ‰˜ç®¡Activityé€šè¿‡ä»£ç åŠ¨æ€æ·»åŠ "></a>ï¼ˆ2ï¼‰åŠ¨æ€åŠ è½½ï¼šåœ¨æ‰˜ç®¡Activityé€šè¿‡ä»£ç åŠ¨æ€æ·»åŠ </h2><p>åŠ¨æ€åŠ è½½çš„ä»£ç ä¹Ÿéå¸¸ç®€å•ï¼Œç›´æ¥çœ‹ä¾‹å­ï¼Œä¿®æ”¹main.xmlï¼Œå°†æ•´ä¸ª&lt;fragment&gt;åˆ æ‰ã€‚ä½†å®³ä¿ç•™ä¸€ä¸ªLinearLayoutçš„ç©ºé—´å¹¶ä¸”è¿˜ç»™äº†idã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    tools:context=&quot;.FragmentActivity&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:id=&quot;@+id/layout&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:orientation=&quot;horizontal&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--è¿™æ˜¯é™æ€è°ƒç”¨çš„æ–¹å¼--&gt;</span><br><span class="line">&lt;!--        &lt;fragment--&gt;</span><br><span class="line">&lt;!--            android:layout_width=&quot;match_parent&quot;--&gt;</span><br><span class="line">&lt;!--            android:layout_height=&quot;match_parent&quot;--&gt;</span><br><span class="line">&lt;!--            android:id=&quot;@+id/fragment&quot;--&gt;</span><br><span class="line">&lt;!--            android:name=&quot;com.thefu.androidstudyproject.MyFragment&quot; /&gt;--&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥åœ¨MainActivityä¸­æ·»åŠ ä»£ç ï¼š<br>public class FragmentActivity extends AppCompatActivity {</p>
<pre><code>private Button frag_btn;
private LinearLayout linearLayout;
@Override
protected void onCreate(Bundle savedInstanceState) &#123;
    super.onCreate(savedInstanceState);
    //é™æ€åŠ è½½
    setContentView(R.layout.activity_ftagment);
</code></pre>
<p>&#x2F;&#x2F;        frag_btn &#x3D; findViewById(R.id.frg_btn);<br>&#x2F;&#x2F;        frag_btn.setOnClickListener(new View.OnClickListener() {<br>&#x2F;&#x2F;<br>&#x2F;&#x2F;            @Override<br>&#x2F;&#x2F;            public void onClick(View view) {<br>&#x2F;&#x2F;                Toast.makeText(FragmentActivity.this, â€œæ‚¨ç‚¹å‡»äº†æŒ‰é’®â€, Toast.LENGTH_SHORT).show();<br>&#x2F;&#x2F;            }<br>&#x2F;&#x2F;        });<br>        linearLayout &#x3D; findViewById(R.id.layout);</p>
<pre><code>    //åŠ¨æ€åŠ è½½
    MyFragment fragment = new MyFragment();
    FragmentManager fragmentManager = getSupportFragmentManager();
    FragmentTransaction beginTransacction = fragmentManager.beginTransaction();
    beginTransacction.add(R.id.layout, fragment); //æŠŠç¢ç‰‡æ”¾åˆ°å¸ƒå±€çš„layoutå®¹å™¨é‡Œé¢
    beginTransacction.addToBackStack(null); //å…è®¸ç”¨æˆ·é€šè¿‡æŒ‰é”®è¿”å›å‰ä¸€ä¸ªFragmentçŠ¶æ€
    beginTransacction.commit();

&#125;
</code></pre>
<p>}</p>
<p>å¯å°†æ•´ä¸ªè¿‡ç¨‹å¤§è‡´åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š<br>ç¬¬ä¸€æ­¥ï¼Œå…ˆç”¨getSupportFragmentManager()æ–¹æ³•è·å–ä¸€ä¸ªFragmentManagerå¯¹è±¡ï¼Œå†é€šè¿‡å®ƒçš„beginTransacction()è·å–ä¸€ä¸ªFragmentTransactionçš„å®ä¾‹ã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼Œç”¨beginTransaction.add()æ–¹æ³•å°†MyFragemntå®ä¾‹æ·»åŠ åˆ°mainå¸ƒå±€é‡ŒLinearLayouté‡Œï¼Œç»ˆäºçŸ¥é“ä¹‹å‰é“ºå«çš„Idæ˜¯æ€ä¹ˆå›äº‹äº†ã€‚ä¸€å®šè¦æ³¨æ„ï¼Œadd()æ–¹æ³•é‡Œçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å®¹å™¨è§†å›¾èµ„æºIdï¼Œè€Œä¸æ˜¯layoutã€‚å®¹å™¨è§†å›¾èµ„æºIdæœ‰ä¸¤ä¸ªä½œç”¨ï¼šå‘ŠçŸ¥FragmentManagerï¼Œç¢ç‰‡è§†å›¾åº”è¯¥å‡ºç°åœ¨æ´»åŠ¨è§†å›¾çš„ä»€ä¹ˆåœ°æ–¹ï¼›å®ƒä¹Ÿæ˜¯FragmentManageré˜Ÿåˆ—ä¸­ç¢ç‰‡çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚è€Œé™æ€åŠ è½½æ—¶ç¢ç‰‡çš„å”¯ä¸€æ ‡è¯†ç¬¦æ­£æ˜¯åœ¨æ´»åŠ¨å¸ƒå±€é‡Œ&lt; fragment&gt;ä¸‹çš„idã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼Œè°ƒç”¨beginTransaction.commit()æäº¤ã€‚å¦å¤–ï¼Œå¦‚æœå…è®¸ç”¨æˆ·é€šè¿‡æŒ‰ä¸‹è¿”å›æŒ‰é”®è¿”å›åˆ°å‰ä¸€ä¸ªFragmentçŠ¶æ€ï¼Œåœ¨è°ƒç”¨commit()ä¹‹å‰å…ˆè°ƒç”¨addToBackStack(true)æ–¹æ³•ã€‚</p>
<p>è¿™é‡Œæ³¨æ„åˆ°åŠ¨æ€åŠ è½½è¿›æ¥çš„Fragmenté‡Œçš„ç©ºé—´å¹¶ä¸èƒ½ç›´æ¥åœ¨æ´»åŠ¨ä¸­findViewByIdå¾—åˆ°ï¼Œé‚£ä¹ˆå¦‚ä½•å®ç°ç‚¹å‡»æ•ˆæœå‘¢ï¼Ÿ</p>
<h3 id="4-Fragmentä¸Activityä¹‹é—´é€šä¿¡"><a href="#4-Fragmentä¸Activityä¹‹é—´é€šä¿¡" class="headerlink" title="4.Fragmentä¸Activityä¹‹é—´é€šä¿¡"></a>4.Fragmentä¸Activityä¹‹é—´é€šä¿¡</h3><p>åœ¨æ´»åŠ¨ä¸­å¯ä»¥è°ƒç”¨FragmentManagerçš„findFragmentById()æ–¹æ³•æ¥å¾—åˆ°ç›¸åº”ç¢ç‰‡çš„å®ä¾‹ï¼Œç»§è€Œå¯ä»¥è°ƒç”¨ç¢ç‰‡é‡Œçš„æ–¹æ³•ï¼Œä»¥ä¸Šé¢çš„demoä¸ºä¾‹ï¼Œå¦‚æœæƒ³å¾—åˆ°é™æ€åŠ è½½ç¢ç‰‡çš„å®ä¾‹ï¼Œå¯åœ¨MainActivityæ·»åŠ ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MyFragment myFragment = (MyFragment)getFragmentManager(). findFragmentById(R.id.fragment);</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæƒ³å¾—åˆ°åŠ¨æ€åŠ è½½ç¢ç‰‡çš„å®ä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MyFragment myFragment = (MyFragment)fragmentManager(). findFragmentById(R.id.layout);</span><br></pre></td></tr></table></figure>

<p>åœ¨ç¢ç‰‡ä¸­ä¹Ÿå¯ä»¥è°ƒç”¨getActivity()æ–¹æ³•æ¥å¾—åˆ°å’Œå½“å‰ç¢ç‰‡ç›¸å…³è”çš„æ´»åŠ¨å®ä¾‹ï¼Œè¿™æ ·è°ƒç”¨æ´»åŠ¨é‡Œçš„æ–¹æ³•å°±å˜å¾—è½»è€Œæ˜“ä¸¾äº†ï¼Œæ¯”å¦‚æƒ³åœ¨MyFragmentå¾—åˆ°MainActivityçš„å®ä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MainActivity activity=(MainActivity)getActivity();</span><br></pre></td></tr></table></figure>
<p>äºæ˜¯ç¢ç‰‡å’Œæ´»åŠ¨å¯ä»¥å¾ˆæ–¹ä¾¿çš„è¿›è¡Œé€šä¿¡äº†ï¼Œå†æƒ³ä¸€ä¸‹ç¢ç‰‡å’Œç¢ç‰‡ä¹‹é—´å¦‚ä½•è¿›è¡Œé€šä¿¡ï¼Ÿå…ˆåœ¨è¦ç»™ç¢ç‰‡ä¸­å¯ä»¥å¾—åˆ°ä¸å®ƒç›¸å…³çš„æ´»åŠ¨ï¼Œç„¶åå†é€šè¿‡è¿™ä¸ªæ´»åŠ¨å»è·å–å¦ä¸€ä¸ªç¢ç‰‡å®ä¾‹ï¼Œè¿™æ ·å®ç°äº†ä¸åŒç¢ç‰‡ä¹‹é—´çš„é€šä¿¡äº†ã€‚</p>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¦‚æœæŸä¸€æ¿å—æ¯æ¬¡ç”¨åˆ°éƒ½éœ€è¦ç›¸åŒçš„åŠŸèƒ½ï¼Œå°±å®Œå…¨å¯ä»¥åœ¨ç¢ç‰‡ä¸­å®ç°éœ€æ±‚ï¼Œè€Œä¸å¿…åœ¨æ´»åŠ¨ä¸­é‡å¤ä»£ç ï¼Œè¿™æ ·å¯ä»¥æé«˜ä»£ç çš„å¤ç”¨æ€§ã€‚</p>
]]></content>
      <categories>
        <category>android</category>
      </categories>
  </entry>
  <entry>
    <title>Androidå·¥ç¨‹é¡¹ç›®ç»“æ„è§£æ</title>
    <url>/2022/11/10/Android%E5%B7%A5%E7%A8%8B%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<p>androidå·¥ç¨‹çš„é‡ç‚¹ç›®å½•è§£æ</p>
<span id="more"></span>

<p><img src="https://s3.bmp.ovh/imgs/2022/11/10/7b843f31f0a99719.png"></p>
<p>æ¥ä¸‹æ¥å¯¹å…³é”®éƒ¨åˆ†è¿›è¡Œè®²è§£ï¼š<br>Javaï¼Œæˆ‘ä»¬å†™Javaä»£ç çš„åœ°æ–¹ï¼Œä¸šåŠ¡åŠŸèƒ½éƒ½åœ¨è¿™é‡Œå®ç°<br>resï¼Œæˆ‘ä»¬å­˜æ”¾å„ç§èµ„æºæ–‡ä»¶çš„åœ°æ–¹ï¼Œæœ‰å›¾ç‰‡ï¼Œå­—ç¬¦ä¸²ï¼ŒåŠ¨ç”»ï¼ŒéŸ³é¢‘ï¼Œè¿˜æœ‰å„ç§å½¢å¼çš„xmlæ–‡ä»¶</p>
<h1 id="ä¸€ã€resèµ„æºæ–‡ä»¶å¤¹ä»‹ç»ï¼š"><a href="#ä¸€ã€resèµ„æºæ–‡ä»¶å¤¹ä»‹ç»ï¼š" class="headerlink" title="ä¸€ã€resèµ„æºæ–‡ä»¶å¤¹ä»‹ç»ï¼š"></a>ä¸€ã€resèµ„æºæ–‡ä»¶å¤¹ä»‹ç»ï¼š</h1><p>æ³¨ï¼šè¯´é“è¿™ä¸ªresç›®å½•ï¼Œå¦å¤–è¿˜æœ‰ä¸€ä¸ªassetsç›®å½•ï¼Œè™½ç„¶è¿™é‡Œæ²¡æœ‰ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è‡ªå·±åˆ›å»ºï¼Œä¸¤è€…çš„åŒºåˆ«åœ¨äºæ˜¯å¦å‰è€…ä¸‹æ‰€æœ‰çš„èµ„æºæ–‡ä»¶éƒ½ä¼šåœ¨R.javaæ–‡ä»¶ä¸‹ç”Ÿæˆå¯¹åº”çš„èµ„æºidï¼Œè€Œåè€…å¹¶ä¸ä¼šï¼›å‰è€…æˆ‘ä»¬å¯ä»¥é€šè¿‡èµ„æºidè®¿é—®åˆ°å¯¹åº”çš„èµ„æºï¼›è€Œåè€…åˆ™éœ€è¦æˆ‘ä»¬é€šè¿‡AssetManagerä»¥äºŒè¿›åˆ¶çš„å½¢å¼æ¥è¯»å–äº†ã€‚è¿™ä¸ªRæ–‡ä»¶å¯ä»¥ç†è§£ä¸ºå­—å…¸ï¼Œresä¸‹æ¯ä¸ªèµ„æºéƒ½ä¼šåœ¨è¿™é‡Œç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„idã€‚<br>åˆ†è¾¨ç‡ä¸åŒçš„ç³»ç»Ÿä¼šæ ¹æ®å±å¹•çš„åˆ†è¾¨ç‡æ¥é€‰æ‹©hdpi,mdpi,xmdpi,xxhdpiä¸‹çš„å¯¹åº”å›¾ç‰‡ï¼Œæ‰€ä»¥ä½ è§£å‹åˆ«äººçš„apkå¯ä»¥çœ‹åˆ°ä¸Šè¿°ç›®å½•ç»Ÿä¸€åç§°çš„å›¾ç‰‡ï¼Œåœ¨å››ä¸ªæ–‡ä»¶å¤¹ä¸‹éƒ½æœ‰ï¼Œåªæ˜¯å¤§å°å’Œåƒç´ ä¸ä¸€æ ·è€Œå·²ï¼Œå½“ç„¶ï¼Œè¿™ä¹Ÿä¸æ˜¯ç»å¯¹çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬æŠŠæ‰€æœ‰å›¾ç‰‡éƒ½ä¸¢åˆ°hdpiä¸‹çš„è¯ï¼Œæœ¬è¯¥åŠ è½½ldpiæ–‡ä»¶å¤¹ä¸‹çš„å›¾ç‰‡èµ„æºï¼Œä½†æ˜¯ldpiä¸‹æ²¡æœ‰ï¼Œé‚£ä¹ˆåŠ è½½çš„è¿˜ä¼šä½¿hdpiä¸‹çš„å›¾ç‰‡ï¼Œå¦å¤–è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œæ¯”å¦‚hdpiï¼Œmdpiç›®å½•ä¸‹æœ‰ldpiä¸‹æ²¡æœ‰ï¼Œé‚£ä¹ˆä¼šåŠ è½½mdpiä¸­çš„èµ„æºï¼åŸåˆ™æ˜¯ä½¿ç”¨æœ€æ¥è¿‘å¯†åº¦çº§åˆ«ï¼Œå¦å¤–å¦‚æœä½ æƒ³ç¦æ­¢androidä¸è·Ÿéšå±å¹•å¯†åº¦åŠ è½½ä¸åŒæ–‡ä»¶å¤¹çš„èµ„æºï¼Œåªéœ€åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­æ·»åŠ android:anyDensity&#x3D;â€falseâ€å­—æ®µå³å¯ã€‚</p>
<h2 id="1-å›¾ç‰‡èµ„æº"><a href="#1-å›¾ç‰‡èµ„æº" class="headerlink" title="1.å›¾ç‰‡èµ„æº"></a>1.å›¾ç‰‡èµ„æº</h2><ul>
<li>drawableï¼šå­˜æ”¾å„ç§ä½å›¾æ–‡ä»¶ï¼Œ(.pngï¼Œ.jpgï¼Œ.9pngï¼Œ.gifç­‰)é™¤æ­¤ä¹‹å¤–å¯èƒ½æ˜¯ä¸€äº›å…¶ä»–çš„drawableç±»å‹çš„XMLæ–‡ä»¶</li>
<li>mipmap-hdpiï¼šé«˜åˆ†è¾¨ç‡ï¼Œä¸€èˆ¬æˆ‘ä»¬æŠŠå›¾ç‰‡ä¸¢è¿™é‡Œ</li>
<li>mipmap-mdpiï¼šä¸­ç­‰åˆ†è¾¨ç‡ï¼Œå¾ˆå°‘ï¼Œé™¤éå…¼å®¹çš„çš„æ‰‹æœºå¾ˆæ—§</li>
<li>mipmap-xhdpiï¼šè¶…é«˜åˆ†è¾¨ç‡ï¼Œæ‰‹æœºå±å¹•æè´¨è¶Šæ¥è¶Šå¥½ï¼Œä»¥åä¼°è®¡ä¼šæ…¢æ…¢å¾€è¿™é‡Œè¿‡æ¸¡</li>
<li>mipmap-xxhdpiï¼šè¶…è¶…é«˜åˆ†è¾¨ç‡ï¼Œè¿™ä¸ªåœ¨é«˜ç«¯æœºä¸Šæœ‰æ‰€ä½“ç°</li>
</ul>
<h2 id="2-å¸ƒå±€èµ„æº"><a href="#2-å¸ƒå±€èµ„æº" class="headerlink" title="2.å¸ƒå±€èµ„æº"></a>2.å¸ƒå±€èµ„æº</h2><ul>
<li>layoutï¼šè¯¥ç›®å½•ä¸‹å­˜æ”¾çš„å°±æ˜¯æˆ‘ä»¬çš„å¸ƒå±€æ–‡ä»¶ï¼Œå¦å¤–åœ¨ä¸€äº›ç‰¹å®šçš„æœºå‹ä¸Šï¼Œæˆ‘ä»¬åšå±å¹•é€‚é…ï¼Œæ¯”å¦‚480*320è¿™æ ·çš„æ‰‹æœºï¼Œæˆ‘ä»¬ä¼šå¦å¤–åˆ›å»ºä¸€å¥—å¸ƒå±€ï¼Œå°±è¡Œï¼šlayout-480x320è¿™æ ·çš„æ–‡ä»¶å¤¹ï¼</li>
</ul>
<h2 id="3-èœå•èµ„æº"><a href="#3-èœå•èµ„æº" class="headerlink" title="3.èœå•èµ„æº"></a>3.èœå•èµ„æº</h2><ul>
<li>menuï¼šåœ¨ä»¥å‰æœ‰ç‰©ç†èœå•æŒ‰é’®ï¼Œå³menué”®çš„æ‰‹æœºä¸Šï¼Œç”¨çš„è¾ƒå¤šï¼Œç°åœ¨ç”¨çš„å¹¶ä¸å¤šï¼Œèœå•é¡¹ç›¸å…³çš„èµ„æºxmlå¯åœ¨è¿™é‡Œç¼–å†™ï¼Œä¸çŸ¥é“è°·æ­Œä¼šä¸ä¼šå‡ºæ–°çš„ä¸œè¥¿æ¥æ›¿ä»£èœå•äº†~</li>
</ul>
<h2 id="4-valuesç›®å½•"><a href="#4-valuesç›®å½•" class="headerlink" title="4.valuesç›®å½•"></a>4.valuesç›®å½•</h2><ul>
<li>demens.xmlï¼šå®šä¹‰å°ºå¯¸èµ„æº</li>
<li>string.xmlï¼šå®šä¹‰å­—ç¬¦ä¸²èµ„æº</li>
<li>styles.xmlï¼šå®šä¹‰æ ·å¼èµ„æº</li>
<li>colors.xmlï¼šå®šä¹‰é¢œè‰²èµ„æº</li>
<li>arrays.xmlï¼šå®šä¹‰æ•°ç»„èµ„æº</li>
<li>attrs.xmlï¼šè‡ªå®šä¹‰æ§ä»¶æ—¶ç”¨çš„è¾ƒå¤šï¼Œè‡ªå®šä¹‰æ§ä»¶çš„å±æ€§ï¼</li>
<li>themeä¸»é¢˜æ–‡ä»¶ï¼Œå’Œstyleså¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯ä¼šå¯¹æ•´ä¸ªåº”ç”¨ä¸­çš„Actvitiyæˆ–æŒ‡å®šActivityèµ·ä½œç”¨ï¼Œä¸€èˆ¬æ˜¯æ”¹å˜çª—å£å¤–è§‚çš„ï¼å¯åœ¨Javaä»£ç ä¸­é€šè¿‡setThemeä½¿ç”¨ï¼Œæˆ–è€…åœ¨Androidmanifest.xmlä¸­ä¸º&lt;applicationâ€¦&gt;æ·»åŠ themeçš„å±æ€§ï¼ PS:ä½ å¯èƒ½çœ‹åˆ°è¿‡è¿™æ ·çš„valuesç›®å½•ï¼švalues-w820dpï¼Œvalues-v11ç­‰ï¼Œå‰è€…wä»£è¡¨å¹³æ¿è®¾å¤‡ï¼Œ820dpä»£è¡¨å±å¹•å®½åº¦ï¼›è€Œv11è¿™æ ·ä»£è¡¨åœ¨API(11)ï¼Œå³android 3.0åæ‰ä¼šç”¨åˆ°çš„ï¼</li>
</ul>
<h2 id="5-rawç›®å½•"><a href="#5-rawç›®å½•" class="headerlink" title="5.rawç›®å½•"></a>5.rawç›®å½•</h2><p>ç”¨äºå­˜æ”¾å„ç§åŸç”Ÿèµ„æºï¼ˆéŸ³é¢‘ï¼Œè§†é¢‘ï¼Œä¸€äº›XMLæ–‡ä»¶ç­‰ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡openRawResource(int id)æ¥è·å¾—èµ„æºçš„äºŒè¿›åˆ¶æµï¼Œå…¶å®å’ŒAssetså·®ä¸å¤šï¼Œä¸è¿‡è¿™é‡Œé¢çš„èµ„æºä¼šåœ¨Ræ–‡ä»¶é‡Œç”Ÿæˆä¸€ä¸ªèµ„æºidè€Œå·²<br>6.æœ€åè¿˜æœ‰åŠ¨ç”»çš„ï¼ŒåŠ¨ç”»æœ‰ä¸¤ç§ï¼šå±æ€§åŠ¨ç”»å’Œè¡¥é—´åŠ¨ç”»</p>
<ul>
<li>animatorï¼šå­˜æ”¾å±æ€§åŠ¨ç”»çš„XMLæ–‡ä»¶</li>
<li>animï¼šå­˜æ”¾è¡¥é—´åŠ¨ç”»çš„XMLæ–‡ä»¶</li>
</ul>
<h1 id="äºŒã€æ·±å…¥äº†è§£ä¸‰ä¸ªæ–‡ä»¶"><a href="#äºŒã€æ·±å…¥äº†è§£ä¸‰ä¸ªæ–‡ä»¶" class="headerlink" title="äºŒã€æ·±å…¥äº†è§£ä¸‰ä¸ªæ–‡ä»¶"></a>äºŒã€æ·±å…¥äº†è§£ä¸‰ä¸ªæ–‡ä»¶</h1><p>å·¥ç¨‹ä¸­ä¸‰ä¸ªæ¯”è¾ƒé‡è¦çš„æ–‡ä»¶ï¼šMainActivity.javaï¼Œ å¸ƒå±€æ–‡ä»¶ï¼šactivity_main.xmlå’Œé…ç½®æ–‡ä»¶AndroidMainfest.xml<br>ä»£ç åˆ†æï¼š</p>
<p>MainAcitivity.java<br><img src="https://s3.bmp.ovh/imgs/2022/11/10/48c14edb5816ca14.png"><br>activity_main.xmlï¼š<br><img src="https://s3.bmp.ovh/imgs/2022/11/10/e8bfda21011a2f54.png"><br>AndroidMainfest.xmlé…ç½®æ–‡ä»¶ï¼š<br><img src="https://s3.bmp.ovh/imgs/2022/11/10/d4a0c330f888bfbe.png"><br>â‘ å¦‚æœappåŒ…å«å…¶ä»–ç»„ä»¶çš„è¯,éƒ½è¦ä½¿ç”¨ç±»å‹è¯´æ˜è¯­æ³•åœ¨è¯¥æ–‡ä»¶ä¸­è¿›è¡Œå£°æ˜ Server:<br>â‘¡æƒé™çš„å£°æ˜: åœ¨è¯¥æ–‡ä»¶ä¸­æ˜¾å¼åœ°å£°æ˜ç¨‹åºéœ€è¦çš„æƒé™,é˜²æ­¢appé”™è¯¯åœ°ä½¿ç”¨æœåŠ¡, ä¸æ°å½“åœ°è®¿é—® èµ„æº,æœ€ç»ˆæé«˜android appçš„å¥å£®æ€§ android.permission.SEND_SMS æœ‰è¿™å¥è¯è¡¨ç¤ºappéœ€è¦ä½¿ç”¨å‘é€ä¿¡æ¯çš„æƒé™,å®‰è£…çš„æ—¶å€™å°±ä¼šæç¤ºç”¨æˆ·, ç›¸å…³æƒé™å¯ä»¥åœ¨sdkå‚è€ƒæ‰‹å†ŒæŸ¥æ‰¾ï¼</p>
]]></content>
      <categories>
        <category>android</category>
      </categories>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Androidæ–‡ä»¶ç®¡ç†</title>
    <url>/2022/12/07/Android%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<h2 id="1-Androidæ–‡ä»¶çš„æ“ä½œæ¨¡å¼"><a href="#1-Androidæ–‡ä»¶çš„æ“ä½œæ¨¡å¼" class="headerlink" title="1.Androidæ–‡ä»¶çš„æ“ä½œæ¨¡å¼"></a>1.Androidæ–‡ä»¶çš„æ“ä½œæ¨¡å¼</h2><p>Androidå’Œå…¶ä»–çš„æ“ä½œç³»ç»Ÿä¸ä¸€æ ·ï¼Œå®ƒæ˜¯åŸºäºLinuxçš„ï¼Œåœ¨è¯»å†™æ–‡ä»¶çš„æ—¶å€™ï¼Œè¿˜éœ€è¦åŠ ä¸Šæ–‡ä»¶çš„æ“ä½œæ¨¡å¼ï¼ŒAndroidä¸­çš„æ“ä½œæ¨¡å¼å¦‚ä¸‹ï¼š</p>
<span id="more"></span>
<p>1ï¼‰MODE_PRIVATE â€”â€”&gt; é»˜è®¤æ“ä½œæ¨¡å¼ï¼Œä»£è¡¨è¯¥æ–‡ä»¶æ˜¯ç§æœ‰æ•°æ®ï¼Œåªèƒ½å¤Ÿè¢«æœ¬åº”ç”¨æœ¬èº«è®¿é—®ï¼Œå†™å…¥çš„å†…å®¹ä¼šè¦†ç›–åŸæ–‡ä»¶çš„å†…å®¹<br>2ï¼‰MODE_APPEND â€”â€”&gt; ä¼šæ£€éªŒæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨çš„è¯å¾€æ–‡ä»¶ä¸­è¿½åŠ å†…å®¹ï¼Œå¦åˆ™å»ºç«‹æ–°æ–‡ä»¶<br>3ï¼‰MODE_WORLD_READABLE â€”â€”&gt; å½“å‰æ–‡ä»¶å¯ä»¥è¢«å…¶ä»–åº”ç”¨è¯»å–<br>4ï¼‰MODE_WORLD_WRITEABLE â€”â€”&gt; å½“å‰æ–‡ä»¶å¯ä»¥è¢«å…¶ä»–åº”ç”¨å†™å…¥<br>åé¢ä¸¤ä¸ªé€‚ç”¨äºæ§åˆ¶å…¶ä»–åº”ç”¨æ˜¯å¦æœ‰è¯»å†™æ–‡ä»¶å¾—æƒé™å¾—<br>å¦‚æœæ–‡ä»¶æ—¢å¯ä»¥å†™ï¼Œåˆå¯ä»¥è¯»çš„è¯ï¼Œå¯ä»¥å†™æˆä¸‹é¢çš„å½¢å¼ï¼š<br>openFileOutput(â€œjay123.txtâ€, Content.MODE_WORLD_READABLE + Content.MODE_WORLD_WRITEABLE);</p>
<h2 id="2-æ–‡ä»¶æ“ä½œçš„ç›¸å…³æ–¹æ³•"><a href="#2-æ–‡ä»¶æ“ä½œçš„ç›¸å…³æ–¹æ³•" class="headerlink" title="2.æ–‡ä»¶æ“ä½œçš„ç›¸å…³æ–¹æ³•"></a>2.æ–‡ä»¶æ“ä½œçš„ç›¸å…³æ–¹æ³•</h2><p><a href="https://imgse.com/i/zh3Gz4"><img src="https://s1.ax1x.com/2022/12/11/zh3Gz4.png" alt="zh3Gz4.png"></a></p>
<h2 id="3-ç¤ºä¾‹"><a href="#3-ç¤ºä¾‹" class="headerlink" title="3.ç¤ºä¾‹"></a>3.ç¤ºä¾‹</h2><p>é¦–å…ˆæ˜¯å¸ƒå±€æ–‡ä»¶ï¼šmain_activity.xml</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    tools:context=&quot;.FileActivity&quot;</span><br><span class="line">    android:orientation=&quot;horizontal&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;@string/nametitle&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;EditText</span><br><span class="line">        android:id=&quot;@+id/editname&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;@string/detailtitle&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;EditText</span><br><span class="line">        android:id=&quot;@+id/editdetail&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:minLines=&quot;2&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:layout_width=&quot;fill_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:orientation=&quot;horizontal&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=&quot;@+id/btnsave&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:text=&quot;@string/btnwrite&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=&quot;@+id/btnclean&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:text=&quot;@string/btnclean&quot; /&gt;</span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:id=&quot;@+id/btnread&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;@string/btnread&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå†å†™ä¸€ä¸ªæ–‡ä»¶ååŠ©ç±»ï¼šFileHelper.java</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.thefu.androidstudyproject;</span><br><span class="line"></span><br><span class="line">import android.content.Context;</span><br><span class="line"></span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.FileOutputStream;</span><br><span class="line">import java.io.IOError;</span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">public class FileHelper &#123;</span><br><span class="line"></span><br><span class="line">    private Context context;</span><br><span class="line"></span><br><span class="line">    public FileHelper() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public FileHelper(Context context) &#123;</span><br><span class="line">        super();</span><br><span class="line">        this.context = context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * è¿™é‡Œå®šä¹‰çš„æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¿å­˜çš„æ–¹æ³•ï¼Œå†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥æ˜¯è¾“å‡ºæµ</span><br><span class="line">     * @param fileName</span><br><span class="line">     * @param fileContent</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    public void save(String fileName, String fileContent) throws Exception &#123;</span><br><span class="line">        //è¿™é‡Œä½¿ç”¨ç§æœ‰æ¨¡å¼ï¼Œåˆ›å»ºå‡ºæ¥çš„æ–‡ä»¶åªèƒ½è¢«æœ¬åº”ç”¨è®¿é—®ï¼Œè¿˜ä¼šè¦†ç›–åŸæ–‡ä»¶</span><br><span class="line">        FileOutputStream output = context.openFileOutput(fileName, Context.MODE_PRIVATE);</span><br><span class="line">        output.write(fileContent.getBytes()); //å°†Stringå­—ç¬¦ä¸²ä»¥å­—èŠ‚çš„å½¢å¼å†™å…¥åˆ°è¾“å‡ºæµä¸­</span><br><span class="line">        output.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * è¿™é‡Œå®šä¹‰çš„æ˜¯æ–‡ä»¶è¯»å–çš„æ–¹æ³•</span><br><span class="line">     * @param fileName</span><br><span class="line">     * @return</span><br><span class="line">     * @throws IOException</span><br><span class="line">     */</span><br><span class="line">    public String read(String fileName) throws IOException &#123;</span><br><span class="line">        //æ‰“å¼€æ–‡ä»¶è¾“å…¥æµ</span><br><span class="line">        FileInputStream input = context.openFileInput(fileName);</span><br><span class="line">        byte[] temp = new byte[1024];</span><br><span class="line">        StringBuilder sb = new StringBuilder(&quot;&quot;);</span><br><span class="line">        int len = 0;</span><br><span class="line">        //è¯»å–æ–‡ä»¶å†…å®¹</span><br><span class="line">        while ((len = input.read(temp)) &gt; 0) &#123;</span><br><span class="line">            sb.append(new String(temp, 0, len));</span><br><span class="line">        &#125;</span><br><span class="line">        //å…³é—­è¾“å…¥æµ</span><br><span class="line">        input.close();</span><br><span class="line">        return sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åæ˜¯Activityï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å®Œæˆç›¸å…³æ“ä½œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.thefu.androidstudyproject;</span><br><span class="line"></span><br><span class="line">import androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line">import android.content.Context;</span><br><span class="line">import android.os.Bundle;</span><br><span class="line">import android.view.View;</span><br><span class="line">import android.widget.Button;</span><br><span class="line">import android.widget.EditText;</span><br><span class="line">import android.widget.Toast;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">public class FileActivity extends AppCompatActivity implements View.OnClickListener&#123;</span><br><span class="line"></span><br><span class="line">    private EditText editname;</span><br><span class="line">    private EditText editdetail;</span><br><span class="line">    private Button btnsave;</span><br><span class="line">    private Button btnclean;</span><br><span class="line">    private Button btnread;</span><br><span class="line">    private Context mContext;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_file);</span><br><span class="line">        mContext = getApplicationContext();</span><br><span class="line">        bindView();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void bindView() &#123;</span><br><span class="line">        editdetail = (EditText) findViewById(R.id.editdetail);</span><br><span class="line">        editname = (EditText) findViewById(R.id.editname);</span><br><span class="line">        btnclean = (Button) findViewById(R.id.btnclean);</span><br><span class="line">        btnsave = (Button) findViewById(R.id.btnsave);</span><br><span class="line">        btnread = (Button) findViewById(R.id.btnread);</span><br><span class="line"></span><br><span class="line">        btnclean.setOnClickListener(this);</span><br><span class="line">        btnsave.setOnClickListener(this);</span><br><span class="line">        btnread.setOnClickListener(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onClick(View view) &#123;</span><br><span class="line">        switch (view.getId()) &#123;</span><br><span class="line">            case R.id.btnclean:</span><br><span class="line">                editdetail.setText(&quot;&quot;);</span><br><span class="line">                editname.setText(&quot;&quot;);</span><br><span class="line">                break;</span><br><span class="line">            case R.id.btnsave:</span><br><span class="line">                FileHelper fHelper = new FileHelper(mContext);</span><br><span class="line">                String filename = editname.getText().toString();</span><br><span class="line">                String filedetail = editdetail.getText().toString();</span><br><span class="line">                try &#123;</span><br><span class="line">                    fHelper.save(filename, filedetail);</span><br><span class="line">                    Toast.makeText(getApplicationContext(), &quot;æ•°æ®å†™å…¥æˆåŠŸ&quot;, Toast.LENGTH_SHORT).show();</span><br><span class="line">                &#125; catch (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    Toast.makeText(getApplicationContext(), &quot;æ•°æ®å†™å…¥å¤±è´¥&quot;, Toast.LENGTH_SHORT).show();</span><br><span class="line">                &#125;</span><br><span class="line">                break;</span><br><span class="line">            case R.id.btnread:</span><br><span class="line">                String detail = &quot;&quot;;</span><br><span class="line">                FileHelper fHelper2 = new FileHelper(getApplicationContext());</span><br><span class="line">                try &#123;</span><br><span class="line">                    String fname = editname.getText().toString();</span><br><span class="line">                    detail = fHelper2.read(fname);</span><br><span class="line">                &#125; catch (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                Toast.makeText(getApplicationContext(), detail, Toast.LENGTH_SHORT).show();</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-è¯»å–SDå¡ä¸Šçš„æ–‡ä»¶"><a href="#4-è¯»å–SDå¡ä¸Šçš„æ–‡ä»¶" class="headerlink" title="4.è¯»å–SDå¡ä¸Šçš„æ–‡ä»¶"></a>4.è¯»å–SDå¡ä¸Šçš„æ–‡ä»¶</h2><p><a href="https://imgse.com/i/zh3BFK"><img src="https://s1.ax1x.com/2022/12/11/zh3BFK.png" alt="zh3BFK.png"></a></p>
]]></content>
      <categories>
        <category>android</category>
      </categories>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>Androidæ¨ªç«–å±åˆ‡æ¢ä»¥åŠå¯¹åº”å¸ƒå±€åŠ è½½</title>
    <url>/2022/11/10/Android%E6%A8%AA%E7%AB%96%E5%B1%8F%E5%88%87%E6%8D%A2%E4%BB%A5%E5%8F%8A%E5%AF%B9%E5%BA%94%E5%B8%83%E5%B1%80%E5%8A%A0%E8%BD%BD/</url>
    <content><![CDATA[<p>å¦‚æœè¦è®©è½¯ä»¶åœ¨æ¨ªç«–å±ä¹‹é—´åˆ‡æ¢ï¼Œç”±äºæ¨ªç«–å±çš„å®½é«˜ä¼šå‘ç”Ÿè½¬æ¢ï¼Œæœ‰å¯èƒ½ä¼šè¦æ±‚ä¸åŒçš„å¸ƒå±€ã€‚</p>
<span id="more"></span>
<h1 id="1-æ¨ªç«–å±åˆ‡æ¢è¿å¸¦æ¨ªç«–å±å¸ƒå±€é—®é¢˜ï¼š"><a href="#1-æ¨ªç«–å±åˆ‡æ¢è¿å¸¦æ¨ªç«–å±å¸ƒå±€é—®é¢˜ï¼š" class="headerlink" title="1.æ¨ªç«–å±åˆ‡æ¢è¿å¸¦æ¨ªç«–å±å¸ƒå±€é—®é¢˜ï¼š"></a>1.æ¨ªç«–å±åˆ‡æ¢è¿å¸¦æ¨ªç«–å±å¸ƒå±€é—®é¢˜ï¼š</h1><p>å¦‚æœè¦è®©è½¯ä»¶åœ¨æ¨ªç«–å±ä¹‹é—´åˆ‡æ¢ï¼Œç”±äºæ¨ªç«–å±çš„å®½é«˜ä¼šå‘ç”Ÿè½¬æ¢ï¼Œæœ‰å¯èƒ½ä¼šè¦æ±‚ä¸åŒçš„å¸ƒå±€ã€‚<br>å¯ä»¥é€šè¿‡ä¸€ä¸‹ä¸¤ç§æ–¹æ³•åˆ‡æ¢å¸ƒå±€ï¼š<br>1ï¼‰åœ¨resç›®å½•ä¸‹å»ºç«‹layout-landå’Œlayout-portç›®å½•ï¼Œç›¸åº”çš„layoutæ–‡ä»¶åä¸å˜ï¼Œæ¯”å¦‚ï¼šlayout-landæ˜¯æ¨ªå±çš„ï¼Œlayout-portæ˜¯ç«–å±çš„æ—¶å€™ï¼Œå…¶ä»–çš„ä¸ç”¨ç®¡ï¼Œæ¨ªç«–å±åˆ‡æ¢æ—¶ç¨‹åºè°ƒç”¨Activityçš„onCreateæ–¹æ³•ä¸­çš„setOnContent(xxx)ï¼Œå¹¶è‡ªåŠ¨åŠ è½½ç›¸åº”çš„å¸ƒå±€ã€‚<br>2ï¼‰å‡å¦‚å¸ƒå±€èµ„æºä¸æŒ‰ç…§å¦‚ä¸Šè®¾ç½®ï¼Œåˆ™å¯ä»¥é€šè¿‡Javaä»£ç æ¥åˆ¤æ–­å½“å‰æ˜¯æ¨ªå±è¿˜æ˜¯ç«–å±ç„¶åæ¥åŠ è½½ç›¸åº”çš„xmlå¸ƒå±€æ–‡ä»¶ã€‚å› ä¸ºå½“å±å¹•å˜ä¸ºæ¨ªå±çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šé‡æ–°åŠ è½½å½“å‰Activityçš„onCreateæ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼šè¯¥Activityçš„å£°æ˜å‘¨æœŸè¦é‡å¤´å¼€å§‹ï¼‰ï¼Œä½ å¯ä»¥æŠŠä»¥ä¸‹æ–¹æ³•æ”¾åœ¨ä½ çš„onCreateä¸­æ¥æ£€æŸ¥å½“å‰çš„æ–¹æ³•ï¼Œç„¶åå¯ä»¥è®©ä½ çš„setContentVIewæ¥è½½å…¥ä¸åŒçš„layout</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Private int orientation;</span><br><span class="line">Orientation = getResources().getConfiguration().orientation;</span><br></pre></td></tr></table></figure>
<h1 id="2-å¼ºåˆ¶è®¾å®šå±å¹•çš„æ¨ªç«–å±æ–¹å‘"><a href="#2-å¼ºåˆ¶è®¾å®šå±å¹•çš„æ¨ªç«–å±æ–¹å‘" class="headerlink" title="2.å¼ºåˆ¶è®¾å®šå±å¹•çš„æ¨ªç«–å±æ–¹å‘"></a>2.å¼ºåˆ¶è®¾å®šå±å¹•çš„æ¨ªç«–å±æ–¹å‘</h1><p>androidæ¨ªç«–å±åˆ‡æ¢åœ¨æ‰‹æœºå¼€å‘ä¸­æ¯”è¾ƒå¸¸è§ï¼Œå¾ˆå¤šè½¯ä»¶åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä¸ºäº†é¿å…æ¨ªç«–å±åˆ‡æ¢æ—¶å¼•å‘ä¸å¿…è¦çš„éº»çƒ¦ï¼Œé€šå¸¸è¦å¼ºåˆ¶è®¾ç½®æ¨ªç«–å±çš„æ–¹å‘ï¼Œé€šè¿‡åœ¨androidMainfest.xmlä¸­è®¾ç½®activityä¸­çš„android:screenOrientationå±æ€§å€¼æ¥å®ç°ã€‚<br>æ¯”å¦‚ä¸‹åˆ—è®¾ç½®ï¼š<br>æ¨ªå±æ˜¾ç¤ºè®¾ç½®ï¼Œandroid:screenOrientation&#x3D;â€landscapeâ€<br>ç«–å±æ˜¾ç¤ºè®¾ç½®ï¼Œandroid:screenOrientation&#x3D;â€portraitâ€<br>å½“ç„¶ä¸Šè¿°ä¿®æ”¹ä¹Ÿå¯ä»¥åœ¨Javaä»£ç ä¸­é€šè¿‡ä»£ç å®ç°ï¼šï¼ˆandroidå±å¹•çš„åˆ‡æ¢ä¼šé‡å¯Activityï¼Œæ‰€ä»¥åœ¨Activityé”€æ¯å‰ä¿å­˜å½“å‰æ´»åŠ¨çš„çŠ¶æ€ï¼Œå¹¶åœ¨Activityå†æ¬¡Createçš„æ—¶å€™è½½å…¥é…ç½®ï¼‰<br>setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_LANDSCAPE)</p>
<h1 id="3-æ‹¦æˆªæ¨ªç«–å±åˆ‡æ¢-éœ€è¦çš„é…ç½®æ–‡ä»¶ï¼šonConfigurationChanged"><a href="#3-æ‹¦æˆªæ¨ªç«–å±åˆ‡æ¢-éœ€è¦çš„é…ç½®æ–‡ä»¶ï¼šonConfigurationChanged" class="headerlink" title="3.æ‹¦æˆªæ¨ªç«–å±åˆ‡æ¢ éœ€è¦çš„é…ç½®æ–‡ä»¶ï¼šonConfigurationChanged"></a>3.æ‹¦æˆªæ¨ªç«–å±åˆ‡æ¢ éœ€è¦çš„é…ç½®æ–‡ä»¶ï¼šonConfigurationChanged</h1><p>Activityæ¯æ¬¡æ¨ªç«–å±åˆ‡æ¢éƒ½ä¼šé‡æ–°è°ƒç”¨onPause-&gt;onStop-&gt;onDestory-&gt;onCreate-&gt;onStart-&gt;onResumeï¼ˆä¸ºæ­¤å†…å®¹å’Œæ•°æ®è¦ä¿å­˜å’Œè¯»å–ï¼Œå¦åˆ™è½¬å±ä¹‹å‰å†…å®¹å°†å°±ä¼šæ¶ˆå¤±äº†ï¼‰<br>å¾ˆå¤šæ—¶å€™è¿™æ ·çš„ç»“æœè®©ç¨‹åºç¹çï¼Œä¸ºæ­¤androidæä¾›äº†åœ¨mainfestä¸­è®¾ç½®android:configChangeså±æ€§ï¼Œä»è€Œè®©activityä¸å»¶ç»­ä¸Šè¿°çš„é‡å»ºæµç¨‹ï¼›<br>æ–¹å¼ä¸€ï¼šåœ¨androidå·¥ç¨‹çš„Mainfest.xmlä¸­é…ç½®activityï¼šandroid:configChanges&#x3D;â€keyboardHidden|orientationâ€ï¼Œæ¨ªç«–å±åˆ‡æ¢ä¹‹åå°±ä¸ä¼šå»æ‰§è¡ŒOnCreateå‡½æ•°äº†ï¼Œè€Œæ˜¯ä¼šå»è°ƒç”¨onConfigurationChanged()è¿™æ ·å°±èƒ½æ§åˆ¶æ¨ªç«–å±çš„åˆ‡æ¢äº†ã€‚<br>æ–¹å¼äºŒï¼šç”¨æˆ·å¯ä»¥åœ¨Activityæˆ–Viewçš„ï¼šonConfigurationChanged(configuration config)ï¼Œå‡½æ•°ä¸­è·å–å½“å‰æ¨ªç«–å±å‚æ•°ï¼Œè‡³äºå…¶è°ƒç”¨é¡ºåºè·Ÿtouchæ—¶é—´çš„ä¼ é€’é¡ºåºç›¸ä¼¼ï¼Œä¸è¿‡ä»–æ²¡æœ‰æ¶ˆè´¹äº‹ä»¶çš„æ¦‚å¿µï¼Œä¼šé¡ºæ¬¡è°ƒç”¨åˆ°æ¯ä¸€ä¸ªonConfigurationChangedå‡½æ•°ã€‚<br>éœ€è¦é‡å†™Activityçš„onConfigurationChangedæ–¹æ³•ã€‚å®ç°æ–¹å¼å¦‚ä¸‹ï¼Œä¸éœ€è¦åšå¤ªå¤šçš„å†…å®¹ï¼š<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒonConfigurationChangedå‡½æ•°ä¸­åªèƒ½è·å¾—æ¨ªç«–å±åˆ‡æ¢åçš„å‚æ•°ï¼Œåœ¨è¯¥å‡½æ•°ä¸­è·å–ä¸åˆ°æ–°çš„Layoutå’Œæ§ä»¶å°ºå¯¸ä½ç½®ä¿¡æ¯ï¼Œå¦‚æœè¦å¤„ç†å°ºå¯¸å’Œä½ç½®ä¿¡æ¯ï¼Œå¿…é¡»é€šè¿‡æ¶ˆæ¯å¼‚æ­¥æˆ–è€…å»¶æ—¶è°ƒç”¨ï¼›</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Override</span><br><span class="line"></span><br><span class="line">       public void onConfigurationChanged(Configuration newConfig) &#123;</span><br><span class="line"></span><br><span class="line">               super.onConfigurationChanged(newConfig);</span><br><span class="line"></span><br><span class="line">               if (getResources().getConfiguration().orientation == Configuration.ORIENTATION_LANDSCAPE) &#123;</span><br><span class="line"></span><br><span class="line">                       // land do nothing is ok</span><br><span class="line"></span><br><span class="line">               &#125; else if (getResources().getConfiguration().orientation == Configuration.ORIENTATION_PORTRAIT) &#123;</span><br><span class="line"></span><br><span class="line">                       // port do nothing is ok</span><br><span class="line"></span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<h1 id="4-è‡ªé€‚åº”åˆ‡æ¢å±å¹•ï¼š"><a href="#4-è‡ªé€‚åº”åˆ‡æ¢å±å¹•ï¼š" class="headerlink" title="4.è‡ªé€‚åº”åˆ‡æ¢å±å¹•ï¼š"></a>4.è‡ªé€‚åº”åˆ‡æ¢å±å¹•ï¼š</h1><p>å¦‚æœæƒ³è®©å®ƒå¯åŠ¨çš„æ—¶å€™æ˜¯æ¨ªå±çš„è¯å°±æ¨ªå±è¡¨ç¤ºï¼Œçºµå±çš„è¯å°±çºµå±è¡¨ç¤ºï¼Œç„¶åæ‰‹æœºåˆ‡æ¢æ¨ªç«–å±å°±ä¸èƒ½ç”¨äº†è¯¥æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ<br>é¦–å…ˆï¼šåœ¨Mainfest.xmlä¸­è¿½åŠ android:screenOrientation&#x3D;â€sensorâ€<br>android:configurationChanges&#x3D;â€orientation|keyboardHiddenâ€<br>ç„¶åï¼šå–å¾—å±å¹•çš„é•¿å’Œå®½ï¼Œè¿›è¡Œæ¯”è¾ƒè®¾ç½®æ¨ªç«–å±çš„å˜é‡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Display display = getWindowManager().getDefaultDisplay();</span><br><span class="line">    int width = display.getWidth();</span><br><span class="line">    int height = display.getHeight();</span><br><span class="line">    if (width &gt; height) &#123;</span><br><span class="line">      orientation = ActivityInfo.SCREEN_ORIENTATION_LANDSCAPE; // æ¨ªå±</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      orientation = ActivityInfo.SCREEN_ORIENTATION_PORTRAIT; // ç«–å±</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">ç„¶åï¼šåœ¨onConfigurationChanged()å‡½æ•°ä¸­è¿½åŠ this.setRequestedOrientation(orientation)</span><br><span class="line">public void onConfigurationChanged(Configuration newConfig) &#123; </span><br><span class="line">         super.onConfigurationChanged(newConfig); </span><br><span class="line">         this.setRequestedOrientation(orientation); </span><br><span class="line">       &#125; </span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯è¿™æ ·çš„è¯ä½ åˆ‡åˆ°åˆ«çš„ç”»é¢çš„æ—¶å€™å†å›åˆ°åŸç”»é¢ï¼Œå®ƒå°±ä»ç„¶æ˜¯æ¨ªçš„æˆ–è€…æ˜¯çºµçš„ã€‚æ€ä¹ˆè®©å®ƒä»åˆ«çš„å±å¹•å›æ¥åï¼Œåˆé‡æ–°æ¨ªç«–å±å¸ƒå±€å‘¢ï¼Ÿ<br>åªè¦åœ¨onResume()ä¸­å†è®¾å®šä¸‹å°±è¡Œäº†ï¼Œä½†æ˜¯è¿™ä¸ªä»…ä»…åªæ˜¯æ”¯æŒæ¨ªç«–å±åªæœ‰ä¸€ä¸ªlayoutçš„ï¼›</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">protected void onResume() &#123;</span><br><span class="line">    orientation = ActivityInfo.SCREEN_ORIENTATION_USER;</span><br><span class="line">    this.setRequestedOrientation(orientation);</span><br><span class="line">    Display display = getWindowManager().getDefaultDisplay();</span><br><span class="line">    int width = display.getWidth();</span><br><span class="line">    int height = display.getHeight();</span><br><span class="line">    if (width &gt; height) &#123;</span><br><span class="line">      orientation = ActivityInfo.SCREEN_ORIENTATION_LANDSCAPE;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      orientation = ActivityInfo.SCREEN_ORIENTATION_PORTRAIT;</span><br><span class="line">    &#125;</span><br><span class="line">    super.onResume();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>æœ‰ä¸‰ç‚¹æ³¨æ„ï¼š<br>1.ä¸è®¾ç½®activityçš„android:confiChangesæ—¶ï¼Œåˆ‡å±ä¼šé‡æ–°è°ƒç”¨å„ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œåˆ‡æ¨ªå±æ—¶ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œåˆ‡ç«–å±æ—¶ä¼šæ‰§è¡Œä¸¤æ¬¡<br>2.è®¾ç½®Activityçš„android:configChanges&#x3D;â€orientationâ€æ—¶ï¼Œåˆ‡å±è¿˜æ˜¯ä¼šé‡æ–°è°ƒç”¨å„ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œåˆ‡æ¨ªç«–å±æ—¶åªä¼šæ‰§è¡Œä¸€æ¬¡<br>3.è®¾ç½®activityçš„android:configChanges&#x3D;â€orientation|keyboardHiddenâ€æ—¶ï¼Œåˆ‡å±ä¸ä¼šé‡æ–°è°ƒç”¨å„ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œåªä¼šæ‰§è¡ŒonConfigurationChangedæ–¹æ³•</p>
]]></content>
      <categories>
        <category>android</category>
      </categories>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>EditText:android:focusableå’Œandroid:focusableInTouchModeçš„åŒºåˆ«</title>
    <url>/2022/10/15/EditText-android-focusable%E5%92%8Candroid-focusableInTouchMode%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
    <content><![CDATA[<p>æœ¬æ–‡å‘å¤§å®¶ä»‹ç»EditText:android:focusableå’Œandroid:focusableInTouchModeçš„åŒºåˆ«ï¼Œä¸»è¦åŒ…æ‹¬EditText:android:focusableå’Œandroid:focusableInTouchModeçš„åŒºåˆ«ä½¿ç”¨å®ä¾‹ï¼Œåº”ç”¨æŠ€å·§ï¼ŒåŸºæœ¬çŸ¥è¯†ç‚¹æ€»ç»“å’Œéœ€è¦æ³¨æ„äº‹é¡¹ï¼Œå…·æœ‰ä¸€å®šçš„å‚è€ƒä»·å€¼ã€‚<br>android:focusable</p>
<span id="more"></span>
<p>ä¹‹æ‰€ä»¥æœ‰è¿™ä¸ªå±æ€§ä¸»è¦æ˜¯å› ä¸ºandroidç³»ç»Ÿä¸ä»…ä»…æ˜¯é’ˆå¯¹æ‰‹æœºçš„ï¼Œæœ‰å¯èƒ½åœ¨ç”µè§†ï¼Œæ‰‹è¡¨ç­‰ç­‰çš„éè§¦æ‘¸è¾“å…¥è®¾å¤‡ä¸Šï¼ˆæ¯”å¦‚android TVï¼‰è¿™äº›è®¾å¤‡åªæœ‰ç‰©ç†ä¸Šä¸‹é”®ä¸å…·å¤‡è§¦æ‘¸åŠŸèƒ½ï¼Œ<br>é‚£ä¹ˆå½“æŠŠè¿™ä¸ªå±æ€§å€¼è®¾ç½®ä¸ºtrueçš„æ—¶å€™ï¼Œæ¯”å¦‚ä½ æŒ‰äº†ä¸€ä¸‹å‘ä¸‹é”®ï¼Œå±å¹•ä¸Šçš„å†…å®¹å°±ä¼šå¯¹åº”é€‰ä¸­ä¸€ä¸ªå‘ä¸‹çš„æ§ä»¶ï¼ˆå¦‚æœè¿™ä¸ªæ§ä»¶è®¾ç½®android:focusable&#x3D;trueçš„è¯ï¼‰ï¼Œå¦åˆ™å°±ä¼šé€‰ä¸­ä¸‹ä¸€ä¸ªå…·å¤‡focusableèƒ½åŠ›çš„æ§ä»¶ã€‚<br>android:focusableInTouchMode<br>ä¸ä¸Šé¢çš„é‚£ç§æƒ…å†µç›¸åï¼Œå¦‚æœæ˜¯é’ˆå¯¹æ‰‹æœºå¼€å‘çš„è¯ï¼Œé‚£ä¹ˆå¤§éƒ¨åˆ†æ‰‹æœºéƒ½å…·å¤‡è§¦æ‘¸åŠŸèƒ½ï¼Œé‚£ä¹ˆè¿™ä¸ªå±æ€§æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ<br>ä»äº¤äº’çš„è§’åº¦æ¥è®²ï¼Œç„¦ç‚¹çš„ä½œç”¨å…¶å®å°±æ˜¯ä¸ºäº†æç¤ºç”¨æˆ·å½“å‰æ§ä»¶å·²ç»è¢«é€‰ä¸­äº†ï¼Œå¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥çš„æ“ä½œã€‚æ¯”å¦‚åœ¨android5.0ä¸Šæ–°é€€å‡ºçš„Material Designæ•ˆæœä¸Šé¢ï¼Œå¦‚æœä¸€ä¸ªEditTextè¢«é€‰ä¸­äº†ï¼Œé‚£ä¹ˆå®ƒçš„è¾“å…¥æ¡†å°±ä¼šæ›´æ¢é¢œè‰²ä»¥ç¤ºåŒºåˆ«ï¼Œä½†æ˜¯åœ¨æ‰‹æœºå¼€å‘ä¸­å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ§ä»¶éƒ½éœ€è¦æœ‰é€‰ä¸­çš„è¿™ç§çŠ¶æ€ï¼Œé€šå¸¸åœ¨ç‚¹å‡»åå¯èƒ½åªæƒ³è¾¾åˆ°æŸç§æ•ˆæœï¼ˆå¦‚ç‚¹å‡»æŒ‰é’®å°±æ˜¯æƒ³è§¦å‘ç‚¹å‡»äº‹ä»¶ï¼Œä¸éœ€è¦æœ‰é€‰ä¸­æ•ˆæœï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœæŠŠandroid:focusableInTouchModeè®¾ç½®ä¸ºtrueï¼Œæ­¤æ—¶æ‰§è¡Œçš„å°±æ˜¯æ›´æ¢ç„¦ç‚¹æ“ä½œï¼Œç›¸åº”çš„äº‹ä»¶å°±æ— æ³•å¾—åˆ°åŠæ—¶ç›¸åº”ï¼Œè¿™æ ·çš„ä½“éªŒå°±ä¼šå¾ˆä¸å¥½ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    android:background=&quot;#ddffff&quot;</span><br><span class="line">    android:gravity=&quot;center&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot;</span><br><span class="line">    android:focusableInTouchMode=&quot;true&quot;</span><br><span class="line">    &gt;</span><br><span class="line">    </span><br><span class="line">    &lt;View</span><br><span class="line">        android:id=&quot;@+id/view_test&quot;</span><br><span class="line">        android:layout_width=&quot;100dip&quot;</span><br><span class="line">        android:layout_height=&quot;100dip&quot;</span><br><span class="line">        android:focusableInTouchMode=&quot;true&quot;</span><br><span class="line">        android:background=&quot;#ff0000&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;Button</span><br><span class="line">        android:id=&quot;@+id/bt_test&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_marginBottom=&quot;20dp&quot;</span><br><span class="line">        android:text=&quot;click me&quot;</span><br><span class="line">        android:focusableInTouchMode=&quot;true&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åˆ†åˆ«ä¸ºLinearLayoutï¼ŒViewï¼ŒButtonéƒ½å¢åŠ ä¸€ä¸ªè§¦æ‘¸æ—¶èƒ½å¤Ÿè·å–åˆ°ç„¦ç‚¹çš„å±æ€§</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">package com.yuneec.testdemo;</span><br><span class="line">import android.os.Bundle;import android.support.v7.app.AppCompatActivity;import android.util.Log;import android.view.View;import android.widget.Button;</span><br><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private View view_test;</span><br><span class="line">    private Button bt_test;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        view_test = findViewById(R.id.view_test);</span><br><span class="line">        bt_test = (Button) findViewById(R.id.bt_test);</span><br><span class="line"></span><br><span class="line">        view_test.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                Log.i(&quot;xp.chen&quot;, &quot;I am view, click................&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        view_test.setOnFocusChangeListener(new View.OnFocusChangeListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onFocusChange(View v, boolean hasFocus) &#123;</span><br><span class="line">                Log.i(&quot;xp.chen&quot;, &quot;==========================================&quot;);</span><br><span class="line">                Log.i(&quot;xp.chen&quot;, &quot;I am view, focus: &quot;+view_test.isFocused());</span><br><span class="line">                Log.i(&quot;xp.chen&quot;, &quot;I am button, focus: &quot;+bt_test.isFocused());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        bt_test.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                Log.i(&quot;xp.chen&quot;, &quot;I am button, click................&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        bt_test.setOnFocusChangeListener(new View.OnFocusChangeListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onFocusChange(View v, boolean hasFocus) &#123;</span><br><span class="line">                Log.i(&quot;xp.chen&quot;, &quot;==========================================&quot;);</span><br><span class="line">                Log.i(&quot;xp.chen&quot;, &quot;I am button, focus: &quot;+bt_test.isFocused());</span><br><span class="line">                Log.i(&quot;xp.chen&quot;, &quot;I am view, focus: &quot;+view_test.isFocused());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å…ˆç‚¹å‡»Viewï¼Œå‘ç°Viewçš„onClickäº‹ä»¶æœªæ‰“å°ï¼Œå†ç‚¹å‡»viewï¼Œå‘ç°viewçš„onclickäº‹ä»¶å¯ä»¥æ­£å¸¸æ‰“å°äº†ã€‚<br>ç„¶åç‚¹å‡»buttonï¼Œå‘ç°buttonçš„onclickäº‹ä»¶ä¹Ÿæœªæ‰“å°ï¼Œå†ç‚¹å‡»ä¸€æ¬¡buttonï¼Œå‘ç°buttonçš„onclickäº‹ä»¶å¯ä»¥æ­£å¸¸æ‰“å°äº†ã€‚<br>è¿™è¯´æ˜ç¬¬ä¸€æ¬¡ç‚¹å‡»viewæˆ–è€…buttonï¼ŒçŸ¥è¯†å•çº¯å°†ç„¦ç‚¹è½¬æ¢åˆ°äº†viewå’Œbuttonä¸Šï¼Œæ­¤æ—¶ä¼šè°ƒç”¨onFocusChangeListeneræ–¹æ³•ï¼Œåªæœ‰å½“å†æ¬¡ç‚¹å‡»çš„æ—¶å€™æ‰ä¼šè°ƒç”¨onClickæ–¹æ³•ã€‚<br>å› æ­¤ï¼Œè¿™ç§æ“ä½œå¯¹Buttonæ¥è¯´æ˜¯å¤šä½™çš„ï¼Œè€Œbuttonçš„android:focusableInTouchModeå±æ€§é»˜è®¤ä¹Ÿå°±æ˜¯falseã€‚<br>ä½†å¯¹äºEditTextè¿™ç§æ§ä»¶æ¥è¯´å°±ä¸ä¸€æ ·äº†ï¼Œæ¯”æ–¹è¯´ä¸€ä¸ªç•Œé¢ä¸Šæœ‰å¾ˆå¤šEditTextï¼Œåœ¨ä½ ç‚¹å‡»äº†å…¶ä¸­ä¸€ä¸ªçš„æ—¶å€™ï¼Œä½ å¿…é¡»å…ˆå‘ŠçŸ¥ç”¨æˆ·ä»–ç‚¹å‡»çš„æ˜¯å“ªä¸€ä¸ªï¼Œè¿™æ ·ç”¨æˆ·æ‰ä¸ä¼šè¾“é”™ï¼Œäº‹å®ä¸Šåœ¨androidæºä»£ç é‡Œé¢ï¼ŒEditTextçš„focusableInTouchModeå±æ€§é»˜è®¤ä¹Ÿå°±æ˜¯Trueã€‚</p>
]]></content>
      <categories>
        <category>android</category>
      </categories>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>GitHub+Hexoæ­å»ºä¸ªäººåšå®¢ç½‘ç«™</title>
    <url>/2022/09/18/GitHub-Hexo%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%BD%91%E7%AB%99/</url>
    <content><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯hexoï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯hexoï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯hexoï¼Ÿ"></a>ä»€ä¹ˆæ˜¯hexoï¼Ÿ</h2><p>Hexoæ˜¯ä¸€æ¬¾åŸºäºNode.jsçš„é™æ€åšå®¢æ¡†æ¶ï¼Œç‰¹ç‚¹æ˜¯å¿«é€Ÿï¼Œç®€ä»‹å¹¶ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ï¼ŒHexoä½¿ç”¨Markdownè§£ææ–‡ç« ï¼Œåœ¨å‡ ç§’å†…ï¼Œå³å¯åˆ©ç”¨é“ä¸½çš„ä¸»é¢˜ç”Ÿæˆé™æ€ç½‘é¡µã€‚å®ƒå¯ä»¥æ–¹ä¾¿çš„ç”Ÿæˆé™æ€ç½‘é¡µæ‰˜ç®¡åœ¨GitHubå’Œå…¶ä»–æ‰˜ç®¡å¹³å°ä¸Šï¼Œæ˜¯æ­å»ºåšå®¢çš„é¦–é€‰æ¡†æ¶ã€‚</p>
<span id="more"></span>
<h2 id="ä»€ä¹ˆæ˜¯githubï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯githubï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯githubï¼Ÿ"></a>ä»€ä¹ˆæ˜¯githubï¼Ÿ</h2><p>GitHubæ˜¯ä¸€ä¸ªåœ¨çº¿è½¯ä»¶æºä»£ç æ‰˜ç®¡æœåŠ¡å¹³å°ï¼Œä½¿ç”¨Gitä½œä¸ºç‰ˆæœ¬æ§åˆ¶è½¯ä»¶ï¼Œæ˜¯ä¸–ç•Œä¸Šæœ€å¤§çš„ä»£ç æ‰˜ç®¡ç½‘ç«™å’Œå¼€æºç¤¾åŒºã€‚æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯githubä¸Šçš„ä¸€ä¸ªæœåŠ¡ï¼ŒGitHub Pagesï¼Œå®ƒæ˜¯ç”±GitHubæä¾›çš„ä¸€ä¸ªç½‘é¡µå¯„å­˜æœåŠ¡ï¼Œå¯ä»¥ç”¨äºå­˜æ”¾é™æ€ç½‘é¡µï¼ŒåŒ…æ‹¬åšå®¢ï¼Œé¡¹ç›®æ–‡æ¡£ç”šè‡³æ•´æœ¬ä¹¦ã€‚ä¸€èˆ¬GitHub Pagesä½¿ç”¨github.ioçš„å­åŸŸåï¼Œä½†æ˜¯ç”¨æˆ·ä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åŸŸåã€‚</p>
<h2 id="æ­å»ºæ­¥éª¤ï¼š"><a href="#æ­å»ºæ­¥éª¤ï¼š" class="headerlink" title="æ­å»ºæ­¥éª¤ï¼š"></a>æ­å»ºæ­¥éª¤ï¼š</h2><h3 id="1-GitHubåˆ›å»ºä¸ªäººä»“åº“"><a href="#1-GitHubåˆ›å»ºä¸ªäººä»“åº“" class="headerlink" title="1.GitHubåˆ›å»ºä¸ªäººä»“åº“"></a>1.GitHubåˆ›å»ºä¸ªäººä»“åº“</h3><p>ç™»å½•åˆ°GitHubï¼Œå¦‚æœæ²¡æœ‰GitHubè´¦å·ï¼Œä½¿ç”¨ä½ çš„é‚®ç®±æ³¨å†ŒGitHubè´¦å·ï¼Œç‚¹å‡»GitHubä¸­çš„New repositoryåˆ›å»ºæ–°ä»“åº“ï¼Œä»“åº“ååº”è¯¥ä¸ºï¼šâ€œç”¨æˆ·å.github.ioâ€è¿™ä¸ªç”¨æˆ·åä½¿ç”¨ä½ çš„githubè´¦å·åç§°ä»£æ›¿ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å¯¹å›ºå®šçš„å†™æ³•ã€‚</p>
<h3 id="2-å®‰è£…git"><a href="#2-å®‰è£…git" class="headerlink" title="2.å®‰è£…git"></a>2.å®‰è£…git</h3><p>ä»€ä¹ˆæ˜¯gitï¼Ÿç®€å•æ¥è¯´Gitæ˜¯å¼€æºçš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œç”¨äºæ•æ·é«˜æ•ˆçš„å¤„ç†é¡¹ç›®ã€‚æˆ‘ä»¬ç½‘ç«™åœ¨æœ¬åœ°æ­å»ºå¥½äº†ï¼Œéœ€è¦ä½¿ç”¨GitåŒæ­¥åˆ°GitHubä¸Šï¼Œæ¨èä¸€ä¸ªå·¨å¥½çš„<a href="http://git.oschina.net/progit/index.html">gitæ•™ç¨‹</a>ã€‚<br>å®‰è£…æˆåŠŸåï¼Œå°†ä½ çš„Gitä¸GitHubè´¦å·ç»‘å®šï¼Œé¼ æ ‡å³å‡»æ‰“å¼€Git Bashï¼Œè®¾ç½®user.nameå’Œuser.eamilé…ç½®ä¿¡æ¯ï¼š<br>git config â€“global user.name â€œä½ çš„GitHubç”¨æˆ·åâ€<br>git config â€“global user.email â€œä½ çš„GitHubæ³¨å†Œé‚®ç®±â€<br>ç”Ÿæˆsshå¯†é’¥æ–‡ä»¶ï¼š<br>ssh-keygen -t rsa -C â€œä½ çš„GitHubæ³¨å†Œé‚®ç®±â€<br>ç„¶åç›´æ¥ä¸‰ä¸ªå›è½¦å³å¯ï¼Œé»˜è®¤ä¸éœ€è¦è®¾ç½®å¯†ç <br>ç„¶åæ‰¾åˆ°ç”Ÿæˆçš„.sshæ–‡ä»¶å¤¹ä¸­çš„id_rsa.pubå¯†é’¥ï¼Œå°†å†…å®¹å…¨éƒ¨å¤åˆ¶<br>æ‰“å¼€GitHub_Settings_keysé¡µé¢ï¼Œæ–°å»ºnew SSH Key<br>Titleä¸ºæ ‡é¢˜ï¼Œä»»æ„å¡«å†™å³å¯ï¼Œå°†åˆšåˆšå¤åˆ¶çš„id_rsa.pubå†…å®¹ç²˜è´´è¿›å»ï¼Œæœ€åç‚¹å‡»Add SSH Keyã€‚<br>åœ¨git bashä¸­æ£€æµ‹GitHubå…¬é’¥æ˜¯å¦æˆåŠŸï¼Œè¾“å…¥ssh <a href="mailto:&#x67;&#105;&#116;&#64;&#x67;&#105;&#x74;&#104;&#117;&#98;&#46;&#x63;&#111;&#x6d;">&#x67;&#105;&#116;&#64;&#x67;&#105;&#x74;&#104;&#117;&#98;&#46;&#x63;&#111;&#x6d;</a><br>è¿™é‡Œä¹‹æ‰€ä»¥è®¾ç½®GitHubå¯†é’¥çš„åŸå› æ˜¯ï¼Œé€šè¿‡éå¯¹ç§°åŠ å¯†çš„å…¬é’¥ä¸ç§é’¥æ¥å®ŒæˆåŠ å¯†ï¼Œå…¬é’¥æ”¾ç½®åœ¨githubä¸Šï¼Œç§é’¥æ”¾ç½®åœ¨è‡ªå·±çš„ç”µè„‘é‡Œã€‚githubè¦æ±‚æ¯æ¬¡æ¨é€ä»£ç éƒ½æ˜¯åˆæ³•ç”¨æˆ·ï¼Œæ‰€ä»¥æ¯æ¬¡æ¨é€éƒ½è¦è¾“å…¥è´¦å·å¯†ç éªŒè¯æ¨é€ç”¨æˆ·æ˜¯å¦åˆæ³•ç”¨æˆ·ï¼Œä¸ºäº†çœå»æ¯æ¬¡è¾“å…¥å¯†ç çš„æ­¥éª¤ï¼Œé‡‡ç”¨sshï¼Œå½“ä½ æ¨é€çš„æ—¶å€™ï¼Œgitå°±ä¼šåŒ¹é…ä½ çš„ç§é’¥è·Ÿgithubä¸Šé¢çš„å…¬é’¥æ˜¯å¦æ˜¯é…å¯¹çš„ï¼Œè‹¥æ˜¯åŒ¹é…å°±è®¤ä¸ºä½ æ˜¯åˆæ³•ç”¨æˆ·ï¼Œåˆ™å…è®¸æ¨é€ã€‚</p>
<h3 id="3-å®‰è£…Node-js"><a href="#3-å®‰è£…Node-js" class="headerlink" title="3.å®‰è£…Node.js"></a>3.å®‰è£…Node.js</h3><p>HexoåŸºäºNode.jsï¼Œ<a href="https://nodejs.org/en/download/">Node.jsä¸‹è½½åœ°å€</a>ï¼Œæ³¨æ„å®‰è£…node.jsä¼šåŒ…å«ç¯å¢ƒå˜é‡åŠnpmçš„å®‰è£…ï¼Œå®‰è£…åï¼Œæ£€æµ‹node.jsæ˜¯å¦å®‰è£…æˆåŠŸï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥node -vï¼Œæ£€æµ‹npmæ˜¯å¦å®‰è£…æˆåŠŸï¼Œnpm -v<br>åˆ°è¿™å„¿ï¼Œå®‰è£…Hexoçš„ç¯å¢ƒå·²ç»å…¨éƒ¨æ­å»ºå®Œæˆã€‚</p>
<h3 id="4-å®‰è£…Hexo"><a href="#4-å®‰è£…Hexo" class="headerlink" title="4.å®‰è£…Hexo"></a>4.å®‰è£…Hexo</h3><p>hexoå°±æ˜¯æˆ‘ä»¬çš„ä¸ªäººåšå®¢ç½‘ç«™çš„æ¡†æ¶ï¼Œè¿™é‡Œéœ€è¦è‡ªå·±åœ¨ç”µè„‘é‡Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¯ä»¥å‘½åä¸ºBlogï¼ŒHexoæ¡†æ¶ä¸ä»¥åä½ è‡ªå·±å‘å¸ƒçš„ç½‘é¡µéƒ½åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œåˆ›å»ºå¥½åï¼Œè¿›å…¥æ–‡ä»¶å¤¹ä¸­ï¼Œæ‰“å¼€å‘½ä»¤è¡Œçª—å£ã€‚<br>ä½¿ç”¨npmå‘½ä»¤å®‰è£…Hexoï¼Œè¾“å…¥ï¼š<br>npm install -g hexo-cli<br>è¿™ä¸ªå®‰è£…æ—¶é—´è¾ƒé•¿è€å¿ƒç­‰å¾…ï¼Œå®‰è£…å®Œæˆåï¼Œåˆå§‹åŒ–æˆ‘ä»¬çš„åšå®¢ï¼Œè¾“å…¥ï¼š<br>hexo init blog<br>æ³¨æ„ï¼šè¿™é‡Œçš„å‘½ä»¤éƒ½æ˜¯ä½œç”¨åœ¨åˆšåˆšåˆ›å»ºçš„blogæ–‡ä»¶å¤¹ä¸­ã€‚<br>åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥å¯åŠ¨å‘½ä»¤ï¼š<br>hexo server<br>æ‰“å¼€æµè§ˆå™¨å“¦ç½‘å€å¯ä»¥çœ‹åˆ°ç½‘ç«™çš„æ ·å¼</p>
<h3 id="5-æ¨é€ç½‘ç«™"><a href="#5-æ¨é€ç½‘ç«™" class="headerlink" title="5.æ¨é€ç½‘ç«™"></a>5.æ¨é€ç½‘ç«™</h3><p>ä¸Šé¢åªæ˜¯åœ¨æœ¬åœ°é¢„è§ˆï¼Œæ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯æ¨é€ç½‘ç«™ï¼Œä¹Ÿå°±æ˜¯å‘å¸ƒç½‘ç«™ï¼Œè®©æˆ‘ä»¬çš„ç½‘ç«™å¯ä»¥è¢«æ›´å¤šäººè®¿é—®åˆ°ã€‚åœ¨è®¾ç½®ä¹‹å‰ï¼Œéœ€è¦è§£é‡Šä¸€ä¸ªæ¦‚å¿µï¼Œåœ¨blogæ ¹ç›®å½•é‡Œçš„_config.ymlæ–‡ä»¶ç§°ä¸ºç«™ç‚¹é…ç½®æ–‡ä»¶<br>è¿›å…¥themesæ–‡ä»¶å¤¹ï¼Œé‡Œé¢ä¹Ÿæœ‰ä¸ª_config.ymlæ–‡ä»¶ï¼Œè¿™ä¸ªç§°ä¸ºä¸»é¢˜é…ç½®æ–‡ä»¶<br>ç°åœ¨éœ€è¦åšçš„æ˜¯å°†æˆ‘ä»¬çš„Hexoå’ŒGitHubå…³è”èµ·æ¥ï¼Œæ‰“å¼€ç«™ç‚¹çš„é…ç½®æ–‡ä»¶_config.ymlï¼Œç¿»åˆ°æœ€åä¿®æ”¹ä¸ºï¼š<br>deploy:<br>type: git<br>repo: è¿™é‡Œå¡«å…¥ä½ ä¹‹å‰åœ¨GitHubä¸Šåˆ›å»ºä»“åº“çš„å®Œæ•´å†ç»ï¼Œè®°å¾—åŠ ä¸Š.git<br>branch: master<br>ä¿å­˜ç«™ç‚¹é…ç½®æ–‡ä»¶ã€‚<br>å…¶å®å°±æ˜¯ç»™hexo dè¿™ä¸ªå‘½ä»¤åšç›¸åº”çš„é…ç½®ï¼Œè®©hexoçŸ¥é“ä½ è¦æŠŠblogéƒ¨ç½²åœ¨å“ªä¸ªä½ç½®ï¼Œå¾ˆæ˜¾ç„¶ï¼Œæˆ‘ä»¬éƒ¨ç½²åœ¨æˆ‘ä»¬GitHubçš„ä»“åº“é‡Œï¼Œæœ€åå®‰è£…gitéƒ¨ç½²æ’ä»¶ï¼Œè¾“å…¥å‘½ä»¤ï¼š<br>npm install hexo-deployer-git â€“save<br>è¿™æ—¶ï¼Œæˆ‘ä»¬åˆ†åˆ«è¾“å…¥ä¸‰æ¡å‘½ä»¤ï¼š<br>hexo clean<br>hexo g<br>hexo d<br>å…¶å®ç¬¬ä¸‰æ¡hexo då°±æ˜¯éƒ¨ç½²ç½‘ç«™çš„å‘½ä»¤ï¼Œdæ˜¯deployçš„ç¼©å†™ï¼Œå®Œæˆåï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œåœ¨åœ°å€æ è¾“å…¥ä½ çš„æ”¾ç½®ä¸ªäººç½‘ç«™çš„ä»“åº“è·¯å¾„ï¼Œä½ å°±å¯ä»¥å‘ç°ä½ çš„åšå®¢å·²ç»ä¸Šçº¿äº†ï¼Œå¯ä»¥åœ¨ç½‘ç»œä¸Šè¢«è®¿é—®åˆ°ã€‚</p>
<h2 id="å¸¸ç”¨hexoå‘½ä»¤åŠè§£é‡Š"><a href="#å¸¸ç”¨hexoå‘½ä»¤åŠè§£é‡Š" class="headerlink" title="å¸¸ç”¨hexoå‘½ä»¤åŠè§£é‡Š"></a>å¸¸ç”¨hexoå‘½ä»¤åŠè§£é‡Š</h2><p>hexo init [folder]<br>æ–°å»ºä¸€ä¸ªç½‘ç«™ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®folderï¼ŒHexoé»˜è®¤åœ¨ç›®å‰çš„æ–‡ä»¶å¤¹å»ºç«‹ç½‘ç«™ã€‚<br>æœ¬å‘½ä»¤ç›¸å½“äºæ‰§è¡Œäº†ä»¥ä¸‹å‡ æ­¥ï¼š<br>1.Git clone <a href="https://github.com/hexojs/hexo-starter">hexo-starter</a>å’Œ<a href="https://github.com/hexojs/hexo-theme-landscape">hexo-theme-landscape</a>ä¸»é¢˜åˆ°å½“å‰ç›®å½•æˆ–è€…æŒ‡å®šç›®å½•<br>2.ä½¿ç”¨<a href="https://classic.yarnpkg.com/lang/en/">Yarn 1</a>ã€<a href="https://pnpm.js.org/">pnpm</a>æˆ–è€…<a href="https://docs.npmjs.com/cli/install">npm</a>åŒ…ç®¡ç†å™¨ä¸‹è½½ä¾èµ–ï¼ˆå¦‚æœ‰å·²å®‰è£…å¤šä¸ªï¼Œåˆ™åˆ—åœ¨å‰é¢çš„ä¼˜å…ˆï¼‰ã€‚npmé»˜è®¤éš<a href="https://hexo.io/docs/#Install-Node-js">Node.js</a>å®‰è£…ã€‚</p>
<p>hexo new [layout] &lt;title&gt;<br>æ–°å»ºä¸€ç¯‡æ–‡ç« ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®layoutçš„è¯ï¼Œé»˜è®¤ä½¿ç”¨_config.ymlä¸­çš„default_layoutå‚æ•°ä»£æ›¿ï¼Œå¦‚æœæ ‡é¢˜åŒ…å«ç©ºæ ¼çš„è¯ï¼Œè¯·ä½¿ç”¨å¼•å·æ‹¬èµ·æ¥ã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼ŒHexoä¼šä½¿ç”¨æ–‡ç« çš„æ ‡é¢˜æ¥å†³å®šæ–‡ç« æ–‡ä»¶çš„è·¯å¾„ã€‚å¯¹äºç‹¬ç«‹é¡µé¢æ¥è¯´ï¼ŒHexoä¼šåˆ›å»ºä¸€ä¸ªä»¥æ ‡é¢˜ä¸ºåå­—çš„ç›®å½•ï¼Œå¹¶åœ¨ç›®å½•ä¸­æ”¾ç½®ä¸€ä¸ªindex.mdæ–‡ä»¶ã€‚ä½ å¯ä»¥ä½¿ç”¨â€“pathå‚æ•°è¦†ç›–ä¸Šè¿°è¡Œä¸ºã€è‡ªè¡Œå†³å®šæ–‡ä»¶çš„ç›®å½•ï¼š<br>hexo new page â€“path about&#x2F;me â€œAbout meâ€<br>ä»¥ä¸Šå‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªsource&#x2F;about&#x2F;me.mdï¼ŒåŒæ—¶me.mdçš„Front Matterä¸­çš„titleä¸ºâ€œpageâ€ã€‚è¿™æ˜¯å› ä¸ºåœ¨ä¸Šè¿°å‘½ä»¤ä¸­ï¼Œhexo-cliå°†pageè§†ä¸ºæŒ‡å®šæ–‡ç« çš„æ ‡é¢˜ï¼Œå¹¶é‡‡ç”¨é»˜è®¤çš„layout</p>
<p>hexo generate<br>ç”Ÿæˆé™æ€æ–‡ä»¶ã€‚</p>
<p>hexo publish [layout] &lt;filename&gt;<br>å‘è¡¨è‰ç¨¿</p>
<p>hexo server<br>å¯åŠ¨æœåŠ¡å™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè®¿é—®åœ°å€ä¸ºï¼š<br><a href="http://localhost:4000/%E3%80%82">http://localhost:4000/ã€‚</a></p>
<p>hexo deploy<br>éƒ¨ç½²ç½‘ç«™ã€‚</p>
<p>hexo clean<br>æ¸…æ¥šç¼“å­˜æ–‡ä»¶ï¼ˆdb.jsonï¼‰å’Œå·²ç”Ÿæˆçš„é™æ€æ–‡ä»¶ï¼ˆpublic)ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆå°¤å…¶æ˜¯æ›´æ¢ä¸»é¢˜åï¼‰,å¦‚æœå‘ç°æ‚¨å¯¹ç«™ç‚¹çš„æ›´æ”¹æ— è®ºå¦‚ä½•ä¹Ÿä¸ç”Ÿæ•ˆï¼Œæ‚¨å¯èƒ½éœ€è¦è¿è¡Œè¯¥å‘½ä»¤ã€‚</p>
<p>hexo list &lt;type&gt;<br>åˆ—å‡ºç½‘ç«™èµ„æ–™</p>
<h3 id="é€‰é¡¹"><a href="#é€‰é¡¹" class="headerlink" title="é€‰é¡¹"></a>é€‰é¡¹</h3><p>hexo â€“safe<br>åœ¨å®‰å…¨æ¨¡å¼ä¸‹ï¼Œä¸ä¼šè½½å…¥æ’ä»¶å’Œè„šæœ¬ã€‚å½“æ‚¨åœ¨å®‰è£…æ–°æ’ä»¶é­é‡é—®é¢˜æ—¶ï¼Œå¯ä»¥å°è¯•ä»¥å®‰å…¨æ¨¡å¼é‡æ–°æ‰§è¡Œã€‚</p>
<p>hexo â€“debug<br>åœ¨ç»ˆç«¯ä¸­æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯å¹¶è®°å½•åˆ°debug.logã€‚å½“æ‚¨ç¢°åˆ°é—®é¢˜æ—¶ï¼Œå¯ä»¥å°è¯•ç”¨è°ƒè¯•æ¨¡å¼é‡æ–°æ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶<a href="https://github.com/hexojs/hexo/issues/new">æäº¤è°ƒå¼ä¿¡æ¯åˆ°GitHub</a>.</p>
<p>hexo â€“silent<br>éšè—ç»ˆç«¯ä¿¡æ¯ã€‚</p>
<p>æ›´å¤šè¯¦æƒ…å¯ä»¥æŸ¥çœ‹<a href="https://zhuanlan.zhihu.com/p/26625249">æ­¤ç¯‡æ–‡æ¡£</a></p>
]]></content>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustä¸­Protobufä½¿ç”¨ç®€ä»‹</title>
    <url>/2024/01/26/Rust%E4%B8%ADProtobuf%E4%BD%BF%E7%94%A8%E7%AE%80%E4%BB%8B/</url>
    <content><![CDATA[<p>Protobufï¼ˆProtocol Buffersï¼‰æ˜¯ Google æ¨å‡ºçš„é«˜æ•ˆåºåˆ—åŒ–åè®®ã€‚Rustä¸­ï¼Œprost æ˜¯æœ€ä¸»æµçš„ Protobuf å®ç°ï¼Œæä¾›äº†ç¼–è¯‘æœŸä»£ç ç”Ÿæˆå’Œè¿è¡Œæ—¶åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–èƒ½åŠ›ã€‚</p>
<span id="more"></span>

<h2 id="Protobuf-ç®€ä»‹"><a href="#Protobuf-ç®€ä»‹" class="headerlink" title="Protobuf ç®€ä»‹"></a>Protobuf ç®€ä»‹</h2><p>Protobuf æ˜¯ä¸€ç§æ•°æ®åºåˆ—åŒ–åè®®ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li><strong>é«˜æ•ˆæ€§</strong>ï¼šæ¯” JSONã€XML æ›´ç´§å‡‘ï¼Œåºåˆ—åŒ–é€Ÿåº¦æ›´å¿«</li>
<li><strong>å‘åå…¼å®¹æ€§</strong>ï¼šæ”¯æŒæ–°æ—§ç‰ˆæœ¬å…±å­˜</li>
<li><strong>è¯­è¨€ä¸­ç«‹</strong>ï¼šæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼ˆJavaã€Pythonã€C++ã€Goã€Rustç­‰ï¼‰</li>
<li><strong>æ¨¡å¼æ¼”è¿›</strong>ï¼šçµæ´»æ”¯æŒå­—æ®µæ·»åŠ å’Œä¿®æ”¹</li>
</ul>
<h2 id="1-å·¥å…·ä¸ç¯å¢ƒ"><a href="#1-å·¥å…·ä¸ç¯å¢ƒ" class="headerlink" title="1. å·¥å…·ä¸ç¯å¢ƒ"></a>1. å·¥å…·ä¸ç¯å¢ƒ</h2><p>ä½¿ç”¨ Rust + Protobuf éœ€è¦ä»¥ä¸‹å·¥å…·ï¼š</p>
<h3 id="å¿…å¤‡å·¥å…·"><a href="#å¿…å¤‡å·¥å…·" class="headerlink" title="å¿…å¤‡å·¥å…·"></a>å¿…å¤‡å·¥å…·</h3><ul>
<li><strong>protoc</strong>ï¼šProtobuf å®˜æ–¹ç¼–è¯‘å™¨ï¼ˆè´Ÿè´£è§£æ <code>.proto</code> æ–‡ä»¶ï¼‰</li>
<li><strong>prost</strong>ï¼šRust çš„ Protobuf è¿è¡Œæ—¶åº“ï¼ˆæä¾›åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–é€»è¾‘ï¼‰</li>
<li><strong>prost-build</strong>ï¼šRust çš„ Protobuf ç¼–è¯‘å·¥å…·ï¼ˆé›†æˆ <code>protoc</code>ï¼Œç”Ÿæˆ Rust ä»£ç ï¼‰</li>
</ul>
<h3 id="Windows-ä¸‹-protoc-å®‰è£…"><a href="#Windows-ä¸‹-protoc-å®‰è£…" class="headerlink" title="Windows ä¸‹ protoc å®‰è£…"></a>Windows ä¸‹ protoc å®‰è£…</h3><p>ä½¿ç”¨ winget å®‰è£…ï¼ˆæ¨èï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. æœç´¢ protoc</span></span><br><span class="line">winget search protoc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å®‰è£…</span></span><br><span class="line">winget install Google.Protobuf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. éªŒè¯å®‰è£…</span></span><br><span class="line">protoc --version</span><br><span class="line"><span class="comment"># è¾“å‡º libprotoc 33.0 æˆ–æ›´é«˜ç‰ˆæœ¬å³å¯</span></span><br></pre></td></tr></table></figure>

<h3 id="å…¶ä»–ç³»ç»Ÿå®‰è£…æ–¹å¼"><a href="#å…¶ä»–ç³»ç»Ÿå®‰è£…æ–¹å¼" class="headerlink" title="å…¶ä»–ç³»ç»Ÿå®‰è£…æ–¹å¼"></a>å…¶ä»–ç³»ç»Ÿå®‰è£…æ–¹å¼</h3><ul>
<li><strong>macOS</strong>ï¼š<code>brew install protobuf</code></li>
<li><strong>Linux</strong>ï¼š<code>apt-get install protobuf-compiler</code>ï¼ˆUbuntu&#x2F;Debianï¼‰</li>
</ul>
<h2 id="2-é¡¹ç›®ä¸­ä½¿ç”¨"><a href="#2-é¡¹ç›®ä¸­ä½¿ç”¨" class="headerlink" title="2. é¡¹ç›®ä¸­ä½¿ç”¨"></a>2. é¡¹ç›®ä¸­ä½¿ç”¨</h2><h3 id="é…ç½®-Cargo-toml"><a href="#é…ç½®-Cargo-toml" class="headerlink" title="é…ç½® Cargo.toml"></a>é…ç½® Cargo.toml</h3><p>åœ¨é¡¹ç›®çš„ <code>Cargo.toml</code> ä¸­æ·»åŠ ä¾èµ–ï¼š</p>
<figure class="highlight toml"><table><tr><td class="code"><pre><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">prost</span> = <span class="string">&quot;0.14.1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[build-dependencies]</span></span><br><span class="line"><span class="attr">prost-build</span> = <span class="string">&quot;0.14.1&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»º-Proto-æ–‡ä»¶"><a href="#åˆ›å»º-Proto-æ–‡ä»¶" class="headerlink" title="åˆ›å»º Proto æ–‡ä»¶"></a>åˆ›å»º Proto æ–‡ä»¶</h3><p>åœ¨é¡¹ç›®ä¸­åˆ›å»º <code>proto/hello.proto</code> æ–‡ä»¶ï¼š</p>
<figure class="highlight protobuf"><table><tr><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> hello;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">MyMessage</span> &#123;</span><br><span class="line">  <span class="type">string</span> name = <span class="number">1</span>;</span><br><span class="line">  <span class="type">int32</span> id = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Proto æ–‡ä»¶è¯´æ˜ï¼š</strong></p>
<ul>
<li><code>syntax = &quot;proto3&quot;</code>ï¼šä½¿ç”¨ proto3 è¯­æ³•</li>
<li><code>package hello</code>ï¼šå®šä¹‰åŒ…åï¼ˆå¯¹åº” Rust ä¸­çš„ moduleï¼‰</li>
<li><code>message</code>ï¼šå®šä¹‰æ¶ˆæ¯ç»“æ„ï¼ˆå¯¹åº” Rust ä¸­çš„ structï¼‰</li>
<li><code>string name = 1</code>ï¼šå­—æ®µç±»å‹ + å­—æ®µå + å­—æ®µåºå·</li>
</ul>
<h3 id="ç¼–å†™-build-rs-è„šæœ¬"><a href="#ç¼–å†™-build-rs-è„šæœ¬" class="headerlink" title="ç¼–å†™ build.rs è„šæœ¬"></a>ç¼–å†™ build.rs è„šæœ¬</h3><p>åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º <code>build.rs</code> ç”¨äºç¼–è¯‘ proto æ–‡ä»¶ä¸º Rust ä»£ç ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> prost_build;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;cargo:rerun-if-changed=proto/hello.proto&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºè¾“å‡ºç›®å½•</span></span><br><span class="line">    std::fs::<span class="title function_ invoke__">create_dir_all</span>(<span class="string">&quot;src/pb&quot;</span>)</span><br><span class="line">        .<span class="title function_ invoke__">expect</span>(<span class="string">&quot;Failed to create output directory&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¼–è¯‘ proto æ–‡ä»¶</span></span><br><span class="line">    prost_build::Config::<span class="title function_ invoke__">new</span>()</span><br><span class="line">        .<span class="title function_ invoke__">out_dir</span>(<span class="string">&quot;src/pb&quot;</span>)</span><br><span class="line">        .<span class="title function_ invoke__">compile_protos</span>(&amp;[<span class="string">&quot;proto/hello.proto&quot;</span>], &amp;[<span class="string">&quot;proto/&quot;</span>])</span><br><span class="line">        .<span class="title function_ invoke__">expect</span>(<span class="string">&quot;Failed to compile proto files&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>build.rs å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li><code>out_dir(&quot;src/pb&quot;)</code>ï¼šç¼–è¯‘ç”Ÿæˆçš„ Rust æ–‡ä»¶å­˜æ”¾ä½ç½®</li>
<li><code>compile_protos(&amp;[&quot;proto/hello.proto&quot;], &amp;[&quot;proto/&quot;])</code>ï¼š<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šè¦ç¼–è¯‘çš„ proto æ–‡ä»¶ï¼ˆæ”¯æŒå¤šä¸ªï¼‰</li>
<li>ç¬¬äºŒä¸ªå‚æ•°ï¼šproto æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•</li>
</ul>
</li>
</ul>
<p><strong>build æˆåŠŸå</strong>ï¼Œä¼šåœ¨ <code>src/pb</code> ä¸‹åˆ›å»º <code>hello.rs</code> æ–‡ä»¶ï¼ˆä¸ proto æ–‡ä»¶ä¸­çš„ package åç§°ç›¸åŒï¼‰ã€‚</p>
<h3 id="ä½¿ç”¨ç”Ÿæˆçš„ä»£ç "><a href="#ä½¿ç”¨ç”Ÿæˆçš„ä»£ç " class="headerlink" title="ä½¿ç”¨ç”Ÿæˆçš„ä»£ç "></a>ä½¿ç”¨ç”Ÿæˆçš„ä»£ç </h3><h4 id="æ–¹æ³•1ï¼šä½¿ç”¨-include-å®"><a href="#æ–¹æ³•1ï¼šä½¿ç”¨-include-å®" class="headerlink" title="æ–¹æ³•1ï¼šä½¿ç”¨ include! å®"></a>æ–¹æ³•1ï¼šä½¿ç”¨ include! å®</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">include!(<span class="string">&quot;pb/hello.rs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> prost::Message;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">msg</span> = MyMessage &#123;</span><br><span class="line">        name: <span class="string">&quot;Protobuf example&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        id: <span class="number">123</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="variable">encoded</span> = msg.<span class="title function_ invoke__">encode_to_vec</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Encoded Msg: &#123;:?&#125;&quot;</span>, encoded);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">decoded</span> = MyMessage::<span class="title function_ invoke__">decode</span>(&amp;encoded[..]).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Decoded Msg: &#123;:?&#125;&quot;</span>, decoded);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ–¹æ³•2ï¼šä½¿ç”¨-mod-å’Œ-useï¼ˆæ¨èï¼‰"><a href="#æ–¹æ³•2ï¼šä½¿ç”¨-mod-å’Œ-useï¼ˆæ¨èï¼‰" class="headerlink" title="æ–¹æ³•2ï¼šä½¿ç”¨ mod å’Œ useï¼ˆæ¨èï¼‰"></a>æ–¹æ³•2ï¼šä½¿ç”¨ mod å’Œ useï¼ˆæ¨èï¼‰</h4><p><strong>1. åœ¨ src&#x2F;pb ä¸‹åˆ›å»º mod.rsï¼š</strong></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> hello;</span><br></pre></td></tr></table></figure>

<p><strong>2. åœ¨ src&#x2F;main.rs ä¸­å¼•å…¥ï¼š</strong></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mod</span> pb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> pb::hello::MyMessage;</span><br><span class="line"><span class="keyword">use</span> prost::Message;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">msg</span> = MyMessage &#123;</span><br><span class="line">        name: <span class="string">&quot;Protobuf example&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        id: <span class="number">123</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">encoded</span> = msg.<span class="title function_ invoke__">encode_to_vec</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Encoded Msg: &#123;:?&#125;&quot;</span>, encoded);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">decoded</span> = MyMessage::<span class="title function_ invoke__">decode</span>(&amp;encoded[..]).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Decoded Msg: &#123;:?&#125;&quot;</span>, decoded);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-å¸¸è§-Proto-ç±»å‹æ˜ å°„"><a href="#3-å¸¸è§-Proto-ç±»å‹æ˜ å°„" class="headerlink" title="3. å¸¸è§ Proto ç±»å‹æ˜ å°„"></a>3. å¸¸è§ Proto ç±»å‹æ˜ å°„</h2><table>
<thead>
<tr>
<th>Proto ç±»å‹</th>
<th>Rust ç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>string</code></td>
<td><code>String</code></td>
<td>å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td><code>bytes</code></td>
<td><code>Vec&lt;u8&gt;</code></td>
<td>å­—èŠ‚æ•°ç»„</td>
</tr>
<tr>
<td><code>int32</code> &#x2F; <code>int64</code></td>
<td><code>i32</code> &#x2F; <code>i64</code></td>
<td>æ•´æ•°</td>
</tr>
<tr>
<td><code>uint32</code> &#x2F; <code>uint64</code></td>
<td><code>u32</code> &#x2F; <code>u64</code></td>
<td>æ— ç¬¦å·æ•´æ•°</td>
</tr>
<tr>
<td><code>float</code> &#x2F; <code>double</code></td>
<td><code>f32</code> &#x2F; <code>f64</code></td>
<td>æµ®ç‚¹æ•°</td>
</tr>
<tr>
<td><code>bool</code></td>
<td><code>bool</code></td>
<td>å¸ƒå°”å€¼</td>
</tr>
<tr>
<td><code>repeated</code></td>
<td><code>Vec&lt;T&gt;</code></td>
<td>æ•°ç»„&#x2F;åˆ—è¡¨</td>
</tr>
</tbody></table>
<h2 id="4-å¸¸ç”¨åºåˆ—åŒ–æ–¹æ³•"><a href="#4-å¸¸ç”¨åºåˆ—åŒ–æ–¹æ³•" class="headerlink" title="4. å¸¸ç”¨åºåˆ—åŒ–æ–¹æ³•"></a>4. å¸¸ç”¨åºåˆ—åŒ–æ–¹æ³•</h2><h3 id="åºåˆ—åŒ–ï¼ˆEncodeï¼‰"><a href="#åºåˆ—åŒ–ï¼ˆEncodeï¼‰" class="headerlink" title="åºåˆ—åŒ–ï¼ˆEncodeï¼‰"></a>åºåˆ—åŒ–ï¼ˆEncodeï¼‰</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> prost::Message;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">msg</span> = MyMessage &#123; ... &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–ç ä¸ºå­—èŠ‚å‘é‡</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">bytes</span> = msg.<span class="title function_ invoke__">encode_to_vec</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–ç å¹¶å†™å…¥ Writer</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">buf</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">msg.<span class="title function_ invoke__">encode</span>(&amp;<span class="keyword">mut</span> buf).<span class="title function_ invoke__">unwrap</span>();</span><br></pre></td></tr></table></figure>

<h3 id="ååºåˆ—åŒ–ï¼ˆDecodeï¼‰"><a href="#ååºåˆ—åŒ–ï¼ˆDecodeï¼‰" class="headerlink" title="ååºåˆ—åŒ–ï¼ˆDecodeï¼‰"></a>ååºåˆ—åŒ–ï¼ˆDecodeï¼‰</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»å­—èŠ‚åˆ‡ç‰‡è§£ç </span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">decoded</span> = MyMessage::<span class="title function_ invoke__">decode</span>(&amp;bytes[..]).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä» Reader è§£ç </span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">decoded</span> = MyMessage::<span class="title function_ invoke__">decode</span>(&amp;<span class="keyword">mut</span> reader).<span class="title function_ invoke__">unwrap</span>();</span><br></pre></td></tr></table></figure>

<h2 id="5-æ›´å¤æ‚çš„ä¾‹å­"><a href="#5-æ›´å¤æ‚çš„ä¾‹å­" class="headerlink" title="5. æ›´å¤æ‚çš„ä¾‹å­"></a>5. æ›´å¤æ‚çš„ä¾‹å­</h2><p><strong>proto æ–‡ä»¶ï¼š</strong></p>
<figure class="highlight protobuf"><table><tr><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> user;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="type">int32</span> id = <span class="number">1</span>;</span><br><span class="line">  <span class="type">string</span> name = <span class="number">2</span>;</span><br><span class="line">  <span class="type">string</span> email = <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">repeated</span> <span class="type">string</span> tags = <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">UserList</span> &#123;</span><br><span class="line">  <span class="keyword">repeated</span> User users = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Rust ä½¿ç”¨ä»£ç ï¼š</strong></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> prost::Message;</span><br><span class="line"><span class="keyword">use</span> pb::user::&#123;User, UserList&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">user1</span> = User &#123;</span><br><span class="line">        id: <span class="number">1</span>,</span><br><span class="line">        name: <span class="string">&quot;Alice&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        email: <span class="string">&quot;alice@example.com&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        tags: <span class="built_in">vec!</span>[<span class="string">&quot;admin&quot;</span>.<span class="title function_ invoke__">to_string</span>(), <span class="string">&quot;user&quot;</span>.<span class="title function_ invoke__">to_string</span>()],</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">user2</span> = User &#123;</span><br><span class="line">        id: <span class="number">2</span>,</span><br><span class="line">        name: <span class="string">&quot;Bob&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        email: <span class="string">&quot;bob@example.com&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        tags: <span class="built_in">vec!</span>[<span class="string">&quot;user&quot;</span>.<span class="title function_ invoke__">to_string</span>()],</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">user_list</span> = UserList &#123;</span><br><span class="line">        users: <span class="built_in">vec!</span>[user1, user2],</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">bytes</span> = user_list.<span class="title function_ invoke__">encode_to_vec</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Serialized: &#123;&#125; bytes&quot;</span>, bytes.<span class="title function_ invoke__">len</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">decoded</span> = UserList::<span class="title function_ invoke__">decode</span>(&amp;bytes[..]).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">user</span> <span class="keyword">in</span> decoded.users &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;User: &#123;&#125; (&#123;&#125;)&quot;</span>, user.name, user.email);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li><strong>Protobuf</strong> æ˜¯é«˜æ•ˆçš„æ•°æ®åºåˆ—åŒ–åè®®ï¼Œé€‚åˆç½‘ç»œä¼ è¾“å’Œå­˜å‚¨</li>
<li><strong>prost</strong> æ˜¯ Rust ä¸­æœ€æµè¡Œçš„ Protobuf å®ç°</li>
<li><strong>build.rs</strong> è„šæœ¬åœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨ç”Ÿæˆ Rust ä»£ç </li>
<li><strong>åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–</strong> é€šè¿‡ <code>Message</code> trait çš„æ–¹æ³•å®ç°</li>
<li>Protobuf æ”¯æŒå¤æ‚åµŒå¥—ç»“æ„ã€æ•°ç»„ã€å‘åå…¼å®¹æ€§ç­‰é«˜çº§ç‰¹æ€§</li>
<li>é€‚ç”¨åœºæ™¯ï¼šå¾®æœåŠ¡ã€RPCã€æ¶ˆæ¯é˜Ÿåˆ—ã€æ•°æ®å­˜å‚¨ç­‰</li>
</ul>
]]></content>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustä¸­å­—ç¬¦ä¸²ä¸æ ¼å¼åŒ–</title>
    <url>/2023/11/24/Rust%E4%B8%AD%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8E%E6%A0%BC%E5%BC%8F%E5%8C%96/</url>
    <content><![CDATA[<p>Rust æä¾›äº†å¤šç§å­—ç¬¦ä¸²ç±»å‹å’Œå¼ºå¤§çš„æ ¼å¼åŒ–å·¥å…·ã€‚</p>
<span id="more"></span>

<h2 id="å­—ç¬¦ä¸²ç±»å‹"><a href="#å­—ç¬¦ä¸²ç±»å‹" class="headerlink" title="å­—ç¬¦ä¸²ç±»å‹"></a>å­—ç¬¦ä¸²ç±»å‹</h2><p>Rust ä¸­ä¸»è¦æœ‰ä¸¤ç§å­—ç¬¦ä¸²ç±»å‹ï¼š<code>&amp;str</code>ï¼ˆå­—ç¬¦ä¸²åˆ‡ç‰‡ï¼‰å’Œ <code>String</code>ï¼ˆåŠ¨æ€å­—ç¬¦ä¸²ï¼‰ï¼ŒäºŒè€…å‡åŸºäº <strong>UTF-8 ç¼–ç </strong>ã€‚</p>
<h3 id="String-åŠ¨æ€å­—ç¬¦ä¸²"><a href="#String-åŠ¨æ€å­—ç¬¦ä¸²" class="headerlink" title="String - åŠ¨æ€å­—ç¬¦ä¸²"></a>String - åŠ¨æ€å­—ç¬¦ä¸²</h3><p><code>String</code> æ˜¯æ ‡å‡†åº“æä¾›çš„æ‹¥æœ‰æ‰€æœ‰æƒçš„åŠ¨æ€å­—ç¬¦ä¸²ç±»å‹ï¼Œå­˜å‚¨åœ¨å †ä¸Šï¼š</p>
<ul>
<li><strong>å¯å˜</strong>ï¼šå¯é€šè¿‡æ–¹æ³•ä¿®æ”¹å†…å®¹ï¼ˆå¦‚æ·»åŠ ã€åˆ é™¤å­—ç¬¦ï¼‰ã€‚</li>
<li><strong>åŠ¨æ€åˆ†é…</strong>ï¼šå†…å­˜ä¼šæ ¹æ®å†…å®¹è‡ªåŠ¨æ‰©å®¹ã€‚</li>
<li><strong>æ‰€æœ‰æƒ</strong>ï¼š<code>String</code> æ‹¥æœ‰å…¶æ•°æ®ï¼Œèµ‹å€¼æˆ–ä¼ é€’æ—¶ä¼šè§¦å‘æ‰€æœ‰æƒè½¬ç§»ã€‚</li>
</ul>
<h4 id="åˆ›å»ºæ–¹å¼"><a href="#åˆ›å»ºæ–¹å¼" class="headerlink" title="åˆ›å»ºæ–¹å¼"></a>åˆ›å»ºæ–¹å¼</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();                   <span class="comment">// ç©ºå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s</span> = <span class="string">&quot;initial&quot;</span>.<span class="title function_ invoke__">to_string</span>();               <span class="comment">// ä»å­—é¢é‡è½¬æ¢</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;initial&quot;</span>);             <span class="comment">// åŒä¸Š</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s</span> = <span class="built_in">format!</span>(<span class="string">&quot;Hello &#123;&#125;&quot;</span>, <span class="string">&quot;world&quot;</span>);        <span class="comment">// é€šè¿‡æ ¼å¼åŒ–å®åˆ›å»º</span></span><br></pre></td></tr></table></figure>

<h3 id="amp-str-å­—ç¬¦ä¸²åˆ‡ç‰‡"><a href="#amp-str-å­—ç¬¦ä¸²åˆ‡ç‰‡" class="headerlink" title="&amp;str - å­—ç¬¦ä¸²åˆ‡ç‰‡"></a>&amp;str - å­—ç¬¦ä¸²åˆ‡ç‰‡</h3><p><code>&amp;str</code> æ˜¯å¯¹ä¸€æ®µ UTF-8 ç¼–ç å­—ç¬¦ä¸²çš„ä¸å¯å˜å¼•ç”¨ï¼Œå®ƒä¸æ‹¥æœ‰æ•°æ®æ‰€æœ‰æƒï¼Œä»…ä½œä¸ºâ€è§†å›¾â€å­˜åœ¨ï¼š</p>
<ul>
<li><strong>ä¸å¯å˜</strong>ï¼šæ— æ³•ç›´æ¥ä¿®æ”¹ <code>&amp;str</code> æŒ‡å‘çš„å†…å®¹ã€‚</li>
<li><strong>è½»é‡</strong>ï¼šç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼ˆæŒ‡é’ˆ + é•¿åº¦ï¼‰ï¼Œä¸åˆ†é…å †å†…å­˜ï¼Œä¼ é€’æ—¶æ— éœ€å¤åˆ¶æ•°æ®ã€‚</li>
<li><strong>å­—é¢é‡é»˜è®¤ç±»å‹</strong>ï¼šä»£ç ä¸­çš„å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆå¦‚ <code>&quot;hello&quot;</code>ï¼‰æœ¬è´¨ä¸Šæ˜¯ <code>&amp;&#39;static str</code>ï¼Œç”Ÿå‘½å‘¨æœŸä¸ºæ•´ä¸ªç¨‹åºè¿è¡ŒæœŸã€‚</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s</span>: &amp;<span class="type">str</span> = <span class="string">&quot;hello world&quot;</span>;  <span class="comment">// å­—ç¬¦ä¸²å­—é¢é‡ï¼Œç±»å‹ä¸º &amp;&#x27;static str</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">slice</span>: &amp;<span class="type">str</span> = &amp;s[<span class="number">0</span>..<span class="number">5</span>];   <span class="comment">// ä» s ä¸­æˆªå–åˆ‡ç‰‡ï¼Œç»“æœä¸º &quot;hello&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="amp-str-ä¸-String-é—´è½¬æ¢"><a href="#amp-str-ä¸-String-é—´è½¬æ¢" class="headerlink" title="&amp;str ä¸ String é—´è½¬æ¢"></a>&amp;str ä¸ String é—´è½¬æ¢</h3><h4 id="String-â†’-amp-str"><a href="#String-â†’-amp-str" class="headerlink" title="String â†’ &amp;str"></a>String â†’ &amp;str</h4><p>é€šè¿‡ <code>as_str()</code> æ–¹æ³•æˆ–ç›´æ¥å¼•ç”¨ï¼ˆ<code>&amp;s</code>ï¼‰ï¼Œå› ä¸º <code>String</code> å®ç°äº† <code>Deref&lt;Target=str&gt;</code>ï¼Œä¼šè‡ªåŠ¨è§£å¼•ç”¨ä¸º <code>&amp;str</code>ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s_slice</span>: &amp;<span class="type">str</span> = s.<span class="title function_ invoke__">as_str</span>();  <span class="comment">// æ˜¾å¼è½¬æ¢</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s_slice2</span>: &amp;<span class="type">str</span> = &amp;s;         <span class="comment">// è‡ªåŠ¨è§£å¼•ç”¨ï¼Œæ›´å¸¸ç”¨</span></span><br></pre></td></tr></table></figure>

<h4 id="amp-str-â†’-String"><a href="#amp-str-â†’-String" class="headerlink" title="&amp;str â†’ String"></a>&amp;str â†’ String</h4><p>é€šè¿‡ <code>String::from</code> æˆ– <code>to_string()</code>ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">slice</span> = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(slice);  <span class="comment">// è½¬æ¢ä¸º String</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">s2</span> = slice.<span class="title function_ invoke__">to_string</span>();   <span class="comment">// ç­‰ä»·æ–¹å¼</span></span><br></pre></td></tr></table></figure>

<h3 id="å¸¸ç”¨æ“ä½œ"><a href="#å¸¸ç”¨æ“ä½œ" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h3><table>
<thead>
<tr>
<th>åˆ†ç±»</th>
<th>æ–¹æ³•</th>
<th>è¿”å›ç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>åˆ›å»º</strong></td>
<td><code>String::new()</code></td>
<td><code>String</code></td>
<td>åˆ›å»ºç©ºå­—ç¬¦ä¸²</td>
</tr>
<tr>
<td></td>
<td><code>String::from(&quot;abc&quot;)</code></td>
<td><code>String</code></td>
<td>ä»å­—é¢é‡åˆ›å»º</td>
</tr>
<tr>
<td></td>
<td><code>&quot;abc&quot;.to_string()</code></td>
<td><code>String</code></td>
<td>ä» <code>&amp;str</code> åˆ›å»º String</td>
</tr>
<tr>
<td></td>
<td><code>String::with_capacity(n)</code></td>
<td><code>String</code></td>
<td>é¢„åˆ†é…å®¹é‡ï¼Œå‡å°‘é‡åˆ†é…</td>
</tr>
<tr>
<td><strong>è½¬æ¢</strong></td>
<td><code>s.as_str()</code></td>
<td><code>&amp;str</code></td>
<td>è½¬æ¢ä¸º <code>&amp;str</code></td>
</tr>
<tr>
<td></td>
<td><code>s.into_bytes()</code></td>
<td><code>Vec&amp;lt;u8&amp;gt;</code></td>
<td>è½¬æ¢ä¸º Vec&lt;u8&gt;</td>
</tr>
<tr>
<td></td>
<td><code>String::from_utf8(v)</code></td>
<td><code>String</code></td>
<td>ä»å­—èŠ‚å‘é‡è¿˜åŸå­—ç¬¦ä¸²</td>
</tr>
<tr>
<td></td>
<td><code>s.to_string()</code></td>
<td><code>String</code></td>
<td>åˆ›å»ºæ–° String</td>
</tr>
<tr>
<td><strong>é•¿åº¦</strong></td>
<td><code>s.len()</code></td>
<td><code>usize</code></td>
<td>è¿”å›å­—èŠ‚é•¿åº¦ï¼ˆä¸æ˜¯å­—ç¬¦æ•°ï¼‰</td>
</tr>
<tr>
<td></td>
<td><code>s.chars().count()</code></td>
<td><code>usize</code></td>
<td>è¿”å›å­—ç¬¦æ•°ï¼ˆUnicode scalarï¼‰</td>
</tr>
<tr>
<td><strong>åˆ¤æ–­</strong></td>
<td><code>s.is_empty()</code></td>
<td><code>bool</code></td>
<td>æ˜¯å¦ä¸ºç©ºå­—ç¬¦ä¸²</td>
</tr>
<tr>
<td></td>
<td><code>s.contains(&quot;ab&quot;)</code></td>
<td><code>bool</code></td>
<td>æ˜¯å¦åŒ…å«å­ä¸²</td>
</tr>
<tr>
<td></td>
<td><code>s.starts_with(&quot;ab&quot;)</code></td>
<td><code>bool</code></td>
<td>æ˜¯å¦ä»¥æŒ‡å®šå­ä¸²å¼€å¤´</td>
</tr>
<tr>
<td></td>
<td><code>s.ends_with(&quot;ab&quot;)</code></td>
<td><code>bool</code></td>
<td>æ˜¯å¦ä»¥æŒ‡å®šå­ä¸²ç»“å°¾</td>
</tr>
<tr>
<td><strong>æ‹¼æ¥</strong></td>
<td><code>s.push(&#39;a&#39;)</code></td>
<td><code>()</code></td>
<td>è¿½åŠ å•ä¸ªå­—ç¬¦</td>
</tr>
<tr>
<td></td>
<td><code>s.push_str(&quot;abc&quot;)</code></td>
<td><code>()</code></td>
<td>è¿½åŠ å­—ç¬¦ä¸²åˆ‡ç‰‡</td>
</tr>
<tr>
<td></td>
<td><code>s1 + &amp;s2</code></td>
<td><code>String</code></td>
<td>æ‹¼æ¥ï¼ˆç§»åŠ¨å·¦ä¾§ï¼‰</td>
</tr>
<tr>
<td></td>
<td><code>format!(&quot;&#123;&#125;&#123;&#125;&quot;, a, b)</code></td>
<td><code>String</code></td>
<td>æ ¼å¼åŒ–æ‹¼æ¥ï¼Œä¸ç§»åŠ¨</td>
</tr>
<tr>
<td><strong>æˆªå–&#x2F;åˆ†å‰²</strong></td>
<td><code>&amp;s[a..b]</code></td>
<td><code>&amp;str</code></td>
<td>æŒ‰å­—èŠ‚åˆ‡ç‰‡ï¼ˆéœ€åœ¨å­—ç¬¦è¾¹ç•Œï¼‰</td>
</tr>
<tr>
<td></td>
<td><code>s.split(&#39;,&#39;)</code></td>
<td>è¿­ä»£å™¨</td>
<td>æŒ‰åˆ†éš”ç¬¦åˆ†å‰²ä¸ºè¿­ä»£å™¨</td>
</tr>
<tr>
<td></td>
<td><code>s.split_whitespace()</code></td>
<td>è¿­ä»£å™¨</td>
<td>æŒ‰ç©ºç™½åˆ†å‰²</td>
</tr>
<tr>
<td></td>
<td><code>s.lines()</code></td>
<td>è¿­ä»£å™¨</td>
<td>æŒ‰è¡Œåˆ†å‰²</td>
</tr>
<tr>
<td><strong>ä¿®å‰ª</strong></td>
<td><code>s.trim()</code></td>
<td><code>&amp;str</code></td>
<td>å»é™¤é¦–å°¾ç©ºç™½</td>
</tr>
<tr>
<td></td>
<td><code>s.trim_start() / trim_end()</code></td>
<td><code>&amp;str</code></td>
<td>å»é™¤é¦–æˆ–å°¾ç©ºç™½</td>
</tr>
<tr>
<td><strong>æ›¿æ¢</strong></td>
<td><code>s.replace(&quot;a&quot;,&quot;b&quot;)</code></td>
<td><code>String</code></td>
<td>å…¨éƒ¨æ›¿æ¢</td>
</tr>
<tr>
<td></td>
<td><code>s.replacen(&quot;a&quot;,&quot;b&quot;,n)</code></td>
<td><code>String</code></td>
<td>æ›¿æ¢å‰ n æ¬¡</td>
</tr>
<tr>
<td><strong>å¤§å°å†™</strong></td>
<td><code>s.to_lowercase()</code></td>
<td><code>String</code></td>
<td>è½¬å°å†™</td>
</tr>
<tr>
<td></td>
<td><code>s.to_uppercase()</code></td>
<td><code>String</code></td>
<td>è½¬å¤§å†™</td>
</tr>
<tr>
<td><strong>æŸ¥æ‰¾</strong></td>
<td><code>s.find(&quot;ab&quot;)</code></td>
<td><code>Option&lt;usize&gt;</code></td>
<td>è¿”å›é¦–ä¸ªåŒ¹é…ä½ç½®</td>
</tr>
<tr>
<td></td>
<td><code>s.rfind(&quot;ab&quot;)</code></td>
<td><code>Option&lt;usize&gt;</code></td>
<td>ä»åå¾€å‰æ‰¾</td>
</tr>
<tr>
<td><strong>è¿­ä»£</strong></td>
<td><code>s.chars()</code></td>
<td>è¿­ä»£å™¨</td>
<td>æŒ‰å­—ç¬¦è¿­ä»£</td>
</tr>
<tr>
<td></td>
<td><code>s.bytes()</code></td>
<td>è¿­ä»£å™¨</td>
<td>æŒ‰å­—èŠ‚è¿­ä»£</td>
</tr>
<tr>
<td><strong>æ¯”è¾ƒ</strong></td>
<td><code>s1 == s2</code></td>
<td><code>bool</code></td>
<td>å†…å®¹æ¯”è¾ƒï¼ˆUTF-8 å®‰å…¨ï¼‰</td>
</tr>
<tr>
<td><strong>æ‹·è´&#x2F;å…‹éš†</strong></td>
<td><code>s.clone()</code></td>
<td><code>String</code></td>
<td>æ·±æ‹·è´ï¼ˆå †ä¸Šå†…å®¹å¤åˆ¶ï¼‰</td>
</tr>
<tr>
<td><strong>æ¸…ç©º&#x2F;å®¹é‡</strong></td>
<td><code>s.clear()</code></td>
<td><code>()</code></td>
<td>æ¸…ç©ºå†…å®¹</td>
</tr>
<tr>
<td></td>
<td><code>s.capacity()</code></td>
<td><code>usize</code></td>
<td>å½“å‰å®¹é‡</td>
</tr>
<tr>
<td></td>
<td><code>s.reserve(n)</code></td>
<td><code>()</code></td>
<td>é¢„ç•™é¢å¤–å®¹é‡</td>
</tr>
<tr>
<td><strong>å­—èŠ‚è®¿é—®</strong></td>
<td><code>s.as_bytes()</code></td>
<td><code>&amp;[u8]</code></td>
<td>è·å–å­—èŠ‚åˆ‡ç‰‡</td>
</tr>
<tr>
<td><strong>è¿æ¥ Vec</strong></td>
<td><code>vec.join(&quot;,&quot;)</code></td>
<td><code>String</code></td>
<td>ç”¨åˆ†éš”ç¬¦è¿æ¥</td>
</tr>
<tr>
<td><strong>æ ¼å¼åŒ–è¾“å‡º</strong></td>
<td><code>format!()</code></td>
<td><code>String</code></td>
<td>è¿”å›æ ¼å¼åŒ–å­—ç¬¦ä¸²</td>
</tr>
</tbody></table>
<h2 id="æ ¼å¼åŒ–"><a href="#æ ¼å¼åŒ–" class="headerlink" title="æ ¼å¼åŒ–"></a>æ ¼å¼åŒ–</h2><p>Rust æä¾›äº†ä¸€å¥—å¼ºå¤§çš„æ ¼å¼åŒ–å®ï¼Œç”¨äºå­—ç¬¦ä¸²æ‹¼æ¥ã€è¾“å‡ºç­‰åœºæ™¯ï¼Œæ ¸å¿ƒæ˜¯ <code>format!</code>ï¼ˆè¿”å› <code>String</code>ï¼‰ï¼Œä»¥åŠè¡ç”Ÿçš„ <code>print!</code>ï¼ˆæ‰“å°åˆ°æ ‡å‡†è¾“å‡ºï¼‰ã€<code>println!</code>ï¼ˆå¸¦æ¢è¡Œçš„æ‰“å°ï¼‰ã€<code>eprint!</code>ï¼ˆæ‰“å°åˆ°æ ‡å‡†é”™è¯¯ï¼‰ç­‰ã€‚</p>
<h3 id="æ ¼å¼åŒ–è¯­æ³•"><a href="#æ ¼å¼åŒ–è¯­æ³•" class="headerlink" title="æ ¼å¼åŒ–è¯­æ³•"></a>æ ¼å¼åŒ–è¯­æ³•</h3><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">&#123;[argument][:[fill][align][width][.precision][type]]&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å®Œæ•´ç¤ºä¾‹"><a href="#å®Œæ•´ç¤ºä¾‹" class="headerlink" title="å®Œæ•´ç¤ºä¾‹"></a>å®Œæ•´ç¤ºä¾‹</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŠ¨æ€å®½åº¦ + ç²¾åº¦ï¼ˆåé¢éœ€è¦ $ï¼‰</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;value:&gt;width$.prec$&#125;&quot;</span>, value=<span class="number">3.14159</span>, width=<span class="number">10</span>, prec=<span class="number">3</span>); <span class="comment">// &quot;     3.142&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¸¦å‰ç¼€çš„åå…­è¿›åˆ¶</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;:#08x&#125;&quot;</span>, <span class="number">42</span>); <span class="comment">// &quot;0x00002a&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘½åå‚æ•° + æ ¼å¼åŒ–</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;name:*^10&#125;&quot;</span>, name=<span class="string">&quot;ALICE&quot;</span>); <span class="comment">// &quot;**ALICE***&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="å‚æ•°æŒ‡å®š"><a href="#å‚æ•°æŒ‡å®š" class="headerlink" title="å‚æ•°æŒ‡å®š"></a>å‚æ•°æŒ‡å®š</h3><p><code>&#123;argument&#125;</code> ç”¨äºæŒ‡å®šè¦æ ¼å¼åŒ–çš„å‚æ•°ï¼Œé»˜è®¤çœç•¥ï¼ˆæŒ‰é¡ºåºï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹å¼</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
<th>è¾“å‡º</th>
</tr>
</thead>
<tbody><tr>
<td>çœç•¥</td>
<td>æŒ‰å‚æ•°é¡ºåºåŒ¹é…ï¼ˆé»˜è®¤ï¼‰</td>
<td><code>println!(&quot;&#123;&#125;, &#123;&#125;&quot;, &quot;a&quot;, &quot;b&quot;)</code></td>
<td><code>a, b</code></td>
</tr>
<tr>
<td>ä½ç½®ç´¢å¼• <code>&#123;n&#125;</code></td>
<td>æŒ‰ç´¢å¼• nï¼ˆä» 0 å¼€å§‹ï¼‰åŒ¹é…</td>
<td><code>println!(&quot;&#123;1&#125;, &#123;0&#125;&quot;, &quot;a&quot;, &quot;b&quot;)</code></td>
<td><code>b, a</code></td>
</tr>
<tr>
<td>å‘½å <code>&#123;name&#125;</code></td>
<td>æŒ‰å‚æ•°ååŒ¹é…</td>
<td><code>println!(&quot;&#123;x&#125;, &#123;y&#125;&quot;, x=1, y=2)</code></td>
<td><code>1, 2</code></td>
</tr>
</tbody></table>
<h3 id="å¡«å……ä¸å¯¹é½"><a href="#å¡«å……ä¸å¯¹é½" class="headerlink" title="å¡«å……ä¸å¯¹é½"></a>å¡«å……ä¸å¯¹é½</h3><p>è¯­æ³•ç‰‡æ®µï¼š<code>[fill][align][width]</code></p>
<ul>
<li>**<code>fill</code>**ï¼šä»»æ„å•å­—ç¬¦ï¼ˆé»˜è®¤ç©ºæ ¼ï¼‰ï¼›ä½¿ç”¨ fill æ—¶éœ€è¦åŒæ—¶æŒ‡å®š <code>align+width</code>ã€‚</li>
<li>**<code>align</code>**ï¼š<code>&lt;</code>ï¼ˆå·¦å¯¹é½ï¼‰ã€<code>&gt;</code>ï¼ˆå³å¯¹é½ï¼Œé»˜è®¤ï¼‰ã€<code>^</code>ï¼ˆå±…ä¸­ï¼‰ã€‚</li>
<li>**<code>width</code>**ï¼šæœ€å°å­—æ®µå®½åº¦ï¼ˆæ•´æ•°ï¼‰ï¼Œä¸è¶³æ—¶ä½¿ç”¨ <code>fill</code> å¡«å……ã€‚</li>
</ul>
<h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="built_in">format!</span>(<span class="string">&quot;&#123;:&gt;8&#125;&quot;</span>, <span class="string">&quot;hi&quot;</span>)       <span class="comment">// å³å¯¹é½ -&gt; &quot;      hi&quot;</span></span><br><span class="line"><span class="built_in">format!</span>(<span class="string">&quot;&#123;:&lt;8&#125;&quot;</span>, <span class="string">&quot;hi&quot;</span>)       <span class="comment">// å·¦å¯¹é½ -&gt; &quot;hi      &quot;</span></span><br><span class="line"><span class="built_in">format!</span>(<span class="string">&quot;&#123;:^8&#125;&quot;</span>, <span class="string">&quot;hi&quot;</span>)       <span class="comment">// å±…ä¸­ -&gt; &quot;   hi   &quot;</span></span><br><span class="line"><span class="built_in">format!</span>(<span class="string">&quot;&#123;:0&gt;5&#125;&quot;</span>, <span class="number">42</span>)        <span class="comment">// å¡«å……å­—ç¬¦ &#x27;0&#x27;, å³å¯¹é½ -&gt; &quot;00042&quot;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
<th>è¾“å‡º</th>
</tr>
</thead>
<tbody><tr>
<td>å›ºå®šå®½åº¦ <code>&#123;:w&#125;</code></td>
<td><code>println!(&quot;width: [&#123;:*^5&#125;]&quot;, 123);</code></td>
<td><code>[*123*]</code></td>
</tr>
<tr>
<td>åŠ¨æ€å®½åº¦ <code>&#123;:width$&#125;</code></td>
<td><code>println!(&quot;[&#123;:w$&#125;]&quot;, 123, w=5);</code></td>
<td><code>[ 123]</code></td>
</tr>
</tbody></table>
<h3 id="ç²¾åº¦"><a href="#ç²¾åº¦" class="headerlink" title="ç²¾åº¦"></a>ç²¾åº¦</h3><p>è¯­æ³•ç‰‡æ®µï¼š<code>.precision</code>ï¼ˆå†™ä½œ <code>.N</code> æˆ–åŠ¨æ€ <code>.*</code>ï¼‰</p>
<table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
<th>è¾“å‡º</th>
</tr>
</thead>
<tbody><tr>
<td><strong>å­—ç¬¦ä¸²</strong></td>
<td>æœ€å¤§é•¿åº¦ï¼ˆè¶…è¿‡åˆ™æˆªæ–­ï¼‰</td>
<td><code>println!(&quot;&#123;:.3&#125;&quot;, &quot;hello&quot;)</code></td>
<td><code>hel</code></td>
</tr>
<tr>
<td><strong>æµ®ç‚¹æ•°</strong></td>
<td>å°æ•°ä½æ•°ï¼ˆå››èˆäº”å…¥ï¼‰</td>
<td><code>println!(&quot;&#123;:.2&#125;&quot;, 3.1415)</code></td>
<td><code>3.14</code></td>
</tr>
<tr>
<td><strong>æ•´æ•°</strong></td>
<td>æœ€å°ä½æ•°ï¼ˆä¸è¶³è¡¥ 0ï¼Œè¶…è¿‡åˆ™åŸæ ·è¾“å‡ºï¼‰</td>
<td><code>println!(&quot;&#123;:.4&#125;&quot;, 12)</code></td>
<td><code>0012</code></td>
</tr>
<tr>
<td><strong>åŠ¨æ€ç²¾åº¦ <code>&#123;:.*&#125;</code></strong></td>
<td>ç²¾åº¦ç”±å‚æ•°æŒ‡å®šï¼ˆå‰ä¸€ä¸ªå‚æ•°ä¸ºç²¾åº¦å€¼ï¼‰</td>
<td><code>println!(&quot;&#123;&#125;-&#123;:.*&#125;&quot;,&quot;ab&quot;, 2, 3.1415)</code></td>
<td><code>ab-3.14</code></td>
</tr>
</tbody></table>
<h3 id="ç±»å‹æ ¼å¼"><a href="#ç±»å‹æ ¼å¼" class="headerlink" title="ç±»å‹æ ¼å¼"></a>ç±»å‹æ ¼å¼</h3><h4 id="æ•´æ•°ç±»å‹"><a href="#æ•´æ•°ç±»å‹" class="headerlink" title="æ•´æ•°ç±»å‹"></a>æ•´æ•°ç±»å‹</h4><p>æ•´æ•°ç±»å‹ï¼ˆi8&#x2F;i16&#x2F;i32&#x2F;i64&#x2F;u8&#x2F;u16&#x2F;â€¦&#x2F;usize&#x2F;isizeï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th>æ ¼å¼</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
<th>è¾“å‡º</th>
</tr>
</thead>
<tbody><tr>
<td><code>b</code></td>
<td>äºŒè¿›åˆ¶</td>
<td><code>println!(&quot;&#123;:b&#125;&quot;, 10)</code></td>
<td><code>1010</code></td>
</tr>
<tr>
<td><code>o</code></td>
<td>å…«è¿›åˆ¶</td>
<td><code>println!(&quot;&#123;:o&#125;&quot;, 10)</code></td>
<td><code>12</code></td>
</tr>
<tr>
<td><code>d</code></td>
<td>åè¿›åˆ¶ï¼ˆé»˜è®¤ï¼‰</td>
<td><code>println!(&quot;&#123;:d&#125;&quot;, 10)</code></td>
<td><code>10</code></td>
</tr>
<tr>
<td><code>x</code></td>
<td>å°å†™åå…­è¿›åˆ¶</td>
<td><code>println!(&quot;&#123;:x&#125;&quot;, 255)</code></td>
<td><code>ff</code></td>
</tr>
<tr>
<td><code>X</code></td>
<td>å¤§å†™åå…­è¿›åˆ¶</td>
<td><code>println!(&quot;&#123;:X&#125;&quot;, 255)</code></td>
<td><code>FF</code></td>
</tr>
</tbody></table>
<h4 id="æµ®ç‚¹æ•°ç±»å‹"><a href="#æµ®ç‚¹æ•°ç±»å‹" class="headerlink" title="æµ®ç‚¹æ•°ç±»å‹"></a>æµ®ç‚¹æ•°ç±»å‹</h4><p>æµ®ç‚¹æ•°ç±»å‹ï¼ˆf32&#x2F;f64ï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th>æ ¼å¼</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
<th>è¾“å‡º</th>
</tr>
</thead>
<tbody><tr>
<td><code>f</code></td>
<td>å°æ•°å½¢å¼ï¼ˆé»˜è®¤ï¼‰</td>
<td><code>println!(&quot;&#123;:f&#125;&quot;, 123.456)</code></td>
<td><code>123.456000</code>ï¼ˆé»˜è®¤ 6 ä½å°æ•°ï¼‰</td>
</tr>
<tr>
<td><code>e</code></td>
<td>ç§‘å­¦è®¡æ•°æ³•ï¼ˆå°å†™ eï¼‰</td>
<td><code>println!(&quot;&#123;:e&#125;&quot;, 123.456)</code></td>
<td><code>1.234560e+02</code></td>
</tr>
<tr>
<td><code>E</code></td>
<td>ç§‘å­¦è®¡æ•°æ³•ï¼ˆå¤§å†™ Eï¼‰</td>
<td><code>println!(&quot;&#123;:E&#125;&quot;, 123.456)</code></td>
<td><code>1.234560E+02</code></td>
</tr>
<tr>
<td><code>g</code></td>
<td>è‡ªåŠ¨é€‰æ‹© f æˆ– eï¼ˆå–è¾ƒçŸ­å½¢å¼ï¼‰</td>
<td><code>println!(&quot;&#123;:g&#125;&quot;, 123456789.0)</code></td>
<td><code>1.23457e+08</code></td>
</tr>
<tr>
<td><code>G</code></td>
<td>è‡ªåŠ¨é€‰æ‹© f æˆ– E</td>
<td><code>println!(&quot;&#123;:G&#125;&quot;, 123456789.0)</code></td>
<td><code>1.23457E+08</code></td>
</tr>
</tbody></table>
<h4 id="é€šç”¨ä¸ç‰¹æ®Šç±»å‹"><a href="#é€šç”¨ä¸ç‰¹æ®Šç±»å‹" class="headerlink" title="é€šç”¨ä¸ç‰¹æ®Šç±»å‹"></a>é€šç”¨ä¸ç‰¹æ®Šç±»å‹</h4><table>
<thead>
<tr>
<th>æ ¼å¼</th>
<th>è¯´æ˜</th>
<th>é€‚ç”¨ç±»å‹</th>
<th>ç¤ºä¾‹</th>
<th>è¾“å‡º</th>
</tr>
</thead>
<tbody><tr>
<td><code>?</code></td>
<td>æŒ‰ Debug trait æ ¼å¼åŒ–ï¼ˆè°ƒè¯•ç”¨ï¼‰</td>
<td>æ‰€æœ‰å®ç° Debug çš„ç±»å‹</td>
<td><code>println!(&quot;&#123;:?&#125;&quot;, vec![1,2])</code></td>
<td><code>[1, 2]</code></td>
</tr>
<tr>
<td><code>#?</code></td>
<td>ç¾åŒ–çš„ Debug æ ¼å¼ï¼ˆæ¢è¡Œ + ç¼©è¿›ï¼‰</td>
<td>å¤æ‚ç»“æ„ï¼ˆå¦‚ç»“æ„ä½“ã€åµŒå¥—é›†åˆï¼‰</td>
<td><code>println!(&quot;&#123;:#?&#125;&quot;, vec![1,2])</code></td>
<td><code>[\n 1,\n 2\n]</code></td>
</tr>
<tr>
<td><code>p</code></td>
<td>æŒ‡é’ˆåœ°å€</td>
<td>ä»…ç”¨äºå¼•ç”¨ç±»å‹</td>
<td><code>println!(&quot;&#123;:p&#125;&quot;, &amp;10)</code></td>
<td><code>0x7ff72194e7b8</code></td>
</tr>
</tbody></table>
<h4 id="æ ‡å¿—ï¼ˆFlagsï¼‰"><a href="#æ ‡å¿—ï¼ˆFlagsï¼‰" class="headerlink" title="æ ‡å¿—ï¼ˆFlagsï¼‰"></a>æ ‡å¿—ï¼ˆFlagsï¼‰</h4><p>ç‰¹æ®Šä¿®é¥°ç¬¦ï¼Œç”¨äºè°ƒæ•´è¾“å‡ºæ ¼å¼ï¼Œå¯ä¸å…¶ä»–è¯´æ˜ç¬¦ç»„åˆä½¿ç”¨ã€‚</p>
<table>
<thead>
<tr>
<th>æ ‡å¿—</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
<th>è¾“å‡º</th>
</tr>
</thead>
<tbody><tr>
<td><code>#</code></td>
<td>ä¸ºæ•°å€¼æ·»åŠ å‰ç¼€ï¼ˆäºŒè¿›åˆ¶ 0bã€å…«è¿›åˆ¶ 0oã€åå…­è¿›åˆ¶ 0xï¼‰</td>
<td><code>println!(&quot;&#123;:#x&#125;&quot;, 255)</code></td>
<td><code>0xff</code></td>
</tr>
<tr>
<td><code>+</code></td>
<td>å¼ºåˆ¶æ˜¾ç¤ºæ­£è´Ÿå·ï¼ˆæ­£æ•°æ˜¾ +ï¼Œè´Ÿæ•°æ˜¾ -ï¼‰</td>
<td><code>println!(&quot;&#123;:+&#125;&quot;, 10); println!(&quot;&#123;:+&#125;&quot;, -10)</code></td>
<td><code>+10 -10</code></td>
</tr>
<tr>
<td><code>0</code></td>
<td>ç”¨ 0 å¡«å……ï¼ˆä»£æ›¿ç©ºæ ¼ï¼‰</td>
<td><code>println!(&quot;&#123;:05&#125;&quot;, 123)</code></td>
<td><code>00123</code></td>
</tr>
<tr>
<td><code>_</code></td>
<td>ä¸ºå¤§æ•°å€¼æ·»åŠ åƒä½åˆ†éš”ç¬¦ï¼ˆä»…æ•´æ•°å’Œæµ®ç‚¹æ•°ï¼‰</td>
<td><code>println!(&quot;&#123;:_&#125;&quot;, 1000000)</code></td>
<td><code>1_000_000</code></td>
</tr>
</tbody></table>
<h4 id="ç‰¹æ®Šæ ¼å¼"><a href="#ç‰¹æ®Šæ ¼å¼" class="headerlink" title="ç‰¹æ®Šæ ¼å¼"></a>ç‰¹æ®Šæ ¼å¼</h4><table>
<thead>
<tr>
<th>è¯´æ˜</th>
<th>è¾“å‡º</th>
</tr>
</thead>
<tbody><tr>
<td><code>&#123;&#123;` | è¾“å‡ºå·¦èŠ±æ‹¬å· `&#123;` |
| `&#125;&#125;</code></td>
<td>è¾“å‡ºå³èŠ±æ‹¬å· <code>&#125;</code></td>
</tr>
</tbody></table>
<h3 id="è‡ªå®šä¹‰-Display-è·å–å‚æ•°"><a href="#è‡ªå®šä¹‰-Display-è·å–å‚æ•°" class="headerlink" title="è‡ªå®šä¹‰ Display è·å–å‚æ•°"></a>è‡ªå®šä¹‰ Display è·å–å‚æ•°</h3><p>å½“åœ¨ç±»å‹ä¸Šå®ç° <code>fmt::Display</code> æ—¶ï¼Œå¯ä»¥åœ¨ <code>fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;&#39;_&gt;)</code> ä¸­è¯»å–ç”¨æˆ·ç»™çš„ <code>width</code>ã€<code>precision</code>ã€<code>alternate</code> ç­‰ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123; </span><br><span class="line">    x: <span class="type">f64</span>, </span><br><span class="line">    y: <span class="type">f64</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">fmt</span>::Display <span class="keyword">for</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> fmt::Formatter&lt;<span class="symbol">&#x27;_</span>&gt;) <span class="punctuation">-&gt;</span> fmt::<span class="type">Result</span> &#123;</span><br><span class="line">        <span class="comment">// è·å– width / precisionï¼ˆOption&lt;usize&gt;ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(prec) = f.<span class="title function_ invoke__">precision</span>() &#123;</span><br><span class="line">            <span class="built_in">write!</span>(f, <span class="string">&quot;(&#123;:.prec$&#125;, &#123;:.prec$&#125;)&quot;</span>, <span class="keyword">self</span>.x, <span class="keyword">self</span>.y)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> f.<span class="title function_ invoke__">alternate</span>() &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœç”¨æˆ·å†™äº† &quot;&#123;:#&#125;&quot;ï¼Œå¯åˆ‡æ¢æ ¼å¼</span></span><br><span class="line">            <span class="built_in">write!</span>(f, <span class="string">&quot;Point &#123;&#123; x: &#123;&#125;, y: &#123;&#125; &#125;&#125;&quot;</span>, <span class="keyword">self</span>.x, <span class="keyword">self</span>.y)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">write!</span>(f, <span class="string">&quot;(&#123;&#125;, &#123;&#125;)&quot;</span>, <span class="keyword">self</span>.x, <span class="keyword">self</span>.y)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">p</span> = Point &#123; x: <span class="number">3.14159</span>, y: <span class="number">2.71828</span> &#125;;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, p);              <span class="comment">// &quot;(3.14159, 2.71828)&quot;</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:.2&#125;&quot;</span>, p);           <span class="comment">// &quot;(3.14, 2.72)&quot;</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;:#&#125;&quot;</span>, p);            <span class="comment">// &quot;Point &#123; x: 3.14159, y: 2.71828 &#125;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li><strong>å­—ç¬¦ä¸²ç±»å‹</strong>ï¼š<code>String</code>ï¼ˆå¯å˜ã€æ‹¥æœ‰æ‰€æœ‰æƒã€å †å­˜å‚¨ï¼‰vs <code>&amp;str</code>ï¼ˆä¸å¯å˜ã€å¼•ç”¨ã€è½»é‡ï¼‰</li>
<li><strong>è½¬æ¢</strong>ï¼š<code>String</code> &lt;â†’ <code>&amp;str</code> é€šè¿‡ <code>as_str()</code>ã€<code>to_string()</code>ã€è‡ªåŠ¨è§£å¼•ç”¨</li>
<li><strong>å¸¸ç”¨æ“ä½œ</strong>ï¼šåˆ›å»ºã€æ‹¼æ¥ã€æŸ¥æ‰¾ã€æ›¿æ¢ã€åˆ†å‰²ç­‰</li>
<li><strong>æ ¼å¼åŒ–</strong>ï¼šå¼ºå¤§çš„å®ç³»ç»Ÿï¼Œæ”¯æŒå¯¹é½ã€ç²¾åº¦ã€è¿›åˆ¶ã€è‡ªå®šä¹‰æ ¼å¼</li>
<li><strong>Format Spec</strong>ï¼š<code>&#123;[argument][:[fill][align][width][.precision][type]]&#125;</code></li>
</ul>
]]></content>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustä¸­æ‰€æœ‰æƒå’Œä½œç”¨åŸŸä»¥åŠç”Ÿå‘¨æœŸ</title>
    <url>/2024/07/12/Rust%E4%B8%AD%E6%89%80%E6%9C%89%E6%9D%83%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F%E4%BB%A5%E5%8F%8A%E7%94%9F%E5%91%A8%E6%9C%9F/</url>
    <content><![CDATA[<p>åœ¨rustä¸­ï¼Œä½œç”¨åŸŸï¼ˆScopeï¼‰å’Œæ‰€æœ‰æƒï¼ˆOwnershipï¼‰æ˜¯ä¿è¯å†…å­˜å®‰å…¨çš„æ ¸å¿ƒæœºåˆ¶ï¼Œå®ƒä»¬å…±åŒå†³å®šäº†å˜é‡çš„ç”Ÿå‘½å‘¨æœŸå’Œå†…å­˜ç®¡ç†æ–¹å¼ï¼Œæ— éœ€åƒåœ¾å›æ”¶å³å¯é¿å…æ‚¬å‚æŒ‡é’ˆã€åŒé‡é‡Šæ”¾ç­‰å†…å­˜é—®é¢˜ã€‚</p>
<span id="more"></span>

<table>
<thead>
<tr>
<th>æ¦‚å¿µ</th>
<th>å«ä¹‰</th>
<th>æ˜¯å¦è‡ªåŠ¨è§¦å‘é”€æ¯</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td>ä½œç”¨åŸŸï¼ˆScope</td>
<td>å˜é‡çš„å¯è®¿é—®èŒƒå›´</td>
<td>æ˜¯</td>
<td>{ let x &#x3D; 1; }</td>
</tr>
<tr>
<td>æ‰€æœ‰æƒï¼ˆOwnership</td>
<td>èµ„æºçš„å”¯ä¸€æŒæœ‰è€…</td>
<td>æ˜¯</td>
<td>let s &#x3D; String:from(â€œhiâ€);</td>
</tr>
<tr>
<td>ç”Ÿå‘½å‘¨æœŸï¼ˆLifetimeï¼‰</td>
<td>å¼•ç”¨çš„æœ‰æ•ˆåŒºé—´</td>
<td>å¦</td>
<td>&amp;&#96;a str</td>
</tr>
</tbody></table>
<h1 id="ä½œç”¨åŸŸ"><a href="#ä½œç”¨åŸŸ" class="headerlink" title="ä½œç”¨åŸŸ"></a>ä½œç”¨åŸŸ</h1><p>ä½œç”¨åŸŸæ˜¯ä¸€ä¸ªå˜é‡ï¼ˆæˆ–å¼•ç”¨ã€èµ„æºï¼‰åœ¨ç¨‹åºä¸­æœ‰æ•ˆã€å¯è®¿é—®çš„ä»£ç èŒƒå›´ï¼Œç”±ä¸€å¯¹èŠ±æ‹¬å·{}ç•Œå®šï¼›</p>
<p>1.ç¡®å®šæ€§ï¼šä½œç”¨åŸŸç”±ä»£ç ç»“æ„æ˜¾ç¤ºç•Œå®šï¼Œç¼–è¯‘æœŸå³å¯ç¡®å®šï¼Œä¸å­˜åœ¨è¿è¡Œæ—¶åŠ¨æ€å˜åŒ–ï¼›<br>2.è‡ªåŠ¨æ¸…ç†ï¼šRustä¼šè‡ªåŠ¨è°ƒç”¨å…¶dropæ–¹æ³•(è‹¥å®ç°äº†drop traitï¼Œåˆ™ä¼šè°ƒç”¨dropå‡½æ•°)ï¼Œé‡Šæ”¾å†…å­˜æˆ–èµ„æºï¼ˆå¦‚æ–‡ä»¶å¥æŸ„ã€ç½‘ç»œè¿æ¥ç­‰ï¼‰ã€‚<br>3.åµŒå¥—æ€§ï¼šä½œç”¨åŸŸå¯ä»¥åµŒå¥—ï¼ˆå†…éƒ¨ä½œç”¨åŸŸåŒ…å«åœ¨å¤–éƒ¨ä½œç”¨åŸŸä¸­ï¼‰ï¼Œå†…éƒ¨ä½œç”¨åŸŸå¯ä»¥è®¿é—®å¤–éƒ¨ä½œç”¨åŸŸçš„å®ä½“ï¼Œä½†å¤–éƒ¨ä½œç”¨åŸŸæ— æ³•è®¿é—®å†…éƒ¨ä½œç”¨åŸŸçš„å®ä½“ã€‚</p>
<table>
<thead>
<tr>
<th>äº‹ä»¶</th>
<th>å‘ç”Ÿæ—¶æœº</th>
<th>ç»“æœ</th>
</tr>
</thead>
<tbody><tr>
<td>å˜é‡ç»‘å®š</td>
<td>è¯­å¥æ‰§è¡Œæ—¶</td>
<td>å†…å­˜åˆ†é…ï¼ˆå¦‚éœ€è¦ï¼‰</td>
</tr>
<tr>
<td>å˜é‡å¯è§</td>
<td>å£°æ˜ç‚¹åˆ°ä½œç”¨åŸŸç»“æŸ</td>
<td>å¯åœ¨ä½œç”¨åŸŸå†…è®¿é—®</td>
</tr>
<tr>
<td>å˜é‡é”€æ¯</td>
<td>ç¦»å¼€ä½œç”¨åŸŸæ—¶</td>
<td>è°ƒç”¨dropé‡Šæ”¾èµ„æº</td>
</tr>
<tr>
<td>å˜é‡çš„é”€æ¯é¡ºåºï¼š</td>
<td></td>
<td></td>
</tr>
<tr>
<td>1.åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰ï¼šä¸å£°æ˜é¡ºåºç›¸å</td>
<td></td>
<td></td>
</tr>
<tr>
<td>2.ç»“æ„ä½“å­—æ®µï¼šæŒ‰å£°æ˜é¡ºåºé”€æ¯</td>
<td></td>
<td></td>
</tr>
<tr>
<td>3.æ•°ç»„å…ƒç´ ï¼šä»ç¬¬ä¸€ä¸ªåˆ°æœ€åä¸€ä¸ª</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h1 id="æ‰€æœ‰æƒ"><a href="#æ‰€æœ‰æƒ" class="headerlink" title="æ‰€æœ‰æƒ"></a>æ‰€æœ‰æƒ</h1><p>rustä¸é€‚ç”¨åƒåœ¾å›æ”¶ï¼ˆGCï¼‰ï¼Œè€Œæ˜¯é€šè¿‡æ‰€æœ‰æƒç³»ç»Ÿåœ¨ç¼–è¯‘æœŸä¿è¯å†…å­˜å®‰å…¨ï¼ˆåœ¨ç¼–è¯‘æ—¶ä¼šè¿›è¡Œä¸€ç³»åˆ—çš„è§„åˆ™æ£€æŸ¥ï¼Œåœ¨è¿è¡Œæ—¶é›¶å¼€é”€ï¼‰ï¼›</p>
<p>æ¯ä¸ªå€¼ï¼ˆèµ„æºï¼‰åœ¨ä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…ï¼ˆownerï¼‰ï¼›<br>å½“æ‰€æœ‰è€…ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå€¼ä¼šè¢«è‡ªåŠ¨é”€æ¯ï¼›<br>èµ‹å€¼æˆ–ä¼ å‚ä¼šç§»åŠ¨ï¼ˆmoveï¼‰æ‰€æœ‰æƒï¼Œé™¤éå®ç°äº†copy traitã€‚</p>
<h2 id="å¼•ç”¨ä¸å€Ÿç”¨"><a href="#å¼•ç”¨ä¸å€Ÿç”¨" class="headerlink" title="å¼•ç”¨ä¸å€Ÿç”¨"></a>å¼•ç”¨ä¸å€Ÿç”¨</h2><p>ä¸ºé¿å…é¢‘ç¹çš„æ‰€æœ‰æƒè½¬ç§»ï¼ŒRustæä¾›äº†å¼•ç”¨æœºåˆ¶ï¼š<br>1.ä¸å¯å˜å¼•ç”¨ï¼ˆ&amp;Tï¼‰ï¼šåªè¯»è®¿é—®ï¼Œå…è®¸å¤šä¸ªåŒæ—¶å­˜åœ¨ï¼›<br>2.å¯å˜å¼•ç”¨ï¼ˆ&amp;mut Tï¼‰:å¯ä¿®æ”¹æ•°æ®ï¼ŒåŒä¸€ä½œç”¨åŸŸå†…ä»…å…è®¸ä¸€ä¸ªã€‚</p>
<p>å€Ÿç”¨è§„åˆ™ï¼š<br>1.å¼•ç”¨ä½œç”¨åŸŸä¸èƒ½è¶…è¿‡è¢«å¼•ç”¨å˜é‡çš„ä½œç”¨åŸŸï¼ˆé˜²æ‚¬å‚å¼•ç”¨ï¼‰ï¼›<br>2.åŒä¸€æ•°æ®ä¸èƒ½åŒæ—¶å­˜åœ¨å¯å˜å’Œä¸å¯å˜å¼•ç”¨ã€‚</p>
<h2 id="èµ‹å€¼"><a href="#èµ‹å€¼" class="headerlink" title="èµ‹å€¼"></a>èµ‹å€¼</h2><p>èµ‹å€¼ä¼šå¼•èµ·ä¸¤ç§è¯­ä¹‰ï¼š<br>1.å¤åˆ¶ï¼ˆCOPYï¼‰ï¼šaä»ç„¶å¯ä»¥ä½¿ç”¨ï¼›<br>    éšå¼æµ…æ‹·è´ï¼šè‹¥ç±»å‹å®ç°Copy traitï¼ˆå¦‚æ•´æ•°ã€æµ®ç‚¹ã€å¸ƒå°”ã€å­—ç¬¦ã€å…ƒç»„ä¸­å…¨æ˜¯Copyç±»å‹ï¼‰ï¼Œåˆ™èµ‹å€¼æ—¶ä¸ºCopyè¯­ä¹‰ï¼Œä¸ä¼šè½¬ç§»æ‰€æœ‰æƒï¼›<br>    Cloneï¼ˆæ˜¾å¼æ·±æ‹·è´ï¼‰ï¼šä¼šåŒæ—¶èµ‹å€¼å †æ•°æ®ï¼›<br>2.æ‰€æœ‰æƒè½¬ç§»ï¼ˆMoveï¼‰ï¼šaä¸å†æœ‰æ•ˆã€‚</p>
<h2 id="Copyç±»å‹"><a href="#Copyç±»å‹" class="headerlink" title="Copyç±»å‹"></a>Copyç±»å‹</h2><table>
<thead>
<tr>
<th>ç±»å‹ç±»åˆ«</th>
<th>ç¤ºä¾‹</th>
<th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td>æ ‡é‡ç±»å‹ï¼ˆscalarï¼‰</td>
<td>i32, u64, f32, bool, char</td>
<td>å°ä¸”å›ºå®šå¤§å°ï¼Œåœ¨æ ˆä¸Š</td>
</tr>
<tr>
<td>å…¨æ˜¯Copyç±»å‹çš„å…ƒç»„</td>
<td>ï¼ˆi32, i32ï¼‰ï¼Œï¼ˆu8, f64, boolï¼‰</td>
<td>åªè¦é‡Œé¢æ¯ä¸ªå­—æ®µéƒ½æ˜¯Copy</td>
</tr>
<tr>
<td>æŒ‡é’ˆç±»ï¼ˆå°‘è§ï¼‰</td>
<td>*const T, *mut TåŸç”ŸæŒ‡é’ˆ</td>
<td>ä¸æ¶‰åŠæ‰€æœ‰æƒ</td>
</tr>
<tr>
<td>å‡½æ•°æŒ‡é’ˆ</td>
<td>fn(i32) -&gt; i32</td>
<td>ä¹Ÿæ˜¯Copy</td>
</tr>
</tbody></table>
<h2 id="éCopyç±»å‹"><a href="#éCopyç±»å‹" class="headerlink" title="éCopyç±»å‹"></a>éCopyç±»å‹</h2><table>
<thead>
<tr>
<th>ç±»å‹ç±»åˆ«</th>
<th>ç¤ºä¾‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>å †åˆ†é…ç±»å‹</td>
<td>Stringï¼ŒVec<T>, Box<T></T></T></td>
<td>åŒ…å«å †å†…å­˜æŒ‡é’ˆ</td>
</tr>
<tr>
<td>åŠ¨æ€å¤§å°ç±»å‹</td>
<td>&amp;str,Â [T],Â Rc<T></T></td>
<td>å†…éƒ¨æœ‰å¼•ç”¨è®¡æ•°æˆ–æŒ‡é’ˆ</td>
</tr>
<tr>
<td>ç”¨æˆ·å®šä¹‰ç»“æ„ä½“</td>
<td>è‹¥å­—æ®µä¸­å«éCopyæˆå‘˜</td>
<td>æ•´ä½“å°±ä¸æ˜¯Copy</td>
</tr>
<tr>
<td>å…¶ä»–æ™ºèƒ½æŒ‡é’ˆ</td>
<td>Rc<T>, Arc<T>, RefCell<T></T></T></T></td>
<td>æœ‰è¿è¡Œæ—¶ç®¡ç†é€»è¾‘</td>
</tr>
</tbody></table>
<h1 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h1><p>ç”Ÿå‘½å‘¨æœŸï¼ˆLifetimeï¼‰æ˜¯ç¼–è¯‘å™¨ç”¨æ¥ç¡®ä¿å¼•ç”¨å§‹ç»ˆæœ‰æ•ˆçš„æ ¸å¿ƒæœºåˆ¶ã€‚å®ƒä»¬è§£å†³äº†â€æ‚¬å‚å¼•ç”¨â€é—®é¢˜â€”â€”ç¡®ä¿å¼•ç”¨ä¸ä¼šæŒ‡å‘å·²é‡Šæ”¾çš„å†…å­˜ã€‚ç”Ÿå‘½å‘¨æœŸæ˜¯å¼•ç”¨æœ‰æ•ˆçš„ä½œç”¨åŸŸèŒƒå›´ï¼Œç”±ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶è¿›è¡Œé™æ€åˆ†æï¼Œä¸äº§ç”Ÿè¿è¡Œæ—¶å¼€é”€ï¼š** Â **<br>1.å¼•ç”¨åœ¨ä½¿ç”¨æ—¶å¼åˆæ³•çš„ï¼›<br>2.ä¸ä¼šæ‚¬ç©ºï¼ˆdangling referenceï¼‰<br>3.ä¸ä¼šåŒæ—¶å­˜åœ¨å†²çªçš„å¯å˜&#x2F;ä¸å¯å˜å¼•ç”¨ã€‚</p>
<p>ç”Ÿå‘½å‘¨æœŸå‚æ•°ç”¨Â â€˜a,Â â€˜bÂ ç­‰è¡¨ç¤ºï¼ˆæ’‡å·â€™å£°æ˜ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼‰ï¼Œç”¨æ³•ç±»ä¼¼äºæ³›å‹å‚æ•° ï¼ˆ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒRust ä¼šè‡ªåŠ¨æ¨æ–­ç”Ÿå‘½å‘¨æœŸï¼‰ï¼š<br>1.â€™aÂ å¹¶ä¸æ”¹å˜è¿è¡Œé€»è¾‘ï¼›<br>2.åªæ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ï¼šâ€œè¿™äº›å¼•ç”¨ä¹‹é—´çš„å…³ç³»â€</p>
<table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>å¿…é¡»æ˜ç¡®æ ‡æ³¨çš„æƒ…å†µ</th>
<th>å¯ä»¥çœç•¥çš„æƒ…å†µ</th>
</tr>
</thead>
<tbody><tr>
<td>ç»“æ„ä½“</td>
<td>åŒ…å«å¼•ç”¨ç±»å‹çš„å­—æ®µï¼ˆæ— è®ºå¤šå°‘ä¸ªï¼‰</td>
<td>ä¸åŒ…å«å¼•ç”¨å­—æ®µï¼ˆæ— éœ€ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼‰</td>
</tr>
<tr>
<td>æ™®é€šå‡½æ•°</td>
<td>1.å¤šä¸ªå¼•ç”¨å‚æ•°ä¸”è¿”å›å¼•ç”¨</td>
<td>1.æ— è¿”å›å¼•ç”¨ï¼›2.å•ä¸ªå¼•ç”¨å‚æ•°ä¸”è¿”å›å¼•ç”¨</td>
</tr>
<tr>
<td>æ–¹æ³•</td>
<td>1.è¿”å›å¼•ç”¨æ¥è‡ªå¤–éƒ¨å‚æ•°ï¼ˆéselfï¼‰ï¼›2.å¤šä¸ªå¤–éƒ¨å¼•ç”¨å‚æ•°</td>
<td>1.è¿”å›å¼•ç”¨æ¥è‡ªselfï¼Œ2.æ— è¿”å›å¼•ç”¨</td>
</tr>
<tr>
<td>Trait&#x2F;æšä¸¾</td>
<td>åŒ…å«å¼•ç”¨ç±»å‹çš„å…³è”é¡¹æˆ–æ–¹æ³•å‚æ•° &#x2F; è¿”å›å€¼</td>
<td>ä¸åŒ…å«å¼•ç”¨ç±»å‹çš„å…³è”é¡¹æˆ–æ–¹æ³•</td>
</tr>
</tbody></table>
<h2 id="ç»“æ„ä½“"><a href="#ç»“æ„ä½“" class="headerlink" title="ç»“æ„ä½“"></a>ç»“æ„ä½“</h2><p>å½“ç»“æ„ä½“åŒ…å«å¼•ç”¨æ—¶ï¼Œå¿…é¡»ä¸ºè¿™äº›å¼•ç”¨æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸï¼Œä»¥ç¡®ä¿ç»“æ„ä½“çš„ç”Ÿå‘½å‘¨æœŸä¸è¶…è¿‡å®ƒæ‰€åŒ…å«çš„å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸã€‚</p>
<p>è‹¥ç»“æ„ä½“çš„å¤šä¸ªå¼•ç”¨æ¥è‡ªä¸åŒç”Ÿå‘½å‘¨æœŸï¼Œå¯ç”¨å¤šä¸ªå‚æ•°åŒºåˆ†</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ä¸¤ä¸ªå­—æ®µçš„ç”Ÿå‘½å‘¨æœŸä¸åŒï¼Œåˆ†åˆ«ç”¨&#x27;aå’Œ&#x27;bæ ‡æ³¨</span><br><span class="line">structÂ Article&lt;&#x27;a, &#x27;b&gt; &#123;</span><br><span class="line">    content: &amp;&#x27;a str, // å†…å®¹çš„ç”Ÿå‘½å‘¨æœŸä¸º&#x27;aÂ  Â Â </span><br><span class="line">    source: &amp;&#x27;b str, Â // æ¥æºçš„ç”Ÿå‘½å‘¨æœŸä¸º&#x27;b</span><br><span class="line">&#125;</span><br><span class="line">fnÂ main() &#123;Â  Â Â </span><br><span class="line">    letÂ content =Â String::from(&quot;Rust lifecycle intro&quot;);Â  Â Â </span><br><span class="line">    letÂ source =Â &quot;Wikipedia&quot;;Â // å­—ç¬¦ä¸²å­—é¢é‡ï¼Œç”Ÿå‘½å‘¨æœŸä¸º&#x27;static</span><br><span class="line">Â  Â Â letÂ art =Â ArticleÂ &#123;Â  Â  Â  Â Â </span><br><span class="line">        content: &amp;content,Â  Â  Â  Â Â </span><br><span class="line">        source: &amp;source,Â  Â  </span><br><span class="line">    &#125;;Â  Â Â </span><br><span class="line">    // artçš„ç”Ÿå‘½å‘¨æœŸå—é™äº&#x27;aï¼ˆcontentçš„ç”Ÿå‘½å‘¨æœŸï¼‰å’Œ&#x27;bï¼ˆsourceçš„ç”Ÿå‘½å‘¨æœŸï¼‰ä¸­è¾ƒçŸ­çš„ä¸€ä¸ª</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><p>å‡½æ•°çš„å‚æ•°æˆ–è¿”å›å€¼å¦‚æœæ˜¯å¼•ç”¨ç±»å‹ï¼Œå¯èƒ½éœ€è¦æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸã€‚<br>çœç•¥è§„åˆ™ï¼šç¼–è¯‘å™¨æœ‰3æ¡ç”Ÿå‘½å‘¨æœŸæ¨æ–­è§„åˆ™ï¼Œå…è®¸åœ¨å¸¸è§åœºæ™¯ä¸­çœç•¥æ˜¾å¼æ³¨è§£ï¼š<br>1.æ¯ä¸ªå¼•ç”¨å‚æ•°è·å–è‡ªå·±çš„å£°æ˜å‘¨æœŸå‚æ•°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">fn foo(x: &amp;i32) Â  Â  Â  Â  // éšå¼ï¼šfn foo&lt;&#x27;a&gt;(x: &amp;&#x27;a i32)</span><br><span class="line">fnÂ foo(x: &amp;i32, y: &amp;i32) // éšå¼ï¼šfn foo&lt;&#x27;a, &#x27;b&gt;(x: &amp;&#x27;a i32, y: &amp;&#x27;b i32)</span><br></pre></td></tr></table></figure>
<p>2.è‹¥åªæœ‰ä¸€ä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œå®ƒè¢«èµ‹äºˆæ‰€æœ‰è¾“å‡ºå£°æ˜å‘¨æœŸå‚æ•°ï¼›</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">fn bar(x: &amp;str) -&gt; &amp;strÂ // éšå¼ï¼šfn bar&lt;&#x27;a&gt;(x: &amp;&#x27;aÂ str) -&gt; &amp;&#x27;a str</span><br></pre></td></tr></table></figure>
<p>3.è‹¥æœ‰å¤šä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œä½†å…¶ä¸­ä¸€ä¸ªæ˜¯&amp;selfæˆ–Â &amp;mut selfï¼Œåˆ™selfçš„ç”Ÿå‘½å‘¨æœŸå°†èµ‹äºˆæ‰€æœ‰è¾“å‡ºå‘¨æœŸå‚æ•°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">impl&lt;&#x27;a&gt; ImportantExcerpt&lt;&#x27;a&gt; &#123;Â  Â  </span><br><span class="line">    fn announce(&amp;self, announcement: &amp;str) -&gt; &amp;strÂ &#123;Â  Â  Â  Â  </span><br><span class="line">        // éšå¼ï¼šfn announce&lt;&#x27;b&gt;(&amp;&#x27;a self, announcement: &amp;&#x27;b str) -&gt; &amp;&#x27;aÂ strÂ  Â  Â  Â  </span><br><span class="line">        println!(&quot;æ³¨æ„ï¼š&#123;&#125;&quot;, announcement);Â  Â  Â  Â  </span><br><span class="line">        self.partÂ  Â  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¿…é¡»æ˜ç¡®æ ‡æ³¨çš„æƒ…å†µï¼šå½“å‡½æ•°çš„è¿”å›å¼•ç”¨å¯èƒ½æ¥è‡ªå¤šä¸ªè¾“å…¥å¼•ç”¨ï¼Œæˆ–ç¼–è¯‘å™¨æ— æ³•æ¨æ–­è¿”å›å¼•ç”¨çš„æ¥æºæ—¶ï¼Œå¿…é¡»æ‰‹åŠ¨æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸï¼š<br>å¤šä¸ªè¾“å…¥å¼•ç”¨å‚æ•°ï¼Œä¸”è¿”å›å¼•ç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// æ­£ç¡®ç¤ºä¾‹ï¼šæ ‡æ³¨ç”Ÿå‘½å‘¨æœŸ&#x27;aï¼Œè¯´æ˜xã€yå’Œè¿”å›å€¼å…±äº«åŒä¸€ç”Ÿå‘½å‘¨æœŸ</span><br><span class="line">// æ³¨è§£&#x27;aè¡¨ç¤ºï¼šè¿”å›çš„å¼•ç”¨å¿…é¡»æ¥è‡ªxæˆ–yï¼Œä¸”å…¶ç”Ÿå‘½å‘¨æœŸä¸è¶…è¿‡xå’Œyä¸­ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„é‚£ä¸ªã€‚</span><br><span class="line">fn longest&lt;&#x27;a&gt;(x: &amp;&#x27;a str,Â y: &amp;&#x27;a str) -&gt; &amp;&#x27;a str &#123;Â  Â Â </span><br><span class="line">    ifÂ x.len() &gt; y.len() &#123; x &#125;Â elseÂ &#123; y &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="é™æ€ç”Ÿå‘½å‘¨æœŸ"><a href="#é™æ€ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="é™æ€ç”Ÿå‘½å‘¨æœŸ"></a>é™æ€ç”Ÿå‘½å‘¨æœŸ</h2><p>â€˜staticæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç”Ÿå‘½å‘¨æœŸï¼Œè¡¨ç¤ºå¼•ç”¨å¯ä»¥å­˜æ´»åˆ°æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´ã€‚å¸¸è§ï¼š<br>1.å­—ç¬¦ä¸²å­—é¢é‡ï¼šå­˜å‚¨åœ¨ç¨‹åºçš„åªè¯»å†…å­˜ä¸­ï¼Œç”Ÿå‘½å‘¨æœŸä¸ºâ€™staticã€‚<br>2.æ˜¾å¼å£°æ˜ä¸ºâ€™staticçš„å¼•ç”¨ï¼ˆéœ€ç¡®ä¿å¼•ç”¨çš„å€¼ç¡®å®èƒ½å­˜æ´»åˆ°ç¨‹åºç»“æŸï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼‰ã€‚</p>
]]></content>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustä¸­æ¨¡å—å®šä¹‰ä¸å¯¼å…¥</title>
    <url>/2024/09/17/Rust%E4%B8%AD%E6%A8%A1%E5%9D%97%E5%AE%9A%E4%B9%89%E4%B8%8E%E5%AF%BC%E5%85%A5/</url>
    <content><![CDATA[<p>æ¨¡å—ï¼ˆmodï¼‰æ˜¯Rustçš„æ ¸å¿ƒä»£ç ç»„ç»‡å·¥å…·ï¼Œç”¨äºè§£å†³å‘½åå†²çªã€æ§åˆ¶ä»£ç å¯è§æ€§ï¼ˆå°è£…ï¼‰ã€æ‹†åˆ†å¤§å‹é¡¹ç›®ã€‚</p>
<span id="more"></span>

<h2 id="æ¨¡å—çš„ä½œç”¨"><a href="#æ¨¡å—çš„ä½œç”¨" class="headerlink" title="æ¨¡å—çš„ä½œç”¨"></a>æ¨¡å—çš„ä½œç”¨</h2><ol>
<li><strong>ç»„ç»‡ä»£ç ç»“æ„</strong>ï¼šæŠŠé€»è¾‘ç›¸å…³çš„å‡½æ•°ã€ç»“æ„ç­‰æ”¾åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œä¿æŒä»£ç æ¸…æ™°</li>
<li><strong>æ§åˆ¶å¯è§æ€§</strong>ï¼šæ¨¡å—å†…çš„é¡¹ï¼ˆå¦‚å‡½æ•°ã€ç»“æ„ç­‰ï¼‰é»˜è®¤æ˜¯ç§æœ‰çš„ï¼ˆ<code>private</code>ï¼‰ï¼Œæ ¹æ®éœ€è¦è®¾å®šå…¶å…¬å¼€æ€§</li>
<li><strong>å‘½åç©ºé—´ç®¡ç†ï¼ˆä½œç”¨åŸŸéš”ç¦»ï¼‰</strong>ï¼šæ¨¡å—æ”¯æŒå±‚çº§è·¯å¾„è®¿é—®ï¼Œå¯é˜²æ­¢å‘½åå†²çª</li>
</ol>
<h2 id="modã€use-çš„å…³ç³»"><a href="#modã€use-çš„å…³ç³»" class="headerlink" title="modã€use çš„å…³ç³»"></a>modã€use çš„å…³ç³»</h2><table>
<thead>
<tr>
<th>æ¦‚å¿µ</th>
<th>è¯´æ˜</th>
<th>å±‚é¢</th>
</tr>
</thead>
<tbody><tr>
<td>æ–‡ä»¶&#x2F;ç›®å½•ä½œä¸º mod å</td>
<td>æ¨¡å—çš„ã€Œç‰©ç†è½½ä½“ã€ï¼ˆå•æ–‡ä»¶ &#x3D; å•ä¸ª modï¼Œç›®å½• &#x3D; æ¨¡å—å®¹å™¨ï¼‰</td>
<td>ç‰©ç†å±‚é¢ç»„ç»‡ä»£ç </td>
</tr>
<tr>
<td>æ˜ç¡®ç”¨ mod&lt;name&gt; å£°æ˜</td>
<td>æ¨¡å—çš„ã€Œç¼–è¯‘å™¨æ³¨å†Œã€ï¼ˆå‘Šè¯‰ç¼–è¯‘å™¨â€è¿™ä¸ªæ¨¡å—å­˜åœ¨ï¼ŒåŠ å…¥é¡¹ç›®â€ï¼‰</td>
<td>é€»è¾‘å±‚é¢æ³¨å†Œ</td>
</tr>
<tr>
<td>use è¯­å¥</td>
<td>æ¨¡å—å…ƒç´ çš„ã€Œä½œç”¨åŸŸå¯¼å…¥ã€</td>
<td>æŠŠå·²æ³¨å†Œæ¨¡å—ä¸­çš„å…ƒç´ å¯¼å…¥å½“å‰ä½œç”¨åŸŸ</td>
</tr>
</tbody></table>
<h2 id="1-æ¨¡å—å®šä¹‰"><a href="#1-æ¨¡å—å®šä¹‰" class="headerlink" title="1. æ¨¡å—å®šä¹‰"></a>1. æ¨¡å—å®šä¹‰</h2><p>æ¨¡å—æ—¢å¯ä»¥å†…è”å®šä¹‰ï¼ˆinline moduleï¼‰ï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨ç‹¬ç«‹æ–‡ä»¶&#x2F;ç›®å½•ä¸­ã€‚</p>
<h3 id="Rust-é¡¹ç›®çš„æ ¹æ¨¡å—"><a href="#Rust-é¡¹ç›®çš„æ ¹æ¨¡å—" class="headerlink" title="Rust é¡¹ç›®çš„æ ¹æ¨¡å—"></a>Rust é¡¹ç›®çš„æ ¹æ¨¡å—</h3><p>Rust é¡¹ç›®çš„æ ¹æ¨¡å—ç”±å…¥å£æ–‡ä»¶å†³å®šï¼š</p>
<ul>
<li><strong>äºŒè¿›åˆ¶é¡¹ç›®</strong>ï¼šå…¥å£æ˜¯ <code>src/main.rs</code>ï¼Œ<code>main.rs</code> å°±æ˜¯æ ¹æ¨¡å—ï¼ˆ<code>crate</code>ï¼‰</li>
<li><strong>åº“é¡¹ç›®</strong>ï¼šå…¥å£æ˜¯ <code>src/lib.rs</code>ï¼Œ<code>lib.rs</code> æ˜¯æ ¹æ¨¡å—ï¼ˆ<code>crate</code>ï¼‰</li>
</ul>
<p>æ‰€æœ‰æ¨¡å—ï¼ˆæ–‡ä»¶&#x2F;ç›®å½•ï¼‰éƒ½éœ€åœ¨æ ¹æ¨¡å—ä¸­é€šè¿‡ <code>mod</code> æ³¨å†Œï¼Œæ‰èƒ½è¢«è®¿é—®ã€‚</p>
<h3 id="å†…è”æ¨¡å—"><a href="#å†…è”æ¨¡å—" class="headerlink" title="å†…è”æ¨¡å—"></a>å†…è”æ¨¡å—</h3><p>åœ¨åŒä¸€ä¸ªæ–‡ä»¶å†…å®šä¹‰æ¨¡å—ï¼›ç”¨ <code>mod æ¨¡å—å &#123; ... &#125;</code> å£°æ˜æ¨¡å—ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰æ ¹æ¨¡å—ä¸‹çš„æ¨¡å— math</span></span><br><span class="line"><span class="keyword">mod</span> math &#123;</span><br><span class="line">    <span class="comment">// æ¨¡å—å†…çš„ç§æœ‰å‡½æ•°ï¼ˆé»˜è®¤ç§æœ‰ï¼Œä»…æ¨¡å—å†…å¯è®¿é—®ï¼‰</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">square</span>(x: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        x * x</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨ pub æš´éœ²å…¬å…±å‡½æ•°ï¼ˆå¤–éƒ¨å¯è®¿é—®ï¼‰</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        a + b</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åµŒå¥—æ¨¡å—ï¼ˆæ¨¡å—å¯åµŒå¥—ï¼‰</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">mod</span> advanced &#123;</span><br><span class="line">        <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">multiply</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">            a * b</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">square</span>(x: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">            x * x</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = math::<span class="title function_ invoke__">add</span>(<span class="number">5</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, result); <span class="comment">// 8</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="variable">advanced_result</span> = math::advanced::<span class="title function_ invoke__">multiply</span>(<span class="number">5</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, advanced_result); <span class="comment">// 15</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ–‡ä»¶æˆ–ç›®å½•æ¨¡å—"><a href="#æ–‡ä»¶æˆ–ç›®å½•æ¨¡å—" class="headerlink" title="æ–‡ä»¶æˆ–ç›®å½•æ¨¡å—"></a>æ–‡ä»¶æˆ–ç›®å½•æ¨¡å—</h3><p>å°†æ¨¡å—æ‹†åˆ†ä¸ºå¤šä¸ªæ–‡ä»¶&#x2F;ç›®å½•ï¼Œæ ¸å¿ƒè§„åˆ™ï¼š</p>
<ul>
<li>ä¸€ä¸ªæ–‡ä»¶å¯¹åº”ä¸€ä¸ªæ¨¡å—ï¼ˆå¦‚ <code>math.rs</code> å¯¹åº”æ¨¡å— <code>math</code>ï¼‰</li>
<li>ä¸€ä¸ªç›®å½•å¯¹åº”ä¸€ä¸ªæ¨¡å—ï¼ˆå¦‚ <code>utils/</code> å¯¹åº”æ¨¡å— <code>utils</code>ï¼‰ï¼Œç›®å½•åå³ä¸ºæ¨¡å—å</li>
</ul>
<h4 id="é¡¹ç›®ç›®å½•ç»“æ„ç¤ºä¾‹"><a href="#é¡¹ç›®ç›®å½•ç»“æ„ç¤ºä¾‹" class="headerlink" title="é¡¹ç›®ç›®å½•ç»“æ„ç¤ºä¾‹"></a>é¡¹ç›®ç›®å½•ç»“æ„ç¤ºä¾‹</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">src/</span><br><span class="line">â”œâ”€â”€ main.rs                # æ ¹æ¨¡å—</span><br><span class="line">â”œâ”€â”€ math.rs                # å•æ–‡ä»¶æ¨¡å—ï¼šmath</span><br><span class="line">â””â”€â”€ utils/                 # ç›®å½•æ¨¡å—ï¼šutils</span><br><span class="line">    â”œâ”€â”€ mod.rs             # å£°æ˜å­æ¨¡å—ï¼ˆRust 1.32+ å¯é€‰ï¼‰</span><br><span class="line">    â”œâ”€â”€ string.rs          # å­æ¨¡å— utils::string</span><br><span class="line">    â””â”€â”€ math.rs            # å­æ¨¡å— utils::math</span><br></pre></td></tr></table></figure>

<h4 id="æ–‡ä»¶æ¨¡å—ç¤ºä¾‹"><a href="#æ–‡ä»¶æ¨¡å—ç¤ºä¾‹" class="headerlink" title="æ–‡ä»¶æ¨¡å—ç¤ºä¾‹"></a>æ–‡ä»¶æ¨¡å—ç¤ºä¾‹</h4><p><strong>src&#x2F;math.rsï¼ˆå®šä¹‰ math æ¨¡å—ï¼‰ï¼š</strong></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">subtract</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    a - b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>src&#x2F;main.rsï¼ˆæ ¹æ¨¡å—ï¼Œæ³¨å†Œ mathï¼‰ï¼š</strong></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mod</span> math; <span class="comment">// æ³¨å†Œ math æ¨¡å—</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = math::<span class="title function_ invoke__">add</span>(<span class="number">10</span>, <span class="number">5</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, result); <span class="comment">// 15</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç›®å½•æ¨¡å—ç¤ºä¾‹"><a href="#ç›®å½•æ¨¡å—ç¤ºä¾‹" class="headerlink" title="ç›®å½•æ¨¡å—ç¤ºä¾‹"></a>ç›®å½•æ¨¡å—ç¤ºä¾‹</h4><p><strong>src&#x2F;utils&#x2F;mod.rsï¼ˆå£°æ˜ utils æ¨¡å—åŠå…¶å­æ¨¡å—ï¼‰ï¼š</strong></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> string;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> math;</span><br></pre></td></tr></table></figure>

<p><strong>src&#x2F;utils&#x2F;string.rsï¼š</strong></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">trim_str</span>(s: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="type">str</span> &#123;</span><br><span class="line">    s.<span class="title function_ invoke__">trim</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">to_uppercase</span>(s: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">    s.<span class="title function_ invoke__">to_uppercase</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>src&#x2F;utils&#x2F;math.rsï¼š</strong></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">multiply</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    a * b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>src&#x2F;main.rsï¼ˆæ ¹æ¨¡å—ï¼‰ï¼š</strong></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mod</span> utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">trimmed</span> = utils::string::<span class="title function_ invoke__">trim_str</span>(<span class="string">&quot;  hello  &quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">product</span> = utils::math::<span class="title function_ invoke__">multiply</span>(<span class="number">5</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, trimmed);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, product);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¯è§æ€§ä¿®é¥°ç¬¦"><a href="#å¯è§æ€§ä¿®é¥°ç¬¦" class="headerlink" title="å¯è§æ€§ä¿®é¥°ç¬¦"></a>å¯è§æ€§ä¿®é¥°ç¬¦</h3><p>é»˜è®¤æ˜¯æ¨¡å—ç§æœ‰ï¼ˆä»…å½“å‰æ¨¡å—åŠå­æ¨¡å—å¯è®¿é—®ï¼‰ï¼Œé€šè¿‡ <code>pub</code> æ‰©å±•å¯è§æ€§ï¼Œæ”¯æŒç»†ç²’åº¦æ§åˆ¶ï¼š</p>
<table>
<thead>
<tr>
<th>ä¿®é¥°ç¬¦</th>
<th>èŒƒå›´</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td><code>pub</code></td>
<td>å…¨å±€å¯è§</td>
<td>æš´éœ²å…¬å…± API</td>
</tr>
<tr>
<td><code>pub(crate)</code></td>
<td>å½“å‰ crate å†…æ‰€æœ‰åœ°æ–¹å¯è§</td>
<td>å†…éƒ¨æ¨¡å—é—´å…±äº«ï¼Œä¸å¯¹å¤–æš´éœ²</td>
</tr>
<tr>
<td><code>pub(super)</code></td>
<td>å½“å‰æ¨¡å—çš„ã€Œçˆ¶æ¨¡å—ã€åŠå…¶åä»£æ¨¡å—ä¸­å¯è§</td>
<td>å­æ¨¡å—å‘çˆ¶æ¨¡å—æš´éœ²</td>
</tr>
<tr>
<td><code>pub(in è·¯å¾„)</code></td>
<td>åœ¨æŒ‡å®šè·¯å¾„ä»£è¡¨çš„æ¨¡å—åŠå…¶æ‰€æœ‰åä»£ä¸­å¯è§</td>
<td>è·¨å¤šçº§æ¨¡å—çš„æœ‰é™å…±äº«</td>
</tr>
<tr>
<td>é»˜è®¤ï¼ˆæ— ä¿®é¥°ï¼‰</td>
<td>å½“å‰æ¨¡å—åŠå…¶åä»£æ¨¡å—ä¸­å¯è§</td>
<td>å®Œå…¨ç§æœ‰</td>
</tr>
</tbody></table>
<h4 id="å¯è§æ€§ç¤ºä¾‹"><a href="#å¯è§æ€§ç¤ºä¾‹" class="headerlink" title="å¯è§æ€§ç¤ºä¾‹"></a>å¯è§æ€§ç¤ºä¾‹</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mod</span> outer &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">a</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;a: å…¨å±€å¯è§&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">pub</span>(<span class="keyword">crate</span>) <span class="keyword">fn</span> <span class="title function_">b</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;b: ä»…å½“å‰ crate å¯è§&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">pub</span>(<span class="keyword">super</span>) <span class="keyword">fn</span> <span class="title function_">c</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;c: ä»…çˆ¶æ¨¡å—ï¼ˆæ ¹æ¨¡å—ï¼‰å¯è§&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">pub</span>(<span class="keyword">in</span> crate::outer::inner) <span class="keyword">fn</span> <span class="title function_">d</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;d: ä»… inner æ¨¡å—å¯è§&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">mod</span> inner &#123;</span><br><span class="line">        <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">e</span>() &#123;</span><br><span class="line">            <span class="comment">// å­æ¨¡å—å¯è®¿é—®çˆ¶æ¨¡å—çš„æ‰€æœ‰å…ƒç´ ï¼ˆåŒ…æ‹¬ç§æœ‰ï¼‰</span></span><br><span class="line">            super::<span class="title function_ invoke__">a</span>();</span><br><span class="line">            super::<span class="title function_ invoke__">b</span>();</span><br><span class="line">            super::<span class="title function_ invoke__">c</span>();</span><br><span class="line">            super::<span class="title function_ invoke__">d</span>();</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;e: ç§æœ‰å‡½æ•°ï¼Œä»…å½“å‰æ¨¡å—å¯è§&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    outer::<span class="title function_ invoke__">a</span>(); <span class="comment">// âœ“ å¯ä»¥è®¿é—®</span></span><br><span class="line">    outer::<span class="title function_ invoke__">c</span>(); <span class="comment">// âœ“ å¯ä»¥è®¿é—®</span></span><br><span class="line">    <span class="comment">// outer::b(); // âœ— ç¼–è¯‘é”™è¯¯ï¼špub(crate) åªåœ¨ crate å†…å¯è®¿é—®</span></span><br><span class="line">    <span class="comment">// outer::d(); // âœ— ç¼–è¯‘é”™è¯¯ï¼špub(in ...) åªåœ¨æŒ‡å®šè·¯å¾„å¯è®¿é—®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-æ¨¡å—çš„å¼•ç”¨"><a href="#2-æ¨¡å—çš„å¼•ç”¨" class="headerlink" title="2. æ¨¡å—çš„å¼•ç”¨"></a>2. æ¨¡å—çš„å¼•ç”¨</h2><p>å¼•ç”¨æ¨¡å—å†…çš„å…ƒç´ æ—¶ï¼Œéœ€è¦é€šè¿‡è·¯å¾„ã€‚</p>
<h3 id="è·¯å¾„ç±»å‹"><a href="#è·¯å¾„ç±»å‹" class="headerlink" title="è·¯å¾„ç±»å‹"></a>è·¯å¾„ç±»å‹</h3><ul>
<li><strong>ç»å¯¹è·¯å¾„</strong>ï¼šä»æ ¹æ¨¡å—ï¼ˆ<code>crate</code>ï¼‰å¼€å§‹ï¼Œä»¥ <code>crate::</code> å¼€å¤´ï¼ˆ<code>crate</code> ä»£è¡¨å½“å‰é¡¹ç›®ï¼‰</li>
<li><strong>ç›¸å¯¹è·¯å¾„</strong>ï¼šä»å½“å‰æ¨¡å—å¼€å§‹ï¼Œç”¨ <code>self</code>ï¼ˆå½“å‰æ¨¡å—ï¼Œé»˜è®¤å¯çœç•¥ï¼‰æˆ– <code>super</code>ï¼ˆçˆ¶æ¨¡å—ï¼‰å¯¼èˆª</li>
</ul>
<h4 id="è·¯å¾„ç¤ºä¾‹"><a href="#è·¯å¾„ç¤ºä¾‹" class="headerlink" title="è·¯å¾„ç¤ºä¾‹"></a>è·¯å¾„ç¤ºä¾‹</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç»å¯¹è·¯å¾„</span></span><br><span class="line">crate::math::<span class="title function_ invoke__">add</span>(<span class="number">10</span>, <span class="number">5</span>);</span><br><span class="line">crate::utils::string::<span class="title function_ invoke__">trim_str</span>(<span class="string">&quot;  hello  &quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›¸å¯¹è·¯å¾„ï¼ˆåœ¨åŒçº§æ¨¡å—ä¸­ï¼‰</span></span><br><span class="line">self::math::<span class="title function_ invoke__">add</span>(<span class="number">10</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›¸å¯¹è·¯å¾„ï¼ˆè®¿é—®çˆ¶æ¨¡å—ï¼‰</span></span><br><span class="line">super::math::<span class="title function_ invoke__">add</span>(<span class="number">10</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<h3 id="æ³¨å†Œä¸å¯¼å…¥"><a href="#æ³¨å†Œä¸å¯¼å…¥" class="headerlink" title="æ³¨å†Œä¸å¯¼å…¥"></a>æ³¨å†Œä¸å¯¼å…¥</h3><p>å½“å‰é¡¹ç›®å†…çš„æºä»£ç æ–‡ä»¶å’Œå†…éƒ¨æ¨¡å—ï¼Œé¦–æ¬¡åœ¨é¡¹ç›®ä¸­å¼•å…¥ï¼ˆ<code>use</code>ï¼‰æ—¶ï¼Œå¿…é¡»ç”¨ <code>mod</code> å£°æ˜æ³¨å†Œï¼ˆåœ¨æ ¹æ¨¡å—ï¼ˆ<code>main.rs</code>&#x2F;<code>lib.rs</code>ï¼‰å†™ <code>mod &lt;mod-name&gt;;</code>ï¼‰ã€‚</p>
<p>å¯¹äºå¤–éƒ¨ä¾èµ–ï¼ˆå¦‚ <code>serde</code>ã€<code>prost</code>ï¼‰ï¼Œé€šè¿‡ <code>Cargo.toml</code> å£°æ˜ï¼ˆå·²åœ¨å…¶è‡ªèº«çš„ <code>lib.rs</code> ä¸­æ³¨å†Œè¿‡äº†ï¼Œæ— éœ€ <code>mod</code>ï¼‰ï¼Œç›´æ¥ç”¨ <code>use</code> å¯¼å…¥å³å¯ã€‚</p>
<h4 id="æ³¨å†Œè§„åˆ™"><a href="#æ³¨å†Œè§„åˆ™" class="headerlink" title="æ³¨å†Œè§„åˆ™"></a>æ³¨å†Œè§„åˆ™</h4><ul>
<li>å•æ–‡ä»¶ modï¼ˆå¦‚ <code>engine.rs</code>ï¼‰ï¼šåœ¨æ ¹æ¨¡å—ï¼ˆ<code>main.rs</code>&#x2F;<code>lib.rs</code>ï¼‰å†™ <code>mod engine;</code>ï¼ˆæ³¨å†Œï¼‰</li>
<li>ç›®å½• modï¼ˆå¦‚ <code>engine/</code>ï¼‰ï¼šåœ¨æ ¹æ¨¡å—å†™ <code>mod engine &#123; pub mod core; &#125;</code>ï¼ˆæ³¨å†Œï¼‰</li>
<li>åŒä¸€æ–‡ä»¶å†…çš„æ˜¾å¼ modï¼šç›´æ¥å†™ <code>mod math &#123; ... &#125;</code>ï¼ˆå£°æ˜å³æ³¨å†Œï¼‰</li>
</ul>
<h4 id="mod-æ³¨å†ŒæŸ¥æ‰¾è§„åˆ™"><a href="#mod-æ³¨å†ŒæŸ¥æ‰¾è§„åˆ™" class="headerlink" title="mod æ³¨å†ŒæŸ¥æ‰¾è§„åˆ™"></a>mod æ³¨å†ŒæŸ¥æ‰¾è§„åˆ™</h4><p>ä»¥ <code>mod game;</code> ä¸ºä¾‹ï¼š</p>
<ol>
<li>æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ <code>game.rs</code></li>
<li>æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶å¤¹ <code>game</code></li>
<li>ä¸€æ—¦æ‰¾åˆ°å…¶ä¸­ä¸€ä¸ªï¼Œå°±ä¼šåœæ­¢ç»§ç»­æŸ¥æ‰¾</li>
</ol>
<h4 id="æ³¨å†Œä¸å¯¼å…¥å®Œæ•´ç¤ºä¾‹"><a href="#æ³¨å†Œä¸å¯¼å…¥å®Œæ•´ç¤ºä¾‹" class="headerlink" title="æ³¨å†Œä¸å¯¼å…¥å®Œæ•´ç¤ºä¾‹"></a>æ³¨å†Œä¸å¯¼å…¥å®Œæ•´ç¤ºä¾‹</h4><p><strong>ç›®å½•ç»“æ„ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">src/</span><br><span class="line">â”œâ”€â”€ main.rs               # æ ¹æ¨¡å—ï¼ˆæ³¨å†Œæ‰€æœ‰è‡ªå®šä¹‰æ¨¡å—ï¼‰</span><br><span class="line">â”œâ”€â”€ utils.rs              # å•æ–‡ä»¶æ¨¡å—ï¼šé€šç”¨å·¥å…·å‡½æ•°</span><br><span class="line">â””â”€â”€ calc/                 # ç›®å½•æ¨¡å—ï¼šè®¡ç®—æ ¸å¿ƒ</span><br><span class="line">    â”œâ”€â”€ mod.rs</span><br><span class="line">    â”œâ”€â”€ base.rs           # å­æ¨¡å— calc::baseï¼šåŸºç¡€åŠ å‡</span><br><span class="line">    â””â”€â”€ advanced.rs       # å­æ¨¡å— calc::advancedï¼šé«˜çº§ä¹˜é™¤/å¹³æ–¹</span><br></pre></td></tr></table></figure>

<p><strong>src&#x2F;main.rsï¼ˆæ ¹æ¨¡å—ï¼‰ï¼š</strong></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// =====================================================================</span></span><br><span class="line"><span class="comment">// ç¬¬ä¸€æ­¥ï¼šmod æ³¨å†Œï¼ˆå‘Šè¯‰ç¼–è¯‘å™¨&quot;è¿™äº›æ¨¡å—å­˜åœ¨ï¼ŒåŠ å…¥é¡¹ç›®&quot;ï¼‰</span></span><br><span class="line"><span class="comment">// =====================================================================</span></span><br><span class="line"><span class="keyword">mod</span> utils;</span><br><span class="line"><span class="keyword">mod</span> calc;</span><br><span class="line"></span><br><span class="line"><span class="comment">// =====================================================================</span></span><br><span class="line"><span class="comment">// æ¼”ç¤º1ï¼šä¸ç”¨ useï¼Œé€šè¿‡å®Œæ•´è·¯å¾„è®¿é—®ï¼ˆä¸ç®€åŒ–ï¼‰</span></span><br><span class="line"><span class="comment">// =====================================================================</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">demo_without_use</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">trimmed</span> = crate::utils::<span class="title function_ invoke__">trim_str</span>(<span class="string">&quot;  hello world  &quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Trimmed: &#123;&#125;&quot;</span>, trimmed);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">add_res</span> = crate::calc::base::<span class="title function_ invoke__">add</span>(<span class="number">10</span>, <span class="number">20</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Add result: &#123;&#125;&quot;</span>, add_res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// =====================================================================</span></span><br><span class="line"><span class="comment">// æ¼”ç¤º2ï¼šç”¨ use å¯¼å…¥åè®¿é—®ï¼ˆç®€åŒ–è·¯å¾„ï¼Œé€‚åˆé¢‘ç¹è®¿é—®ï¼‰</span></span><br><span class="line"><span class="comment">// =====================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åœºæ™¯1ï¼šå¯¼å…¥å•ä¸ªå…ƒç´ ï¼ˆç›´æ¥ç”¨ trim_strï¼Œæ— éœ€å‰ç¼€ï¼‰</span></span><br><span class="line"><span class="keyword">use</span> utils::trim_str;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœºæ™¯2ï¼šå¯¼å…¥æ¨¡å—ï¼ˆç”¨&quot;æ¨¡å—å::å…ƒç´ &quot;è®¿é—®ï¼Œé€‚åˆå¤šä¸ªå…ƒç´ ï¼‰</span></span><br><span class="line"><span class="keyword">use</span> calc::base;</span><br><span class="line"><span class="keyword">use</span> calc::advanced;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">demo_with_use</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">trimmed</span> = <span class="title function_ invoke__">trim_str</span>(<span class="string">&quot;  use ç®€åŒ–è®¿é—®  &quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Trimmed: &#123;&#125;&quot;</span>, trimmed);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">sub_res</span> = base::<span class="title function_ invoke__">subtract</span>(<span class="number">20</span>, <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Subtract result: &#123;&#125;&quot;</span>, sub_res);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">mul_res</span> = advanced::<span class="title function_ invoke__">multiply</span>(<span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Multiply result: &#123;&#125;&quot;</span>, mul_res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// =====================================================================</span></span><br><span class="line"><span class="comment">// æ¼”ç¤º3ï¼šå¯¼å…¥å¤šä¸ªå…ƒç´ ï¼ˆå¤§æ‹¬å· &#123;&#125;ï¼‰</span></span><br><span class="line"><span class="comment">// =====================================================================</span></span><br><span class="line"><span class="keyword">use</span> calc::&#123;base, advanced&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">demo_import_multiple</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">add_res</span> = base::<span class="title function_ invoke__">add</span>(<span class="number">100</span>, <span class="number">200</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">mul_res</span> = advanced::<span class="title function_ invoke__">multiply</span>(<span class="number">10</span>, <span class="number">20</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Add: &#123;&#125;, Multiply: &#123;&#125;&quot;</span>, add_res, mul_res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// =====================================================================</span></span><br><span class="line"><span class="comment">// æ¼”ç¤º4ï¼šå¯¼å…¥å…¨éƒ¨å…¬å…±å…ƒç´ ï¼ˆé€šé…ç¬¦ *ï¼‰</span></span><br><span class="line"><span class="comment">// =====================================================================</span></span><br><span class="line"><span class="keyword">use</span> utils::*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">demo_wildcard</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">trimmed</span> = <span class="title function_ invoke__">trim_str</span>(<span class="string">&quot;  wildcard import  &quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">upper</span> = <span class="title function_ invoke__">to_uppercase</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Trimmed: &#123;&#125;, Upper: &#123;&#125;&quot;</span>, trimmed, upper);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// =====================================================================</span></span><br><span class="line"><span class="comment">// æ¼”ç¤º5ï¼šåˆ«å asï¼ˆè§£å†³å‘½åå†²çªï¼‰</span></span><br><span class="line"><span class="comment">// =====================================================================</span></span><br><span class="line"><span class="keyword">use</span> calc::base <span class="keyword">as</span> base_calc;</span><br><span class="line"><span class="keyword">use</span> calc::advanced <span class="keyword">as</span> advanced_calc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">demo_alias</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">res1</span> = base_calc::<span class="title function_ invoke__">add</span>(<span class="number">5</span>, <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">res2</span> = advanced_calc::<span class="title function_ invoke__">square</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Add: &#123;&#125;, Square: &#123;&#125;&quot;</span>, res1, res2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// =====================================================================</span></span><br><span class="line"><span class="comment">// æ¼”ç¤º6ï¼šé‡å¯¼å‡º pub useï¼ˆæš´éœ²ç»™å¤–éƒ¨ï¼‰</span></span><br><span class="line"><span class="comment">// =====================================================================</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> utils::trim_str <span class="keyword">as</span> public_trim_str;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;=== Demo 1: Without use ===&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">demo_without_use</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;\n=== Demo 2: With use ===&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">demo_with_use</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;\n=== Demo 3: Import multiple ===&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">demo_import_multiple</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;\n=== Demo 4: Wildcard ===&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">demo_wildcard</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;\n=== Demo 5: Alias ===&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">demo_alias</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>src&#x2F;utils.rsï¼š</strong></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">trim_str</span>(s: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="type">str</span> &#123;</span><br><span class="line">    s.<span class="title function_ invoke__">trim</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">to_uppercase</span>(s: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">    s.<span class="title function_ invoke__">to_uppercase</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">to_lowercase</span>(s: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">    s.<span class="title function_ invoke__">to_lowercase</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>src&#x2F;calc&#x2F;mod.rsï¼š</strong></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> base;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">mod</span> advanced;</span><br></pre></td></tr></table></figure>

<p><strong>src&#x2F;calc&#x2F;base.rsï¼š</strong></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">add</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">subtract</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    a - b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>src&#x2F;calc&#x2F;advanced.rsï¼š</strong></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">multiply</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    a * b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">divide</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">panic!</span>(<span class="string">&quot;Division by zero&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    a / b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">square</span>(x: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    x * x</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="use-å…³é”®å­—ç”¨æ³•"><a href="#use-å…³é”®å­—ç”¨æ³•" class="headerlink" title="use å…³é”®å­—ç”¨æ³•"></a>use å…³é”®å­—ç”¨æ³•</h3><h4 id="å¯¼å…¥å¤šä¸ªå…ƒç´ ï¼ˆå¤§æ‹¬å·ï¼‰"><a href="#å¯¼å…¥å¤šä¸ªå…ƒç´ ï¼ˆå¤§æ‹¬å·ï¼‰" class="headerlink" title="å¯¼å…¥å¤šä¸ªå…ƒç´ ï¼ˆå¤§æ‹¬å·ï¼‰"></a>å¯¼å…¥å¤šä¸ªå…ƒç´ ï¼ˆå¤§æ‹¬å·ï¼‰</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯¼å…¥å¤šä¸ªç›¸å…³å…ƒç´ </span></span><br><span class="line"><span class="keyword">use</span> std::collections::&#123;HashMap, HashSet, BTreeMap&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼å…¥æŸä¸ªå…ƒç´ å’Œè¯¥æ¨¡å—è‡ªèº«</span></span><br><span class="line"><span class="keyword">use</span> std::io::&#123;<span class="keyword">self</span>, Write&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="å¯¼å…¥å…¨éƒ¨å…¬å…±å…ƒç´ ï¼ˆé€šé…ç¬¦ï¼‰"><a href="#å¯¼å…¥å…¨éƒ¨å…¬å…±å…ƒç´ ï¼ˆé€šé…ç¬¦ï¼‰" class="headerlink" title="å¯¼å…¥å…¨éƒ¨å…¬å…±å…ƒç´ ï¼ˆé€šé…ç¬¦ï¼‰"></a>å¯¼å…¥å…¨éƒ¨å…¬å…±å…ƒç´ ï¼ˆé€šé…ç¬¦ï¼‰</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯¼å…¥ prelude ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼ˆé€šå¸¸ç”¨äºæ ‡å‡†åº“ï¼‰</span></span><br><span class="line"><span class="keyword">use</span> std::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼å…¥è‡ªå®šä¹‰æ¨¡å—çš„æ‰€æœ‰å…ƒç´ </span></span><br><span class="line"><span class="keyword">use</span> my_module::*;</span><br></pre></td></tr></table></figure>

<h4 id="åˆ«åï¼ˆasï¼‰"><a href="#åˆ«åï¼ˆasï¼‰" class="headerlink" title="åˆ«åï¼ˆasï¼‰"></a>åˆ«åï¼ˆasï¼‰</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è§£å†³åç§°å†²çª</span></span><br><span class="line"><span class="keyword">use</span> std::io::<span class="type">Result</span> <span class="keyword">as</span> IoResult;</span><br><span class="line"><span class="keyword">use</span> std::fmt::<span class="type">Result</span> <span class="keyword">as</span> FmtResult;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">io_operation</span>() <span class="punctuation">-&gt;</span> IoResult&lt;()&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">fmt_operation</span>() <span class="punctuation">-&gt;</span> FmtResult &#123;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é‡å¯¼å‡ºï¼ˆpub-useï¼‰"><a href="#é‡å¯¼å‡ºï¼ˆpub-useï¼‰" class="headerlink" title="é‡å¯¼å‡ºï¼ˆpub useï¼‰"></a>é‡å¯¼å‡ºï¼ˆpub useï¼‰</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨ mod.rs ä¸­é‡å¯¼å‡ºï¼Œç®€åŒ– API è·¯å¾„</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> some_module::deeply::nested::Item;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨è€…å¯ä»¥ç›´æ¥è®¿é—®</span></span><br><span class="line"><span class="keyword">use</span> my_crate::Item; <span class="comment">// è€Œä¸æ˜¯ my_crate::some_module::deeply::nested::Item</span></span><br></pre></td></tr></table></figure>

<h2 id="3-æœ€ä½³å®è·µ"><a href="#3-æœ€ä½³å®è·µ" class="headerlink" title="3. æœ€ä½³å®è·µ"></a>3. æœ€ä½³å®è·µ</h2><ol>
<li><p><strong>æ–‡ä»¶æ¨¡å— vs å†…è”æ¨¡å—</strong></p>
<ul>
<li>ç®€å•çš„æ¨¡å—ï¼šä½¿ç”¨å†…è”æ¨¡å—ï¼ˆåŒä¸€æ–‡ä»¶ï¼‰</li>
<li>å¤æ‚çš„æ¨¡å—ï¼šæ‹†åˆ†ä¸ºå•ç‹¬æ–‡ä»¶æˆ–ç›®å½•</li>
</ul>
</li>
<li><p><strong>å¯è§æ€§æ§åˆ¶</strong></p>
<ul>
<li>é»˜è®¤ç§æœ‰ï¼ŒæŒ‰éœ€æš´éœ²å…¬å…± API</li>
<li>ä½¿ç”¨ <code>pub(crate)</code> éšè—å†…éƒ¨å®ç°ç»†èŠ‚</li>
</ul>
</li>
<li><p><strong>æ¨¡å—ç»„ç»‡</strong></p>
<ul>
<li>æŒ‰åŠŸèƒ½åˆ†ç»„ï¼Œé€»è¾‘æ¸…æ™°</li>
<li>é¿å…è¿‡æ·±çš„æ¨¡å—åµŒå¥—ï¼ˆé€šå¸¸ä¸è¶…è¿‡3å±‚ï¼‰</li>
</ul>
</li>
<li><p><strong>å¯¼å…¥æ–¹å¼</strong></p>
<ul>
<li>é¢‘ç¹ä½¿ç”¨ï¼šå¯¼å…¥å…·ä½“å…ƒç´ ï¼ˆ<code>use module::function;</code>ï¼‰</li>
<li>å¤šä¸ªå…ƒç´ ï¼šå¯¼å…¥æ¨¡å—ï¼ˆ<code>use module;</code>ï¼‰</li>
<li>è§£å†³å†²çªï¼šä½¿ç”¨ <code>as</code> åˆ«å</li>
</ul>
</li>
</ol>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li><strong>æ¨¡å—</strong>æ˜¯ Rust çš„æ ¸å¿ƒä»£ç ç»„ç»‡å·¥å…·</li>
<li><strong>mod æ³¨å†Œ</strong>å‘Šè¯‰ç¼–è¯‘å™¨æ¨¡å—çš„å­˜åœ¨</li>
<li><strong>use å¯¼å…¥</strong>åœ¨å½“å‰ä½œç”¨åŸŸç®€åŒ–è®¿é—®</li>
<li><strong>å¯è§æ€§ä¿®é¥°ç¬¦</strong>æ§åˆ¶å…ƒç´ çš„è®¿é—®èŒƒå›´</li>
<li><strong>ç»å¯¹&#x2F;ç›¸å¯¹è·¯å¾„</strong>ç”¨äºå¼•ç”¨æ¨¡å—å…ƒç´ </li>
<li><strong>é‡å¯¼å‡ºï¼ˆpub useï¼‰</strong>å¯ä»¥ç®€åŒ–å¤–éƒ¨ API</li>
</ul>
]]></content>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustä¸­çš„ Send å’Œ Sync trait è¯¦è§£</title>
    <url>/2023/09/20/Rust%E4%B8%AD%E7%9A%84-Send-%E5%92%8C-Sync-trait-%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<p>Rustä¸­çš„æ ‡è®° traitï¼ˆMarker Traitï¼‰<code>Send</code> å’Œ <code>Sync</code> æ˜¯å¹¶å‘å®‰å…¨çš„æ ¸å¿ƒåŸºçŸ³ã€‚ç”¨äºæ ‡è®°ç±»å‹çš„å¹¶å‘å®‰å…¨å±æ€§ï¼Œè®©ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶æ£€æŸ¥çº¿ç¨‹é—´æ•°æ®ä¼ é€’çš„åˆæ³•æ€§ï¼Œä»æ ¹æºä¸Šé¿å…æ•°æ®ç«äº‰ï¼ˆData Raceï¼‰ã€‚</p>
<span id="more"></span>

<h2 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h2><ul>
<li>**<code>Send</code>**ï¼šç±»å‹çš„å€¼èƒ½ä¸èƒ½åœ¨çº¿ç¨‹ä¹‹é—´â€ç§»åŠ¨æ‰€æœ‰æƒâ€ã€‚</li>
<li>**<code>Sync</code>**ï¼šç±»å‹çš„å€¼èƒ½ä¸èƒ½åœ¨å¤šä¸ªçº¿ç¨‹ä¸­â€å…±äº«å¼•ç”¨ &amp;Tâ€ã€‚</li>
</ul>
<h3 id="é‡è¦åŸåˆ™"><a href="#é‡è¦åŸåˆ™" class="headerlink" title="é‡è¦åŸåˆ™"></a>é‡è¦åŸåˆ™</h3><ul>
<li>å¯¹åŒä¸€ä¸ªå€¼è¿›è¡Œ<strong>å¹¶å‘è®¿é—®ï¼ˆåªè¯»ï¼‰</strong>æ˜¯å†…å­˜å®‰å…¨çš„ã€‚</li>
<li><strong>å¹¶å‘ä¿®æ”¹</strong>ä»ç„¶è¦é é”&#x2F;åŸå­&#x2F;å…¶ä»–æœºåˆ¶ã€‚</li>
</ul>
<h2 id="1-Send-æ‰€æœ‰æƒåœ¨çº¿ç¨‹é—´çš„è½¬ç§»"><a href="#1-Send-æ‰€æœ‰æƒåœ¨çº¿ç¨‹é—´çš„è½¬ç§»" class="headerlink" title="1. Send - æ‰€æœ‰æƒåœ¨çº¿ç¨‹é—´çš„è½¬ç§»"></a>1. Send - æ‰€æœ‰æƒåœ¨çº¿ç¨‹é—´çš„è½¬ç§»</h2><p>ä¸€ä¸ªç±»å‹ <code>T</code> æ˜¯ <code>Send</code>ï¼Œè¡¨ç¤ºæŠŠ <code>T</code> çš„ä¸€ä¸ªå€¼ä»ä¸€ä¸ªçº¿ç¨‹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸ä¼šå¼•å‘æ•°æ®ç«äº‰æˆ–å†…å­˜å®‰å…¨é—®é¢˜ã€‚</p>
<h3 id="Send-çš„ç‰¹ç‚¹"><a href="#Send-çš„ç‰¹ç‚¹" class="headerlink" title="Send çš„ç‰¹ç‚¹"></a>Send çš„ç‰¹ç‚¹</h3><ul>
<li>ç§»åŠ¨çš„æ˜¯<strong>æ‰€æœ‰æƒ</strong>ï¼Œè€Œä¸æ˜¯å¼•ç”¨ã€‚</li>
<li>ç§»åŠ¨ä¹‹åï¼ŒåŸçº¿ç¨‹ä¸èƒ½å†ç”¨è¿™ä¸ªå€¼ï¼ˆæ‰€æœ‰æƒå·²ç»è¢« moveï¼‰ã€‚</li>
</ul>
<h3 id="ä¸æ˜¯-Send-çš„ç±»å‹ï¼ˆ-Sendï¼‰"><a href="#ä¸æ˜¯-Send-çš„ç±»å‹ï¼ˆ-Sendï¼‰" class="headerlink" title="ä¸æ˜¯ Send çš„ç±»å‹ï¼ˆ!Sendï¼‰"></a>ä¸æ˜¯ Send çš„ç±»å‹ï¼ˆ<code>!Send</code>ï¼‰</h3><p>ç»å¤§å¤šæ•°ç±»å‹è‡ªåŠ¨å®ç° <code>Send</code>ï¼Œä»¥ä¸‹ä¸€äº›ä¾‹å¤–ï¼š</p>
<ul>
<li>**<code>Rc&lt;T&gt;</code>**ï¼šå¼•ç”¨è®¡æ•°æ˜¯éåŸå­æ“ä½œï¼Œè·¨çº¿ç¨‹è½¬ç§»ä¼šå¯¼è‡´è®¡æ•°ç«äº‰ï¼ˆæ•°æ®ç«äº‰ï¼‰ã€‚</li>
<li>**<code>RefCell&lt;T&gt;</code> &#x2F; <code>Cell&lt;T&gt;</code>**ï¼šå†…éƒ¨å¯å˜æ€§æ— åŒæ­¥æœºåˆ¶ï¼Œè·¨çº¿ç¨‹è½¬ç§»åï¼Œå¤šä¸ªçº¿ç¨‹å¯èƒ½åŒæ—¶ä¿®æ”¹æ•°æ®ã€‚</li>
<li>**è£¸æŒ‡é’ˆ <code>*const T</code> &#x2F; <code>*mut T</code>**ï¼šæ— å®‰å…¨ä¿è¯ï¼Œç›´æ¥è·¨çº¿ç¨‹è½¬ç§»å¯èƒ½å¯¼è‡´æ‚¬å‚æŒ‡é’ˆæˆ–æ•°æ®ç«äº‰ã€‚</li>
<li>**<code>UnsafeCell&lt;T&gt;</code>**ï¼šå†…éƒ¨å¯å˜æ€§çš„åº•å±‚å®ç°ï¼Œæœ¬èº« <code>!Send</code>ï¼ˆä½†åŸºäºå®ƒçš„çº¿ç¨‹å®‰å…¨ç±»å‹å¦‚ <code>Mutex</code> ä¼šæ‰‹åŠ¨å®ç° <code>Send</code>ï¼‰ã€‚</li>
</ul>
<h3 id="Send-ç¤ºä¾‹"><a href="#Send-ç¤ºä¾‹" class="headerlink" title="Send ç¤ºä¾‹"></a>Send ç¤ºä¾‹</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    <span class="comment">// Vec&lt;i32&gt; æ˜¯ Sendï¼Œé€šè¿‡moveæŠŠæ‰€æœ‰æƒç§»åˆ°çº¿ç¨‹ä¸­</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">handle</span> = thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, v);</span><br><span class="line">    &#125;);</span><br><span class="line">    handle.<span class="title function_ invoke__">join</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-Sync-å¼•ç”¨åœ¨çº¿ç¨‹é—´çš„å…±äº«"><a href="#2-Sync-å¼•ç”¨åœ¨çº¿ç¨‹é—´çš„å…±äº«" class="headerlink" title="2. Sync - å¼•ç”¨åœ¨çº¿ç¨‹é—´çš„å…±äº«"></a>2. Sync - å¼•ç”¨åœ¨çº¿ç¨‹é—´çš„å…±äº«</h2><p>ä¸€ä¸ªç±»å‹ <code>T</code> æ˜¯ <code>Sync</code>ï¼Œè¡¨ç¤ºå¯ä»¥å®‰å…¨åœ°è¢«å¤šä¸ªçº¿ç¨‹å…±äº«ï¼ˆå³ <code>&amp;T</code> æ˜¯ <code>Send</code>ï¼‰ã€‚å³ï¼Œå¦‚æœä¸€ä¸ªç±»å‹çš„å¼•ç”¨ <code>&amp;T</code> èƒ½å®‰å…¨è·¨çº¿ç¨‹ä¼ é€’ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å‹å°±æ˜¯ <code>Sync</code>ï¼ˆå¤šä¸ªçº¿ç¨‹æŒæœ‰ <code>&amp;T</code> ä¸ä¼šå¯¼è‡´æ•°æ®ç«äº‰ï¼‰ã€‚</p>
<h3 id="ä¸æ˜¯-Sync-çš„ç±»å‹ï¼ˆ-Syncï¼‰"><a href="#ä¸æ˜¯-Sync-çš„ç±»å‹ï¼ˆ-Syncï¼‰" class="headerlink" title="ä¸æ˜¯ Sync çš„ç±»å‹ï¼ˆ!Syncï¼‰"></a>ä¸æ˜¯ Sync çš„ç±»å‹ï¼ˆ<code>!Sync</code>ï¼‰</h3><p>ä»»ä½•å…è®¸é€šè¿‡å…±äº«å¼•ç”¨ <code>&amp;T</code> è·å¾—å¯å˜è®¿é—®ä¸”æ²¡æœ‰åŒæ­¥ä¿æŠ¤çš„ç±»å‹ï¼Œéƒ½ä¸æ˜¯ <code>Sync</code>ï¼š</p>
<ul>
<li>**<code>Cell&lt;T&gt;</code> &#x2F; <code>RefCell&lt;T&gt;</code>**ï¼šå…è®¸é€šè¿‡ <code>&amp;T</code> æ”¹å˜å†…éƒ¨æ•°æ®ï¼ˆâ€å†…éƒ¨å¯å˜æ€§â€ï¼‰ï¼Œä½†ä¸ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</li>
<li>**<code>Rc&lt;T&gt;</code>**ï¼šé€šè¿‡å…±äº«å¼•ç”¨å¯ä»¥å…‹éš† <code>Rc</code> å¾—åˆ°æ›´å¤šå¼•ç”¨ï¼Œä»è€Œåœ¨å¤šçº¿ç¨‹ä¸‹å¯¼è‡´ç«äº‰ã€‚</li>
<li><strong>éçº¿ç¨‹å®‰å…¨çš„ FFI å¯¹è±¡</strong>ï¼Œå¦‚æœé€šè¿‡ <code>&amp;</code> èƒ½è°ƒç”¨ä¼šä¿®æ”¹å†…éƒ¨çŠ¶æ€çš„æ–¹æ³•ã€‚</li>
</ul>
<h3 id="Sync-ç¤ºä¾‹"><a href="#Sync-ç¤ºä¾‹" class="headerlink" title="Sync ç¤ºä¾‹"></a>Sync ç¤ºä¾‹</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::sync::&#123;Arc, Mutex&#125;;</span><br><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">data</span> = Arc::<span class="title function_ invoke__">new</span>(Mutex::<span class="title function_ invoke__">new</span>(<span class="number">5</span>)); <span class="comment">// Arc&lt;Mutex&lt;i32&gt;&gt;</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">data_clone</span> = data.<span class="title function_ invoke__">clone</span>();</span><br><span class="line"></span><br><span class="line">    thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">guard</span> = data_clone.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>(); <span class="comment">// åŠ é”ï¼Œç‹¬å è®¿é—®</span></span><br><span class="line">        *guard += <span class="number">1</span>;</span><br><span class="line">    &#125;).<span class="title function_ invoke__">join</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, data.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>()); <span class="comment">// è¾“å‡º 6</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-Auto-Trait-è‡ªåŠ¨æ¨å¯¼"><a href="#3-Auto-Trait-è‡ªåŠ¨æ¨å¯¼" class="headerlink" title="3. Auto Trait - è‡ªåŠ¨æ¨å¯¼"></a>3. Auto Trait - è‡ªåŠ¨æ¨å¯¼</h2><p><code>Send</code> å’Œ <code>Sync</code> éƒ½æ˜¯ auto traitï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®ç±»å‹çš„ç»„æˆéƒ¨åˆ†è‡ªåŠ¨æ¨å¯¼å®ç°ã€‚</p>
<h3 id="Send-å’Œ-Sync-çš„å››ç§ç»„åˆ"><a href="#Send-å’Œ-Sync-çš„å››ç§ç»„åˆ" class="headerlink" title="Send å’Œ Sync çš„å››ç§ç»„åˆ"></a>Send å’Œ Sync çš„å››ç§ç»„åˆ</h3><table>
<thead>
<tr>
<th>ç»„åˆ</th>
<th>è¯´æ˜</th>
<th>ä¾‹å­</th>
</tr>
</thead>
<tbody><tr>
<td><code>Send + Sync</code></td>
<td>å¯ä»¥åœ¨çº¿ç¨‹é—´ç§»åŠ¨ï¼Œä¹Ÿå¯ä»¥å¤šçº¿ç¨‹å…±äº«å¼•ç”¨</td>
<td><code>i32</code>ã€<code>Mutex&lt;T&gt;</code>ç­‰</td>
</tr>
<tr>
<td><code>Send + !Sync</code></td>
<td>å¯ä»¥åœ¨çº¿ç¨‹é—´ç§»åŠ¨ï¼Œä½†ä¸èƒ½å¤šçº¿ç¨‹å…±äº«å¼•ç”¨</td>
<td>ä¸€äº› <code>*mut T</code> å°è£…ã€<code>Sender&lt;T&gt;</code></td>
</tr>
<tr>
<td><code>!Send + Sync</code></td>
<td>ä¸èƒ½è·¨çº¿ç¨‹ç§»åŠ¨ï¼›ä¸ç§»åŠ¨ï¼Œåªè¯»å…±äº«æ˜¯å®‰å…¨çš„</td>
<td>å°‘æ•°ç‰¹æ®Š FFI å¯¹è±¡ï¼ˆè¾ƒå°‘è§ï¼‰</td>
</tr>
<tr>
<td><code>!Send + !Sync</code></td>
<td>æ—¢ä¸èƒ½è·¨çº¿ç¨‹ç§»åŠ¨ï¼Œä¹Ÿä¸èƒ½å¤šçº¿ç¨‹å…±äº«å¼•ç”¨</td>
<td><code>Rc&lt;RefCell&lt;T&gt;&gt;</code> ç­‰</td>
</tr>
</tbody></table>
<h2 id="4-æ‰‹åŠ¨å®ç°-Send-å’Œ-Sync"><a href="#4-æ‰‹åŠ¨å®ç°-Send-å’Œ-Sync" class="headerlink" title="4. æ‰‹åŠ¨å®ç° Send å’Œ Sync"></a>4. æ‰‹åŠ¨å®ç° Send å’Œ Sync</h2><p>åªæœ‰åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ï¼ˆå†™åº•å±‚åº“ &#x2F; FFI å°è£… &#x2F; è‡ªå·±çš„é”å’ŒåŸå­æ•°æ®ç»“æ„æ—¶ï¼‰æ‰ä¼šéœ€è¦æ‰‹åŠ¨å®ç° <code>Send</code> å’Œ <code>Sync</code>ï¼š</p>
<ul>
<li><code>unsafe impl Send</code> &#x2F; <code>unsafe impl Sync</code> æ˜¯éå¸¸ä¸¥è‚ƒçš„æ‰¿è¯º</li>
<li>è¦è‡ªå·±ä¿è¯æ‰€æœ‰å¯èƒ½çš„å¹¶å‘è®¿é—®è·¯å¾„éƒ½ä¸ä¼šäº§ç”Ÿæ•°æ®ç«äº‰ã€æ‚¬å‚æŒ‡é’ˆç­‰ã€‚</li>
</ul>
<h3 id="æ‰‹åŠ¨å®ç°ç¤ºä¾‹ï¼šç”¨-Mutex-ä¿æŠ¤è£¸æŒ‡é’ˆ"><a href="#æ‰‹åŠ¨å®ç°ç¤ºä¾‹ï¼šç”¨-Mutex-ä¿æŠ¤è£¸æŒ‡é’ˆ" class="headerlink" title="æ‰‹åŠ¨å®ç°ç¤ºä¾‹ï¼šç”¨ Mutex ä¿æŠ¤è£¸æŒ‡é’ˆ"></a>æ‰‹åŠ¨å®ç°ç¤ºä¾‹ï¼šç”¨ Mutex ä¿æŠ¤è£¸æŒ‡é’ˆ</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::sync::Mutex;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰ç±»å‹ï¼šç”¨ Mutex ä¿æŠ¤è£¸æŒ‡é’ˆï¼ˆè£¸æŒ‡é’ˆæœ¬èº« !Send/!Syncï¼‰</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SafePtr</span>&lt;T&gt;(Mutex&lt;*<span class="keyword">mut</span> T&gt;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; SafePtr&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(value: T) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">ptr</span> = <span class="type">Box</span>::<span class="title function_ invoke__">into_raw</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(value)); <span class="comment">// è£¸æŒ‡é’ˆæŒ‡å‘å †å†…å­˜</span></span><br><span class="line">        <span class="title function_ invoke__">SafePtr</span>(Mutex::<span class="title function_ invoke__">new</span>(ptr))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®‰å…¨è®¿é—®ï¼šé€šè¿‡ Mutex åŠ é”ï¼Œä¿è¯ç‹¬å è®¿é—®</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;&amp;T&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">guard</span> = <span class="keyword">self</span>.<span class="number">0</span>.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        <span class="keyword">unsafe</span> &#123; <span class="title function_ invoke__">Some</span>(&amp;**guard) &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set</span>(&amp;<span class="keyword">self</span>, new_value: T) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">guard</span> = <span class="keyword">self</span>.<span class="number">0</span>.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        <span class="keyword">unsafe</span> &#123;</span><br><span class="line">            std::ptr::<span class="title function_ invoke__">drop_in_place</span>(*guard);</span><br><span class="line">            *guard = <span class="type">Box</span>::<span class="title function_ invoke__">into_raw</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(new_value));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰‹åŠ¨å®ç° Send å’Œ Syncï¼Œå› ä¸ºæˆ‘ä»¬é€šè¿‡ Mutex ç¡®ä¿äº†çº¿ç¨‹å®‰å…¨</span></span><br><span class="line"><span class="keyword">unsafe</span> <span class="keyword">impl</span>&lt;T: <span class="built_in">Send</span>&gt; <span class="built_in">Send</span> <span class="keyword">for</span> <span class="title class_">SafePtr</span>&lt;T&gt; &#123;&#125;</span><br><span class="line"><span class="keyword">unsafe</span> <span class="keyword">impl</span>&lt;T: <span class="built_in">Send</span>&gt; <span class="built_in">Sync</span> <span class="keyword">for</span> <span class="title class_">SafePtr</span>&lt;T&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li><strong><code>Send</code></strong> ä¿è¯æ‰€æœ‰æƒå¯ä»¥å®‰å…¨åœ°åœ¨çº¿ç¨‹é—´è½¬ç§»</li>
<li><strong><code>Sync</code></strong> ä¿è¯å¼•ç”¨å¯ä»¥å®‰å…¨åœ°åœ¨å¤šä¸ªçº¿ç¨‹é—´å…±äº«</li>
<li>å¤§å¤šæ•°ç±»å‹ä¼šè‡ªåŠ¨å®ç°è¿™äº› trait</li>
<li>åªæœ‰åœ¨å¤„ç†ç‰¹æ®Šæƒ…å†µï¼ˆè£¸æŒ‡é’ˆã€FFIã€è‡ªå®šä¹‰åŒæ­¥åŸè¯­ï¼‰æ—¶æ‰éœ€è¦æ‰‹åŠ¨å®ç°</li>
<li>æ‰‹åŠ¨å®ç° <code>unsafe impl Send/Sync</code> æ—¶è¦ç‰¹åˆ«è°¨æ…ï¼Œç¡®ä¿ç¡®å®æ»¡è¶³å¹¶å‘å®‰å…¨æ¡ä»¶</li>
</ul>
]]></content>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustä¸­çš„Enumä¸Structè¯¦è§£</title>
    <url>/2024/02/13/Rust%E4%B8%AD%E7%9A%84Enum%E4%B8%8EStruct%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<p>åœ¨ Rust ä¸­ï¼Œ<code>struct</code>ï¼ˆç»“æ„ä½“ï¼‰å’Œ <code>enum</code>ï¼ˆæšä¸¾ï¼‰æ˜¯ä¸¤ç§æ ¸å¿ƒçš„è‡ªå®šä¹‰ç±»å‹ï¼Œåˆ†åˆ«ç”¨äº<strong>ç»„åˆç›¸å…³æ•°æ®</strong>å’Œ<strong>è¡¨ç¤ºäº’æ–¥çš„å¯èƒ½æ€§</strong>ã€‚</p>
<span id="more"></span>

<h2 id="ç»“æ„ä½“ï¼ˆstructï¼‰"><a href="#ç»“æ„ä½“ï¼ˆstructï¼‰" class="headerlink" title="ç»“æ„ä½“ï¼ˆstructï¼‰"></a>ç»“æ„ä½“ï¼ˆstructï¼‰</h2><p><code>struct</code> ç”¨äºå°†å¤šä¸ªç›¸å…³çš„å€¼ç»„åˆåœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªæœ‰æ„ä¹‰çš„ç»„ã€‚</p>
<h3 id="å…·åç»“æ„ä½“ï¼ˆnamed-structï¼‰"><a href="#å…·åç»“æ„ä½“ï¼ˆnamed-structï¼‰" class="headerlink" title="å…·åç»“æ„ä½“ï¼ˆnamed structï¼‰"></a>å…·åç»“æ„ä½“ï¼ˆnamed structï¼‰</h3><p>æœ€å¸¸ç”¨çš„ç»“æ„ä½“å½¢å¼ï¼Œå­—æ®µæœ‰æ˜ç¡®çš„åç§°ï¼Œå¯è¯»æ€§å¼ºï¼Œé€‚åˆæ•°æ®å«ä¹‰æ˜ç¡®çš„åœºæ™¯ã€‚</p>
<ul>
<li>å­—æ®µé»˜è®¤ç§æœ‰ï¼ˆä»…å½“å‰æ¨¡å—å†…å¯è§ï¼‰</li>
<li>é€šè¿‡ <code>impl</code> å®ç°å…³è”å‡½æ•°ï¼ˆæ–¹æ³•ï¼‰</li>
<li>é€šè¿‡ <code>..</code> å®ç°èµ‹å€¼ï¼ˆæ‰€æœ‰æœªæŒ‡å®šçš„å­—æ®µï¼Œå…¨éƒ¨æ›¿æ¢ä¸º <code>..</code> å¯¹åº”å˜é‡ä¸­çš„ï¼‰ï¼›è‹¥å­—æ®µä¸ºç§»åŠ¨è¯­ä¹‰ï¼Œæ‰€æœ‰æƒè¢«ç§»èµ°</li>
<li>é€šè¿‡ <code>trait</code> å®ç°å¤šæ€</li>
</ul>
<h4 id="åŸºæœ¬ç¤ºä¾‹"><a href="#åŸºæœ¬ç¤ºä¾‹" class="headerlink" title="åŸºæœ¬ç¤ºä¾‹"></a>åŸºæœ¬ç¤ºä¾‹</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> name: <span class="type">String</span>,</span><br><span class="line">    age: <span class="type">u8</span>,</span><br><span class="line">    active: <span class="type">bool</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">fmt</span>::Display <span class="keyword">for</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> fmt::Formatter&lt;<span class="symbol">&#x27;_</span>&gt;) <span class="punctuation">-&gt;</span> fmt::<span class="type">Result</span> &#123;</span><br><span class="line">        <span class="built_in">write!</span>(f, <span class="string">&quot;Person &#123;&#123; name: &#123;&#125;, age: &#123;&#125;, active: &#123;&#125; &#125;&#125;&quot;</span>, </span><br><span class="line">            <span class="keyword">self</span>.name, <span class="keyword">self</span>.age, <span class="keyword">self</span>.active)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">alice</span> = Person &#123; </span><br><span class="line">        name: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Alice&quot;</span>), </span><br><span class="line">        age: <span class="number">30</span>, </span><br><span class="line">        active: <span class="literal">true</span> </span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">mike</span> = Person &#123; </span><br><span class="line">        name: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Mike&quot;</span>), </span><br><span class="line">        ..alice </span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;person: &#123;&#125;&quot;</span>, mike);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è§£æ„ä¸ ..</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">Person</span> &#123; name, .. &#125; = mike;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;name: &#123;&#125;&quot;</span>, name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å¯è§æ€§"><a href="#å¯è§æ€§" class="headerlink" title="å¯è§æ€§"></a>å¯è§æ€§</h4><p>é»˜è®¤ä¸ºç§æœ‰ï¼Œå¯é€šè¿‡ <code>pub</code> ä¿®é¥°ç¬¦ä¿®æ”¹ï¼š</p>
<table>
<thead>
<tr>
<th>ä¿®é¥°ç¬¦</th>
<th>ä½œç”¨åŸŸ</th>
<th>å…¸å‹åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td><code>pub</code></td>
<td>å…¨å±€å¯è§ï¼ˆè·¨ crateï¼‰</td>
<td>å®Œå…¨å…¬å¼€</td>
</tr>
<tr>
<td><code>pub(crate)</code></td>
<td>æ•´ä¸ªå½“å‰ crate å†…å¯è§</td>
<td>åº“å†…éƒ¨å…±äº«</td>
</tr>
<tr>
<td><code>pub(super)</code></td>
<td>çˆ¶æ¨¡å—å¯è§</td>
<td>å­æ¨¡å—è¾…åŠ©å‡½æ•°</td>
</tr>
<tr>
<td><code>pub(in path)</code></td>
<td>æŒ‡å®šæ¨¡å—è·¯å¾„å†…å¯è§</td>
<td>æœ€çµæ´»çš„æ§åˆ¶</td>
</tr>
<tr>
<td>ï¼ˆæ— ä¿®é¥°ï¼‰</td>
<td>å½“å‰æ¨¡å—ç§æœ‰</td>
<td>é»˜è®¤ç§æœ‰</td>
</tr>
</tbody></table>
<h4 id="Traitï¼ˆç»§æ‰¿-x2F-å¤šæ€ï¼‰"><a href="#Traitï¼ˆç»§æ‰¿-x2F-å¤šæ€ï¼‰" class="headerlink" title="Traitï¼ˆç»§æ‰¿&#x2F;å¤šæ€ï¼‰"></a>Traitï¼ˆç»§æ‰¿&#x2F;å¤šæ€ï¼‰</h4><p>Rust æ²¡æœ‰ä¼ ç»Ÿ OOP çš„ç±»ç»§æ‰¿ï¼ˆæ²¡æœ‰åŸºç±»&#x2F;å­ç±»ï¼‰ã€‚ç”¨ <code>trait</code> + <code>impl</code> æ¥å®ç°æ¥å£&#x2F;å¤šæ€ã€‚</p>
<p>Trait å®šä¹‰æ–¹æ³•ç­¾åé›†åˆï¼Œå®ç° trait çš„ç±»å¿…é¡»æä¾›æ‰€æœ‰å¯¹åº”æ–¹æ³•ï¼š</p>
<ul>
<li><strong>é™æ€åˆ†å‘</strong>ï¼ˆ<code>T: Trait</code>ï¼‰åœ¨ç¼–è¯‘æœŸç¡®å®šå…·ä½“ç±»å‹ï¼ˆå•æ€åŒ–ï¼Œæ€§èƒ½å¥½ï¼‰ã€‚</li>
<li><strong>åŠ¨æ€åˆ†å‘</strong>ï¼ˆ<code>&amp;dyn Trait</code> æˆ– <code>Box&lt;dyn Trait&gt;</code>ï¼‰é€šè¿‡è™šå‡½æ•°è¡¨ (vtable)ï¼Œåœ¨è¿è¡Œæ—¶åˆ†å‘ï¼ˆé€‚åˆå¼‚æ„é›†åˆ&#x2F;æ’ä»¶å¼æ¶æ„ï¼‰ã€‚</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">trait</span> <span class="title class_">Drawable</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">draw</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Circle</span> &#123; </span><br><span class="line">    radius: <span class="type">f64</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Square</span> &#123; </span><br><span class="line">    side: <span class="type">f64</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Drawable</span> <span class="keyword">for</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">draw</span>(&amp;<span class="keyword">self</span>) &#123; </span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;circle r=&#123;&#125;&quot;</span>, <span class="keyword">self</span>.radius); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Drawable</span> <span class="keyword">for</span> <span class="title class_">Square</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">draw</span>(&amp;<span class="keyword">self</span>) &#123; </span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;square s=&#123;&#125;&quot;</span>, <span class="keyword">self</span>.side); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é™æ€åˆ†å‘ï¼ˆæ³›å‹ï¼‰</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">draw_all</span>&lt;T: Drawable&gt;(items: &amp;[T]) &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">item</span> <span class="keyword">in</span> items &#123;</span><br><span class="line">        item.<span class="title function_ invoke__">draw</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ¨æ€åˆ†å‘ï¼ˆè™šå‡½æ•°è¡¨ï¼‰</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">draw_dyn</span>(items: &amp;[<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Drawable&gt;]) &#123;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">item</span> <span class="keyword">in</span> items &#123;</span><br><span class="line">        item.<span class="title function_ invoke__">draw</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ³›å‹ä¸ç”Ÿå‘½å‘¨æœŸ"><a href="#æ³›å‹ä¸ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="æ³›å‹ä¸ç”Ÿå‘½å‘¨æœŸ"></a>æ³›å‹ä¸ç”Ÿå‘½å‘¨æœŸ</h4><p>ç»“æ„ä½“å¯ä»¥æ˜¯æ³›å‹çš„ï¼Œä¹Ÿå¯ä»¥å¸¦ç”Ÿå‘½å‘¨æœŸå‚æ•°ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Holder</span>&lt;<span class="symbol">&#x27;a</span>, T&gt; &#123; </span><br><span class="line">    r: &amp;<span class="symbol">&#x27;a</span> T, </span><br><span class="line">    val: T </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Pair</span>&lt;T, U&gt;(T, U);</span><br></pre></td></tr></table></figure>

<p>æ³›å‹è¯´æ˜ï¼š</p>
<table>
<thead>
<tr>
<th>è¯­æ³•</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>struct Point&lt;T&gt;</code></td>
<td>å®šä¹‰æ³›å‹ç»“æ„ä½“</td>
</tr>
<tr>
<td><code>impl&lt;T&gt; Point&lt;T&gt;</code></td>
<td>ä¸ºæ‰€æœ‰ç±»å‹å®ç°æ–¹æ³•</td>
</tr>
<tr>
<td><code>impl Point&lt;i32&gt;</code></td>
<td>ä¸ºç‰¹å®šç±»å‹å®ç°æ–¹æ³•</td>
</tr>
<tr>
<td><code>T: Display</code></td>
<td>æ³›å‹çº¦æŸï¼Œè¦æ±‚ç±»å‹å®ç° Display trait</td>
</tr>
<tr>
<td><code>where T: Clone, U: Debug</code></td>
<td>æ³›å‹çº¦æŸï¼Œæ›´æ¸…æ™°çš„çº¦æŸè¯­æ³•</td>
</tr>
</tbody></table>
<h3 id="å…ƒç»„ç»“æ„ä½“ï¼ˆtuple-structï¼‰"><a href="#å…ƒç»„ç»“æ„ä½“ï¼ˆtuple-structï¼‰" class="headerlink" title="å…ƒç»„ç»“æ„ä½“ï¼ˆtuple structï¼‰"></a>å…ƒç»„ç»“æ„ä½“ï¼ˆtuple structï¼‰</h3><p>å­—æ®µæ²¡æœ‰åç§°ï¼Œä»…é€šè¿‡ä½ç½®åŒºåˆ†ï¼Œé€‚åˆæ•°æ®ç»“æ„ç®€å•ã€å­—æ®µå«ä¹‰å¯é€šè¿‡ä½ç½®æ¨æ–­çš„åœºæ™¯ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å…ƒç»„ç»“æ„ä½“ï¼šé€šè¿‡ä½ç½®åŒºåˆ†ï¼ˆx, yï¼‰</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>(<span class="type">i32</span>, <span class="type">i32</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºå®ä¾‹</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">p1</span> = <span class="title function_ invoke__">Point</span>(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¿é—®å­—æ®µï¼ˆé€šè¿‡ç´¢å¼•ï¼‰</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;xåæ ‡ï¼š&#123;&#125;&quot;</span>, p1.<span class="number">0</span>); <span class="comment">// è¾“å‡ºï¼šxåæ ‡ï¼š3</span></span><br></pre></td></tr></table></figure>

<h3 id="å•å…ƒç»“æ„ä½“ï¼ˆunit-structï¼‰"><a href="#å•å…ƒç»“æ„ä½“ï¼ˆunit-structï¼‰" class="headerlink" title="å•å…ƒç»“æ„ä½“ï¼ˆunit structï¼‰"></a>å•å…ƒç»“æ„ä½“ï¼ˆunit structï¼‰</h3><p>ä¸€ç§ä¸åŒ…å«ä»»ä½•å­—æ®µçš„ç»“æ„ä½“ã€‚å®ƒçš„å®šä¹‰å½¢å¼ç±»ä¼¼äºä¸€ä¸ªâ€ç©ºâ€çš„ç»“æ„ä½“ï¼š</p>
<ul>
<li>åœ¨å†…å­˜ä¸­ä¸å ç”¨ä»»ä½•ç©ºé—´ï¼ˆ<code>size_of::&lt;UnitStruct&gt;() == 0</code>ï¼‰</li>
<li>ä¸»è¦ç”¨äºæ ‡è®°ç±»å‹ï¼ˆè¡¨ç¤ºâ€å­˜åœ¨æ€§â€è€Œéâ€æ•°æ®â€ï¼‰</li>
</ul>
<h4 id="çŠ¶æ€æ ‡è®°ç¤ºä¾‹"><a href="#çŠ¶æ€æ ‡è®°ç¤ºä¾‹" class="headerlink" title="çŠ¶æ€æ ‡è®°ç¤ºä¾‹"></a>çŠ¶æ€æ ‡è®°ç¤ºä¾‹</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰çŠ¶æ€</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Locked</span>;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Unlocked</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é—¨çš„ç»“æ„ï¼Œä½¿ç”¨æ³›å‹å‚æ•°è¡¨ç¤ºçŠ¶æ€</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Door</span>&lt;TState&gt; &#123;</span><br><span class="line">    id: <span class="type">u32</span>,</span><br><span class="line">    _state: std::marker::PhantomData&lt;TState&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åªæœ‰ Locked çŠ¶æ€æ‰èƒ½è§£é”</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Door</span>&lt;Locked&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">unlock</span>(<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> Door&lt;Unlocked&gt; &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;é—¨ &#123;&#125; å·²è§£é”&quot;</span>, <span class="keyword">self</span>.id);</span><br><span class="line">        Door &#123;</span><br><span class="line">            id: <span class="keyword">self</span>.id,</span><br><span class="line">            _state: std::marker::PhantomData,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åªæœ‰ Unlocked çŠ¶æ€æ‰èƒ½æ‰“å¼€</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Door</span>&lt;Unlocked&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">open</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;é—¨ &#123;&#125; å·²æ‰“å¼€&quot;</span>, <span class="keyword">self</span>.id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–è¯‘å™¨ä¿è¯æ“ä½œé¡ºåºï¼šå¿…é¡»å…ˆè§£é”å†æ‰“å¼€</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">door</span> = Door::&lt;Locked&gt; &#123;</span><br><span class="line">    id: <span class="number">1</span>,</span><br><span class="line">    _state: std::marker::PhantomData,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">unlocked_door</span> = door.<span class="title function_ invoke__">unlock</span>();</span><br><span class="line">unlocked_door.<span class="title function_ invoke__">open</span>();</span><br></pre></td></tr></table></figure>

<h2 id="æšä¸¾ï¼ˆenumï¼‰"><a href="#æšä¸¾ï¼ˆenumï¼‰" class="headerlink" title="æšä¸¾ï¼ˆenumï¼‰"></a>æšä¸¾ï¼ˆenumï¼‰</h2><p>æšä¸¾çš„æ ¸å¿ƒä½œç”¨æ˜¯å®šä¹‰ä¸€ä¸ªç±»å‹ï¼Œå…¶å€¼æ˜¯æœ‰é™çš„ã€äº’æ–¥çš„å‡ ç§å¯èƒ½å˜ä½“ï¼ˆvariantsï¼‰ä¹‹ä¸€ã€‚æ¯ä¸ªå˜ä½“å¯ä»¥å…³è”ä¸åŒç±»å‹å’Œæ•°é‡çš„æ•°æ®ã€‚</p>
<p>æšä¸¾é€šè¿‡ <code>enum</code> å…³é”®å­—å®šä¹‰ï¼Œæ¯ä¸ªå˜ä½“å¯ä»¥æ˜¯â€ç©ºâ€çš„ï¼Œä¹Ÿå¯ä»¥æºå¸¦æ•°æ®ï¼ˆç±»ä¼¼å…ƒç»„æˆ–ç»“æ„ä½“ï¼‰ã€‚</p>
<h3 id="åŸºæœ¬å®šä¹‰"><a href="#åŸºæœ¬å®šä¹‰" class="headerlink" title="åŸºæœ¬å®šä¹‰"></a>åŸºæœ¬å®šä¹‰</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰æšä¸¾ï¼šæ¶ˆæ¯ç±»å‹</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    Quit,                          <span class="comment">// æ— æ•°æ®ï¼šé€€å‡ºæ¶ˆæ¯</span></span><br><span class="line">    Move &#123; x: <span class="type">i32</span>, y: <span class="type">i32</span> &#125;,       <span class="comment">// å…·åæ•°æ®ï¼šç§»åŠ¨åˆ° (x, y)</span></span><br><span class="line">    <span class="title function_ invoke__">Write</span>(<span class="type">String</span>),                 <span class="comment">// å…ƒç»„æ•°æ®ï¼šå†™å…¥æ–‡æœ¬</span></span><br><span class="line">    <span class="title function_ invoke__">ChangeColor</span>(<span class="type">i32</span>, <span class="type">i32</span>, <span class="type">i32</span>),    <span class="comment">// å…ƒç»„æ•°æ®ï¼šä¿®æ”¹é¢œè‰²ï¼ˆRGBï¼‰</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºæšä¸¾å®ä¾‹</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">msg1</span> = Message::Quit;                    <span class="comment">// é€€å‡ºæ¶ˆæ¯</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">msg2</span> = Message::Move &#123; x: <span class="number">10</span>, y: <span class="number">20</span> &#125;;   <span class="comment">// ç§»åŠ¨åˆ° (10, 20)</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">msg3</span> = Message::<span class="title function_ invoke__">Write</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>));  <span class="comment">// å†™å…¥æ–‡æœ¬</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">msg4</span> = Message::<span class="title function_ invoke__">ChangeColor</span>(<span class="number">255</span>, <span class="number">128</span>, <span class="number">0</span>);     <span class="comment">// ä¿®æ”¹é¢œè‰²</span></span><br></pre></td></tr></table></figure>

<h3 id="æ¨¡å¼åŒ¹é…"><a href="#æ¨¡å¼åŒ¹é…" class="headerlink" title="æ¨¡å¼åŒ¹é…"></a>æ¨¡å¼åŒ¹é…</h3><p>æšä¸¾çš„æ ¸å¿ƒç”¨æ³•æ˜¯é€šè¿‡ <code>match</code> è¡¨è¾¾å¼åŒ¹é…å…¶å˜ä½“ï¼Œä»è€Œå¤„ç†ä¸åŒæƒ…å†µï¼ˆç±»ä¼¼â€å¤šåˆ†æ”¯æ¡ä»¶åˆ¤æ–­â€ï¼Œä½†æ›´å®‰å…¨ï¼‰ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">process_message</span>(msg: Message) &#123;</span><br><span class="line">    <span class="keyword">match</span> msg &#123;</span><br><span class="line">        Message::Quit =&gt; <span class="built_in">println!</span>(<span class="string">&quot;æ”¶åˆ°é€€å‡ºæ¶ˆæ¯&quot;</span>),</span><br><span class="line">        Message::Move &#123; x, y &#125; =&gt; <span class="built_in">println!</span>(<span class="string">&quot;ç§»åŠ¨åˆ°åæ ‡ï¼š(&#123;&#125;, &#123;&#125;)&quot;</span>, x, y),</span><br><span class="line">        Message::<span class="title function_ invoke__">Write</span>(text) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;å†™å…¥å†…å®¹ï¼š&#123;&#125;&quot;</span>, text),</span><br><span class="line">        Message::<span class="title function_ invoke__">ChangeColor</span>(r, g, b) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;ä¿®æ”¹é¢œè‰²ä¸º RGB(&#123;&#125;, &#123;&#125;, &#123;&#125;)&quot;</span>, r, g, b),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">process_message</span>(msg1); <span class="comment">// è¾“å‡ºï¼šæ”¶åˆ°é€€å‡ºæ¶ˆæ¯</span></span><br><span class="line"><span class="title function_ invoke__">process_message</span>(msg2); <span class="comment">// è¾“å‡ºï¼šç§»åŠ¨åˆ°åæ ‡ï¼š(10, 20)</span></span><br><span class="line"><span class="title function_ invoke__">process_message</span>(msg3); <span class="comment">// è¾“å‡ºï¼šå†™å…¥å†…å®¹ï¼šhello</span></span><br></pre></td></tr></table></figure>

<h3 id="å¸¸è§æšä¸¾"><a href="#å¸¸è§æšä¸¾" class="headerlink" title="å¸¸è§æšä¸¾"></a>å¸¸è§æšä¸¾</h3><h4 id="Option-lt-T-gt-è¡¨ç¤ºå¯é€‰å€¼"><a href="#Option-lt-T-gt-è¡¨ç¤ºå¯é€‰å€¼" class="headerlink" title="Option&lt;T&gt; - è¡¨ç¤ºå¯é€‰å€¼"></a><code>Option&lt;T&gt;</code> - è¡¨ç¤ºå¯é€‰å€¼</h4><p><code>Option&lt;T&gt;</code> æ˜¯ Rust ä¸­ç”¨äºè¡¨ç¤ºâ€æœ‰å€¼â€æˆ–â€æ— å€¼â€çš„æšä¸¾ï¼Œå½»åº•é¿å…äº†ç©ºæŒ‡é’ˆï¼ˆNullï¼‰é—®é¢˜ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Option</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(T),  <span class="comment">// æœ‰å€¼ï¼šå­˜å‚¨ç±»å‹ä¸º T çš„å€¼</span></span><br><span class="line">    <span class="literal">None</span>,     <span class="comment">// æ— å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Result-lt-T-E-gt-è¡¨ç¤ºæ“ä½œç»“æœ"><a href="#Result-lt-T-E-gt-è¡¨ç¤ºæ“ä½œç»“æœ" class="headerlink" title="Result&lt;T, E&gt; - è¡¨ç¤ºæ“ä½œç»“æœ"></a><code>Result&lt;T, E&gt;</code> - è¡¨ç¤ºæ“ä½œç»“æœ</h4><p><code>Result&lt;T, E&gt;</code> ç”¨äºè¡¨ç¤ºæ“ä½œâ€æˆåŠŸâ€æˆ–â€å¤±è´¥â€çš„ç»“æœï¼Œæ˜¯ Rust é”™è¯¯å¤„ç†çš„æ ¸å¿ƒç±»å‹ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Result</span>&lt;T, E&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(T),   <span class="comment">// æˆåŠŸï¼šå­˜å‚¨ç±»å‹ä¸º T çš„ç»“æœ</span></span><br><span class="line">    <span class="title function_ invoke__">Err</span>(E),  <span class="comment">// å¤±è´¥ï¼šå­˜å‚¨ç±»å‹ä¸º E çš„é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Ordering-è¡¨ç¤ºæ¯”è¾ƒç»“æœ"><a href="#Ordering-è¡¨ç¤ºæ¯”è¾ƒç»“æœ" class="headerlink" title="Ordering - è¡¨ç¤ºæ¯”è¾ƒç»“æœ"></a><code>Ordering</code> - è¡¨ç¤ºæ¯”è¾ƒç»“æœ</h4><p><code>Ordering</code> ç”¨äºè¡¨ç¤ºä¸¤ä¸ªå€¼çš„æ¯”è¾ƒç»“æœï¼ˆå°äºã€ç­‰äºã€å¤§äºï¼‰ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Ordering</span> &#123;</span><br><span class="line">    Less,    <span class="comment">// å°äº</span></span><br><span class="line">    Equal,   <span class="comment">// ç­‰äº</span></span><br><span class="line">    Greater, <span class="comment">// å¤§äº</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Struct-vs-Enum-å¯¹æ¯”"><a href="#Struct-vs-Enum-å¯¹æ¯”" class="headerlink" title="Struct vs Enum å¯¹æ¯”"></a>Struct vs Enum å¯¹æ¯”</h2><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>Struct</th>
<th>Enum</th>
</tr>
</thead>
<tbody><tr>
<td><strong>ç”¨é€”</strong></td>
<td>ç»„åˆç›¸å…³æ•°æ®ï¼ˆâ€ä¸â€å…³ç³»ï¼‰</td>
<td>è¡¨ç¤ºäº’æ–¥çš„å¯èƒ½æ€§ï¼ˆâ€æˆ–â€å…³ç³»ï¼‰</td>
</tr>
<tr>
<td><strong>å­—æ®µ</strong></td>
<td>ä¸€ä¸ªå®ä¾‹åŒ…å«æ‰€æœ‰å­—æ®µ</td>
<td>ä¸€ä¸ªå®ä¾‹åªå±äºæŸä¸ªå˜ä½“</td>
</tr>
<tr>
<td><strong>å†…å­˜</strong></td>
<td>æ‰€æœ‰å­—æ®µè¿ç»­å­˜å‚¨</td>
<td>åªå­˜å‚¨å½“å‰å˜ä½“çš„æ•°æ®</td>
</tr>
<tr>
<td><strong>åŒ¹é…</strong></td>
<td>ç›´æ¥è®¿é—®å­—æ®µ</td>
<td>å¿…é¡»é€šè¿‡æ¨¡å¼åŒ¹é…</td>
</tr>
<tr>
<td><strong>å¤šæ€</strong></td>
<td>é€šè¿‡ trait å®ç°</td>
<td>é€šè¿‡æ¨¡å¼åŒ¹é…å®ç°</td>
</tr>
<tr>
<td><strong>é€‚ç”¨åœºæ™¯</strong></td>
<td>æ•°æ®èšåˆã€æ•°æ®æ¨¡å‹</td>
<td>æœ‰é™çŠ¶æ€ã€é”™è¯¯å¤„ç†ã€å¯é€‰å€¼</td>
</tr>
</tbody></table>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li><strong>Struct</strong>ï¼šç”¨äº<strong>ç»„ç»‡ç›¸å…³æ•°æ®</strong>ï¼Œæ‰€æœ‰å­—æ®µåŒæ—¶å­˜åœ¨ï¼Œé€‚åˆè¡¨ç¤ºå¤åˆå¯¹è±¡</li>
<li><strong>Enum</strong>ï¼šç”¨äºè¡¨ç¤º<strong>å¤šä¸ªäº’æ–¥çŠ¶æ€</strong>ï¼Œä»»ä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªå˜ä½“ï¼Œé€‚åˆè¡¨ç¤ºæœ‰é™çš„å¯èƒ½æ€§</li>
<li><strong>Trait</strong>ï¼šRust çš„å¤šæ€æœºåˆ¶ï¼Œé€šè¿‡é™æ€åˆ†å‘ï¼ˆæ€§èƒ½å¥½ï¼‰å’ŒåŠ¨æ€åˆ†å‘ï¼ˆçµæ´»ï¼‰æä¾›çµæ´»çš„æŠ½è±¡</li>
<li><strong>Pattern Matching</strong>ï¼šæšä¸¾çš„å¼ºå¤§ç‰¹æ€§ï¼Œåœ¨ç¼–è¯‘æ—¶ä¿è¯æ‰€æœ‰æƒ…å†µéƒ½è¢«å¤„ç†</li>
</ul>
]]></content>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustä¸­çš„forå¾ªç¯ä¸è¿­ä»£å™¨</title>
    <url>/2024/02/10/Rust%E4%B8%AD%E7%9A%84for%E5%BE%AA%E7%8E%AF%E4%B8%8E%E8%BF%AD%E4%BB%A3%E5%99%A8/</url>
    <content><![CDATA[<p><code>for</code> å¾ªç¯æ˜¯è¿­ä»£å™¨çš„è¯­æ³•ç³–ï¼Œè€Œè¿­ä»£å™¨æ˜¯ Rust å¤„ç†é›†åˆï¼ˆå¦‚ <code>Vec</code>ã€<code>HashMap</code>ï¼‰çš„æ ¸å¿ƒæŠ½è±¡ã€‚</p>
<span id="more"></span>

<h2 id="1-for-å¾ªç¯"><a href="#1-for-å¾ªç¯" class="headerlink" title="1. for å¾ªç¯"></a>1. for å¾ªç¯</h2><h3 id="for-å¾ªç¯æœ¬è´¨"><a href="#for-å¾ªç¯æœ¬è´¨" class="headerlink" title="for å¾ªç¯æœ¬è´¨"></a>for å¾ªç¯æœ¬è´¨</h3><p><code>for</code> å¾ªç¯æœ¬è´¨æ˜¯è‡ªåŠ¨éå†ä¸€ä¸ªâ€å¯è¿­ä»£å¯¹è±¡â€ï¼ˆå®ç° <code>IntoIterator</code> trait çš„ç±»å‹ï¼‰ï¼Œåº•å±‚é€»è¾‘å¦‚ä¸‹ï¼š</p>
<ol>
<li>å¯¹ç›®æ ‡å¯¹è±¡è°ƒç”¨ <code>into_iter()</code> æ–¹æ³•ï¼Œå°†å…¶è½¬æ¢ä¸ºè¿­ä»£å™¨ï¼ˆIteratorï¼‰</li>
<li>å¾ªç¯è°ƒç”¨è¿­ä»£å™¨çš„ <code>next()</code> æ–¹æ³•ï¼Œæ¯æ¬¡è·å–ä¸€ä¸ªå…ƒç´ ï¼ˆ<code>Some(T)</code>ï¼‰</li>
<li>å½“ <code>next()</code> è¿”å› <code>None</code> æ—¶ï¼Œå¾ªç¯ç»ˆæ­¢</li>
</ol>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// for å¾ªç¯çš„åŸå§‹å½¢å¼</span></span><br><span class="line"><span class="keyword">for</span> <span class="variable">item</span> <span class="keyword">in</span> collection &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼šè½¬æ¢ä¸ºä»¥ä¸‹è¿‘ä¼¼ä»£ç </span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">iter</span> = <span class="built_in">IntoIterator</span>::<span class="title function_ invoke__">into_iter</span>(collection);</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Some</span>(item) = iter.<span class="title function_ invoke__">next</span>() &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="for-å¾ªç¯çš„ç”¨æ³•"><a href="#for-å¾ªç¯çš„ç”¨æ³•" class="headerlink" title="for å¾ªç¯çš„ç”¨æ³•"></a>for å¾ªç¯çš„ç”¨æ³•</h3><p>ä»»ä½•å®ç° <code>IntoIterator</code> çš„ç±»å‹ï¼Œéƒ½èƒ½ç›´æ¥ç”¨ <code>for</code> å¾ªç¯éå†ã€‚</p>
<h4 id="1-éå†é›†åˆ"><a href="#1-éå†é›†åˆ" class="headerlink" title="1. éå†é›†åˆ"></a>1. éå†é›†åˆ</h4><p>éœ€æ³¨æ„æ‰€æœ‰æƒä¸å€Ÿç”¨æ¨¡å¼ï¼Œä¸‰ç§æ ¸å¿ƒæ¨¡å¼ï¼š</p>
<ul>
<li><p><strong>æ‰€æœ‰æƒè½¬ç§»éå†</strong>ï¼š<code>into_iter()</code></p>
<ul>
<li>è½¬ç§»æ‰€æœ‰æƒï¼Œ<code>T</code> ç±»å‹</li>
<li><code>for x in v</code></li>
</ul>
</li>
<li><p><strong>ä¸å¯å˜å€Ÿç”¨éå†</strong>ï¼š<code>iter()</code></p>
<ul>
<li>ä¸å¯å˜å¼•ç”¨ <code>&amp;T</code>ï¼Œéœ€é€šè¿‡è§£å¼•ç”¨ï¼ˆ<code>*</code>ï¼‰è®¿é—®å…ƒç´ å€¼</li>
<li><code>for x in &amp;v</code></li>
</ul>
</li>
<li><p><strong>å¯å˜å€Ÿç”¨éå†</strong>ï¼š<code>iter_mut()</code></p>
<ul>
<li>å¯å˜å¼•ç”¨ <code>&amp;mut T</code>ï¼Œéœ€é€šè¿‡è§£å¼•ç”¨ï¼ˆ<code>*</code>ï¼‰ä¿®æ”¹å…ƒç´ </li>
<li><code>for x in &amp;mut v</code></li>
</ul>
</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. æ‰€æœ‰æƒè½¬ç§»ï¼ˆæ¶ˆè€—é›†åˆï¼‰</span></span><br><span class="line"><span class="keyword">for</span> <span class="variable">x</span> <span class="keyword">in</span> v.<span class="title function_ invoke__">into_iter</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, x); <span class="comment">// x æ˜¯ i32</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// v ä¸å†å¯ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ä¸å¯å˜å€Ÿç”¨ï¼ˆåªè¯»ï¼‰</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">for</span> <span class="variable">x</span> <span class="keyword">in</span> &amp;v &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, x); <span class="comment">// x æ˜¯ &amp;i32</span></span><br><span class="line">    <span class="comment">// éœ€è¦è§£å¼•ç”¨ï¼šprintln!(&quot;&#123;&#125;&quot;, *x);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// v ä»å¯ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. å¯å˜å€Ÿç”¨ï¼ˆä¿®æ”¹ï¼‰</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">for</span> <span class="variable">x</span> <span class="keyword">in</span> &amp;<span class="keyword">mut</span> v &#123;</span><br><span class="line">    *x += <span class="number">10</span>; <span class="comment">// ä¿®æ”¹å…ƒç´ </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, v); <span class="comment">// [11, 12, 13]</span></span><br></pre></td></tr></table></figure>

<h4 id="2-è®¡æ•°å¾ªç¯-Range-åŒºé—´éå†"><a href="#2-è®¡æ•°å¾ªç¯-Range-åŒºé—´éå†" class="headerlink" title="2. è®¡æ•°å¾ªç¯ - Range åŒºé—´éå†"></a>2. è®¡æ•°å¾ªç¯ - Range åŒºé—´éå†</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å·¦é—­å³å¼€åŒºé—´ (a..b)</span></span><br><span class="line"><span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">5</span> &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, i); <span class="comment">// è¾“å‡º 0, 1, 2, 3, 4</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å·¦é—­å³é—­åŒºé—´ (a..=b)</span></span><br><span class="line"><span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..=<span class="number">5</span> &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, i); <span class="comment">// è¾“å‡º 0, 1, 2, 3, 4, 5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åå‘è®¡æ•° - rev() åå‘è¿­ä»£</span></span><br><span class="line"><span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> (<span class="number">1</span>..=<span class="number">5</span>).<span class="title function_ invoke__">rev</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, i); <span class="comment">// è¾“å‡º 5, 4, 3, 2, 1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-é”®å€¼å¯¹éå†ï¼ˆHashMap-x2F-BTreeMapï¼‰"><a href="#3-é”®å€¼å¯¹éå†ï¼ˆHashMap-x2F-BTreeMapï¼‰" class="headerlink" title="3. é”®å€¼å¯¹éå†ï¼ˆHashMap&#x2F;BTreeMapï¼‰"></a>3. é”®å€¼å¯¹éå†ï¼ˆHashMap&#x2F;BTreeMapï¼‰</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">map</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line">map.<span class="title function_ invoke__">insert</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">map.<span class="title function_ invoke__">insert</span>(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;30&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// for (key, value) in &amp;mapï¼ˆè¿”å› key ä¸ value çš„å¼•ç”¨ï¼‰</span></span><br><span class="line"><span class="title function_ invoke__">for</span> (key, value) <span class="keyword">in</span> &amp;map &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;: &#123;&#125;&quot;</span>, key, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-éå†ç´¢å¼•ä¸å€¼"><a href="#4-éå†ç´¢å¼•ä¸å€¼" class="headerlink" title="4. éå†ç´¢å¼•ä¸å€¼"></a>4. éå†ç´¢å¼•ä¸å€¼</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">fruits</span> = <span class="built_in">vec!</span>[<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;orange&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// enumerate() é€‚é…å™¨ï¼ˆè¿”å› (index, value) å…ƒç»„ï¼‰</span></span><br><span class="line"><span class="title function_ invoke__">for</span> (idx, fruit) <span class="keyword">in</span> fruits.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">enumerate</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;. &#123;&#125;&quot;</span>, idx, fruit);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment">// 0. apple</span></span><br><span class="line"><span class="comment">// 1. banana</span></span><br><span class="line"><span class="comment">// 2. orange</span></span><br></pre></td></tr></table></figure>

<h3 id="ä¸‰ç§éå†æ¨¡å¼å¯¹æ¯”"><a href="#ä¸‰ç§éå†æ¨¡å¼å¯¹æ¯”" class="headerlink" title="ä¸‰ç§éå†æ¨¡å¼å¯¹æ¯”"></a>ä¸‰ç§éå†æ¨¡å¼å¯¹æ¯”</h3><table>
<thead>
<tr>
<th>for å¾ªç¯å½¢å¼</th>
<th>åº•å±‚è°ƒç”¨</th>
<th>å…ƒç´ ç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>for x in v</code></td>
<td><code>v.into_iter()</code></td>
<td><code>T</code>ï¼ˆåŸå€¼ï¼‰</td>
<td>æ‰€æœ‰æƒè½¬ç§»ï¼ˆæ¶ˆè€—é›†åˆï¼‰</td>
</tr>
<tr>
<td><code>for x in &amp;v</code></td>
<td><code>v.iter()</code></td>
<td><code>&amp;T</code>ï¼ˆä¸å¯å˜å¼•ç”¨ï¼‰</td>
<td>ä¸å¯å˜å€Ÿç”¨ï¼ˆåªè¯»é›†åˆï¼‰</td>
</tr>
<tr>
<td><code>for x in &amp;mut v</code></td>
<td><code>v.iter_mut()</code></td>
<td><code>&amp;mut T</code>ï¼ˆå¯å˜å¼•ç”¨ï¼‰</td>
<td>å¯å˜å€Ÿç”¨ï¼ˆä¿®æ”¹é›†åˆï¼‰</td>
</tr>
<tr>
<td><code>for i in 0..n</code></td>
<td>Range è¿­ä»£å™¨</td>
<td>å€¼æ‹·è´</td>
<td>è®¡æ•°å¾ªç¯</td>
</tr>
</tbody></table>
<h3 id="ç»‘å®šè§£æ„"><a href="#ç»‘å®šè§£æ„" class="headerlink" title="ç»‘å®šè§£æ„"></a>ç»‘å®šè§£æ„</h3><p>è¿­ä»£å™¨éå†ä¸­å…ƒç´ çš„ç±»å‹ç”± <code>Iterator</code> trait ä¸­çš„ <code>Item</code> ç¡®å®šã€‚å¯¹äºå¼•ç”¨ç±»å‹ï¼Œå¯é€šè¿‡ <code>&amp;</code>ï¼ˆä¸æ˜¯å–åœ°å€ï¼‰è¿›è¡Œè§£æ„ã€‚ä»¥ <code>iter()</code>ï¼ˆ<code>Item</code> æ˜¯ <code>&amp;T</code>ï¼‰éå†ä¸ºä¾‹ï¼š</p>
<ul>
<li>**ç”¨ <code>x</code>**ï¼šç»‘å®š <code>&amp;T</code>ï¼ˆä¿ç•™å¼•ç”¨ï¼‰ï¼Œéœ€é€šè¿‡ <code>*x</code> è§£å¼•ç”¨æ“ä½œå€¼</li>
<li>**ç”¨ <code>&amp;x</code>**ï¼šè§£æ„ä¸€å±‚å¼•ç”¨ï¼Œç›´æ¥ç»‘å®š <code>T</code>ï¼ˆåŸå€¼ï¼‰ï¼Œæ— éœ€è§£å¼•ç”¨</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">type_of</span>&lt;T&gt;(_: &amp;T) <span class="punctuation">-&gt;</span> &amp;<span class="symbol">&#x27;static</span> <span class="type">str</span> &#123;</span><br><span class="line">    std::any::type_name::&lt;T&gt;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">map</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    map.<span class="title function_ invoke__">insert</span>(<span class="string">&quot;english&quot;</span>, <span class="number">80</span>);</span><br><span class="line">    map.<span class="title function_ invoke__">insert</span>(<span class="string">&quot;math&quot;</span>, <span class="number">90</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨ &amp;(&amp;key, &amp;value) è§£æ„ä¸€å±‚å¼•ç”¨</span></span><br><span class="line">    <span class="title function_ invoke__">for</span> (&amp;key, &amp;value) <span class="keyword">in</span> &amp;map &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;: &#123;&#125; (ç±»å‹: &#123;&#125;: &#123;&#125;)&quot;</span>, </span><br><span class="line">            key, value,</span><br><span class="line">            <span class="title function_ invoke__">type_of</span>(&amp;key),      <span class="comment">// &amp;str</span></span><br><span class="line">            <span class="title function_ invoke__">type_of</span>(&amp;value)     <span class="comment">// i32</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸è§£æ„ï¼Œä¿ç•™å¼•ç”¨</span></span><br><span class="line">    <span class="title function_ invoke__">for</span> (key, value) <span class="keyword">in</span> &amp;map &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;: &#123;&#125; (ç±»å‹: &#123;&#125;: &#123;&#125;)&quot;</span>, </span><br><span class="line">            key, value,</span><br><span class="line">            <span class="title function_ invoke__">type_of</span>(&amp;key),      <span class="comment">// &amp;&amp;str</span></span><br><span class="line">            <span class="title function_ invoke__">type_of</span>(&amp;value)     <span class="comment">// &amp;i32</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-è¿­ä»£å™¨"><a href="#2-è¿­ä»£å™¨" class="headerlink" title="2. è¿­ä»£å™¨"></a>2. è¿­ä»£å™¨</h2><p>Rust çš„è¿­ä»£å™¨æ˜¯å®ç°äº† <code>Iterator</code> trait çš„å¯¹è±¡ã€‚è¿­ä»£å™¨ä¸ä»…ä»…æ˜¯ä¸€ä¸ªâ€éå†å·¥å…·â€ï¼Œè¿˜èƒ½æƒ°æ€§å¤„ç†æ•°æ®æµï¼Œå³<strong>æƒ°æ€§æ±‚å€¼ï¼ˆlazy evaluationï¼‰</strong>ã€‚</p>
<h3 id="è¿­ä»£å™¨çš„ç‰¹ç‚¹"><a href="#è¿­ä»£å™¨çš„ç‰¹ç‚¹" class="headerlink" title="è¿­ä»£å™¨çš„ç‰¹ç‚¹"></a>è¿­ä»£å™¨çš„ç‰¹ç‚¹</h3><p>å¤šæ•°æ–¹æ³•ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œåªæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„è¿­ä»£å™¨ã€‚ç›´åˆ°è°ƒç”¨ <code>.collect()</code>ã€<code>.for_each()</code> ç­‰æœ€ç»ˆæ¶ˆè´¹æ–¹æ³•æ—¶ï¼Œæ‰è®¡ç®—ã€‚</p>
<h3 id="Iterator-trait"><a href="#Iterator-trait" class="headerlink" title="Iterator trait"></a>Iterator trait</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Iterator</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Item</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="keyword">Self</span>::Item&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¶ä»–å¾ˆå¤šé»˜è®¤å®ç°çš„æ–¹æ³•ï¼ˆmap, filter, fold ç­‰ï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é€‚é…å™¨ï¼ˆAdapterï¼‰"><a href="#é€‚é…å™¨ï¼ˆAdapterï¼‰" class="headerlink" title="é€‚é…å™¨ï¼ˆAdapterï¼‰"></a>é€‚é…å™¨ï¼ˆAdapterï¼‰</h3><p>é€‚é…å™¨æ˜¯è¿”å›æ–°è¿­ä»£å™¨çš„æ–¹æ³•ï¼Œç”¨äºè½¬æ¢ã€ç­›é€‰ã€ç»„åˆåŸè¿­ä»£å™¨ã€‚å¤šä¸ªé€‚é…å™¨å¯ç»„æˆâ€é“¾å¼â€ï¼Œå³é€šè¿‡æŠŠå¤šä¸ªè¿­ä»£å™¨é€‚é…å™¨ç»„åˆåœ¨ä¸€èµ·å½¢æˆæµæ°´çº¿å¼çš„æ•°æ®å¤„ç†æµç¨‹ã€‚</p>
<h4 id="å¸¸è§é€‚é…å™¨"><a href="#å¸¸è§é€‚é…å™¨" class="headerlink" title="å¸¸è§é€‚é…å™¨"></a>å¸¸è§é€‚é…å™¨</h4><table>
<thead>
<tr>
<th>é€‚é…å™¨</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>map(f)</code></td>
<td>å¯¹å…ƒç´ åº”ç”¨ fï¼Œè½¬æ¢å…ƒç´ ç±»å‹</td>
</tr>
<tr>
<td><code>filter(f)</code></td>
<td>ä¿ç•™æ»¡è¶³æ¡ä»¶ f çš„å…ƒç´ ï¼Œè¿”å› bool</td>
</tr>
<tr>
<td><code>flat_map(f)</code></td>
<td>å¯¹å…ƒç´ åº”ç”¨ fï¼Œæ‰å¹³åŒ–ç»“æœ</td>
</tr>
<tr>
<td><code>rev()</code></td>
<td>åå‘éå†ï¼ˆéœ€è¿­ä»£å™¨å®ç° DoubleEndedIteratorï¼‰</td>
</tr>
<tr>
<td><code>skip(n)</code></td>
<td>è·³è¿‡å‰ n ä¸ªå…ƒç´ </td>
</tr>
<tr>
<td><code>take(n)</code></td>
<td>å–å‰ n ä¸ªå…ƒç´ ï¼Œä¹‹åç»ˆæ­¢è¿­ä»£</td>
</tr>
<tr>
<td><code>chain(iter2)</code></td>
<td>æ‹¼æ¥ä¸¤ä¸ªè¿­ä»£å™¨</td>
</tr>
<tr>
<td><code>enumerate()</code></td>
<td>åŒæ—¶è·å–å…ƒç´ çš„ç´¢å¼•å’Œå€¼ï¼Œè¿”å›ä¸€ä¸ªå…ƒç»„ (usize, T)</td>
</tr>
</tbody></table>
<h4 id="é€‚é…å™¨é“¾å¼å¤„ç†ç¤ºä¾‹"><a href="#é€‚é…å™¨é“¾å¼å¤„ç†ç¤ºä¾‹" class="headerlink" title="é€‚é…å™¨é“¾å¼å¤„ç†ç¤ºä¾‹"></a>é€‚é…å™¨é“¾å¼å¤„ç†ç¤ºä¾‹</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. æ‹†åˆ†å•è¯ä¸ºå­—ç¬¦ â†’ 2. ç­›é€‰å°å†™å­—æ¯ â†’ 3. è½¬æ¢ä¸ºå¤§å†™ â†’ 4. æ”¶é›†ä¸º Vec&lt;char&gt;</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">words</span> = <span class="built_in">vec!</span>[<span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;World&quot;</span>, <span class="string">&quot;Rust&quot;</span>];</span><br><span class="line"><span class="keyword">let</span> <span class="variable">uppercase_chars</span>: <span class="type">Vec</span>&lt;<span class="type">char</span>&gt; = words</span><br><span class="line">    .<span class="title function_ invoke__">iter</span>()</span><br><span class="line">    .<span class="title function_ invoke__">flat_map</span>(|s| s.<span class="title function_ invoke__">chars</span>())              <span class="comment">// æ‰å¹³åŒ–ï¼š[&#x27;H&#x27;,&#x27;e&#x27;,&#x27;l&#x27;,&#x27;l&#x27;,&#x27;o&#x27;, ...]</span></span><br><span class="line">    .<span class="title function_ invoke__">filter</span>(|&amp;c| c.<span class="title function_ invoke__">is_ascii_lowercase</span>())  <span class="comment">// ç­›é€‰å°å†™å­—æ¯</span></span><br><span class="line">    .<span class="title function_ invoke__">map</span>(|c| c.<span class="title function_ invoke__">to_ascii_uppercase</span>())      <span class="comment">// è½¬æ¢ä¸ºå¤§å†™</span></span><br><span class="line">    .<span class="title function_ invoke__">collect</span>();                           <span class="comment">// æ¶ˆè€—å‹æ–¹æ³•ï¼šè§¦å‘æƒ°æ€§æ±‚å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, uppercase_chars);</span><br><span class="line"><span class="comment">// è¾“å‡º: [&#x27;E&#x27;, &#x27;L&#x27;, &#x27;L&#x27;, &#x27;O&#x27;, &#x27;O&#x27;, &#x27;R&#x27;, &#x27;L&#x27;, &#x27;D&#x27;, &#x27;U&#x27;, &#x27;S&#x27;, &#x27;T&#x27;]</span></span><br></pre></td></tr></table></figure>

<h3 id="æ¶ˆè€—æ€§æ–¹æ³•ï¼ˆConsuming-Adapterï¼‰"><a href="#æ¶ˆè€—æ€§æ–¹æ³•ï¼ˆConsuming-Adapterï¼‰" class="headerlink" title="æ¶ˆè€—æ€§æ–¹æ³•ï¼ˆConsuming Adapterï¼‰"></a>æ¶ˆè€—æ€§æ–¹æ³•ï¼ˆConsuming Adapterï¼‰</h3><p>æ¶ˆè€—å‹æ–¹æ³•ä¼šéå†è¿­ä»£å™¨ã€æ¶ˆè€—å…ƒç´ ï¼Œå¹¶è¿”å›æœ€ç»ˆç»“æœï¼ˆè§¦å‘æƒ°æ€§æ±‚å€¼ï¼‰ã€‚</p>
<h4 id="å¸¸è§æ¶ˆè€—æ€§æ–¹æ³•"><a href="#å¸¸è§æ¶ˆè€—æ€§æ–¹æ³•" class="headerlink" title="å¸¸è§æ¶ˆè€—æ€§æ–¹æ³•"></a>å¸¸è§æ¶ˆè€—æ€§æ–¹æ³•</h4><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>collect&lt;T&gt;()</code></td>
<td>æ”¶é›†å…ƒç´ ä¸ºé›†åˆ T</td>
</tr>
<tr>
<td><code>count()</code></td>
<td>è¿”å›å…ƒç´ ä¸ªæ•°</td>
</tr>
<tr>
<td><code>fold(init, f)</code></td>
<td>æŠ˜å å…ƒç´ ï¼ˆèšåˆè®¡ç®—ï¼‰ï¼Œinit ä¸ºåˆå§‹å€¼</td>
</tr>
<tr>
<td><code>any(f)</code></td>
<td>å­˜åœ¨å…ƒç´ æ»¡è¶³ fï¼Œåˆ™è¿”å› true</td>
</tr>
<tr>
<td><code>all(f)</code></td>
<td>æ‰€æœ‰å…ƒç´ æ»¡è¶³ fï¼Œåˆ™è¿”å› true</td>
</tr>
<tr>
<td><code>find(f)</code></td>
<td>æŸ¥æ‰¾ç¬¬ä¸€ä¸ªæ»¡è¶³ f çš„å…ƒç´ ï¼Œè¿”å› Option&lt;Item&gt;</td>
</tr>
<tr>
<td><code>for_each(f)</code></td>
<td>å¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œ fï¼Œç­‰ä»·äº for å¾ªç¯</td>
</tr>
</tbody></table>
<h4 id="æ¶ˆè€—æ€§æ–¹æ³•ç¤ºä¾‹"><a href="#æ¶ˆè€—æ€§æ–¹æ³•ç¤ºä¾‹" class="headerlink" title="æ¶ˆè€—æ€§æ–¹æ³•ç¤ºä¾‹"></a>æ¶ˆè€—æ€§æ–¹æ³•ç¤ºä¾‹</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">nums</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. æ±‚ç§¯ï¼ˆfold æŠ˜å ï¼‰</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">product</span> = nums.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">fold</span>(<span class="number">1</span>, |init, &amp;x| init * x);</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;é˜¶ä¹˜ï¼š&#123;&#125;&quot;</span>, product); <span class="comment">// è¾“å‡º 120</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¶æ•°</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">first_even</span> = nums.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">find</span>(|&amp;&amp;x| x % <span class="number">2</span> == <span class="number">0</span>);</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;ç¬¬ä¸€ä¸ªå¶æ•°ï¼š&#123;:?&#125;&quot;</span>, first_even); <span class="comment">// è¾“å‡º Some(&amp;2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. åˆ¤æ–­æ˜¯å¦å­˜åœ¨å¤§äº 5 çš„å…ƒç´ </span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">has_over_five</span> = nums.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">any</span>(|&amp;x| x &gt; <span class="number">5</span>);</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;æ˜¯å¦å­˜åœ¨å¤§äº5çš„å…ƒç´ ï¼š&#123;&#125;&quot;</span>, has_over_five); <span class="comment">// è¾“å‡º false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. åˆ¤æ–­æ‰€æœ‰å…ƒç´ éƒ½å¤§äº 0</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">all_positive</span> = nums.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">all</span>(|&amp;x| x &gt; <span class="number">0</span>);</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;æ‰€æœ‰å…ƒç´ éƒ½ä¸ºæ­£æ•°ï¼š&#123;&#125;&quot;</span>, all_positive); <span class="comment">// è¾“å‡º true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. æ”¶é›†ä¸ºå‘é‡</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">doubled</span>: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; = nums.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">map</span>(|&amp;x| x * <span class="number">2</span>).<span class="title function_ invoke__">collect</span>();</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;ç¿»å€åï¼š&#123;:?&#125;&quot;</span>, doubled); <span class="comment">// è¾“å‡º [2, 4, 6, 8, 10]</span></span><br></pre></td></tr></table></figure>

<h3 id="æ— é™è¿­ä»£å™¨"><a href="#æ— é™è¿­ä»£å™¨" class="headerlink" title="æ— é™è¿­ä»£å™¨"></a>æ— é™è¿­ä»£å™¨</h3><p>æ— é™è¿­ä»£å™¨ï¼ˆå¦‚ <code>iter::repeat</code>ã€<code>iter::cycle</code>ï¼‰ï¼Œéœ€é€šè¿‡ <code>take(n)</code> ç­‰æ–¹æ³•é™åˆ¶è¿­ä»£æ¬¡æ•°ï¼Œå¦åˆ™ä¼šé™·å…¥æ­»å¾ªç¯ã€‚</p>
<h4 id="å¸¸è§æ— é™è¿­ä»£å™¨"><a href="#å¸¸è§æ— é™è¿­ä»£å™¨" class="headerlink" title="å¸¸è§æ— é™è¿­ä»£å™¨"></a>å¸¸è§æ— é™è¿­ä»£å™¨</h4><ul>
<li>**<code>iter::repeat(val)</code>**ï¼šæ— é™é‡å¤ <code>val</code></li>
<li>**<code>iter::cycle()</code>**ï¼šå¾ªç¯è¿­ä»£åŸè¿­ä»£å™¨ï¼ˆåŸè¿­ä»£å™¨éœ€æ˜¯ <code>Clone</code>ï¼‰</li>
<li>**<code>(0..).step_by(n)</code>**ï¼šæ— é™é€’å¢åºåˆ—ï¼ˆæ­¥é•¿ <code>n</code>ï¼‰</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::iter;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. æ— é™é‡å¤ï¼Œå–å‰ 3 ä¸ª</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">repeated</span>: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; = iter::<span class="title function_ invoke__">repeat</span>(<span class="number">5</span>).<span class="title function_ invoke__">take</span>(<span class="number">3</span>).<span class="title function_ invoke__">collect</span>();</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, repeated); <span class="comment">// [5, 5, 5]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. å¾ªç¯è¿­ä»£</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> <span class="variable">cycled</span>: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; = v.<span class="title function_ invoke__">iter</span>()</span><br><span class="line">    .<span class="title function_ invoke__">map</span>(|&amp;x| x)</span><br><span class="line">    .<span class="title function_ invoke__">cycle</span>()</span><br><span class="line">    .<span class="title function_ invoke__">take</span>(<span class="number">7</span>)</span><br><span class="line">    .<span class="title function_ invoke__">collect</span>();</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, cycled); <span class="comment">// [1, 2, 3, 1, 2, 3, 1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. æ— é™é€’å¢åºåˆ—</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">increasing</span>: <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; = (<span class="number">0</span>..)</span><br><span class="line">    .<span class="title function_ invoke__">step_by</span>(<span class="number">2</span>)</span><br><span class="line">    .<span class="title function_ invoke__">take</span>(<span class="number">5</span>)</span><br><span class="line">    .<span class="title function_ invoke__">collect</span>();</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;:?&#125;&quot;</span>, increasing); <span class="comment">// [0, 2, 4, 6, 8]</span></span><br></pre></td></tr></table></figure>

<h3 id="è‡ªå®šä¹‰è¿­ä»£å™¨"><a href="#è‡ªå®šä¹‰è¿­ä»£å™¨" class="headerlink" title="è‡ªå®šä¹‰è¿­ä»£å™¨"></a>è‡ªå®šä¹‰è¿­ä»£å™¨</h3><p>è¦åˆ›å»ºè‡ªå®šä¹‰è¿­ä»£å™¨ï¼Œåªéœ€å®ç° <code>Iterator</code> trait çš„ <code>next()</code> æ–¹æ³•ï¼ˆå…¶ä»–æ–¹æ³•ä¸ºé»˜è®¤å®ç°ï¼‰ã€‚</p>
<p><code>Iterator</code> trait ç»§æ‰¿äº† <code>IntoIterator</code> trait çš„é»˜è®¤å®ç°ï¼ˆ<code>IntoIterator::into_iter()</code> ä¼šç›´æ¥è¿”å›è¿­ä»£å™¨æœ¬èº«ï¼ˆ<code>Self</code>ï¼‰ï¼‰ã€‚å› æ­¤ï¼Œåªè¦ä¸€ä¸ªç±»å‹å®ç°äº† <code>Iterator::next()</code>ï¼Œå°±è‡ªåŠ¨æ”¯æŒ <code>for</code> å¾ªç¯éå†ã€‚</p>
<h4 id="è®¡æ•°è¿­ä»£å™¨ç¤ºä¾‹"><a href="#è®¡æ•°è¿­ä»£å™¨ç¤ºä¾‹" class="headerlink" title="è®¡æ•°è¿­ä»£å™¨ç¤ºä¾‹"></a>è®¡æ•°è¿­ä»£å™¨ç¤ºä¾‹</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    count: <span class="type">u32</span>,</span><br><span class="line">    upper: <span class="type">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(upper: <span class="type">u32</span>) <span class="punctuation">-&gt;</span> Counter &#123;</span><br><span class="line">        Counter &#123; count: <span class="number">0</span>, upper &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Iterator</span> <span class="keyword">for</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Item</span> = <span class="type">u32</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="keyword">Self</span>::Item&gt; &#123;</span><br><span class="line">        <span class="keyword">self</span>.count += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.count &lt;= <span class="keyword">self</span>.upper &#123;</span><br><span class="line">            <span class="title function_ invoke__">Some</span>(<span class="keyword">self</span>.count)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="literal">None</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// for å¾ªç¯è‡ªåŠ¨è°ƒç”¨ into_iter()ï¼Œè¿”å› Counter æœ¬èº«</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">num</span> <span class="keyword">in</span> Counter::<span class="title function_ invoke__">new</span>(<span class="number">5</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, num); <span class="comment">// è¾“å‡º 1, 2, 3, 4, 5</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¹Ÿå¯ä»¥ä½¿ç”¨è¿­ä»£å™¨æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">sum</span>: <span class="type">u32</span> = Counter::<span class="title function_ invoke__">new</span>(<span class="number">10</span>)</span><br><span class="line">        .<span class="title function_ invoke__">filter</span>(|x| x % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">        .<span class="title function_ invoke__">map</span>(|x| x * x)</span><br><span class="line">        .<span class="title function_ invoke__">sum</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Sum: &#123;&#125;&quot;</span>, sum); <span class="comment">// è¾“å‡º 2+4+6+...+10 çš„å¹³æ–¹å’Œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è‡ªå®šä¹‰å®¹å™¨"><a href="#è‡ªå®šä¹‰å®¹å™¨" class="headerlink" title="è‡ªå®šä¹‰å®¹å™¨"></a>è‡ªå®šä¹‰å®¹å™¨</h3><p>å®¹å™¨è¦è¢« <code>for</code> å¾ªç¯éå†ï¼Œéœ€è®©å®¹å™¨ï¼ˆæˆ–å…¶å¼•ç”¨ï¼‰å®ç° <code>IntoIterator</code> traitï¼š</p>
<ul>
<li><code>iter()</code> -&gt; è¿”å›ä¸å¯å˜å¼•ç”¨çš„è¿­ä»£å™¨</li>
<li><code>iter_mut()</code> -&gt; è¿”å›å¯å˜å¼•ç”¨çš„è¿­ä»£å™¨</li>
<li><code>into_iter()</code> -&gt; è½¬ç§»æ‰€æœ‰æƒè¿­ä»£å™¨</li>
</ul>
<h4 id="IntoIterator-å®ç°ç¤ºä¾‹"><a href="#IntoIterator-å®ç°ç¤ºä¾‹" class="headerlink" title="IntoIterator å®ç°ç¤ºä¾‹"></a>IntoIterator å®ç°ç¤ºä¾‹</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">MyContainer</span>&lt;T&gt; &#123;</span><br><span class="line">    items: <span class="type">Vec</span>&lt;T&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç° 1: for x in my_containerï¼ˆæ¶ˆè€—æ‰€æœ‰æƒï¼‰</span></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; <span class="built_in">IntoIterator</span> <span class="keyword">for</span> <span class="title class_">MyContainer</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Item</span> = T;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">IntoIter</span> = std::vec::IntoIter&lt;T&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">into_iter</span>(<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span>::IntoIter &#123;</span><br><span class="line">        <span class="keyword">self</span>.items.<span class="title function_ invoke__">into_iter</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç° 2: for x in &amp;my_containerï¼ˆä¸å¯å˜å¼•ç”¨ï¼‰</span></span><br><span class="line"><span class="keyword">impl</span>&lt;<span class="symbol">&#x27;a</span>, T&gt; <span class="built_in">IntoIterator</span> <span class="keyword">for</span> &amp;<span class="symbol">&#x27;a</span> MyContainer&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Item</span> = &amp;<span class="symbol">&#x27;a</span> T;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">IntoIter</span> = std::slice::Iter&lt;<span class="symbol">&#x27;a</span>, T&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">into_iter</span>(<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span>::IntoIter &#123;</span><br><span class="line">        <span class="keyword">self</span>.items.<span class="title function_ invoke__">iter</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç° 3: for x in &amp;mut my_containerï¼ˆå¯å˜å¼•ç”¨ï¼‰</span></span><br><span class="line"><span class="keyword">impl</span>&lt;<span class="symbol">&#x27;a</span>, T&gt; <span class="built_in">IntoIterator</span> <span class="keyword">for</span> &amp;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> MyContainer&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Item</span> = &amp;<span class="symbol">&#x27;a</span> <span class="keyword">mut</span> T;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">IntoIter</span> = std::slice::IterMut&lt;<span class="symbol">&#x27;a</span>, T&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">into_iter</span>(<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span>::IntoIter &#123;</span><br><span class="line">        <span class="keyword">self</span>.items.<span class="title function_ invoke__">iter_mut</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">container</span> = MyContainer &#123;</span><br><span class="line">        items: <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰€æœ‰æƒè½¬ç§»</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">x</span> <span class="keyword">in</span> container &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‹é¢æ— æ³•æ‰§è¡Œï¼Œå› ä¸º container å·²è¢«æ¶ˆè€—</span></span><br><span class="line">    <span class="comment">// for x in &amp;container &#123; ... &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç¯å½¢ç¼“å†²åŒºç¤ºä¾‹ï¼ˆé«˜çº§ï¼‰"><a href="#ç¯å½¢ç¼“å†²åŒºç¤ºä¾‹ï¼ˆé«˜çº§ï¼‰" class="headerlink" title="ç¯å½¢ç¼“å†²åŒºç¤ºä¾‹ï¼ˆé«˜çº§ï¼‰"></a>ç¯å½¢ç¼“å†²åŒºç¤ºä¾‹ï¼ˆé«˜çº§ï¼‰</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::mem::MaybeUninit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">RingBuffer</span>&lt;T, <span class="keyword">const</span> N: <span class="type">usize</span>&gt; &#123;</span><br><span class="line">    data: [MaybeUninit&lt;T&gt;; N],</span><br><span class="line">    head: <span class="type">usize</span>,</span><br><span class="line">    len: <span class="type">usize</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T, <span class="keyword">const</span> N: <span class="type">usize</span>&gt; RingBuffer&lt;T, N&gt; &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123;</span><br><span class="line">            data: <span class="keyword">unsafe</span> &#123; MaybeUninit::<span class="title function_ invoke__">uninit</span>().<span class="title function_ invoke__">assume_init</span>() &#125;,</span><br><span class="line">            head: <span class="number">0</span>,</span><br><span class="line">            len: <span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">push</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, value: T) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.len &lt; N &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">tail</span> = (<span class="keyword">self</span>.head + <span class="keyword">self</span>.len) % N;</span><br><span class="line">            <span class="keyword">self</span>.data[tail] = MaybeUninit::<span class="title function_ invoke__">new</span>(value);</span><br><span class="line">            <span class="keyword">self</span>.len += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">pop</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;T&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.len == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="literal">None</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">val</span> = std::mem::<span class="title function_ invoke__">replace</span>(</span><br><span class="line">                &amp;<span class="keyword">mut</span> <span class="keyword">self</span>.data[<span class="keyword">self</span>.head],</span><br><span class="line">                MaybeUninit::<span class="title function_ invoke__">uninit</span>(),</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">self</span>.head = (<span class="keyword">self</span>.head + <span class="number">1</span>) % N;</span><br><span class="line">            <span class="keyword">self</span>.len -= <span class="number">1</span>;</span><br><span class="line">            <span class="title function_ invoke__">Some</span>(<span class="keyword">unsafe</span> &#123; val.<span class="title function_ invoke__">assume_init</span>() &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸º RingBuffer å®ç°ä¸‰ç§è¿­ä»£æ–¹å¼</span></span><br><span class="line"><span class="keyword">impl</span>&lt;T, <span class="keyword">const</span> N: <span class="type">usize</span>&gt; <span class="built_in">IntoIterator</span> <span class="keyword">for</span> <span class="title class_">RingBuffer</span>&lt;T, N&gt; &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Item</span> = T;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">IntoIter</span> = RingBufferIntoIter&lt;T, N&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">into_iter</span>(<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span>::IntoIter &#123;</span><br><span class="line">        RingBufferIntoIter &#123;</span><br><span class="line">            buffer: <span class="keyword">self</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">RingBufferIntoIter</span>&lt;T, <span class="keyword">const</span> N: <span class="type">usize</span>&gt; &#123;</span><br><span class="line">    buffer: RingBuffer&lt;T, N&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T, <span class="keyword">const</span> N: <span class="type">usize</span>&gt; <span class="built_in">Iterator</span> <span class="keyword">for</span> <span class="title class_">RingBufferIntoIter</span>&lt;T, N&gt; &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Item</span> = T;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="keyword">Self</span>::Item&gt; &#123;</span><br><span class="line">        <span class="keyword">self</span>.buffer.<span class="title function_ invoke__">pop</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><h3 id="for-å¾ªç¯"><a href="#for-å¾ªç¯" class="headerlink" title="for å¾ªç¯"></a>for å¾ªç¯</h3><ul>
<li><code>for</code> å¾ªç¯æ˜¯ <code>IntoIterator</code> trait çš„è¯­æ³•ç³–</li>
<li>ä¸‰ç§æ ¸å¿ƒæ¨¡å¼ï¼šæ‰€æœ‰æƒè½¬ç§»ï¼ˆ<code>into_iter()</code>ï¼‰ã€ä¸å¯å˜å€Ÿç”¨ï¼ˆ<code>iter()</code>ï¼‰ã€å¯å˜å€Ÿç”¨ï¼ˆ<code>iter_mut()</code>ï¼‰</li>
<li>æ”¯æŒ Rangeã€é”®å€¼å¯¹ã€ç´¢å¼•+å€¼ ç­‰å¤šç§éå†æ–¹å¼</li>
</ul>
<h3 id="è¿­ä»£å™¨"><a href="#è¿­ä»£å™¨" class="headerlink" title="è¿­ä»£å™¨"></a>è¿­ä»£å™¨</h3><ul>
<li><strong>æƒ°æ€§æ±‚å€¼</strong>ï¼šé€‚é…å™¨ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œåªæœ‰æ¶ˆè€—å‹æ–¹æ³•æ‰ä¼šè§¦å‘è®¡ç®—</li>
<li><strong>é€‚é…å™¨é“¾å¼å¤„ç†</strong>ï¼šé€šè¿‡ç»„åˆå¤šä¸ªé€‚é…å™¨å®ç°å¤æ‚çš„æ•°æ®å¤„ç†æµç¨‹</li>
<li><strong>è‡ªå®šä¹‰è¿­ä»£å™¨</strong>ï¼šå®ç° <code>Iterator</code> trait çš„ <code>next()</code> æ–¹æ³•å³å¯</li>
<li><strong>è‡ªå®šä¹‰å®¹å™¨</strong>ï¼šå®ç° <code>IntoIterator</code> trait æ”¯æŒ <code>for</code> å¾ªç¯éå†</li>
<li><strong>æ— é™è¿­ä»£å™¨</strong>ï¼šéœ€è¦é€šè¿‡ <code>take()</code> ç­‰æ–¹æ³•é™åˆ¶è¿­ä»£æ¬¡æ•°</li>
</ul>
<p>è¿­ä»£å™¨æ˜¯ Rust å¤„ç†é›†åˆå’Œåºåˆ—çš„æ ¸å¿ƒå·¥å…·ï¼Œå…·æœ‰é«˜æ•ˆã€å®‰å…¨ã€è¡¨è¾¾åŠ›å¼ºçš„ç‰¹ç‚¹ã€‚</p>
]]></content>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustä¸­çš„é—­åŒ…</title>
    <url>/2023/12/10/Rust%E4%B8%AD%E7%9A%84%E9%97%AD%E5%8C%85/</url>
    <content><![CDATA[<p>Rust çš„é—­åŒ…åœ¨åŠŸèƒ½å’Œç”¨é€”ä¸Šä¸å…¶ä»–è¯­è¨€çš„ lambda ç›¸åŒï¼Œéƒ½æ˜¯åœ¨æœ¬åœ°å®šä¹‰çš„å°å‹åŒ¿åå‡½æ•°ï¼Œå¯ä»¥æ•è·å¤–éƒ¨å˜é‡ã€‚</p>
<span id="more"></span>

<h2 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h2><p>Rust é—­åŒ…çš„åŸºæœ¬å®šä¹‰å½¢å¼å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>|å‚æ•°åˆ—è¡¨|</code>ï¼šç”¨ç«–çº¿åŒ…è£¹å‚æ•°ï¼Œå¤šä¸ªå‚æ•°ç”¨é€—å·åˆ†éš”ï¼ˆå¦‚ <code>|x, y|</code>ï¼‰ã€‚</li>
<li>å‡½æ•°ä½“ï¼šå¯ä»¥æ˜¯å•ä¸ªè¡¨è¾¾å¼ï¼ˆçœç•¥ <code>&#123;&#125;</code>ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªè¯­å¥ï¼ˆéœ€ç”¨ <code>&#123;&#125;</code> åŒ…è£¹ï¼‰ã€‚</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">closure_name</span> = |å‚æ•°åˆ—è¡¨| <span class="punctuation">-&gt;</span> è¿”å›ç±»å‹ &#123;</span><br><span class="line">    è¡¨è¾¾å¼æˆ–è¯­å¥å—</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="åŸºæœ¬è¯­æ³•ç¤ºä¾‹"><a href="#åŸºæœ¬è¯­æ³•ç¤ºä¾‹" class="headerlink" title="åŸºæœ¬è¯­æ³•ç¤ºä¾‹"></a>åŸºæœ¬è¯­æ³•ç¤ºä¾‹</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ— å‚æ•°ï¼Œå•ä¸ªè¡¨è¾¾å¼ï¼ˆçœç•¥èŠ±æ‹¬å·ï¼‰</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">greet</span> = || <span class="built_in">println!</span>(<span class="string">&quot;Hello!&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">greet</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ‰å‚æ•°ï¼Œå•ä¸ªè¡¨è¾¾å¼</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">add</span> = |x, y| x + y;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">result</span> = <span class="title function_ invoke__">add</span>(<span class="number">2</span>, <span class="number">3</span>); <span class="comment">// result = 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ‰å‚æ•°ï¼Œå¤šä¸ªè¯­å¥ï¼ˆéœ€è¦èŠ±æ‹¬å·ï¼‰</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">multiply</span> = |x, y| &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Calculating: &#123;&#125; * &#123;&#125;&quot;</span>, x, y);</span><br><span class="line">    x * y</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡å®šè¿”å›ç±»å‹</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">divide</span> = |x: <span class="type">i32</span>, y: <span class="type">i32</span>| <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> y == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="number">0</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        x / y</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="ç±»å‹ä¸ç‰¹å¾"><a href="#ç±»å‹ä¸ç‰¹å¾" class="headerlink" title="ç±»å‹ä¸ç‰¹å¾"></a>ç±»å‹ä¸ç‰¹å¾</h2><p>é—­åŒ…åœ¨ Rust ä¸­æœ‰ç‹¬ç«‹çš„åŒ¿åç±»å‹ï¼Œå¹¶è‡ªåŠ¨å®ç°ä»¥ä¸‹ç‰¹å¾ä¹‹ä¸€ï¼š</p>
<table>
<thead>
<tr>
<th>ç‰¹å¾</th>
<th>æ•è·æ–¹å¼</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>Fn</code></td>
<td>ä¸å¯å˜æ•è·ç¯å¢ƒ</td>
<td>åªè¯»è®¿é—®ã€‚å¯å¤šæ¬¡è°ƒç”¨ï¼Œæ•è·çš„å˜é‡ä»å¯åœ¨å¤–éƒ¨ä½¿ç”¨</td>
</tr>
<tr>
<td><code>FnMut</code></td>
<td>å¯å˜æ•è·ç¯å¢ƒ</td>
<td>å¯ä¿®æ”¹æ•è·çš„å˜é‡ã€‚å¯å¤šæ¬¡è°ƒç”¨ï¼Œä½†æ•è·çš„å˜é‡åœ¨å¤–éƒ¨éœ€ä¸º <code>mut</code></td>
</tr>
<tr>
<td><code>FnOnce</code></td>
<td>è½¬ç§»æ•è·å˜é‡çš„æ‰€æœ‰æƒ</td>
<td>ä½¿ç”¨ <code>move</code> å…³é”®å­—ã€‚åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼ˆæ‰€æœ‰æƒè½¬ç§»åæ— æ³•å†æ¬¡ä½¿ç”¨ï¼‰</td>
</tr>
</tbody></table>
<h3 id="ç±»å‹ä¸ç‰¹å¾ç¤ºä¾‹"><a href="#ç±»å‹ä¸ç‰¹å¾ç¤ºä¾‹" class="headerlink" title="ç±»å‹ä¸ç‰¹å¾ç¤ºä¾‹"></a>ç±»å‹ä¸ç‰¹å¾ç¤ºä¾‹</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">closure_test</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">greeting</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hi&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Fnï¼ˆåªè¯»ï¼‰</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">say_hi</span> = || <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, greeting);</span><br><span class="line">    <span class="title function_ invoke__">say_hi</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;greeting: &#123;&#125;&quot;</span>, greeting);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// FnMutï¼ˆå¯å˜ï¼‰</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">num</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">add_one</span> = || num += <span class="number">1</span>;</span><br><span class="line">    <span class="title function_ invoke__">add_one</span>();</span><br><span class="line">    <span class="title function_ invoke__">add_one</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;num: &#123;&#125;&quot;</span>, num);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// FnOnceï¼ˆç§»åŠ¨ï¼‰</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Rust&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">consume</span> = <span class="keyword">move</span> || &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, s);</span><br><span class="line">        <span class="comment">// s å·²è¢«æ¶ˆè€—</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_ invoke__">consume</span>(); <span class="comment">// æ­£å¸¸</span></span><br><span class="line">    <span class="comment">// consume(); // ç¼–è¯‘é”™è¯¯ï¼šåªèƒ½è°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="move-è¯­ä¹‰"><a href="#move-è¯­ä¹‰" class="headerlink" title="move è¯­ä¹‰"></a>move è¯­ä¹‰</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé—­åŒ…ä¼šæ ¹æ®å¯¹å˜é‡çš„æ“ä½œ<strong>è‡ªåŠ¨é€‰æ‹©æ•è·æ–¹å¼</strong>ï¼ˆä¸å¯å˜å€Ÿç”¨ã€å¯å˜å€Ÿç”¨ï¼‰ï¼Œå°½é‡é¿å…æ‰€æœ‰æƒè½¬ç§»ã€‚è€Œ <code>move</code> å…³é”®å­—ä¼šå¼ºåˆ¶é—­åŒ…â€å¤ºå–â€æ•è·å˜é‡çš„æ‰€æœ‰æƒï¼ˆå¯¹äºé <code>Copy</code> ç±»å‹ï¼‰ï¼Œæˆ–å¤åˆ¶å˜é‡ï¼ˆå¯¹äº <code>Copy</code> ç±»å‹ï¼‰ã€‚</p>
<ul>
<li><strong>é <code>Copy</code> ç±»å‹</strong>ï¼ˆå¦‚ <code>String</code>ã€<code>Vec</code>ï¼‰çš„æ‰€æœ‰æƒå…·æœ‰å”¯ä¸€æ€§ï¼Œ<code>move</code> ä¼šè®©é—­åŒ…ç›´æ¥è·å–å…¶æ‰€æœ‰æƒï¼ŒåŸå˜é‡åœ¨é—­åŒ…å¤–<strong>ä¸å¯å†ä½¿ç”¨</strong>ï¼ˆæ‰€æœ‰æƒå·²è½¬ç§»ï¼‰ã€‚</li>
<li><strong><code>Copy</code> ç±»å‹</strong>åœ¨èµ‹å€¼æ—¶ä¼šè‡ªåŠ¨å¤åˆ¶ï¼Œ<code>move</code> ä¼šè®©é—­åŒ…è·å–å˜é‡çš„å‰¯æœ¬ï¼ŒåŸå˜é‡ä»å¯æ­£å¸¸ä½¿ç”¨ã€‚</li>
</ul>
<h3 id="move-ä¸é—­åŒ…-Trait"><a href="#move-ä¸é—­åŒ…-Trait" class="headerlink" title="move ä¸é—­åŒ… Trait"></a>move ä¸é—­åŒ… Trait</h3><p><code>move</code> ä»…å†³å®šé—­åŒ…å¦‚ä½•æ•è·å˜é‡ï¼ˆæ‰€æœ‰æƒè½¬ç§»ï¼‰ï¼Œä½†é—­åŒ…æœ€ç»ˆå®ç° <code>Fn</code>&#x2F;<code>FnMut</code>&#x2F;<code>FnOnce</code> ä¸­çš„å“ªä¸ª traitï¼Œå–å†³äºé—­åŒ…å¦‚ä½•ä½¿ç”¨æ•è·çš„å˜é‡ï¼ˆè€Œé <code>move</code> æœ¬èº«ï¼‰ã€‚</p>
<h4 id="move-åªè¯»ä½¿ç”¨-â†’-å®ç°-Fn"><a href="#move-åªè¯»ä½¿ç”¨-â†’-å®ç°-Fn" class="headerlink" title="move + åªè¯»ä½¿ç”¨ â†’ å®ç° Fn"></a><code>move</code> + åªè¯»ä½¿ç”¨ â†’ å®ç° <code>Fn</code></h4><p>è‹¥ <code>move</code> é—­åŒ…ä»…åªè¯»è®¿é—®æ•è·çš„å˜é‡ï¼ˆä¸ä¿®æ”¹ã€ä¸æ¶ˆè€—ï¼‰ï¼Œåˆ™å®ç° <code>Fn</code> traitï¼Œå¯å¤šæ¬¡è°ƒç”¨ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="comment">// move æ•è· s çš„æ‰€æœ‰æƒï¼Œé—­åŒ…ä»…è¯»å– s</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">closure</span> = <span class="keyword">move</span> || <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, s);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">closure</span>(); <span class="comment">// æ­£å¸¸</span></span><br><span class="line"><span class="title function_ invoke__">closure</span>(); <span class="comment">// æ­£å¸¸ï¼ˆå¯å¤šæ¬¡è°ƒç”¨ï¼Œå› æœªæ¶ˆè€— sï¼‰</span></span><br><span class="line"><span class="comment">// println!(&quot;&#123;&#125;&quot;, s); // ç¼–è¯‘é”™è¯¯ï¼šs çš„æ‰€æœ‰æƒå·²è¢«è½¬ç§»åˆ°é—­åŒ…ä¸­</span></span><br></pre></td></tr></table></figure>

<h4 id="move-ä¿®æ”¹ä½¿ç”¨-â†’-å®ç°-FnMut"><a href="#move-ä¿®æ”¹ä½¿ç”¨-â†’-å®ç°-FnMut" class="headerlink" title="move + ä¿®æ”¹ä½¿ç”¨ â†’ å®ç° FnMut"></a><code>move</code> + ä¿®æ”¹ä½¿ç”¨ â†’ å®ç° <code>FnMut</code></h4><p>è‹¥ <code>move</code> é—­åŒ…ä¿®æ”¹æ•è·çš„å˜é‡ï¼ˆä½†ä¸æ¶ˆè€—ï¼‰ï¼Œåˆ™å®ç° <code>FnMut</code> traitï¼Œé—­åŒ…è‡ªèº«éœ€ä¸º <code>mut</code>ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é Copy è¯­ä¹‰ç±»å‹ï¼Œæ‰€æœ‰æƒè¢«è½¬ç§»</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="comment">// move æ•è· v çš„æ‰€æœ‰æƒï¼Œé—­åŒ…ä¿®æ”¹ v</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">closure</span> = <span class="keyword">move</span> || v.<span class="title function_ invoke__">push</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">closure</span>(); <span class="comment">// v å˜ä¸º [1, 2, 3]</span></span><br><span class="line"><span class="title function_ invoke__">closure</span>(); <span class="comment">// v å˜ä¸º [1, 2, 3, 3]ï¼ˆå¯å¤šæ¬¡è°ƒç”¨ï¼‰</span></span><br><span class="line"><span class="comment">// println!(&quot;&#123;&#125;&quot;, v); // ç¼–è¯‘é”™è¯¯ï¼šv çš„æ‰€æœ‰æƒå·²è¢«è½¬ç§»åˆ°é—­åŒ…ä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ==========================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Copy è¯­ä¹‰ç±»å‹ï¼Œå¤åˆ¶ä¸€ä¸ªå‰¯æœ¬ï¼Œä¿®æ”¹ä¸å½±å“å¤–éƒ¨</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">num</span> = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">add_one</span> = <span class="keyword">move</span> || num += <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">add_one</span>();</span><br><span class="line"><span class="title function_ invoke__">add_one</span>();</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;num: &#123;&#125;&quot;</span>, num); <span class="comment">// è¾“å‡º 0ï¼ˆnum æœªè¢«ä¿®æ”¹ï¼‰</span></span><br></pre></td></tr></table></figure>

<h4 id="move-æ¶ˆè€—ä½¿ç”¨-â†’-å®ç°-FnOnce"><a href="#move-æ¶ˆè€—ä½¿ç”¨-â†’-å®ç°-FnOnce" class="headerlink" title="move + æ¶ˆè€—ä½¿ç”¨ â†’ å®ç° FnOnce"></a><code>move</code> + æ¶ˆè€—ä½¿ç”¨ â†’ å®ç° <code>FnOnce</code></h4><p>è‹¥ <code>move</code> é—­åŒ…æ¶ˆè€—æ•è·çš„å˜é‡ï¼ˆå¦‚è°ƒç”¨ <code>drop</code> æˆ–è½¬ç§»æ‰€æœ‰æƒç»™å…¶ä»–å¯¹è±¡ï¼‰ï¼Œåˆ™å®ç° <code>FnOnce</code> traitï¼Œåªèƒ½è°ƒç”¨ä¸€æ¬¡ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">test_fnonce</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="comment">// move æ•è· s çš„æ‰€æœ‰æƒï¼Œé—­åŒ…æ¶ˆè€— sï¼ˆè½¬ç§»ç»™ println!ï¼‰</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">closure</span> = <span class="keyword">move</span> || &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, s);</span><br><span class="line">        s <span class="comment">// è¿™é‡Œ s è¢«æ¶ˆè€—</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_ invoke__">closure</span>(); <span class="comment">// æ­£å¸¸</span></span><br><span class="line">    <span class="comment">// closure(); // ç¼–è¯‘é”™è¯¯ï¼šs å·²è¢«æ¶ˆè€—ï¼Œé—­åŒ…åªèƒ½è°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å…¸å‹ä½¿ç”¨åœºæ™¯"><a href="#å…¸å‹ä½¿ç”¨åœºæ™¯" class="headerlink" title="å…¸å‹ä½¿ç”¨åœºæ™¯"></a>å…¸å‹ä½¿ç”¨åœºæ™¯</h3><p><code>move</code> ä¸»è¦ç”¨äºè§£å†³ç”Ÿå‘½å‘¨æœŸé—®é¢˜ï¼š</p>
<ul>
<li><strong>çº¿ç¨‹é—´ä¼ é€’é—­åŒ…</strong>ï¼šçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ç‹¬ç«‹çš„ï¼Œæ— æ³•ä¿è¯å¤–éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸèƒ½è¦†ç›–çº¿ç¨‹çš„ã€‚æ­¤æ—¶ <code>move</code> å¯å°†å˜é‡æ‰€æœ‰æƒè½¬ç§»åˆ°çº¿ç¨‹å†…éƒ¨ï¼Œ<strong>é¿å…æ‚¬å‚å¼•ç”¨</strong>ã€‚</li>
<li><strong>å»¶é•¿å˜é‡ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šå½“é—­åŒ…éœ€è¦â€å¸¦èµ°â€å˜é‡å¹¶åœ¨æ›´æ™šçš„æ—¶å€™ä½¿ç”¨æ—¶ï¼Œ<code>move</code> å¯ç¡®ä¿å˜é‡çš„æ‰€æœ‰æƒéšé—­åŒ…ä¸€èµ·å­˜åœ¨ï¼Œé¿å…æå‰é”€æ¯ã€‚</li>
</ul>
<h2 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h2><p>é—­åŒ…åœ¨ç¼–è¯‘æ—¶ä¼šè¢«è½¬æ¢ä¸ºä¸€ä¸ªåŒ¿åç»“æ„ä½“ç±»å‹ï¼ˆå³ä½¿ä¸¤ä¸ªé—­åŒ…ä»£ç å®Œå…¨ç›¸åŒï¼Œä¹Ÿä¼šç”Ÿæˆä¸åŒçš„ç±»å‹ï¼‰ã€‚ç»“æ„ä½“çš„å­—æ®µä¸ºæ•è·çš„å˜é‡ï¼Œå®é™…å­—æ®µç±»å‹å–å†³äºæ•è·æ–¹å¼ï¼ˆå€Ÿç”¨ã€æ‰€æœ‰æƒï¼‰ã€‚</p>
<ul>
<li>è‹¥<strong>ä¸æ•è·ä»»ä½•å˜é‡</strong>ï¼šç»“æ„ä½“ä¸ºé›¶å¤§å°ï¼ˆZSTï¼Œæ— å­—æ®µï¼‰ï¼Œä¸å ç”¨å†…å­˜ç©ºé—´ï¼Œè°ƒç”¨æˆæœ¬æä½ï¼ˆç¼–è¯‘å™¨å¯å®Œå…¨ä¼˜åŒ–æ‰ï¼‰ã€‚</li>
<li>è‹¥<strong>æ•è·å¤šä¸ªå˜é‡</strong>ï¼šç»“æ„ä½“å­—æ®µæŒ‰å£°æ˜é¡ºåºè¿ç»­å­˜å‚¨ï¼ˆç±»ä¼¼æ™®é€šç»“æ„ä½“ï¼‰ã€‚<ul>
<li>æ•è·å¼•ç”¨æ—¶ï¼šç»“æ„ä½“ä¸­ä»…å­˜å‚¨å˜é‡çš„å¼•ç”¨ï¼›</li>
<li>æ•è·æ‰€æœ‰æƒæ—¶ï¼šç»“æ„ä½“å­˜å‚¨è¢«æ•è·å˜é‡çš„å®é™…å€¼ï¼ˆæ‹¥æœ‰æ‰€æœ‰æƒï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h3 id="é—­åŒ…ä¸å¯¹åº”çš„ç»“æ„ä½“"><a href="#é—­åŒ…ä¸å¯¹åº”çš„ç»“æ„ä½“" class="headerlink" title="é—­åŒ…ä¸å¯¹åº”çš„ç»“æ„ä½“"></a>é—­åŒ…ä¸å¯¹åº”çš„ç»“æ„ä½“</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span> = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">y</span> = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">closure</span> = |z| x + z; <span class="comment">// æ•è· xï¼ˆä¸å¯å˜å€Ÿç”¨ï¼‰ï¼Œä¸æ•è· y</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥ä¸Šé—­åŒ…ä¼šç”Ÿæˆç±»ä¼¼ä¸‹é¢çš„</span></span><br><span class="line"><span class="comment">// åŒ¿åç»“æ„ä½“ï¼Œå‘½åä¸º ClosureType ä»…ä½œç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ClosureType</span>&lt;<span class="symbol">&#x27;a</span>&gt; &#123;</span><br><span class="line">    x: &amp;<span class="symbol">&#x27;a</span> <span class="type">i32</span>, <span class="comment">// æ•è· x çš„ä¸å¯å˜å¼•ç”¨ï¼ˆå› ä»…è¯»å– xï¼‰</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;<span class="symbol">&#x27;a</span>&gt; <span class="built_in">Fn</span>&lt;(<span class="type">i32</span>,)&gt; <span class="keyword">for</span> <span class="title class_">ClosureType</span>&lt;<span class="symbol">&#x27;a</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Output</span> = <span class="type">i32</span>;</span><br><span class="line">    <span class="comment">// call æ–¹æ³•çš„é€»è¾‘å³é—­åŒ…ä½“ï¼šx + z</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">call</span>(&amp;<span class="keyword">self</span>, args: (<span class="type">i32</span>,)) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.x + args.<span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœé—­åŒ…æ•è·äº† y çš„æ‰€æœ‰æƒå¹¶è½¬ç§»ç»™å…¶ä»–å¯¹è±¡ï¼Œåˆ™å®ç° FnOnce</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">closure2</span> = <span class="keyword">move</span> || y; <span class="comment">// æ¶ˆè€— y</span></span><br><span class="line"><span class="comment">// å¯¹åº”çš„ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ClosureType2</span> &#123;</span><br><span class="line">    y: <span class="type">String</span>, <span class="comment">// ç›´æ¥å­˜å‚¨ String å€¼</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">FnOnce</span>&lt;()&gt; <span class="keyword">for</span> <span class="title class_">ClosureType2</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Output</span> = <span class="type">String</span>;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">call_once</span>(<span class="keyword">self</span>, _args: ()) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.y <span class="comment">// æ‰€æœ‰æƒè½¬ç§»ç»™è°ƒç”¨è€…</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li><strong>é—­åŒ…çš„ä¸‰ä¸ª trait</strong>ï¼š<code>Fn</code>ï¼ˆåªè¯»ï¼‰ã€<code>FnMut</code>ï¼ˆå¯å˜ï¼‰ã€<code>FnOnce</code>ï¼ˆæ¶ˆè€—ï¼‰ç”±é—­åŒ…çš„å®é™…ä½¿ç”¨æ–¹å¼è‡ªåŠ¨ç¡®å®š</li>
<li><strong><code>move</code> å…³é”®å­—</strong>ï¼šå¼ºåˆ¶è½¬ç§»æ•è·å˜é‡çš„æ‰€æœ‰æƒï¼ˆé <code>Copy</code> ç±»å‹ï¼‰æˆ–å¤åˆ¶ï¼ˆ<code>Copy</code> ç±»å‹ï¼‰</li>
<li><strong>ç¼–è¯‘æ—¶ä¼˜åŒ–</strong>ï¼šé—­åŒ…åœ¨ç¼–è¯‘æ—¶è½¬æ¢ä¸ºåŒ¿åç»“æ„ä½“ï¼Œé›¶å‚æ•°é—­åŒ…å¯è¢«å®Œå…¨ä¼˜åŒ–</li>
<li><strong>å…¸å‹åº”ç”¨</strong>ï¼šè§£å†³ç”Ÿå‘½å‘¨æœŸé—®é¢˜ï¼Œç‰¹åˆ«æ˜¯çº¿ç¨‹é—´ä¼ é€’æ•°æ®æ—¶</li>
</ul>
]]></content>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustä¸­çš„é›†åˆCollection</title>
    <url>/2023/09/26/Rust%E4%B8%AD%E7%9A%84%E9%9B%86%E5%90%88Collection/</url>
    <content><![CDATA[<p>é›†åˆï¼ˆCollectionsï¼‰æ˜¯å­˜å‚¨å¤šä¸ªå€¼çš„æ•°æ®ç»“æ„ï¼Œä¸»è¦å­˜æ”¾åœ¨æ ‡å‡†åº“ <code>std::collections</code> æ¨¡å—ä¸­ã€‚é›†åˆçš„å¤§å°å¯ä»¥åŠ¨æ€å˜åŒ–ï¼Œä¸”æ•°æ®é€šå¸¸å­˜å‚¨åœ¨å †ä¸Šã€‚</p>
<span id="more"></span>

<h2 id="Rust-æ ‡å‡†åº“ä¸­çš„ä¸»è¦é›†åˆç±»å‹"><a href="#Rust-æ ‡å‡†åº“ä¸­çš„ä¸»è¦é›†åˆç±»å‹" class="headerlink" title="Rust æ ‡å‡†åº“ä¸­çš„ä¸»è¦é›†åˆç±»å‹"></a>Rust æ ‡å‡†åº“ä¸­çš„ä¸»è¦é›†åˆç±»å‹</h2><table>
<thead>
<tr>
<th>é›†åˆç±»å‹</th>
<th>è¯´æ˜</th>
<th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td><code>Vec&lt;T&gt;</code></td>
<td>åŠ¨æ€æ•°ç»„</td>
<td>å…ƒç´ æœ‰åºã€å¯å˜é•¿ã€éšæœºè®¿é—®é«˜æ•ˆ</td>
</tr>
<tr>
<td><code>VecDeque&lt;T&gt;</code></td>
<td>åŒç«¯é˜Ÿåˆ—</td>
<td>æ”¯æŒä¸¤ç«¯é«˜æ•ˆæ’å…¥&#x2F;åˆ é™¤</td>
</tr>
<tr>
<td><code>LinkedList&lt;T&gt;</code></td>
<td>åŒå‘é“¾è¡¨</td>
<td>æ’å…¥åˆ é™¤å¿«ï¼Œéšæœºè®¿é—®æ…¢</td>
</tr>
<tr>
<td><code>HashMap&lt;K,V&gt;</code></td>
<td>å“ˆå¸Œè¡¨</td>
<td>åŸºäºå“ˆå¸Œçš„é”®å€¼å­˜å‚¨ï¼Œæ— åº</td>
</tr>
<tr>
<td><code>BTreeMap&lt;K,V&gt;</code></td>
<td>å¹³è¡¡æ ‘æ˜ å°„</td>
<td>åŸºäºæ’åºçš„é”®å€¼å­˜å‚¨ï¼Œæœ‰åº</td>
</tr>
<tr>
<td><code>HashSet&lt;T&gt;</code></td>
<td>å“ˆå¸Œé›†åˆ</td>
<td>ä¸é‡å¤å…ƒç´ ï¼Œæ— åº</td>
</tr>
<tr>
<td><code>BTreeSet&lt;T&gt;</code></td>
<td>æœ‰åºé›†åˆ</td>
<td>ä¸é‡å¤å…ƒç´ ï¼Œæœ‰åº</td>
</tr>
<tr>
<td><code>BinaryHeap&lt;T&gt;</code></td>
<td>å †ç»“æ„</td>
<td>å¯ç”¨äºä¼˜å…ˆé˜Ÿåˆ—ï¼ˆæœ€å¤§å †ï¼‰</td>
</tr>
</tbody></table>
<h2 id="1-åŠ¨æ€æ•°ç»„-Vec-lt-T-gt"><a href="#1-åŠ¨æ€æ•°ç»„-Vec-lt-T-gt" class="headerlink" title="1. åŠ¨æ€æ•°ç»„ Vec&lt;T&gt;"></a>1. åŠ¨æ€æ•°ç»„ Vec&lt;T&gt;</h2><p><code>Vec&lt;T&gt;</code> æ˜¯ Rust ä¸­æœ€å¸¸ç”¨çš„é›†åˆï¼Œæœ¬è´¨æ˜¯åŠ¨æ€æ•°ç»„ï¼Œæ”¯æŒåœ¨æœ«å°¾é«˜æ•ˆæ’å…¥&#x2F;åˆ é™¤å…ƒç´ ï¼Œä¸”å¯é€šè¿‡ç´¢å¼•éšæœºè®¿é—®ã€‚</p>
<h3 id="åˆ›å»ºæ–¹å¼"><a href="#åˆ›å»ºæ–¹å¼" class="headerlink" title="åˆ›å»ºæ–¹å¼"></a>åˆ›å»ºæ–¹å¼</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">v1</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();              <span class="comment">// ç©º vector</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">v2</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];           <span class="comment">// å®åˆ›å»º</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v3</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">with_capacity</span>(<span class="number">10</span>); <span class="comment">// é¢„åˆ†é…å®¹é‡</span></span><br></pre></td></tr></table></figure>

<h3 id="å¸¸ç”¨æ–¹æ³•"><a href="#å¸¸ç”¨æ–¹æ³•" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h3><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
<th>è¿”å›ç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>new()</code></td>
<td>åˆ›å»ºç©ºå‘é‡</td>
<td><code>Vec&lt;T&gt;</code></td>
</tr>
<tr>
<td><code>with_capacity(n)</code></td>
<td>é¢„åˆ†é…å®¹é‡</td>
<td><code>Vec&lt;T&gt;</code></td>
</tr>
<tr>
<td><code>push(value)</code></td>
<td>æœ«å°¾æ·»åŠ å…ƒç´ </td>
<td><code>()</code></td>
</tr>
<tr>
<td><code>pop()</code></td>
<td>ç§»é™¤æœ€åä¸€ä¸ªå…ƒç´ </td>
<td><code>Option&lt;T&gt;</code></td>
</tr>
<tr>
<td><code>insert(index, value)</code></td>
<td>åœ¨æŒ‡å®šä½ç½®æ’å…¥</td>
<td><code>()</code></td>
</tr>
<tr>
<td><code>remove(index)</code></td>
<td>ç§»é™¤æŒ‡å®šä½ç½®</td>
<td><code>T</code></td>
</tr>
<tr>
<td><code>clear()</code></td>
<td>æ¸…ç©ºæ‰€æœ‰å…ƒç´ </td>
<td><code>()</code></td>
</tr>
<tr>
<td><code>len()</code></td>
<td>è¿”å›é•¿åº¦</td>
<td><code>usize</code></td>
</tr>
<tr>
<td><code>capacity()</code></td>
<td>è¿”å›å®¹é‡</td>
<td><code>usize</code></td>
</tr>
<tr>
<td><code>reserve(n)</code></td>
<td>æ‰©å®¹</td>
<td><code>()</code></td>
</tr>
<tr>
<td><code>shrink_to_fit()</code></td>
<td>æ”¶ç¼©å®¹é‡</td>
<td><code>()</code></td>
</tr>
<tr>
<td><code>get(i)</code></td>
<td>å®‰å…¨è®¿é—®å…ƒç´ </td>
<td><code>Option&lt;&amp;T&gt;</code></td>
</tr>
<tr>
<td><code>get_mut(i)</code></td>
<td>å¯å˜è®¿é—®å…ƒç´ </td>
<td><code>Option&lt;&amp;mut T&gt;</code></td>
</tr>
<tr>
<td><code>first() / last()</code></td>
<td>è·å–é¦–&#x2F;å°¾å…ƒç´ </td>
<td><code>Option&lt;&amp;T&gt;</code></td>
</tr>
<tr>
<td><code>iter() / iter_mut()</code></td>
<td>éå†å…ƒç´ </td>
<td>è¿­ä»£å™¨</td>
</tr>
<tr>
<td><code>sort() / sort_by()</code></td>
<td>æ’åº</td>
<td><code>()</code></td>
</tr>
</tbody></table>
<h3 id="Vec-ç¤ºä¾‹"><a href="#Vec-ç¤ºä¾‹" class="headerlink" title="Vec ç¤ºä¾‹"></a>Vec ç¤ºä¾‹</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// 1. åˆ›å»ºå’Œæ·»åŠ å…ƒç´ </span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v</span> = <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    v.<span class="title function_ invoke__">push</span>(<span class="number">1</span>);</span><br><span class="line">    v.<span class="title function_ invoke__">push</span>(<span class="number">2</span>);</span><br><span class="line">    v.<span class="title function_ invoke__">push</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Vec: &#123;:?&#125;&quot;</span>, v); <span class="comment">// [1, 2, 3]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. è®¿é—®å…ƒç´ </span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;First: &#123;&#125;&quot;</span>, v[<span class="number">0</span>]); <span class="comment">// 1</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Safe get: &#123;:?&#125;&quot;</span>, v.<span class="title function_ invoke__">get</span>(<span class="number">1</span>)); <span class="comment">// Some(&amp;2)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. ä¿®æ”¹å…ƒç´ </span></span><br><span class="line">    v[<span class="number">0</span>] = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. åˆ é™¤å…ƒç´ </span></span><br><span class="line">    v.<span class="title function_ invoke__">pop</span>(); <span class="comment">// åˆ é™¤æœ«å°¾å…ƒç´  3</span></span><br><span class="line">    v.<span class="title function_ invoke__">remove</span>(<span class="number">0</span>); <span class="comment">// åˆ é™¤é¦–å…ƒç´  10</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. éå†</span></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">item</span> <span class="keyword">in</span> &amp;v &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6. æ’åº</span></span><br><span class="line">    v.<span class="title function_ invoke__">sort</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7. å®¹é‡ç®¡ç†</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Len: &#123;&#125;, Capacity: &#123;&#125;&quot;</span>, v.<span class="title function_ invoke__">len</span>(), v.<span class="title function_ invoke__">capacity</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-åŒç«¯é˜Ÿåˆ—-VecDeque-lt-T-gt"><a href="#2-åŒç«¯é˜Ÿåˆ—-VecDeque-lt-T-gt" class="headerlink" title="2. åŒç«¯é˜Ÿåˆ— VecDeque&lt;T&gt;"></a>2. åŒç«¯é˜Ÿåˆ— VecDeque&lt;T&gt;</h2><p><code>VecDeque&lt;T&gt;</code>ï¼ˆDouble-ended Queueï¼‰æ˜¯åŒç«¯é˜Ÿåˆ—ï¼Œåº•å±‚ä½¿ç”¨ç¯å½¢ç¼“å†²åŒºå®ç°ã€‚æ”¯æŒåœ¨é¦–å°¾ä¸¤ç«¯é«˜æ•ˆæ’å…¥&#x2F;åˆ é™¤å…ƒç´ ã€‚</p>
<h3 id="åˆ›å»ºå’ŒåŸºæœ¬æ“ä½œ"><a href="#åˆ›å»ºå’ŒåŸºæœ¬æ“ä½œ" class="headerlink" title="åˆ›å»ºå’ŒåŸºæœ¬æ“ä½œ"></a>åˆ›å»ºå’ŒåŸºæœ¬æ“ä½œ</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::VecDeque;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">deque</span> = VecDeque::<span class="title function_ invoke__">new</span>();</span><br><span class="line">deque.<span class="title function_ invoke__">push_back</span>(<span class="number">2</span>);    <span class="comment">// æœ«å°¾å…¥é˜Ÿ</span></span><br><span class="line">deque.<span class="title function_ invoke__">push_front</span>(<span class="number">1</span>);   <span class="comment">// å¤´éƒ¨å…¥é˜Ÿ</span></span><br><span class="line">deque.<span class="title function_ invoke__">pop_front</span>();     <span class="comment">// ä»å¤´éƒ¨å‡ºé˜Ÿï¼Œè¿”å› Some(1)</span></span><br><span class="line">deque.<span class="title function_ invoke__">pop_back</span>();      <span class="comment">// ä»å°¾éƒ¨å‡ºé˜Ÿï¼Œè¿”å› Some(2)</span></span><br></pre></td></tr></table></figure>

<h3 id="å¸¸ç”¨æ–¹æ³•-1"><a href="#å¸¸ç”¨æ–¹æ³•-1" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h3><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
<th>è¿”å›ç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>new()</code></td>
<td>åˆ›å»ºç©ºé˜Ÿåˆ—</td>
<td><code>VecDeque&lt;T&gt;</code></td>
</tr>
<tr>
<td><code>with_capacity(n)</code></td>
<td>é¢„åˆ†é…å®¹é‡</td>
<td><code>VecDeque&lt;T&gt;</code></td>
</tr>
<tr>
<td><code>push_back(value)</code></td>
<td>æœ«å°¾å…¥é˜Ÿ</td>
<td><code>()</code></td>
</tr>
<tr>
<td><code>push_front(value)</code></td>
<td>å¤´éƒ¨å…¥é˜Ÿ</td>
<td><code>()</code></td>
</tr>
<tr>
<td><code>pop_back()</code></td>
<td>ä»å°¾éƒ¨å‡ºé˜Ÿ</td>
<td><code>Option&lt;T&gt;</code></td>
</tr>
<tr>
<td><code>pop_front()</code></td>
<td>ä»å¤´éƒ¨å‡ºé˜Ÿ</td>
<td><code>Option&lt;T&gt;</code></td>
</tr>
<tr>
<td><code>front() / back()</code></td>
<td>æŸ¥çœ‹é¦–å°¾å…ƒç´ </td>
<td><code>Option&lt;&amp;T&gt;</code></td>
</tr>
<tr>
<td><code>len() / is_empty()</code></td>
<td>é•¿åº¦&#x2F;æ˜¯å¦ç©º</td>
<td><code>usize / bool</code></td>
</tr>
<tr>
<td><code>get(i)</code></td>
<td>å®‰å…¨ç´¢å¼•è®¿é—®</td>
<td><code>Option&lt;&amp;T&gt;</code></td>
</tr>
<tr>
<td><code>iter() / iter_mut()</code></td>
<td>éå†</td>
<td>è¿­ä»£å™¨</td>
</tr>
<tr>
<td><code>rotate_left(k) / rotate_right(k)</code></td>
<td>å¾ªç¯æ—‹è½¬</td>
<td><code>()</code></td>
</tr>
</tbody></table>
<h3 id="VecDeque-ç¤ºä¾‹"><a href="#VecDeque-ç¤ºä¾‹" class="headerlink" title="VecDeque ç¤ºä¾‹"></a>VecDeque ç¤ºä¾‹</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::VecDeque;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">deque</span> = VecDeque::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä»ä¸¤ç«¯æ’å…¥</span></span><br><span class="line">    deque.<span class="title function_ invoke__">push_back</span>(<span class="number">2</span>);</span><br><span class="line">    deque.<span class="title function_ invoke__">push_back</span>(<span class="number">3</span>);</span><br><span class="line">    deque.<span class="title function_ invoke__">push_front</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Deque: &#123;:?&#125;&quot;</span>, deque); <span class="comment">// [1, 2, 3]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»ä¸¤ç«¯åˆ é™¤</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Front: &#123;:?&#125;&quot;</span>, deque.<span class="title function_ invoke__">pop_front</span>()); <span class="comment">// Some(1)</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Back: &#123;:?&#125;&quot;</span>, deque.<span class="title function_ invoke__">pop_back</span>());   <span class="comment">// Some(3)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ—‹è½¬</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">deque</span> = VecDeque::<span class="title function_ invoke__">from</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br><span class="line">    deque.<span class="title function_ invoke__">rotate_left</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;After rotate_left(2): &#123;:?&#125;&quot;</span>, deque); <span class="comment">// [3, 4, 5, 1, 2]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-åŒå‘é“¾è¡¨-LinkedList-lt-T-gt"><a href="#3-åŒå‘é“¾è¡¨-LinkedList-lt-T-gt" class="headerlink" title="3. åŒå‘é“¾è¡¨ LinkedList&lt;T&gt;"></a>3. åŒå‘é“¾è¡¨ LinkedList&lt;T&gt;</h2><p><code>LinkedList&lt;T&gt;</code> æ˜¯åŒå‘é“¾è¡¨ï¼Œå…ƒç´ é€šè¿‡æŒ‡é’ˆè¿æ¥ï¼Œä¸è¿ç»­å­˜å‚¨ã€‚</p>
<h3 id="æ€§èƒ½è€ƒé‡"><a href="#æ€§èƒ½è€ƒé‡" class="headerlink" title="æ€§èƒ½è€ƒé‡"></a>æ€§èƒ½è€ƒé‡</h3><ul>
<li><strong>å®é™…æ€§èƒ½è¾ƒå·®</strong>ï¼šå› å…ƒç´ ä¸è¿ç»­ï¼Œç¼“å­˜å‹å¥½æ€§ä½ï¼Œéšæœºè®¿é—®æ•ˆç‡ä½ï¼ˆO(n)ï¼‰</li>
<li><strong>æå°‘ä½¿ç”¨</strong>ï¼šé™¤éæ˜ç¡®éœ€è¦é“¾è¡¨çš„ç†è®ºç‰¹æ€§ï¼Œå¦åˆ™ä¼˜å…ˆç”¨ <code>Vec</code> æˆ– <code>VecDeque</code></li>
</ul>
<h3 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::LinkedList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">list</span> = LinkedList::<span class="title function_ invoke__">new</span>();</span><br><span class="line">list.<span class="title function_ invoke__">push_back</span>(<span class="number">1</span>);     <span class="comment">// å°¾éƒ¨æ·»åŠ ï¼š[1]</span></span><br><span class="line">list.<span class="title function_ invoke__">push_front</span>(<span class="number">0</span>);    <span class="comment">// å¤´éƒ¨æ·»åŠ ï¼š[0, 1]</span></span><br><span class="line">list.<span class="title function_ invoke__">pop_back</span>();       <span class="comment">// å°¾éƒ¨ç§»é™¤ï¼šè¿”å› Some(1)</span></span><br><span class="line">list.<span class="title function_ invoke__">pop_front</span>();      <span class="comment">// å¤´éƒ¨ç§»é™¤ï¼šè¿”å› Some(0)</span></span><br></pre></td></tr></table></figure>

<h3 id="å¸¸ç”¨æ–¹æ³•-2"><a href="#å¸¸ç”¨æ–¹æ³•-2" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h3><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
<th>è¿”å›ç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>new()</code></td>
<td>åˆ›å»ºç©ºé“¾è¡¨</td>
<td><code>LinkedList&lt;T&gt;</code></td>
</tr>
<tr>
<td><code>push_back(value)</code></td>
<td>å°¾éƒ¨æ’å…¥</td>
<td><code>()</code></td>
</tr>
<tr>
<td><code>push_front(value)</code></td>
<td>å¤´éƒ¨æ’å…¥</td>
<td><code>()</code></td>
</tr>
<tr>
<td><code>pop_back() / pop_front()</code></td>
<td>ç§»é™¤é¦–&#x2F;å°¾</td>
<td><code>Option&lt;T&gt;</code></td>
</tr>
<tr>
<td><code>front() / back()</code></td>
<td>è·å–é¦–å°¾å¼•ç”¨</td>
<td><code>Option&lt;&amp;T&gt;</code></td>
</tr>
<tr>
<td><code>len() / is_empty()</code></td>
<td>è·å–é•¿åº¦&#x2F;æ˜¯å¦ä¸ºç©º</td>
<td><code>usize / bool</code></td>
</tr>
<tr>
<td><code>clear()</code></td>
<td>æ¸…ç©ºé“¾è¡¨</td>
<td><code>()</code></td>
</tr>
<tr>
<td><code>append(&amp;mut other)</code></td>
<td>æ‹¼æ¥å¦ä¸€ä¸ªé“¾è¡¨</td>
<td><code>()</code></td>
</tr>
<tr>
<td><code>iter() / iter_mut()</code></td>
<td>éå†</td>
<td>è¿­ä»£å™¨</td>
</tr>
</tbody></table>
<h2 id="4-å“ˆå¸Œè¡¨-HashMap-lt-K-V-gt"><a href="#4-å“ˆå¸Œè¡¨-HashMap-lt-K-V-gt" class="headerlink" title="4. å“ˆå¸Œè¡¨ HashMap&lt;K,V&gt;"></a>4. å“ˆå¸Œè¡¨ HashMap&lt;K,V&gt;</h2><p><code>HashMap&lt;K, V&gt;</code> åŸºäºå“ˆå¸Œè¡¨å®ç°ï¼Œé€šè¿‡å“ˆå¸Œå‡½æ•°å°†é”®æ˜ å°„åˆ°å­˜å‚¨ä½ç½®ï¼ŒæŸ¥è¯¢å’Œæ’å…¥çš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚</p>
<h3 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul>
<li><strong>æ— åºå­˜å‚¨</strong>ï¼ˆé”®çš„é¡ºåºä¸å›ºå®šï¼‰</li>
<li>é”® <code>K</code> éœ€å®ç° <code>Hash</code> å’Œ <code>Eq</code> traitï¼ˆç”¨äºå“ˆå¸Œè®¡ç®—å’Œç›¸ç­‰æ€§æ¯”è¾ƒï¼‰</li>
<li>æ€§èƒ½ä¾èµ–å“ˆå¸Œå‡½æ•°çš„è´¨é‡ï¼ˆé¿å…å“ˆå¸Œå†²çªï¼‰</li>
</ul>
<h3 id="åˆ›å»ºæ–¹å¼-1"><a href="#åˆ›å»ºæ–¹å¼-1" class="headerlink" title="åˆ›å»ºæ–¹å¼"></a>åˆ›å»ºæ–¹å¼</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. åŸºæœ¬åˆ›å»º</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">scores</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line">scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Alice&quot;</span>), <span class="number">90</span>);</span><br><span class="line">scores.<span class="title function_ invoke__">insert</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Bob&quot;</span>), <span class="number">85</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ä»è¿­ä»£å™¨åˆ›å»º</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">teams</span> = <span class="built_in">vec!</span>[<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Blue&quot;</span>), <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Red&quot;</span>)];</span><br><span class="line"><span class="keyword">let</span> <span class="variable">initial_scores</span> = <span class="built_in">vec!</span>[<span class="number">10</span>, <span class="number">50</span>];</span><br><span class="line"><span class="keyword">let</span> <span class="variable">scores</span>: HashMap&lt;_, _&gt; = teams</span><br><span class="line">    .<span class="title function_ invoke__">into_iter</span>()</span><br><span class="line">    .<span class="title function_ invoke__">zip</span>(initial_scores.<span class="title function_ invoke__">into_iter</span>())</span><br><span class="line">    .<span class="title function_ invoke__">collect</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. ä½¿ç”¨ from_iter</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">map</span> = HashMap::<span class="title function_ invoke__">from_iter</span>(<span class="built_in">vec!</span>[(<span class="string">&quot;a&quot;</span>, <span class="number">1</span>), (<span class="string">&quot;b&quot;</span>, <span class="number">2</span>)]);</span><br></pre></td></tr></table></figure>

<h3 id="å¸¸ç”¨æ–¹æ³•-3"><a href="#å¸¸ç”¨æ–¹æ³•-3" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h3><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
<th>è¿”å›ç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>new()</code></td>
<td>åˆ›å»ºç©ºæ˜ å°„</td>
<td><code>HashMap&lt;K,V&gt;</code></td>
</tr>
<tr>
<td><code>with_capacity(n)</code></td>
<td>é¢„åˆ†é…å®¹é‡</td>
<td><code>HashMap&lt;K,V&gt;</code></td>
</tr>
<tr>
<td><code>insert(key, val)</code></td>
<td>æ’å…¥æˆ–æ›´æ–°é”®å€¼</td>
<td><code>Option&lt;V&gt;</code>ï¼ˆæ—§å€¼ï¼‰</td>
</tr>
<tr>
<td><code>remove(key)</code></td>
<td>åˆ é™¤é”®</td>
<td><code>Option&lt;V&gt;</code></td>
</tr>
<tr>
<td><code>get(key)</code></td>
<td>è·å–å€¼å¼•ç”¨</td>
<td><code>Option&lt;&amp;V&gt;</code></td>
</tr>
<tr>
<td><code>get_mut(key)</code></td>
<td>å¯å˜å¼•ç”¨</td>
<td><code>Option&lt;&amp;mut V&gt;</code></td>
</tr>
<tr>
<td><code>contains_key(key)</code></td>
<td>æ˜¯å¦å­˜åœ¨</td>
<td><code>bool</code></td>
</tr>
<tr>
<td><code>entry(key)</code></td>
<td>è·å–æˆ–åˆ›å»º entry</td>
<td><code>Entry&lt;K,V&gt;</code></td>
</tr>
<tr>
<td><code>len() / is_empty()</code></td>
<td>é•¿åº¦&#x2F;æ˜¯å¦ç©º</td>
<td><code>usize / bool</code></td>
</tr>
<tr>
<td><code>keys() / values() / iter()</code></td>
<td>è¿­ä»£é”®ã€å€¼ã€é”®å€¼å¯¹</td>
<td>è¿­ä»£å™¨</td>
</tr>
<tr>
<td><code>clear()</code></td>
<td>æ¸…ç©º</td>
<td><code>()</code></td>
</tr>
</tbody></table>
<h3 id="HashMap-ç¤ºä¾‹"><a href="#HashMap-ç¤ºä¾‹" class="headerlink" title="HashMap ç¤ºä¾‹"></a>HashMap ç¤ºä¾‹</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">map</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ’å…¥</span></span><br><span class="line">    map.<span class="title function_ invoke__">insert</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">    map.<span class="title function_ invoke__">insert</span>(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;30&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æŸ¥è¯¢</span></span><br><span class="line">    <span class="keyword">match</span> map.<span class="title function_ invoke__">get</span>(<span class="string">&quot;name&quot;</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(value) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Name: &#123;&#125;&quot;</span>, value),</span><br><span class="line">        <span class="literal">None</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Not found&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ›´æ–°</span></span><br><span class="line">    map.<span class="title function_ invoke__">insert</span>(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;31&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éå†</span></span><br><span class="line">    <span class="title function_ invoke__">for</span> (key, value) <span class="keyword">in</span> &amp;map &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;: &#123;&#125;&quot;</span>, key, value);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ é™¤</span></span><br><span class="line">    map.<span class="title function_ invoke__">remove</span>(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Entry APIï¼ˆé«˜æ•ˆæ›´æ–°ï¼‰</span></span><br><span class="line">    map.<span class="title function_ invoke__">entry</span>(<span class="string">&quot;city&quot;</span>).<span class="title function_ invoke__">or_insert</span>(<span class="string">&quot;Beijing&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-æœ‰åºæ˜ å°„-BTreeMap-lt-K-V-gt"><a href="#5-æœ‰åºæ˜ å°„-BTreeMap-lt-K-V-gt" class="headerlink" title="5. æœ‰åºæ˜ å°„ BTreeMap&lt;K,V&gt;"></a>5. æœ‰åºæ˜ å°„ BTreeMap&lt;K,V&gt;</h2><p><code>BTreeMap&lt;K, V&gt;</code> åŸºäº B æ ‘å®ç°ï¼Œé”®å€¼å¯¹æŒ‰é”®çš„æ’åºé¡ºåºå­˜å‚¨ï¼ŒæŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä¸º O(log n)ã€‚</p>
<h3 id="ç‰¹ç‚¹-1"><a href="#ç‰¹ç‚¹-1" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul>
<li><strong>æœ‰åºå­˜å‚¨</strong>ï¼šé”®å€¼å¯¹æŒ‰é”®çš„è‡ªç„¶é¡ºåºï¼ˆæˆ–è‡ªå®šä¹‰æ’åºï¼‰æœ‰åºå­˜å‚¨</li>
<li>é”® <code>K</code> éœ€å®ç° <code>Ord</code> traitï¼ˆç”¨äºæ’åºï¼‰</li>
<li><strong>æ”¯æŒèŒƒå›´æŸ¥è¯¢</strong>ï¼šå¦‚è·å–â€å¤§äº x ä¸”å°äº yâ€çš„é”®å€¼å¯¹</li>
</ul>
<h3 id="åŸºæœ¬æ“ä½œ-1"><a href="#åŸºæœ¬æ“ä½œ-1" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::BTreeMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">map</span> = BTreeMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line">map.<span class="title function_ invoke__">insert</span>(<span class="number">3</span>, <span class="string">&quot;c&quot;</span>);</span><br><span class="line">map.<span class="title function_ invoke__">insert</span>(<span class="number">1</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line">map.<span class="title function_ invoke__">insert</span>(<span class="number">2</span>, <span class="string">&quot;b&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†ï¼šæŒ‰é”®çš„å‡åºè¾“å‡º (1,&quot;a&quot;), (2,&quot;b&quot;), (3,&quot;c&quot;)</span></span><br><span class="line"><span class="title function_ invoke__">for</span> (k, v) <span class="keyword">in</span> &amp;map &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;: &#123;&#125;&quot;</span>, k, v);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// èŒƒå›´æŸ¥è¯¢ï¼šè·å–é”® &gt;1 ä¸” &lt;=3 çš„é”®å€¼å¯¹</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">range</span> = map.<span class="title function_ invoke__">range</span>(<span class="number">1</span>..=<span class="number">3</span>); <span class="comment">// åŒ…å«1å’Œ3</span></span><br></pre></td></tr></table></figure>

<h3 id="å¸¸ç”¨æ–¹æ³•-4"><a href="#å¸¸ç”¨æ–¹æ³•-4" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h3><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
<th>è¿”å›ç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>new()</code></td>
<td>åˆ›å»ºç©ºæ˜ å°„</td>
<td><code>BTreeMap&lt;K,V&gt;</code></td>
</tr>
<tr>
<td><code>insert(key, val)</code></td>
<td>æ’å…¥æˆ–æ›¿æ¢</td>
<td><code>Option&lt;V&gt;</code></td>
</tr>
<tr>
<td><code>remove(key)</code></td>
<td>åˆ é™¤é”®</td>
<td><code>Option&lt;V&gt;</code></td>
</tr>
<tr>
<td><code>get(key)</code></td>
<td>è·å–å¼•ç”¨</td>
<td><code>Option&lt;&amp;V&gt;</code></td>
</tr>
<tr>
<td><code>contains_key(key)</code></td>
<td>æ£€æŸ¥å­˜åœ¨</td>
<td><code>bool</code></td>
</tr>
<tr>
<td><code>len() / is_empty()</code></td>
<td>é•¿åº¦&#x2F;ç©º</td>
<td><code>usize / bool</code></td>
</tr>
<tr>
<td><code>iter()</code></td>
<td>éå†æœ‰åºé”®å€¼</td>
<td>è¿­ä»£å™¨</td>
</tr>
<tr>
<td><code>range(range)</code></td>
<td>èŒƒå›´éå†</td>
<td>è¿­ä»£å™¨</td>
</tr>
<tr>
<td><code>first_key_value() / last_key_value()</code></td>
<td>æœ€å°&#x2F;æœ€å¤§é”®</td>
<td><code>Option&lt;(&amp;K,&amp;V)&gt;</code></td>
</tr>
<tr>
<td><code>clear()</code></td>
<td>æ¸…ç©º</td>
<td><code>()</code></td>
</tr>
</tbody></table>
<h3 id="BTreeMap-ç¤ºä¾‹"><a href="#BTreeMap-ç¤ºä¾‹" class="headerlink" title="BTreeMap ç¤ºä¾‹"></a>BTreeMap ç¤ºä¾‹</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::BTreeMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">map</span> = BTreeMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    map.<span class="title function_ invoke__">insert</span>(<span class="number">5</span>, <span class="string">&quot;five&quot;</span>);</span><br><span class="line">    map.<span class="title function_ invoke__">insert</span>(<span class="number">2</span>, <span class="string">&quot;two&quot;</span>);</span><br><span class="line">    map.<span class="title function_ invoke__">insert</span>(<span class="number">8</span>, <span class="string">&quot;eight&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æœ‰åºéå†</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Ordered iteration:&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">for</span> (k, v) <span class="keyword">in</span> &amp;map &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;: &#123;&#125;&quot;</span>, k, v); <span class="comment">// è¾“å‡º 2, 5, 8</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// èŒƒå›´æŸ¥è¯¢</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Range [2, 7]:&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">for</span> (k, v) <span class="keyword">in</span> map.<span class="title function_ invoke__">range</span>(<span class="number">2</span>..=<span class="number">7</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;: &#123;&#125;&quot;</span>, k, v); <span class="comment">// è¾“å‡º 2, 5</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æœ€å°æœ€å¤§å…ƒç´ </span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>((k, v)) = map.<span class="title function_ invoke__">first_key_value</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;First: &#123;&#125;: &#123;&#125;&quot;</span>, k, v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-å“ˆå¸Œé›†åˆ-HashSet-lt-T-gt"><a href="#6-å“ˆå¸Œé›†åˆ-HashSet-lt-T-gt" class="headerlink" title="6. å“ˆå¸Œé›†åˆ HashSet&lt;T&gt;"></a>6. å“ˆå¸Œé›†åˆ HashSet&lt;T&gt;</h2><p><code>HashSet&lt;T&gt;</code> åŸºäº <code>HashMap&lt;T, ()&gt;</code> å®ç°ï¼Œå­˜å‚¨å”¯ä¸€å…ƒç´ ï¼Œæ— åºã€‚</p>
<h3 id="ç‰¹ç‚¹-2"><a href="#ç‰¹ç‚¹-2" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul>
<li><strong>å…ƒç´ å”¯ä¸€</strong>ï¼šæ’å…¥é‡å¤å…ƒç´ ä¼šè¢«å¿½ç•¥</li>
<li>å…ƒç´  <code>T</code> éœ€å®ç° <code>Hash</code> å’Œ <code>Eq</code> trait</li>
<li>æ’å…¥ã€æŸ¥è¯¢ã€åˆ é™¤çš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º O(1)</li>
</ul>
<h3 id="åŸºæœ¬æ“ä½œ-2"><a href="#åŸºæœ¬æ“ä½œ-2" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashSet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">set</span> = HashSet::<span class="title function_ invoke__">new</span>();</span><br><span class="line">set.<span class="title function_ invoke__">insert</span>(<span class="number">1</span>);</span><br><span class="line">set.<span class="title function_ invoke__">insert</span>(<span class="number">2</span>);</span><br><span class="line">set.<span class="title function_ invoke__">insert</span>(<span class="number">1</span>); <span class="comment">// é‡å¤å…ƒç´ ï¼Œæ’å…¥å¤±è´¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¸¸ç”¨æ–¹æ³•</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">has_one</span> = set.<span class="title function_ invoke__">contains</span>(&amp;<span class="number">1</span>);  <span class="comment">// true</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">removed</span> = set.<span class="title function_ invoke__">remove</span>(&amp;<span class="number">1</span>);    <span class="comment">// trueï¼Œç§»é™¤1</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">len</span> = set.<span class="title function_ invoke__">len</span>();             <span class="comment">// 1ï¼ˆå‰©ä½™å…ƒç´ 2ï¼‰</span></span><br></pre></td></tr></table></figure>

<h3 id="å¸¸ç”¨æ–¹æ³•-5"><a href="#å¸¸ç”¨æ–¹æ³•-5" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h3><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
<th>è¿”å›ç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>new()</code></td>
<td>åˆ›å»ºç©ºé›†åˆ</td>
<td><code>HashSet&lt;T&gt;</code></td>
</tr>
<tr>
<td><code>insert(value)</code></td>
<td>æ’å…¥</td>
<td><code>bool</code>(æ˜¯å¦æ–°æ’å…¥)</td>
</tr>
<tr>
<td><code>remove(value)</code></td>
<td>åˆ é™¤</td>
<td><code>bool</code></td>
</tr>
<tr>
<td><code>contains(value)</code></td>
<td>æ˜¯å¦å­˜åœ¨</td>
<td><code>bool</code></td>
</tr>
<tr>
<td><code>len() / is_empty()</code></td>
<td>é•¿åº¦&#x2F;ç©º</td>
<td><code>usize / bool</code></td>
</tr>
<tr>
<td><code>clear()</code></td>
<td>æ¸…ç©º</td>
<td><code>()</code></td>
</tr>
<tr>
<td><code>iter()</code></td>
<td>éå†</td>
<td>è¿­ä»£å™¨</td>
</tr>
<tr>
<td><code>union(&amp;other)</code></td>
<td>å¹¶é›†</td>
<td>è¿­ä»£å™¨</td>
</tr>
<tr>
<td><code>intersection(&amp;other)</code></td>
<td>äº¤é›†</td>
<td>è¿­ä»£å™¨</td>
</tr>
<tr>
<td><code>difference(&amp;other)</code></td>
<td>å·®é›†</td>
<td>è¿­ä»£å™¨</td>
</tr>
<tr>
<td><code>symmetric_difference(&amp;other)</code></td>
<td>å¯¹ç§°å·®</td>
<td>è¿­ä»£å™¨</td>
</tr>
</tbody></table>
<h3 id="HashSet-ç¤ºä¾‹"><a href="#HashSet-ç¤ºä¾‹" class="headerlink" title="HashSet ç¤ºä¾‹"></a>HashSet ç¤ºä¾‹</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashSet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">set1</span> = HashSet::<span class="title function_ invoke__">from</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">set2</span> = HashSet::<span class="title function_ invoke__">from</span>([<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ’å…¥å’ŒæŸ¥è¯¢</span></span><br><span class="line">    set1.<span class="title function_ invoke__">insert</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Contains 3: &#123;&#125;&quot;</span>, set1.<span class="title function_ invoke__">contains</span>(&amp;<span class="number">3</span>)); <span class="comment">// true</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é›†åˆæ“ä½œ</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">union</span>: HashSet&lt;_&gt; = set1.<span class="title function_ invoke__">union</span>(&amp;set2).<span class="title function_ invoke__">cloned</span>().<span class="title function_ invoke__">collect</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Union: &#123;:?&#125;&quot;</span>, union); <span class="comment">// &#123;1, 2, 3, 4, 5&#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="variable">intersection</span>: HashSet&lt;_&gt; = set1.<span class="title function_ invoke__">intersection</span>(&amp;set2).<span class="title function_ invoke__">cloned</span>().<span class="title function_ invoke__">collect</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Intersection: &#123;:?&#125;&quot;</span>, intersection); <span class="comment">// &#123;2, 3&#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="variable">difference</span>: HashSet&lt;_&gt; = set1.<span class="title function_ invoke__">difference</span>(&amp;set2).<span class="title function_ invoke__">cloned</span>().<span class="title function_ invoke__">collect</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Difference: &#123;:?&#125;&quot;</span>, difference); <span class="comment">// &#123;1, 5&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-æœ‰åºé›†åˆ-BTreeSet-lt-T-gt"><a href="#7-æœ‰åºé›†åˆ-BTreeSet-lt-T-gt" class="headerlink" title="7. æœ‰åºé›†åˆ BTreeSet&lt;T&gt;"></a>7. æœ‰åºé›†åˆ BTreeSet&lt;T&gt;</h2><p><code>BTreeSet&lt;T&gt;</code> åŸºäº <code>BTreeMap&lt;T, ()&gt;</code> å®ç°ï¼Œå­˜å‚¨å”¯ä¸€å…ƒç´ ï¼Œä¸”æŒ‰å…ƒç´ é¡ºåºæ’åºã€‚</p>
<h3 id="ç‰¹ç‚¹-3"><a href="#ç‰¹ç‚¹-3" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul>
<li><strong>å…ƒç´ å”¯ä¸€ä¸”æœ‰åº</strong>ï¼šæŒ‰ <code>Ord</code> trait æ’åº</li>
<li>å…ƒç´  <code>T</code> éœ€å®ç° <code>Ord</code> trait</li>
<li><strong>æ”¯æŒèŒƒå›´æŸ¥è¯¢</strong>ï¼ŒæŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä¸º O(log n)</li>
</ul>
<h3 id="åŸºæœ¬æ“ä½œ-3"><a href="#åŸºæœ¬æ“ä½œ-3" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::BTreeSet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">set</span> = BTreeSet::<span class="title function_ invoke__">new</span>();</span><br><span class="line">set.<span class="title function_ invoke__">insert</span>(<span class="number">3</span>);</span><br><span class="line">set.<span class="title function_ invoke__">insert</span>(<span class="number">1</span>);</span><br><span class="line">set.<span class="title function_ invoke__">insert</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†ï¼šæŒ‰é¡ºåºè¾“å‡º 1, 2, 3</span></span><br><span class="line"><span class="keyword">for</span> <span class="variable">num</span> <span class="keyword">in</span> &amp;set &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, num);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// èŒƒå›´æŸ¥è¯¢ï¼šè·å– &gt;1 ä¸” &lt;=3 çš„å…ƒç´ </span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">range</span> = set.<span class="title function_ invoke__">range</span>(<span class="number">1</span>..=<span class="number">3</span>); <span class="comment">// åŒ…å«1å’Œ3</span></span><br></pre></td></tr></table></figure>

<h3 id="å¸¸ç”¨æ–¹æ³•-6"><a href="#å¸¸ç”¨æ–¹æ³•-6" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h3><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
<th>è¿”å›ç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>new()</code></td>
<td>åˆ›å»ºç©ºé›†åˆ</td>
<td><code>BTreeSet&lt;T&gt;</code></td>
</tr>
<tr>
<td><code>insert(value)</code></td>
<td>æ’å…¥</td>
<td><code>bool</code></td>
</tr>
<tr>
<td><code>remove(value)</code></td>
<td>åˆ é™¤</td>
<td><code>bool</code></td>
</tr>
<tr>
<td><code>contains(value)</code></td>
<td>æ˜¯å¦å­˜åœ¨</td>
<td><code>bool</code></td>
</tr>
<tr>
<td><code>len() / is_empty()</code></td>
<td>é•¿åº¦&#x2F;ç©º</td>
<td><code>usize / bool</code></td>
</tr>
<tr>
<td><code>iter()</code></td>
<td>éå†æœ‰åºå…ƒç´ </td>
<td>è¿­ä»£å™¨</td>
</tr>
<tr>
<td><code>range(range)</code></td>
<td>èŒƒå›´éå†</td>
<td>è¿­ä»£å™¨</td>
</tr>
<tr>
<td><code>first() / last()</code></td>
<td>æœ€å°&#x2F;æœ€å¤§å…ƒç´ </td>
<td><code>Option&lt;&amp;T&gt;</code></td>
</tr>
<tr>
<td><code>union(&amp;other) / intersection(&amp;other)</code></td>
<td>é›†åˆæ“ä½œ</td>
<td>è¿­ä»£å™¨</td>
</tr>
</tbody></table>
<h3 id="BTreeSet-ç¤ºä¾‹"><a href="#BTreeSet-ç¤ºä¾‹" class="headerlink" title="BTreeSet ç¤ºä¾‹"></a>BTreeSet ç¤ºä¾‹</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::BTreeSet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">set</span> = BTreeSet::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    set.<span class="title function_ invoke__">insert</span>(<span class="number">5</span>);</span><br><span class="line">    set.<span class="title function_ invoke__">insert</span>(<span class="number">2</span>);</span><br><span class="line">    set.<span class="title function_ invoke__">insert</span>(<span class="number">8</span>);</span><br><span class="line">    set.<span class="title function_ invoke__">insert</span>(<span class="number">2</span>); <span class="comment">// é‡å¤ï¼Œä¸ä¼šæ’å…¥</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æœ‰åºéå†</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Ordered:&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">num</span> <span class="keyword">in</span> &amp;set &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, num); <span class="comment">// è¾“å‡º 2, 5, 8</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// èŒƒå›´æŸ¥è¯¢</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Range [2, 6]:&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">num</span> <span class="keyword">in</span> set.<span class="title function_ invoke__">range</span>(<span class="number">2</span>..=<span class="number">6</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, num); <span class="comment">// è¾“å‡º 2, 5</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é¦–å°¾å…ƒç´ </span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;First: &#123;:?&#125;&quot;</span>, set.<span class="title function_ invoke__">first</span>()); <span class="comment">// 2</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Last: &#123;:?&#125;&quot;</span>, set.<span class="title function_ invoke__">last</span>());   <span class="comment">// 8</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-äºŒå‰å †-BinaryHeap-lt-T-gt"><a href="#8-äºŒå‰å †-BinaryHeap-lt-T-gt" class="headerlink" title="8. äºŒå‰å † BinaryHeap&lt;T&gt;"></a>8. äºŒå‰å † BinaryHeap&lt;T&gt;</h2><p><code>BinaryHeap&lt;T&gt;</code> å®ç°ä¼˜å…ˆé˜Ÿåˆ—åŠŸèƒ½ã€‚</p>
<h3 id="ç‰¹ç‚¹-4"><a href="#ç‰¹ç‚¹-4" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul>
<li><strong>é»˜è®¤æ˜¯æœ€å¤§å †</strong></li>
<li>å¯é€šè¿‡ <code>Reverse()</code> åŒ…è£…æ”¹ä¸ºæœ€å°å †</li>
</ul>
<h3 id="åŸºæœ¬æ“ä½œ-4"><a href="#åŸºæœ¬æ“ä½œ-4" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::BinaryHeap;</span><br><span class="line"><span class="keyword">use</span> std::cmp::Reverse;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€å¤§å †</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">max_heap</span> = BinaryHeap::<span class="title function_ invoke__">new</span>();</span><br><span class="line">max_heap.<span class="title function_ invoke__">push</span>(<span class="number">10</span>);</span><br><span class="line">max_heap.<span class="title function_ invoke__">push</span>(<span class="number">5</span>);</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, max_heap.<span class="title function_ invoke__">pop</span>().<span class="title function_ invoke__">unwrap</span>()); <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€å°å †</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">min_heap</span> = BinaryHeap::<span class="title function_ invoke__">new</span>();</span><br><span class="line">min_heap.<span class="title function_ invoke__">push</span>(<span class="title function_ invoke__">Reverse</span>(<span class="number">10</span>));</span><br><span class="line">min_heap.<span class="title function_ invoke__">push</span>(<span class="title function_ invoke__">Reverse</span>(<span class="number">5</span>));</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, min_heap.<span class="title function_ invoke__">pop</span>().<span class="title function_ invoke__">unwrap</span>().<span class="number">0</span>); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>

<h3 id="å¸¸ç”¨æ–¹æ³•-7"><a href="#å¸¸ç”¨æ–¹æ³•-7" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h3><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
<th>è¿”å›ç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>new()</code></td>
<td>åˆ›å»ºç©ºå †</td>
<td><code>BinaryHeap&lt;T&gt;</code></td>
</tr>
<tr>
<td><code>from(vec)</code></td>
<td>ä» Vec æ„å»ºå †</td>
<td><code>BinaryHeap&lt;T&gt;</code></td>
</tr>
<tr>
<td><code>push(value)</code></td>
<td>æ’å…¥å…ƒç´ </td>
<td><code>()</code></td>
</tr>
<tr>
<td><code>pop()</code></td>
<td>å¼¹å‡ºæœ€å¤§å…ƒç´ </td>
<td><code>Option&lt;T&gt;</code></td>
</tr>
<tr>
<td><code>peek()</code></td>
<td>æŸ¥çœ‹æœ€å¤§å…ƒç´ </td>
<td><code>Option&lt;&amp;T&gt;</code></td>
</tr>
<tr>
<td><code>len() / is_empty()</code></td>
<td>é•¿åº¦&#x2F;ç©º</td>
<td><code>usize / bool</code></td>
</tr>
<tr>
<td><code>clear()</code></td>
<td>æ¸…ç©º</td>
<td><code>()</code></td>
</tr>
<tr>
<td><code>into_sorted_vec()</code></td>
<td>å‡åºå–å‡ºæ‰€æœ‰å…ƒç´ </td>
<td><code>Vec&lt;T&gt;</code></td>
</tr>
<tr>
<td><code>drain_sorted()</code></td>
<td>æŒ‰æ’åºè¿­ä»£å‡ºå…ƒç´ </td>
<td>è¿­ä»£å™¨</td>
</tr>
</tbody></table>
<h3 id="BinaryHeap-ç¤ºä¾‹"><a href="#BinaryHeap-ç¤ºä¾‹" class="headerlink" title="BinaryHeap ç¤ºä¾‹"></a>BinaryHeap ç¤ºä¾‹</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::BinaryHeap;</span><br><span class="line"><span class="keyword">use</span> std::cmp::Reverse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// æœ€å¤§å †ç¤ºä¾‹</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">heap</span> = BinaryHeap::<span class="title function_ invoke__">from</span>([<span class="number">10</span>, <span class="number">5</span>, <span class="number">20</span>, <span class="number">15</span>]);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Max: &#123;&#125;&quot;</span>, heap.<span class="title function_ invoke__">pop</span>().<span class="title function_ invoke__">unwrap</span>()); <span class="comment">// 20</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æœ€å°å †ç¤ºä¾‹ï¼ˆä½¿ç”¨ Reverseï¼‰</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">min_heap</span> = BinaryHeap::<span class="title function_ invoke__">from</span>([</span><br><span class="line">        <span class="title function_ invoke__">Reverse</span>(<span class="number">10</span>),</span><br><span class="line">        <span class="title function_ invoke__">Reverse</span>(<span class="number">5</span>),</span><br><span class="line">        <span class="title function_ invoke__">Reverse</span>(<span class="number">20</span>),</span><br><span class="line">    ]);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Min: &#123;&#125;&quot;</span>, min_heap.<span class="title function_ invoke__">pop</span>().<span class="title function_ invoke__">unwrap</span>().<span class="number">0</span>); <span class="comment">// 5</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¼˜å…ˆé˜Ÿåˆ—åº”ç”¨</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">pq</span> = BinaryHeap::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    pq.<span class="title function_ invoke__">push</span>((<span class="number">1</span>, <span class="string">&quot;Low&quot;</span>));</span><br><span class="line">    pq.<span class="title function_ invoke__">push</span>((<span class="number">10</span>, <span class="string">&quot;High&quot;</span>));</span><br><span class="line">    pq.<span class="title function_ invoke__">push</span>((<span class="number">5</span>, <span class="string">&quot;Medium&quot;</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Some</span>((priority, task)) = pq.<span class="title function_ invoke__">pop</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Task: &#123;&#125; (Priority: &#123;&#125;)&quot;</span>, task, priority);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é›†åˆé€‰æ‹©æŒ‡å—"><a href="#é›†åˆé€‰æ‹©æŒ‡å—" class="headerlink" title="é›†åˆé€‰æ‹©æŒ‡å—"></a>é›†åˆé€‰æ‹©æŒ‡å—</h2><table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>æ¨èé›†åˆ</th>
<th>ç†ç”±</th>
</tr>
</thead>
<tbody><tr>
<td>é€šç”¨æœ‰åºé›†åˆ</td>
<td><code>Vec&lt;T&gt;</code></td>
<td>ç®€å•é«˜æ•ˆï¼Œå¤§å¤šæ•°åœºæ™¯é¦–é€‰</td>
</tr>
<tr>
<td>åŒç«¯é˜Ÿåˆ—ï¼ˆFIFO&#x2F;LIFOï¼‰</td>
<td><code>VecDeque&lt;T&gt;</code></td>
<td>ä¸¤ç«¯é«˜æ•ˆæ“ä½œ</td>
</tr>
<tr>
<td>é”®å€¼å­˜å‚¨ï¼ˆæ— åºï¼‰</td>
<td><code>HashMap&lt;K,V&gt;</code></td>
<td>å¹³å‡ O(1) æŸ¥è¯¢</td>
</tr>
<tr>
<td>é”®å€¼å­˜å‚¨ï¼ˆæœ‰åºï¼‰</td>
<td><code>BTreeMap&lt;K,V&gt;</code></td>
<td>æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ŒO(log n) æŸ¥è¯¢</td>
</tr>
<tr>
<td>å»é‡é›†åˆï¼ˆæ— åºï¼‰</td>
<td><code>HashSet&lt;T&gt;</code></td>
<td>å¿«é€Ÿå»é‡å’Œå­˜åœ¨æ€§æ£€æŸ¥</td>
</tr>
<tr>
<td>å»é‡é›†åˆï¼ˆæœ‰åºï¼‰</td>
<td><code>BTreeSet&lt;T&gt;</code></td>
<td>æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼Œæœ‰åºéå†</td>
</tr>
<tr>
<td>ä¼˜å…ˆé˜Ÿåˆ—</td>
<td><code>BinaryHeap&lt;T&gt;</code></td>
<td>é«˜æ•ˆå–æœ€å¤§&#x2F;æœ€å°å€¼</td>
</tr>
<tr>
<td>é“¾è¡¨æ“ä½œ</td>
<td><code>LinkedList&lt;T&gt;</code></td>
<td>æå°‘ä½¿ç”¨ï¼Œé™¤éæ˜ç¡®éœ€è¦</td>
</tr>
</tbody></table>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li><strong>Vec</strong> æ˜¯æœ€å¸¸ç”¨çš„é›†åˆï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯</li>
<li><strong>HashMap&#x2F;BTreeMap</strong> ç”¨äºé”®å€¼å­˜å‚¨ï¼Œé€‰æ‹©å–å†³äºæ˜¯å¦éœ€è¦æœ‰åºæ€§</li>
<li><strong>HashSet&#x2F;BTreeSet</strong> ç”¨äºå»é‡å’Œé›†åˆæ“ä½œ</li>
<li><strong>VecDeque</strong> é€‚åˆåŒç«¯é˜Ÿåˆ—æ“ä½œ</li>
<li><strong>BinaryHeap</strong> å®ç°ä¼˜å…ˆé˜Ÿåˆ—åŠŸèƒ½</li>
<li><strong>LinkedList</strong> åº”é¿å…ä½¿ç”¨ï¼Œå®é™…æ€§èƒ½ä¸å¦‚ Vec&#x2F;VecDeque</li>
</ul>
]]></content>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustä¸­é”™è¯¯å¤„ç†æœºåˆ¶</title>
    <url>/2023/08/24/Rust%E4%B8%AD%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<p>Rust çš„é”™è¯¯å¤„ç†æ˜¯é€šè¿‡ <code>Result</code> ç±»å‹å’Œ <code>panic!</code> å®ä¸¤ä¸ªå±‚æ¬¡æ¥å®Œæˆçš„ï¼š</p>
<span id="more"></span>

<table>
<thead>
<tr>
<th>é”™è¯¯ç±»å‹</th>
<th>ç‰¹å¾</th>
<th>å¤„ç†æ–¹å¼</th>
</tr>
</thead>
<tbody><tr>
<td>å¯æ¢å¤é”™è¯¯</td>
<td>ç¨‹åºé€»è¾‘ä¸Šå¯ä»¥é¢„æœŸå¹¶å¤„ç†ï¼Œæ¯”å¦‚æ–‡ä»¶ä¸å­˜åœ¨ã€ç½‘ç»œè¶…æ—¶</td>
<td>ä½¿ç”¨ <code>Result&amp;lt;T, E&amp;gt;</code></td>
</tr>
<tr>
<td>ä¸å¯æ¢å¤é”™è¯¯</td>
<td>ç¨‹åºå‡ºç° bug æˆ–ä¸¥é‡é—®é¢˜ï¼Œæ— æ³•ç»§ç»­è¿è¡Œ</td>
<td>ä½¿ç”¨ <code>panic!</code> å®</td>
</tr>
<tr>
<td>å¯é€‰å€¼ç¼ºå¤±</td>
<td>ä¸€ä¸ªå€¼å¯èƒ½å­˜åœ¨ <code>Some(T)</code> æˆ–ä¸å­˜åœ¨ <code>None</code>ï¼Œé¿å…ç©ºæŒ‡é’ˆé—®é¢˜</td>
<td>ä½¿ç”¨ <code>Option&amp;lt;T&amp;gt;</code></td>
</tr>
</tbody></table>
<h2 id="å¯æ¢å¤é”™è¯¯ï¼ˆResult-lt-T-E-gt-ï¼‰"><a href="#å¯æ¢å¤é”™è¯¯ï¼ˆResult-lt-T-E-gt-ï¼‰" class="headerlink" title="å¯æ¢å¤é”™è¯¯ï¼ˆResult&lt;T, E&gt;ï¼‰"></a>å¯æ¢å¤é”™è¯¯ï¼ˆResult&lt;T, E&gt;ï¼‰</h2><p><code>Result</code> æ˜¯ä¸€ä¸ªæ³›å‹æšä¸¾ï¼Œå¼ºåˆ¶è°ƒç”¨è€…å¤„ç†æˆåŠŸå’Œå¤±è´¥ä¸¤ç§æƒ…å†µï¼ˆæ˜¯é›¶å¼€é”€çš„ï¼Œç”±ç¼–è¯‘å™¨é™æ€ä¿è¯å¿…é¡»å¤„ç†ï¼‰ï¼š</p>
<ul>
<li><code>T</code>ï¼šæˆåŠŸæ—¶è¿”å›çš„å€¼ç±»å‹ï¼›</li>
<li><code>E</code>ï¼šé”™è¯¯æ—¶è¿”å›çš„é”™è¯¯ç±»å‹ã€‚</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"><span class="keyword">use</span> std::io::Error;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">open_file</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;File, Error&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">file</span> = File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line">    <span class="keyword">match</span> file &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(f) =&gt; <span class="title function_ invoke__">Ok</span>(f),</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="title function_ invoke__">Err</span>(e),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¸¸ç”¨æ–¹æ³•"><a href="#å¸¸ç”¨æ–¹æ³•" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h3><h4 id="unwrap-å’Œ-expect"><a href="#unwrap-å’Œ-expect" class="headerlink" title="unwrap å’Œ expect"></a><code>unwrap</code> å’Œ <code>expect</code></h4><p>å¿«é€Ÿå¤„ç†é”™è¯¯ï¼Œå¤±è´¥æ—¶ä¼š panicï¼š</p>
<ul>
<li><code>unwrap()</code>ï¼šè‹¥ <code>Result</code> ä¸º <code>Ok(v)</code> åˆ™è¿”å› <code>v</code>ï¼›è‹¥ä¸º <code>Err(e)</code> åˆ™è§¦å‘ <code>panic!</code>ï¼ˆé€‚åˆ â€œç†è®ºä¸Šä¸å¯èƒ½å¤±è´¥â€ çš„åœºæ™¯ï¼‰ã€‚</li>
<li><code>expect(msg)</code>ï¼šåŠŸèƒ½ä¸ <code>unwrap</code> ç±»ä¼¼ï¼Œä½†å¯è‡ªå®šä¹‰ <code>panic!</code> çš„é”™è¯¯æ¶ˆæ¯ï¼ˆæ›´æ˜“è°ƒè¯•ï¼‰ã€‚</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::read_to_string;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// è‹¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œunwrapä¼š panic</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">content</span> = <span class="title function_ invoke__">read_to_string</span>(<span class="string">&quot;test.txt&quot;</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰ panic æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">content</span> = <span class="title function_ invoke__">read_to_string</span>(<span class="string">&quot;test.txt&quot;</span>).<span class="title function_ invoke__">expect</span>(<span class="string">&quot;è¯»å– test.txt å¤±è´¥&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é“¾å¼æ–¹æ³•"><a href="#é“¾å¼æ–¹æ³•" class="headerlink" title="é“¾å¼æ–¹æ³•"></a>é“¾å¼æ–¹æ³•</h4><p><code>Result</code> æä¾›äº†å¤§é‡é“¾å¼æ–¹æ³•ï¼Œç”¨äºçµæ´»åœ°å¤„ç†æˆåŠŸæˆ–å¤±è´¥åˆ†æ”¯ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>.is_ok()</code></td>
<td>æ˜¯å¦æ˜¯ <code>Ok</code></td>
</tr>
<tr>
<td><code>.is_err()</code></td>
<td>æ˜¯å¦æ˜¯ <code>Err</code></td>
</tr>
<tr>
<td><code>.ok()</code></td>
<td>å–å€¼ï¼Œè¿”å› <code>Option&amp;lt;T&amp;gt;</code></td>
</tr>
<tr>
<td><code>.err()</code></td>
<td>å–é”™è¯¯ï¼Œè¿”å› <code>Option&amp;lt;E&amp;gt;</code></td>
</tr>
<tr>
<td><code>.unwrap()</code></td>
<td>æˆåŠŸå–å€¼ Tï¼Œå¦åˆ™ panic</td>
</tr>
<tr>
<td><code>.expect(msg)</code></td>
<td>æˆåŠŸå–å€¼ Tï¼Œå¦åˆ™ panic å¹¶æ‰“å° msg</td>
</tr>
<tr>
<td><code>.unwrap_or(default)</code></td>
<td>å¤±è´¥åˆ™è¿”å›é»˜è®¤å€¼</td>
</tr>
<tr>
<td><code>.unwrap_or_else(f)</code></td>
<td>å¤±è´¥æ—¶æ‰§è¡Œå‡½æ•°ç”Ÿæˆé»˜è®¤å€¼</td>
</tr>
<tr>
<td><code>.map(f)</code></td>
<td>è‹¥æ˜¯ Okï¼Œåº”ç”¨å‡½æ•° <code>F(T) -&amp;gt; U</code> åˆ°å†…éƒ¨å€¼ï¼›å¦åˆ™è¿”å›åŸ Err</td>
</tr>
<tr>
<td><code>.map_err(f)</code></td>
<td>å¯¹ Err æ‰§è¡Œ map</td>
</tr>
<tr>
<td><code>.and_then(f)</code></td>
<td>è‹¥æ˜¯ Okï¼Œåº”ç”¨å‡½æ•° <code>F(T) -&amp;gt; Result&amp;lt;U, E&amp;gt;</code> åˆ°å†…éƒ¨å€¼ï¼›å¦åˆ™è¿”å›åŸ Err</td>
</tr>
<tr>
<td><code>.or_else(f)</code></td>
<td>å¯¹ Err æ‰§è¡Œ f</td>
</tr>
</tbody></table>
<h4 id="map-ä¸-unwrap-ç¤ºä¾‹"><a href="#map-ä¸-unwrap-ç¤ºä¾‹" class="headerlink" title="map ä¸ unwrap ç¤ºä¾‹"></a>map ä¸ unwrap ç¤ºä¾‹</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">parse_and_double</span>(vec: <span class="type">Vec</span>&lt;&amp;<span class="type">str</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">    vec.<span class="title function_ invoke__">into_iter</span>()</span><br><span class="line">        .<span class="title function_ invoke__">map</span>(|s| &#123;</span><br><span class="line">            s.parse::&lt;<span class="type">i32</span>&gt;()</span><br><span class="line">                .<span class="title function_ invoke__">map</span>(|n| (n * <span class="number">2</span>).<span class="title function_ invoke__">to_string</span>())</span><br><span class="line">                .<span class="title function_ invoke__">unwrap_or_else</span>(|_| s.<span class="title function_ invoke__">to_string</span>())</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_ invoke__">collect</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">test_parse_and_double</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">vec</span> = <span class="built_in">vec!</span>[<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;three&quot;</span>, <span class="string">&quot;4&quot;</span>];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">doubled</span> = <span class="title function_ invoke__">parse_and_double</span>(vec);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(doubled, <span class="built_in">vec!</span>[<span class="string">&quot;2&quot;</span>, <span class="string">&quot;4&quot;</span>, <span class="string">&quot;three&quot;</span>, <span class="string">&quot;8&quot;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é”™è¯¯ä¼ æ’­ï¼ˆ-è¿ç®—ç¬¦ï¼‰"><a href="#é”™è¯¯ä¼ æ’­ï¼ˆ-è¿ç®—ç¬¦ï¼‰" class="headerlink" title="é”™è¯¯ä¼ æ’­ï¼ˆ? è¿ç®—ç¬¦ï¼‰"></a>é”™è¯¯ä¼ æ’­ï¼ˆ<code>?</code> è¿ç®—ç¬¦ï¼‰</h3><p><code>?</code> æ˜¯ Rust ä¸­æœ€å¸¸ç”¨çš„é”™è¯¯ä¼ æ’­å·¥å…·ï¼š</p>
<ul>
<li>å¦‚æœæ˜¯ <code>Ok(t)</code>ï¼Œæå– <code>t</code>ï¼›</li>
<li>å¦‚æœæ˜¯ <code>Err(e)</code>ï¼Œæå‰è¿”å›å½“å‰å‡½æ•°ï¼Œå¹¶å°†é”™è¯¯å‘ä¸Šä¼ é€’ã€‚</li>
</ul>
<h4 id="æ–‡ä»¶è¯»å†™ç¤ºä¾‹"><a href="#æ–‡ä»¶è¯»å†™ç¤ºä¾‹" class="headerlink" title="æ–‡ä»¶è¯»å†™ç¤ºä¾‹"></a>æ–‡ä»¶è¯»å†™ç¤ºä¾‹</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"><span class="keyword">use</span> std::io::&#123;<span class="keyword">self</span>, Read&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">read_username</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">String</span>, io::Error&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;username.txt&quot;</span>)?.<span class="title function_ invoke__">read_to_string</span>(&amp;<span class="keyword">mut</span> s)?;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰ä»·äº</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">read_username_verbose</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">String</span>, io::Error&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">s</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">f</span> = <span class="keyword">match</span> File::<span class="title function_ invoke__">open</span>(<span class="string">&quot;username.txt&quot;</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(file) =&gt; file,</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(e),</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">match</span> f.<span class="title function_ invoke__">read_to_string</span>(&amp;<span class="keyword">mut</span> s) &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(_) =&gt; <span class="title function_ invoke__">Ok</span>(s),</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="title function_ invoke__">Err</span>(e),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é”™è¯¯ç±»å‹è‡ªåŠ¨è½¬æ¢"><a href="#é”™è¯¯ç±»å‹è‡ªåŠ¨è½¬æ¢" class="headerlink" title="é”™è¯¯ç±»å‹è‡ªåŠ¨è½¬æ¢"></a>é”™è¯¯ç±»å‹è‡ªåŠ¨è½¬æ¢</h4><p>å½“ä½¿ç”¨ <code>?</code> æ—¶ï¼Œé”™è¯¯ç±»å‹ä¼šè‡ªåŠ¨é€šè¿‡ <code>From</code> trait è½¬æ¢ã€‚è¿™æ„å‘³ç€å¯ä»¥ç»„åˆä¸åŒæ¥æºçš„é”™è¯¯ï¼Œåªè¦èƒ½è¢«è½¬æ¢åˆ°åŒä¸€ä¸ªé”™è¯¯ç±»å‹ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::num::ParseIntError;</span><br><span class="line"><span class="keyword">use</span> std::io;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">MyError</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Io</span>(io::Error),</span><br><span class="line">    <span class="title function_ invoke__">Parse</span>(ParseIntError),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">From</span>&lt;io::Error&gt; <span class="keyword">for</span> <span class="title class_">MyError</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">from</span>(e: io::Error) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        MyError::<span class="title function_ invoke__">Io</span>(e)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">From</span>&lt;ParseIntError&gt; <span class="keyword">for</span> <span class="title class_">MyError</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">from</span>(e: ParseIntError) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        MyError::<span class="title function_ invoke__">Parse</span>(e)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">read_and_parse</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">i32</span>, MyError&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">content</span> = std::fs::<span class="title function_ invoke__">read_to_string</span>(<span class="string">&quot;data.txt&quot;</span>)?;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">num</span> = content.<span class="title function_ invoke__">trim</span>().<span class="title function_ invoke__">parse</span>()?;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(num)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Option-æšä¸¾ï¼šå¤„ç†â€ç©ºå€¼â€"><a href="#Option-æšä¸¾ï¼šå¤„ç†â€ç©ºå€¼â€" class="headerlink" title="Option æšä¸¾ï¼šå¤„ç†â€ç©ºå€¼â€"></a><code>Option</code> æšä¸¾ï¼šå¤„ç†â€ç©ºå€¼â€</h3><p><code>Option</code> è™½ä¸ç›´æ¥è¡¨ç¤ºâ€é”™è¯¯â€ï¼Œä½†ç”¨äºå¤„ç†â€å¯èƒ½æ²¡æœ‰å€¼â€çš„åœºæ™¯ï¼ˆé¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼‰ï¼›å¯è®¤ä¸º <code>Option</code> æ˜¯ <code>Result</code> çš„ä¸€ä¸ªç®€åŒ–ç‰ˆæœ¬ï¼ˆé”™è¯¯ç±»å‹å›ºå®šä¸º <code>()</code>ï¼‰ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Option</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">Some</span>(T), <span class="comment">// æœ‰å€¼ï¼šåŒ…å«å…·ä½“å€¼ï¼ˆç±»å‹ä¸º Tï¼‰</span></span><br><span class="line">    <span class="literal">None</span>,    <span class="comment">// æ— å€¼ï¼šè¡¨ç¤º&quot;ç©º&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Option-çš„å¸¸ç”¨æ–¹æ³•"><a href="#Option-çš„å¸¸ç”¨æ–¹æ³•" class="headerlink" title="Option çš„å¸¸ç”¨æ–¹æ³•"></a>Option çš„å¸¸ç”¨æ–¹æ³•</h4><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>is_some() / is_none()</code></td>
<td>æ£€æŸ¥æ˜¯å¦æœ‰å€¼</td>
</tr>
<tr>
<td><code>unwrap()</code></td>
<td>ç›´æ¥å–å€¼ï¼ˆè‹¥ä¸º None åˆ™ panicï¼‰</td>
</tr>
<tr>
<td><code>unwrap_or(default)</code></td>
<td>è‹¥ä¸º None è¿”å›é»˜è®¤å€¼</td>
</tr>
<tr>
<td><code>unwrap_or_else(f)</code></td>
<td>è‹¥ä¸º None æ‰§è¡Œå‡½æ•°è¿”å›å€¼</td>
</tr>
<tr>
<td><code>map(f)</code></td>
<td>æ˜ å°„ Some ä¸­çš„å€¼</td>
</tr>
<tr>
<td><code>and_then(f)</code></td>
<td>é“¾å¼æ“ä½œï¼Œf è¿”å› Option</td>
</tr>
<tr>
<td><code>ok_or(err)</code></td>
<td>è½¬æ¢ä¸º Result</td>
</tr>
<tr>
<td><code>filter(pred)</code></td>
<td>æ¡ä»¶ç­›é€‰</td>
</tr>
</tbody></table>
<h4 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">find_user</span>(id: <span class="type">u32</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> id == <span class="number">1</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(<span class="string">&quot;Alice&quot;</span>.<span class="title function_ invoke__">to_string</span>()) <span class="comment">// æ‰¾åˆ°ç”¨æˆ·</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="literal">None</span> <span class="comment">// æœªæ‰¾åˆ°ç”¨æˆ·</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// æ–¹å¼ 1ï¼šmatch åŒ¹é…</span></span><br><span class="line">    <span class="keyword">match</span> <span class="title function_ invoke__">find_user</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">Some</span>(name) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;æ‰¾åˆ°ç”¨æˆ·ï¼š&#123;&#125;&quot;</span>, name),</span><br><span class="line">        <span class="literal">None</span> =&gt; <span class="built_in">println!</span>(<span class="string">&quot;ç”¨æˆ·ä¸å­˜åœ¨&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ–¹å¼ 2ï¼š? è¿ç®—ç¬¦ï¼ˆéœ€å‡½æ•°è¿”å› Optionï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(user) = <span class="title function_ invoke__">find_user</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;ç”¨æˆ·ï¼š&#123;&#125;&quot;</span>, user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ–¹å¼ 3ï¼šmap é“¾å¼å¤„ç†</span></span><br><span class="line">    <span class="title function_ invoke__">find_user</span>(<span class="number">1</span>)</span><br><span class="line">        .<span class="title function_ invoke__">map</span>(|name| <span class="built_in">println!</span>(<span class="string">&quot;æ‰¾åˆ°ç”¨æˆ·ï¼š&#123;&#125;&quot;</span>, name))</span><br><span class="line">        .<span class="title function_ invoke__">unwrap_or_else</span>(|| <span class="built_in">println!</span>(<span class="string">&quot;ç”¨æˆ·ä¸å­˜åœ¨&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è‡ªå®šä¹‰é”™è¯¯ç±»å‹"><a href="#è‡ªå®šä¹‰é”™è¯¯ç±»å‹" class="headerlink" title="è‡ªå®šä¹‰é”™è¯¯ç±»å‹"></a>è‡ªå®šä¹‰é”™è¯¯ç±»å‹</h3><h4 id="åŸºæœ¬è¦æ±‚"><a href="#åŸºæœ¬è¦æ±‚" class="headerlink" title="åŸºæœ¬è¦æ±‚"></a>åŸºæœ¬è¦æ±‚</h4><p>è‡ªå®šä¹‰é”™è¯¯ç±»å‹éœ€è¦æ»¡è¶³ï¼š</p>
<ul>
<li>å¿…é¡»å®ç° <code>std::error::Error</code> traitï¼šä½¿å…¶æˆä¸ºæ ‡å‡†é”™è¯¯ç±»å‹ï¼›</li>
<li>å¿…é¡»å®ç° <code>std::fmt::Display</code> traitï¼šä»¥æä¾›ç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯ã€‚</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::fmt;</span><br><span class="line"><span class="keyword">use</span> std::error::Error;</span><br><span class="line"><span class="keyword">use</span> std::io;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰é”™è¯¯æšä¸¾ï¼šåŒ…å«ä¸¤ç§é”™è¯¯ç±»å‹</span></span><br><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">MyError</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Io</span>(io::Error),           <span class="comment">// åŒ…è£… IO é”™è¯¯</span></span><br><span class="line">    <span class="title function_ invoke__">Parse</span>(<span class="type">String</span>),           <span class="comment">// è§£æé”™è¯¯ï¼ˆæºå¸¦é”™è¯¯ä¿¡æ¯ï¼‰</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç° Display traitï¼šå®šä¹‰é”™è¯¯çš„ç”¨æˆ·å¯è§ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">fmt</span>::Display <span class="keyword">for</span> <span class="title class_">MyError</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fmt</span>(&amp;<span class="keyword">self</span>, f: &amp;<span class="keyword">mut</span> fmt::Formatter&lt;<span class="symbol">&#x27;_</span>&gt;) <span class="punctuation">-&gt;</span> fmt::<span class="type">Result</span> &#123;</span><br><span class="line">        <span class="keyword">match</span> <span class="keyword">self</span> &#123;</span><br><span class="line">            MyError::<span class="title function_ invoke__">Io</span>(err) =&gt; <span class="built_in">write!</span>(f, <span class="string">&quot;IO error: &#123;&#125;&quot;</span>, err),</span><br><span class="line">            MyError::<span class="title function_ invoke__">Parse</span>(msg) =&gt; <span class="built_in">write!</span>(f, <span class="string">&quot;Parse error: &#123;&#125;&quot;</span>, msg),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç° Error traitï¼šæ ‡è®°ä¸ºæ ‡å‡†é”™è¯¯ç±»å‹</span></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Error</span> <span class="keyword">for</span> <span class="title class_">MyError</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å®ç°-From"><a href="#å®ç°-From" class="headerlink" title="å®ç° From"></a>å®ç° <code>From</code></h4><p>ä¸ºé”™è¯¯ç±»å‹å®ç° <code>From</code>ï¼Œè¿™æ ·å°±èƒ½ä½¿ç”¨ <code>?</code> è¿ç®—ç¬¦è‡ªåŠ¨è½¬æ¢é”™è¯¯ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">From</span>&lt;std::io::Error&gt; <span class="keyword">for</span> <span class="title class_">MyError</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">from</span>(err: std::io::Error) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        MyError::<span class="title function_ invoke__">Io</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">From</span>&lt;std::num::ParseIntError&gt; <span class="keyword">for</span> <span class="title class_">MyError</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">from</span>(err: std::num::ParseIntError) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        MyError::<span class="title function_ invoke__">Parse</span>(err.<span class="title function_ invoke__">to_string</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">read_number_from_file</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;<span class="type">i32</span>, MyError&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">content</span> = std::fs::<span class="title function_ invoke__">read_to_string</span>(<span class="string">&quot;data.txt&quot;</span>)?;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">num</span> = content.<span class="title function_ invoke__">trim</span>().<span class="title function_ invoke__">parse</span>()?;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(num)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ä¸‰æ–¹åº“ç®€åŒ–é”™è¯¯å®šä¹‰"><a href="#ä¸‰æ–¹åº“ç®€åŒ–é”™è¯¯å®šä¹‰" class="headerlink" title="ä¸‰æ–¹åº“ç®€åŒ–é”™è¯¯å®šä¹‰"></a>ä¸‰æ–¹åº“ç®€åŒ–é”™è¯¯å®šä¹‰</h4><p>æ‰‹å†™ <code>Display</code>ã€<code>From</code> å¾ˆç¹çï¼ŒRust ç¤¾åŒºæä¾›äº†ä¸¤ä¸ªå¸¸ç”¨åº“ã€‚</p>
<h5 id="thiserrorï¼ˆ-derive-Error-ï¼‰-å®šä¹‰ç»“æ„åŒ–é”™è¯¯"><a href="#thiserrorï¼ˆ-derive-Error-ï¼‰-å®šä¹‰ç»“æ„åŒ–é”™è¯¯" class="headerlink" title="thiserrorï¼ˆ#[derive(Error)]ï¼‰- å®šä¹‰ç»“æ„åŒ–é”™è¯¯"></a><code>thiserror</code>ï¼ˆ<code>#[derive(Error)]</code>ï¼‰- å®šä¹‰ç»“æ„åŒ–é”™è¯¯</h5><ul>
<li><code>#[derive(Error, Debug)]</code>ï¼šè‡ªåŠ¨ç”Ÿæˆ <code>Error</code> å’Œ <code>Debug</code> trait çš„å®ç°ã€‚</li>
<li><code>#[error(&quot;æ¶ˆæ¯æ¨¡æ¿&quot;)]</code>ï¼šå®šä¹‰ <code>Display</code> trait çš„è¾“å‡ºæ ¼å¼ã€‚</li>
<li><code>#[from]</code>ï¼šè‡ªåŠ¨å®ç° <code>From&amp;lt;T&amp;gt;</code> traitï¼ˆ<code>T</code> æ˜¯å­—æ®µç±»å‹ï¼‰ï¼Œå…è®¸é€šè¿‡ <code>?</code> è¿ç®—ç¬¦å°† <code>T</code> ç±»å‹çš„é”™è¯¯è‡ªåŠ¨è½¬æ¢ä¸ºå½“å‰è‡ªå®šä¹‰é”™è¯¯ã€‚</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> thiserror::Error;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug, Error)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">enum</span> <span class="title class_">MyError</span> &#123;</span><br><span class="line">    <span class="meta">#[error(<span class="string">&quot;IO error: &#123;0&#125;&quot;</span>)]</span></span><br><span class="line">    <span class="title function_ invoke__">Io</span>(<span class="meta">#[from]</span> std::io::Error),</span><br><span class="line">    </span><br><span class="line">    <span class="meta">#[error(<span class="string">&quot;Parse error: &#123;0&#125;&quot;</span>)]</span></span><br><span class="line">    <span class="title function_ invoke__">Parse</span>(<span class="meta">#[from]</span> std::num::ParseIntError),</span><br><span class="line">    </span><br><span class="line">    <span class="meta">#[error(<span class="string">&quot;Not found&quot;</span>)]</span></span><br><span class="line">    NotFound,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="anyhow-ç®€åŒ–ä¸Šå±‚é”™è¯¯å¤„ç†"><a href="#anyhow-ç®€åŒ–ä¸Šå±‚é”™è¯¯å¤„ç†" class="headerlink" title="anyhow - ç®€åŒ–ä¸Šå±‚é”™è¯¯å¤„ç†"></a><code>anyhow</code> - ç®€åŒ–ä¸Šå±‚é”™è¯¯å¤„ç†</h5><ul>
<li><code>anyhow::Result&amp;lt;T&amp;gt;</code> å®é™…æ˜¯ <code>Result&amp;lt;T, anyhow::Error&amp;gt;</code></li>
<li>å¯å®¹çº³ä»»ä½•å®ç° <code>Error</code> trait çš„ç±»å‹ï¼Œæ— éœ€æ‰‹åŠ¨è½¬æ¢</li>
<li><code>context</code> æ–¹æ³•ä¼šå°†åŸå§‹é”™è¯¯ï¼Œå¹¶æ·»åŠ é¢å¤–æè¿°ï¼Œä¾¿äºè¿½è¸ªé”™è¯¯å‘ç”Ÿçš„åœºæ™¯ã€‚</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> anyhow::&#123;<span class="type">Result</span>, Context&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°è¿”å› anyhow::Errorï¼Œå¯å®¹çº³ä»»ä½•å®ç° Error trait çš„ç±»å‹</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">test_anyhow</span>() <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="title function_ invoke__">test_my_error</span>()</span><br><span class="line">        .<span class="title function_ invoke__">context</span>(<span class="string">&quot;test failed&quot;</span>)?; <span class="comment">// ä¸ºé”™è¯¯æ·»åŠ ä¸Šä¸‹æ–‡</span></span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä¸å¯æ¢å¤é”™è¯¯ï¼ˆpanic-ï¼‰"><a href="#ä¸å¯æ¢å¤é”™è¯¯ï¼ˆpanic-ï¼‰" class="headerlink" title="ä¸å¯æ¢å¤é”™è¯¯ï¼ˆpanic!ï¼‰"></a>ä¸å¯æ¢å¤é”™è¯¯ï¼ˆpanic!ï¼‰</h2><p>å½“ç¨‹åºé‡åˆ°ä¸å¯æ¢å¤çš„é”™è¯¯ï¼ˆå¦‚è¿åå†…å­˜å®‰å…¨ã€é€»è¾‘æ–­è¨€å¤±è´¥ï¼‰æ—¶ï¼Œä½¿ç”¨ <code>panic!</code> å®è§¦å‘ç¨‹åºç»ˆæ­¢ã€‚é»˜è®¤ä¼šå¯¼è‡´ç¨‹åºç»ˆæ­¢ï¼Œä½†åœ¨æŸäº›åœºæ™¯ä¸‹ï¼ˆå¦‚éš”ç¦»ç¬¬ä¸‰æ–¹åº“çš„å´©æºƒã€å®ç°å®¹é”™æœºåˆ¶ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦â€å®‰å…¨æ•è·â€ <code>panic</code> ä»¥é¿å…ç¨‹åºæ•´ä½“å´©æºƒã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">divide</span>(a: <span class="type">i32</span>, b: <span class="type">i32</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="built_in">panic!</span>(<span class="string">&quot;é™¤æ•°ä¸èƒ½ä¸º 0&quot;</span>); <span class="comment">// é€»è¾‘é”™è¯¯ï¼šä¸å…è®¸é™¤ 0</span></span><br><span class="line">    &#125;</span><br><span class="line">    a / b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Panic-çš„æ‰§è¡Œæµç¨‹"><a href="#Panic-çš„æ‰§è¡Œæµç¨‹" class="headerlink" title="Panic çš„æ‰§è¡Œæµç¨‹"></a>Panic çš„æ‰§è¡Œæµç¨‹</h3><p>å½“ <code>panic!</code> è¢«è§¦å‘æ—¶ï¼ŒRust é»˜è®¤ä¼šæ‰§è¡Œâ€æ ˆå±•å¼€â€ï¼ˆå¯åœ¨ <code>Cargo.toml</code> ä¸­æ·»åŠ  <code>panic = &quot;abort&quot;</code> ç›´æ¥ç»ˆæ­¢ï¼Œä¸è¿›è¡Œå±•å¼€ï¼‰ï¼š</p>
<ul>
<li>ä» <code>panic!</code> å‘ç”Ÿçš„ä½ç½®å¼€å§‹ï¼Œæ²¿ç€è°ƒç”¨æ ˆå‘ä¸Šå›æº¯ã€‚</li>
<li>ä¾æ¬¡è°ƒç”¨æ¯ä¸ªæ ˆå¸§ä¸­å±€éƒ¨å˜é‡çš„ææ„å‡½æ•°ï¼ˆæ¸…ç†èµ„æºï¼Œå¦‚å…³é—­æ–‡ä»¶ã€é‡Šæ”¾é”ç­‰ï¼‰ã€‚</li>
<li>æœ€ç»ˆæ‰“å°é”™è¯¯ä¿¡æ¯ï¼ˆåŒ…å« <code>panic!</code> çš„ä½ç½®å’Œæ¶ˆæ¯ï¼‰å¹¶ç»ˆæ­¢ç¨‹åºã€‚</li>
</ul>
<p>è¿™ç§è¡Œä¸ºä¿è¯äº†â€èµ„æºå®‰å…¨â€ â€”â€” å³ä½¿ç¨‹åºå´©æºƒï¼Œä¹Ÿä¸ä¼šæ³„éœ²èµ„æºã€‚</p>
<h3 id="catch-unwind"><a href="#catch-unwind" class="headerlink" title="catch_unwind"></a><code>catch_unwind</code></h3><p><code>catch_unwind</code> æ¥æ”¶ä¸€ä¸ªé—­åŒ…ä½œä¸ºå‚æ•°ï¼Œè¿”å› <code>Result&lt;(), Box&lt;dyn Any + Send&gt;&gt;</code>ï¼š</p>
<ul>
<li>è‹¥é—­åŒ…æ‰§è¡Œä¸­æœªå‘ç”Ÿ <code>panic</code>ï¼Œè¿”å› <code>Ok(())</code>ã€‚</li>
<li>è‹¥å‘ç”Ÿ <code>panic</code>ï¼Œè¿”å› <code>Err(cause)</code>ï¼Œå…¶ä¸­ <code>cause</code> æ˜¯ <code>panic!</code> ä¼ é€’çš„å€¼ï¼ˆåŒ…è£…ä¸º <code>Box&lt;dyn Any + Send&gt;</code>ï¼‰ã€‚</li>
</ul>
<h4 id="åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹"><a href="#åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹"></a>åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::panic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// æ•è·é—­åŒ…ä¸­çš„ panic</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = panic::<span class="title function_ invoke__">catch_unwind</span>(|| &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;æ‰§è¡Œå¯èƒ½ panic çš„ä»£ç &quot;</span>);</span><br><span class="line">        <span class="built_in">panic!</span>(<span class="string">&quot;å‘ç”Ÿé”™è¯¯ï¼&quot;</span>); <span class="comment">// è§¦å‘ panic</span></span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤„ç†æ•è·ç»“æœ</span></span><br><span class="line">    <span class="keyword">match</span> result &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(_) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;æœªå‘ç”Ÿ panic&quot;</span>),</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(cause) =&gt; &#123;</span><br><span class="line">            <span class="comment">// å°† cause è½¬æ¢ä¸ºå…·ä½“ç±»å‹ï¼ˆé€šå¸¸æ˜¯ &amp;str æˆ– Stringï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(msg) = cause.downcast_ref::&lt;&amp;<span class="type">str</span>&gt;() &#123;</span><br><span class="line">                <span class="built_in">println!</span>(<span class="string">&quot;æ•è·åˆ° panicï¼š&#123;&#125;&quot;</span>, msg);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(msg) = cause.downcast_ref::&lt;<span class="type">String</span>&gt;() &#123;</span><br><span class="line">                <span class="built_in">println!</span>(<span class="string">&quot;æ•è·åˆ° panicï¼š&#123;&#125;&quot;</span>, msg);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">println!</span>(<span class="string">&quot;æ•è·åˆ°æœªçŸ¥ç±»å‹çš„ panic&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="catch-unwind-çš„é™åˆ¶"><a href="#catch-unwind-çš„é™åˆ¶" class="headerlink" title="catch_unwind çš„é™åˆ¶"></a><code>catch_unwind</code> çš„é™åˆ¶</h4><p><code>catch_unwind</code> å¹¶éä¸‡èƒ½ï¼Œå­˜åœ¨ä»¥ä¸‹å…³é”®é™åˆ¶ï¼š</p>
<ul>
<li><strong>ä»…èƒ½æ•è·â€æ ˆå±•å¼€â€çš„ panic</strong>ï¼šè‹¥ç¨‹åºé…ç½®ä¸º <code>panic = &quot;abort&quot;</code>ï¼Œ<code>catch_unwind</code> æ— æ³•æ•è·ï¼ˆå› ä¸ºä¸ä¼šè§¦å‘æ ˆå±•å¼€ï¼‰ã€‚</li>
<li><strong>æ— æ³•æ•è·æ‰€æœ‰ç»ˆæ­¢æƒ…å†µ</strong>ï¼šå¦‚è°ƒç”¨ <code>std::process::abort()</code>ã€æ“ä½œç³»ç»Ÿä¿¡å·ï¼ˆå¦‚ <code>SIGKILL</code>ï¼‰å¯¼è‡´çš„ç»ˆæ­¢ï¼Œ<code>catch_unwind</code> æ— æ•ˆã€‚</li>
<li><strong>é—­åŒ…éœ€æ»¡è¶³ <code>Send</code> çº¦æŸ</strong>ï¼š<code>catch_unwind</code> çš„é—­åŒ…å‚æ•°è¦æ±‚ <code>FnOnce() + Send</code>ï¼Œè¿™æ„å‘³ç€é—­åŒ…ä¸­ä¸èƒ½åŒ…å«é <code>Send</code> ç±»å‹ï¼ˆå¦‚ <code>Rc</code>ã€<code>RefCell</code> ç­‰çº¿ç¨‹ä¸å®‰å…¨ç±»å‹ï¼‰ã€‚</li>
<li><strong>ç¨‹åºçŠ¶æ€å¯èƒ½ä¸ç¨³å®š</strong>ï¼š<code>panic</code> å‘ç”Ÿæ—¶ï¼Œæ ˆå±•å¼€ä¼šæ¸…ç†å±€éƒ¨èµ„æºï¼Œä½†å…¨å±€çŠ¶æ€ã€å…±äº«èµ„æºå¯èƒ½å¤„äºä¸ä¸€è‡´çŠ¶æ€ï¼ˆå¦‚éƒ¨åˆ†æ›´æ–°çš„ç¼“å­˜ï¼‰ã€‚æ•è· <code>panic</code> åéœ€è°¨æ…å¤„ç†ï¼Œé¿å…ä¾èµ–ä¸ç¨³å®šçŠ¶æ€ã€‚</li>
</ul>
<h4 id="æœ‰æ•ˆè½½è·-Payload"><a href="#æœ‰æ•ˆè½½è·-Payload" class="headerlink" title="æœ‰æ•ˆè½½è· (Payload)"></a>æœ‰æ•ˆè½½è· (Payload)</h4><p><code>panic!()</code> å¯ä»¥æºå¸¦ <code>&amp;&#39;static str</code> æˆ– <code>String</code> ç­‰ä»»æ„ <code>Any + Send</code> ç±»å‹ä½œä¸º payloadã€‚æ•è·åå¯ä»¥å°è¯• <code>downcast_ref</code> æ¥è¯»å–æ¶ˆæ¯ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::panic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Err</span>(payload) = panic::<span class="title function_ invoke__">catch_unwind</span>(|| <span class="built_in">panic!</span>(<span class="string">&quot;oh no&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(s) = payload.downcast_ref::&lt;&amp;<span class="type">str</span>&gt;() &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;&amp;str payload: &#123;&#125;&quot;</span>, s);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(s) = payload.downcast_ref::&lt;<span class="type">String</span>&gt;() &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;String payload: &#123;&#125;&quot;</span>, s);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;æœªçŸ¥ payload ç±»å‹&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="èµ„æºä¸ä¸å˜å¼"><a href="#èµ„æºä¸ä¸å˜å¼" class="headerlink" title="èµ„æºä¸ä¸å˜å¼"></a>èµ„æºä¸ä¸å˜å¼</h4><p>å½“çº¿ç¨‹åœ¨æŒæœ‰ <code>Mutex</code> æ—¶ panicï¼Œè¯¥ <code>Mutex</code> ä¼šè¢«æ ‡è®°ä¸ºâ€poisonedâ€ï¼ˆæ±¡æŸ“ï¼‰ã€‚éšå <code>lock()</code> ä¼šè¿”å› <code>PoisonError</code>ï¼Œè¡¨ç¤ºéœ€è¦å°å¿ƒå¤„ç†å…±äº«çŠ¶æ€å¯èƒ½å¤„äºä¸ä¸€è‡´çŠ¶æ€ã€‚</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::sync::Mutex;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">m</span> = Mutex::<span class="title function_ invoke__">new</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">// çº¿ç¨‹ panic é€ æˆ poison çš„ç¤ºä¾‹è¯·å‚è§æ–‡æ¡£</span></span><br><span class="line"><span class="keyword">match</span> m.<span class="title function_ invoke__">lock</span>() &#123;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(<span class="keyword">mut</span> guard) =&gt; *guard += <span class="number">1</span>,</span><br><span class="line">    <span class="title function_ invoke__">Err</span>(poisoned) =&gt; &#123;</span><br><span class="line">        <span class="comment">// å–å›é”ä»ç„¶å¯ç”¨çš„æ•°æ®ï¼Œä½†çŸ¥é“å®ƒå¯èƒ½ä¸ä¸€è‡´</span></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">guard</span> = poisoned.<span class="title function_ invoke__">into_inner</span>();</span><br><span class="line">        *guard += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li>**<code>Result&amp;lt;T, E&amp;gt;</code>**ï¼šç”¨äºå¤„ç†å¯æ¢å¤é”™è¯¯ï¼Œé€šè¿‡ <code>match</code>ã€<code>?</code>ã€é“¾å¼æ–¹æ³•çµæ´»å¤„ç†</li>
<li>**<code>Option&amp;lt;T&amp;gt;</code>**ï¼šç”¨äºå¤„ç†å¯èƒ½ç¼ºå¤±çš„å€¼ï¼Œé¿å…ç©ºæŒ‡é’ˆé—®é¢˜</li>
<li><strong><code>?</code> è¿ç®—ç¬¦</strong>ï¼šæœ€ç®€æ´çš„é”™è¯¯ä¼ æ’­æ–¹å¼ï¼Œé…åˆ <code>From</code> trait å®ç°è‡ªåŠ¨é”™è¯¯è½¬æ¢</li>
<li><strong>è‡ªå®šä¹‰é”™è¯¯ç±»å‹</strong>ï¼šå®ç° <code>Error</code> å’Œ <code>Display</code> traitï¼Œæ¨èä½¿ç”¨ <code>thiserror</code> åº“ç®€åŒ–ä»£ç </li>
<li>**<code>panic!</code>**ï¼šå¤„ç†ä¸å¯æ¢å¤é”™è¯¯ï¼Œé€šè¿‡æ ˆå±•å¼€ä¿è¯èµ„æºå®‰å…¨</li>
<li>**<code>catch_unwind</code>**ï¼šåœ¨ç‰¹å®šåœºæ™¯ï¼ˆå¦‚éš”ç¦»ç¬¬ä¸‰æ–¹åº“ï¼‰æ•è· panicï¼Œä½†éœ€æ³¨æ„å…¶é™åˆ¶</li>
</ul>
]]></content>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustå¤šçº¿ç¨‹ç¼–ç¨‹ä¹‹Threadä¸Channel</title>
    <url>/2025/04/30/Rust%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B%E4%B9%8BThread%E4%B8%8EChannel/</url>
    <content><![CDATA[<h2 id="Rust-å¤šçº¿ç¨‹ç¼–ç¨‹ä¹‹-Thread-ä¸-Channel"><a href="#Rust-å¤šçº¿ç¨‹ç¼–ç¨‹ä¹‹-Thread-ä¸-Channel" class="headerlink" title="Rust å¤šçº¿ç¨‹ç¼–ç¨‹ä¹‹ Thread ä¸ Channel"></a>Rust å¤šçº¿ç¨‹ç¼–ç¨‹ä¹‹ Thread ä¸ Channel</h2><p>Rust åˆ©ç”¨æ‰€æœ‰æƒï¼ˆOwnershipï¼‰ç³»ç»Ÿåœ¨ç¼–è¯‘æ—¶ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä»æ ¹æœ¬ä¸Šæœç»æ•°æ®ç«äº‰ï¼ˆdata raceï¼‰ã€‚æœ¬æ–‡æ•´ç†å¹¶è¡¥å……äº†åŸæ–‡å…³äº <code>std::thread</code> ä¸ <code>std::sync::mpsc</code>ï¼ˆChannelï¼‰ çš„ç”¨æ³•ã€é”™è¯¯å¤„ç†ã€ä»¥åŠå¤šæ¶ˆè´¹è€… &#x2F; å¹¿æ’­ç­‰å®æˆ˜æ¨¡å¼ä¸ç¤ºä¾‹ã€‚</p>
<span id="more"></span>

<h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ul>
<li>çº¿ç¨‹æ¨¡å‹ä¸æ‰€æœ‰æƒ</li>
<li><code>std::thread</code>ï¼šåˆ›å»ºä¸ç®¡ç†çº¿ç¨‹</li>
<li>çº¿ç¨‹é—´é€šä¿¡ï¼š<code>std::sync::mpsc</code></li>
<li>é”™è¯¯å¤„ç†ï¼ˆ<code>send</code> &#x2F; <code>recv</code>ï¼‰</li>
<li>å¤šæ¶ˆè´¹è€…ä¸å¹¿æ’­æ¨¡å¼</li>
<li>ä½¿ç”¨ <code>crossbeam-channel</code> çš„è¿›é˜¶ç¤ºä¾‹</li>
<li>å°ç»“ä¸å‚è€ƒ</li>
</ul>
<hr>
<h2 id="çº¿ç¨‹æ¨¡å‹ä¸æ‰€æœ‰æƒ"><a href="#çº¿ç¨‹æ¨¡å‹ä¸æ‰€æœ‰æƒ" class="headerlink" title="çº¿ç¨‹æ¨¡å‹ä¸æ‰€æœ‰æƒ"></a>çº¿ç¨‹æ¨¡å‹ä¸æ‰€æœ‰æƒ</h2><p>Rust æ ‡å‡†åº“é‡‡ç”¨ 1:1 çº¿ç¨‹æ¨¡å‹ï¼ˆæ¯ä¸ª Rust çº¿ç¨‹å¯¹åº”ä¸€ä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼‰ã€‚é€šè¿‡æ‰€æœ‰æƒä¸ç±»å‹ç³»ç»Ÿï¼ŒRust åœ¨ç¼–è¯‘æœŸå°±èƒ½é˜²æ­¢æ•°æ®ç«äº‰ï¼Œå‡å°‘è¿è¡Œæ—¶åŒæ­¥é”™è¯¯ã€‚</p>
<p>è¦æ³¨æ„ï¼šå¦‚æœåœ¨æ–°çº¿ç¨‹ä¸­ä½¿ç”¨ä¸»çº¿ç¨‹çš„å˜é‡ï¼Œå¿…é¡»å°†è¿™äº›å˜é‡çš„æ‰€æœ‰æƒç§»åŠ¨ï¼ˆ<code>move</code>ï¼‰åˆ°é—­åŒ…ä¸­ï¼Œæˆ–ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„å…±äº«ç±»å‹ï¼ˆä¾‹å¦‚ <code>Arc&lt;Mutex&lt;T&gt;&gt;</code>ï¼‰ã€‚</p>
<h2 id="std-threadï¼šåˆ›å»ºä¸ç®¡ç†çº¿ç¨‹"><a href="#std-threadï¼šåˆ›å»ºä¸ç®¡ç†çº¿ç¨‹" class="headerlink" title="std::threadï¼šåˆ›å»ºä¸ç®¡ç†çº¿ç¨‹"></a><code>std::thread</code>ï¼šåˆ›å»ºä¸ç®¡ç†çº¿ç¨‹</h2><p>æœ€å¸¸ç”¨çš„åˆ›å»ºçº¿ç¨‹æ–¹å¼æ˜¯ <code>thread::spawn</code>ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªé—­åŒ…å¹¶è¿”å› <code>JoinHandle&lt;T&gt;</code>ï¼Œå¯ä»¥ç”¨æ¥ç­‰å¾…çº¿ç¨‹ç»“æŸå¹¶è·å–è¿”å›å€¼ã€‚</p>
<p>ç¤ºä¾‹ï¼šç®€å•çš„ <code>spawn</code> ä¸ <code>join</code></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"><span class="keyword">use</span> std::time::Duration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="variable">v</span> = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¿…é¡»ä½¿ç”¨ move å°† v çš„æ‰€æœ‰æƒè½¬ç§»åˆ°æ–°çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">handle</span> = thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;å‘é‡ v: &#123;:?&#125;&quot;</span>, v);</span><br><span class="line">        thread::<span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_millis</span>(<span class="number">10</span>));</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…çº¿ç¨‹ç»“æŸ</span></span><br><span class="line">    handle.<span class="title function_ invoke__">join</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>thread::Builder</code> å¯ä»¥è®¾ç½®çº¿ç¨‹åã€æ ˆå¤§å°ç­‰ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">builder</span> = thread::Builder::<span class="title function_ invoke__">new</span>()</span><br><span class="line">    .<span class="title function_ invoke__">name</span>(<span class="string">&quot;channel-test&quot;</span>.<span class="title function_ invoke__">to_string</span>())</span><br><span class="line">    .<span class="title function_ invoke__">stack_size</span>(<span class="number">4</span> * <span class="number">1024</span> * <span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">handle</span> = builder.<span class="title function_ invoke__">spawn</span>(|| &#123;</span><br><span class="line">    <span class="comment">// çº¿ç¨‹ä½“</span></span><br><span class="line">&#125;).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line"></span><br><span class="line">handle.<span class="title function_ invoke__">join</span>().<span class="title function_ invoke__">unwrap</span>();</span><br></pre></td></tr></table></figure>

<p>çº¿ç¨‹å¯ä»¥è¢« <code>join</code>ï¼ˆç­‰å¾…ï¼‰æˆ–â€œdetachâ€ï¼ˆå³ä¸ joinï¼Œè®©æ“ä½œç³»ç»Ÿæ¥ç®¡ï¼‰ã€‚å¯¹éœ€è¦ä¿è¯æ‰§è¡Œå®Œæˆçš„å·¥ä½œä½¿ç”¨ <code>join</code>ã€‚</p>
<h2 id="çº¿ç¨‹é—´é€šä¿¡ï¼šstd-sync-mpsc"><a href="#çº¿ç¨‹é—´é€šä¿¡ï¼šstd-sync-mpsc" class="headerlink" title="çº¿ç¨‹é—´é€šä¿¡ï¼šstd::sync::mpsc"></a>çº¿ç¨‹é—´é€šä¿¡ï¼š<code>std::sync::mpsc</code></h2><p>Rust æ ‡å‡†åº“æä¾›åŸºäºæ¶ˆæ¯ä¼ é€’çš„é€šé“ï¼ˆChannelï¼‰ï¼š<code>std::sync::mpsc</code>ï¼ˆmultiple producer, single consumerï¼‰ã€‚é€šé“ä¼ é€’çš„æ˜¯å€¼çš„æ‰€æœ‰æƒï¼Œå› æ­¤å¤©ç„¶é¿å…äº†æ•°æ®ç«äº‰é—®é¢˜ã€‚</p>
<ul>
<li><code>Sender&lt;T&gt;</code>ï¼šå‘é€ç«¯ï¼Œå¯ä»¥ <code>clone()</code> æ”¯æŒå¤šç”Ÿäº§è€…ã€‚</li>
<li><code>Receiver&lt;T&gt;</code>ï¼šæ¥æ”¶ç«¯ï¼Œé»˜è®¤ä¸å¯å…‹éš†ï¼ˆå•æ¶ˆè´¹è€…ï¼‰ã€‚</li>
</ul>
<p>åˆ›å»ºé€šé“ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::sync::mpsc;</span><br><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> (tx, rx) = mpsc::<span class="title function_ invoke__">channel</span>(); <span class="comment">// æ— ç•Œé€šé“</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">tx_clone</span> = tx.<span class="title function_ invoke__">clone</span>();</span><br><span class="line"></span><br><span class="line">thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">    tx.<span class="title function_ invoke__">send</span>(<span class="string">&quot;hello&quot;</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="variable">received</span> <span class="keyword">in</span> rx &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;æ¥æ”¶åˆ°: &#123;&#125;&quot;</span>, received);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>mpsc::sync_channel(n)</code> å¯ä»¥åˆ›å»ºå¸¦ç¼“å­˜å®¹é‡çš„é€šé“ï¼ˆé˜»å¡å‘é€è€…ç›´åˆ°æœ‰ç©ºé—´ï¼‰ã€‚å½“å®¹é‡ä¸º 0 æ—¶ï¼Œå‘é€æ–¹ä¼šä¸¥æ ¼ç­‰å¾…æ¥æ”¶æ–¹ï¼ˆåŒæ­¥æ¨¡å¼ï¼‰ã€‚</p>
<h3 id="å‘é€-x2F-æ¥æ”¶çš„è¿”å›å€¼ä¸é”™è¯¯å¤„ç†"><a href="#å‘é€-x2F-æ¥æ”¶çš„è¿”å›å€¼ä¸é”™è¯¯å¤„ç†" class="headerlink" title="å‘é€&#x2F;æ¥æ”¶çš„è¿”å›å€¼ä¸é”™è¯¯å¤„ç†"></a>å‘é€&#x2F;æ¥æ”¶çš„è¿”å›å€¼ä¸é”™è¯¯å¤„ç†</h3><p><code>send</code> ä¸ <code>recv</code> éƒ½ä¼šè¿”å› <code>Result</code>ï¼š</p>
<ul>
<li><code>send</code> è¿”å› <code>Result&lt;(), SendError&lt;T&gt;&gt;</code>ï¼šå½“æ‰€æœ‰ <code>Receiver</code> è¢«ä¸¢å¼ƒæ—¶ï¼Œå‘é€ä¼šå¤±è´¥å¹¶è¿”å›é”™è¯¯ï¼›å‘é€å¤±è´¥ä¼šæŠŠè¦å‘é€çš„å€¼å¸¦å› <code>SendError&lt;T&gt;</code>ã€‚</li>
<li><code>recv</code> è¿”å› <code>Result&lt;T, RecvError&gt;</code>ï¼šå½“æ‰€æœ‰ <code>Sender</code> å·²è¢«ä¸¢å¼ƒä¸”é€šé“ä¸­æ— æ›´å¤šæ¶ˆæ¯æ—¶ï¼Œ<code>recv</code> è¿”å›é”™è¯¯ã€‚</li>
</ul>
<p>ç¤ºä¾‹ï¼šå¤„ç† <code>send</code>&#x2F;<code>recv</code> é”™è¯¯</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::sync::mpsc;</span><br><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> (tx, rx) = mpsc::channel::&lt;<span class="type">i32</span>&gt;();</span><br><span class="line"></span><br><span class="line">thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">    <span class="keyword">if</span> tx.<span class="title function_ invoke__">send</span>(<span class="number">1</span>).<span class="title function_ invoke__">is_err</span>() &#123;</span><br><span class="line">        eprintln!(<span class="string">&quot;å‘é€å¤±è´¥ï¼šæ¥æ”¶è€…å·²å…³é—­&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span> rx.<span class="title function_ invoke__">recv</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(v) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;æ”¶åˆ°: &#123;&#125;&quot;</span>, v),</span><br><span class="line">    <span class="title function_ invoke__">Err</span>(_) =&gt; <span class="built_in">println!</span>(<span class="string">&quot;é€šé“å·²å…³é—­ï¼Œæ— æ›´å¤šæ•°æ®&quot;</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å¤šæ¶ˆè´¹è€…ï¼ˆMultiple-Consumersï¼‰ä¸é€‰æ‹©æ–¹æ¡ˆ"><a href="#å¤šæ¶ˆè´¹è€…ï¼ˆMultiple-Consumersï¼‰ä¸é€‰æ‹©æ–¹æ¡ˆ" class="headerlink" title="å¤šæ¶ˆè´¹è€…ï¼ˆMultiple Consumersï¼‰ä¸é€‰æ‹©æ–¹æ¡ˆ"></a>å¤šæ¶ˆè´¹è€…ï¼ˆMultiple Consumersï¼‰ä¸é€‰æ‹©æ–¹æ¡ˆ</h2><p>æ ‡å‡†åº“çš„ <code>mpsc</code> ä»…æä¾›å•æ¶ˆè´¹è€…ã€‚è¦å®ç°å¤šæ¶ˆè´¹è€…æˆ–æ›´é«˜æ€§èƒ½çš„å¹¶å‘æ¶ˆè´¹æ¨¡å‹ï¼Œå¯ä»¥é€‰æ‹©ï¼š</p>
<ol>
<li>ä½¿ç”¨ <code>crossbeam-channel</code>ï¼ˆæ¨èï¼Œæ€§èƒ½å¥½ã€åŠŸèƒ½ä¸°å¯Œï¼Œæ”¯æŒ MPMC&#x2F;å¹¿æ’­ç­‰ï¼‰ã€‚</li>
<li>ç”¨ <code>Arc&lt;Mutex&lt;Receiver&gt;&gt;</code> åŒ…è£¹ <code>Receiver</code>ï¼ˆä¸æ¨èï¼Œé”å¸¦æ¥å¼€é”€ä¸”é™ä½å¹¶å‘æ€§èƒ½ï¼‰ã€‚</li>
</ol>
<p>ç¤ºä¾‹ï¼šä½¿ç”¨ <code>crossbeam_channel::unbounded</code> å®ç°å¤šä¸ªæ¶ˆè´¹è€…æŠ¢å æ¶ˆæ¯ï¼ˆç«äº‰æ¶ˆè´¹ï¼‰ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"><span class="keyword">use</span> crossbeam_channel::unbounded;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">run_mpmc</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> (s, r) = unbounded::&lt;<span class="type">String</span>&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">3</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">r_clone</span> = r.<span class="title function_ invoke__">clone</span>();</span><br><span class="line">        thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">            <span class="keyword">for</span> <span class="variable">msg</span> <span class="keyword">in</span> r_clone.<span class="title function_ invoke__">iter</span>() &#123;</span><br><span class="line">                <span class="built_in">println!</span>(<span class="string">&quot;æ¶ˆè´¹è€… &#123;&#125; æ”¶åˆ°: &#123;&#125;&quot;</span>, i, msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">5</span> &#123;</span><br><span class="line">        s.<span class="title function_ invoke__">send</span>(<span class="built_in">format!</span>(<span class="string">&quot;æ¶ˆæ¯ &#123;&#125;&quot;</span>, i)).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å‘é€ç«¯ drop åï¼Œæ¶ˆè´¹è€…ä¼šç»“æŸè¿­ä»£</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>crossbeam-channel</code> çš„ç‰¹ç‚¹æ˜¯é«˜æ€§èƒ½å¹¶ä¸”æ”¯æŒå¤šç§æ¨¡å¼ï¼ˆæ— ç•Œ&#x2F;æœ‰ç•Œã€è¶…æ—¶ã€é€‰æ‹©ç­‰ï¼‰ã€‚</p>
<h2 id="å¹¿æ’­æ¨¡å¼"><a href="#å¹¿æ’­æ¨¡å¼" class="headerlink" title="å¹¿æ’­æ¨¡å¼"></a>å¹¿æ’­æ¨¡å¼</h2><p>å¦‚æœéœ€è¦å¹¿æ’­ï¼ˆåŒä¸€æ¡æ¶ˆæ¯è¢«å¤šä¸ªæ¶ˆè´¹è€…éƒ½æ”¶åˆ°ï¼‰ï¼Œå¯ä»¥é€‰æ‹©ï¼š</p>
<ul>
<li>å¼‚æ­¥ç¯å¢ƒä¸‹ï¼š<code>tokio::sync::broadcast</code>ã€‚</li>
<li>åŒæ­¥ï¼ˆé˜»å¡ï¼‰åœºæ™¯ï¼šä½¿ç”¨ <code>bus</code>ã€<code>postage</code> ç­‰ crateï¼ˆ<code>bus</code> ç¤ºä¾‹ï¼‰ï¼š</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"><span class="keyword">use</span> bus::Bus;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">run_bus</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">bus</span> = Bus::<span class="title function_ invoke__">new</span>(<span class="number">10</span>); <span class="comment">// å®¹é‡ 10</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">rx1</span> = bus.<span class="title function_ invoke__">add_rx</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">rx2</span> = bus.<span class="title function_ invoke__">add_rx</span>();</span><br><span class="line"></span><br><span class="line">    thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;æ¶ˆè´¹è€… 1 æ”¶åˆ°: &#123;&#125;&quot;</span>, rx1.<span class="title function_ invoke__">recv</span>().<span class="title function_ invoke__">unwrap</span>());</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;æ¶ˆè´¹è€… 2 æ”¶åˆ°: &#123;&#125;&quot;</span>, rx2.<span class="title function_ invoke__">recv</span>().<span class="title function_ invoke__">unwrap</span>());</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    bus.<span class="title function_ invoke__">broadcast</span>(<span class="string">&quot;å¹¿æ’­æ¶ˆæ¯&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šä¸åŒå¹¿æ’­å®ç°çš„è¯­ä¹‰ä¸åŒï¼ˆä¸€äº›åº“æ˜¯æœ‰å®¹é‡é™åˆ¶å¹¶å¯èƒ½ä¸¢å¼ƒæ—§æ¶ˆæ¯ï¼‰ã€‚é€‰æ‹©æ—¶è¯·é˜…è¯»å¯¹åº”åº“æ–‡æ¡£ã€‚</p>
<h2 id="çº¿ç¨‹é—´é€šä¿¡çš„è®¾è®¡è¦ç‚¹ä¸æœ€ä½³å®è·µ"><a href="#çº¿ç¨‹é—´é€šä¿¡çš„è®¾è®¡è¦ç‚¹ä¸æœ€ä½³å®è·µ" class="headerlink" title="çº¿ç¨‹é—´é€šä¿¡çš„è®¾è®¡è¦ç‚¹ä¸æœ€ä½³å®è·µ"></a>çº¿ç¨‹é—´é€šä¿¡çš„è®¾è®¡è¦ç‚¹ä¸æœ€ä½³å®è·µ</h2><ul>
<li>ä¼˜å…ˆä½¿ç”¨æ¶ˆæ¯ä¼ é€’ï¼ˆownership transferï¼‰è€Œéå…±äº«å¯å˜çŠ¶æ€ã€‚</li>
<li>å¯¹äºéœ€è¦å¤šä¸ªæ¶ˆè´¹è€…çš„é«˜åååœºæ™¯ï¼Œä¼˜å…ˆè€ƒè™‘ <code>crossbeam-channel</code>ã€‚</li>
<li>é¿å…ç”¨ <code>Arc&lt;Mutex&lt;Receiver&gt;&gt;</code> ä½œä¸ºé¦–é€‰æ–¹æ¡ˆï¼Œå› ä¸ºé”å¯èƒ½æˆä¸ºç“¶é¢ˆã€‚</li>
<li>ä½¿ç”¨ <code>sync_channel</code> å®ç°ç”Ÿäº§è€…é€Ÿç‡é™åˆ¶ï¼ˆbackpressureï¼‰ã€‚</li>
</ul>
<h2 id="å¸¸è§ç¤ºä¾‹æ±‡æ€»"><a href="#å¸¸è§ç¤ºä¾‹æ±‡æ€»" class="headerlink" title="å¸¸è§ç¤ºä¾‹æ±‡æ€»"></a>å¸¸è§ç¤ºä¾‹æ±‡æ€»</h2><p>å¤šç”Ÿäº§è€…ã€å•æ¶ˆè´¹è€…ï¼ˆæ ‡å‡†åº“ï¼‰ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::sync::mpsc;</span><br><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">run_mpsc_clone</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> (tx, rx) = mpsc::<span class="title function_ invoke__">channel</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">tx1</span> = tx.<span class="title function_ invoke__">clone</span>();</span><br><span class="line"></span><br><span class="line">    thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">vals</span> = <span class="built_in">vec!</span>[<span class="string">&quot;æ¶ˆæ¯1&quot;</span>, <span class="string">&quot;æ¶ˆæ¯2&quot;</span>, <span class="string">&quot;æ¶ˆæ¯3&quot;</span>];</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">val</span> <span class="keyword">in</span> vals &#123;</span><br><span class="line">            tx.<span class="title function_ invoke__">send</span>(val).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            thread::<span class="title function_ invoke__">sleep</span>(std::time::Duration::<span class="title function_ invoke__">from_millis</span>(<span class="number">10</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">vals</span> = <span class="built_in">vec!</span>[<span class="string">&quot;æ¶ˆæ¯A&quot;</span>, <span class="string">&quot;æ¶ˆæ¯B&quot;</span>, <span class="string">&quot;æ¶ˆæ¯C&quot;</span>];</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">val</span> <span class="keyword">in</span> vals &#123;</span><br><span class="line">            tx1.<span class="title function_ invoke__">send</span>(val).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">received</span> <span class="keyword">in</span> rx &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;ä¸»çº¿ç¨‹æ”¶åˆ°: &#123;&#125;&quot;</span>, received);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>sync_channel</code> çš„åŒæ­¥å‘é€ç¤ºä¾‹ï¼ˆå®ç° backpressureï¼‰ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::sync::mpsc;</span><br><span class="line"><span class="keyword">use</span> std::thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">run_sync_channel</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> (tx, rx) = mpsc::<span class="title function_ invoke__">sync_channel</span>(<span class="number">2</span>); <span class="comment">// å®¹é‡ 2</span></span><br><span class="line"></span><br><span class="line">    thread::<span class="title function_ invoke__">spawn</span>(<span class="keyword">move</span> || &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="number">5</span> &#123;</span><br><span class="line">            tx.<span class="title function_ invoke__">send</span>(i).<span class="title function_ invoke__">unwrap</span>(); <span class="comment">// å½“é˜Ÿåˆ—æ»¡æ—¶ä¼šé˜»å¡</span></span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;å‘é€: &#123;&#125;&quot;</span>, i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">v</span> <span class="keyword">in</span> rx &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;æ¥æ”¶: &#123;&#125;&quot;</span>, v);</span><br><span class="line">        thread::<span class="title function_ invoke__">sleep</span>(std::time::Duration::<span class="title function_ invoke__">from_millis</span>(<span class="number">50</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å°ç»“ä¸å‚è€ƒ"><a href="#å°ç»“ä¸å‚è€ƒ" class="headerlink" title="å°ç»“ä¸å‚è€ƒ"></a>å°ç»“ä¸å‚è€ƒ</h2><p>Rust çš„çº¿ç¨‹ä¸é€šé“æ¨¡å‹ä»¥æ‰€æœ‰æƒä¸ºæ ¸å¿ƒï¼Œæ¶ˆæ¯ä¼ é€’å¯ä»¥åœ¨ä¸åŠ é”çš„æƒ…å†µä¸‹å®‰å…¨åœ°ç§»åŠ¨æ•°æ®ã€‚å¯¹äºæ€§èƒ½å’Œæ‰©å±•æ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼Œ<code>crossbeam-channel</code> æ˜¯æ¯”æ ‡å‡†åº“æ›´å¥½çš„é€‰æ‹©ï¼›éœ€è¦å¹¿æ’­æ—¶é€‰æ‹©åˆé€‚çš„å¹¿æ’­åº“ã€‚</p>
]]></content>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustå­¦ä¹ ç¬”è®°</title>
    <url>/2023/06/20/Rust%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>Rust è¯­è¨€æ˜¯ä¸€ç§é«˜æ•ˆã€å¯é çš„é€šç”¨é«˜çº§è¯­è¨€ã€‚å…¶é«˜æ•ˆä¸ä»…é™äºå¼€å‘æ•ˆç‡ï¼Œå®ƒçš„æ‰§è¡Œæ•ˆç‡ä¹Ÿæ˜¯ä»¤äººç§°èµçš„ï¼Œæ˜¯ä¸€ç§å°‘æœ‰çš„å…¼é¡¾å¼€å‘æ•ˆç‡å’Œæ‰§è¡Œæ•ˆç‡çš„è¯­è¨€ã€‚</p>
<span id="more"></span>
<p>Rustè¯­è¨€çš„ç‰¹ç‚¹<br>é«˜æ€§èƒ½ - Rust é€Ÿåº¦æƒŠäººä¸”å†…å­˜åˆ©ç”¨ç‡æé«˜ã€‚ç”±äºæ²¡æœ‰è¿è¡Œæ—¶å’Œåƒåœ¾å›æ”¶ï¼Œå®ƒèƒ½å¤Ÿèƒœä»»å¯¹æ€§èƒ½è¦æ±‚ç‰¹åˆ«é«˜çš„æœåŠ¡ï¼Œå¯ä»¥åœ¨åµŒå…¥å¼è®¾å¤‡ä¸Šè¿è¡Œï¼Œè¿˜èƒ½è½»æ¾å’Œå…¶ä»–è¯­è¨€é›†æˆã€‚</p>
<p>å¯é æ€§ - Rust ä¸°å¯Œçš„ç±»å‹ç³»ç»Ÿå’Œæ‰€æœ‰æƒæ¨¡å‹ä¿è¯äº†å†…å­˜å®‰å…¨å’Œçº¿ç¨‹å®‰å…¨ï¼Œè®©æ‚¨åœ¨ç¼–è¯‘æœŸå°±èƒ½å¤Ÿæ¶ˆé™¤å„ç§å„æ ·çš„é”™è¯¯ã€‚</p>
<p>ç”Ÿäº§åŠ› - Rust æ‹¥æœ‰å‡ºè‰²çš„æ–‡æ¡£ã€å‹å¥½çš„ç¼–è¯‘å™¨å’Œæ¸…æ™°çš„é”™è¯¯æç¤ºä¿¡æ¯ï¼Œ è¿˜é›†æˆäº†ä¸€æµçš„å·¥å…· â€”â€” åŒ…ç®¡ç†å™¨å’Œæ„å»ºå·¥å…·ï¼Œ æ™ºèƒ½åœ°è‡ªåŠ¨è¡¥å…¨å’Œç±»å‹æ£€éªŒçš„å¤šç¼–è¾‘å™¨æ”¯æŒï¼Œ ä»¥åŠè‡ªåŠ¨æ ¼å¼åŒ–ä»£ç ç­‰ç­‰ã€‚</p>
<p>å­¦ä¹ ç¬”è®°å·²ä¸Šä¼ è‡³gitHubï¼š<a href="https://github.com/thefu/RustPrroject">https://github.com/thefu/RustPrroject</a></p>
]]></content>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustå¼‚æ­¥ç¼–ç¨‹ä¹‹asyncä¸.await</title>
    <url>/2023/10/23/Rust%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E4%B9%8Basync%E4%B8%8E-await/</url>
    <content><![CDATA[<p>Rustçš„å¼‚æ­¥ç¼–ç¨‹ä¸»è¦ç”¨äºé«˜å¹¶å‘I&#x2F;Oå¯†é›†å‹ä»»åŠ¡ï¼›Rustçš„å¼‚æ­¥æ¨¡å‹åŸºäº Future + Pollingï¼Œåœ¨å•çº¿ç¨‹ä¸Šå³å¯å®Œæˆæ•°åƒä¸ªå¹¶å‘ä»»åŠ¡ã€‚<code>async</code>&#x2F;<code>.await</code> æ˜¯Rustå†…ç½®è¯­æ³•ï¼Œç”¨äºè®©å¼‚æ­¥å‡½æ•°ç¼–å†™å¾—åƒåŒæ­¥ä»£ç ã€‚<code>async</code> å°†ä»£ç å—è½¬åŒ–æˆå®ç°äº† <code>Future</code> trait çš„çŠ¶æ€æœºã€‚</p>
<span id="more"></span>

<h2 id="1-async-åˆ›å»º-Future"><a href="#1-async-åˆ›å»º-Future" class="headerlink" title="1. async - åˆ›å»º Future"></a>1. async - åˆ›å»º Future</h2><p><code>async</code> æ˜¯ç”¨äºåˆ›å»º Future çš„è¯­æ³•ç³–ï¼Œç”¨æ¥æ ‡è®°ä¸€ä¸ªå‡½æ•°ä¸ºå¼‚æ­¥å‡½æ•°ã€‚</p>
<h3 id="å¼‚æ­¥å‡½æ•°ï¼ˆasync-fnï¼‰"><a href="#å¼‚æ­¥å‡½æ•°ï¼ˆasync-fnï¼‰" class="headerlink" title="å¼‚æ­¥å‡½æ•°ï¼ˆasync fnï¼‰"></a>å¼‚æ­¥å‡½æ•°ï¼ˆasync fnï¼‰</h3><ul>
<li>è°ƒç”¨åä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ª Future</li>
<li>è¿”å›å€¼ä¼šè¢«è‡ªåŠ¨åŒ…è£…ä¸º Future</li>
<li>å¼‚æ­¥å‡½æ•°å†…éƒ¨å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>.await</code></li>
<li>å¼‚æ­¥å‡½æ•°çš„å‚æ•°æ”¯æŒæ‰€æœ‰æ™®é€šå‡½æ•°çš„å‚æ•°ç±»å‹ï¼ˆåŒ…æ‹¬å¼•ç”¨ã€æ‰€æœ‰æƒç±»å‹ç­‰ï¼‰ï¼Œä½†è¦æ³¨æ„ç”Ÿå‘½å‘¨æœŸ</li>
</ul>
<h3 id="å¼‚æ­¥å—ï¼ˆasync-â€¦-ï¼‰"><a href="#å¼‚æ­¥å—ï¼ˆasync-â€¦-ï¼‰" class="headerlink" title="å¼‚æ­¥å—ï¼ˆasync { â€¦ }ï¼‰"></a>å¼‚æ­¥å—ï¼ˆasync { â€¦ }ï¼‰</h3><p><code>async</code> å—å¯ä»¥æ•è·å¤–éƒ¨å˜é‡ï¼ˆç±»ä¼¼é—­åŒ…ï¼‰</p>
<ul>
<li><code>async &#123; ... &#125;</code>ï¼šé»˜è®¤åƒé—­åŒ…æ•è·ï¼ŒæŒ‰å€Ÿç”¨æ•è·å¤–éƒ¨å˜é‡</li>
<li><code>async move &#123; ... &#125;</code>ï¼šæŠŠéœ€è¦çš„å˜é‡æŒ‰å€¼ <code>move</code> è¿› Futureï¼ŒFuture å¯¹å®ƒä»¬å…·æœ‰æ‰€æœ‰æƒ</li>
</ul>
<h3 id="å¼‚æ­¥é—­åŒ…"><a href="#å¼‚æ­¥é—­åŒ…" class="headerlink" title="å¼‚æ­¥é—­åŒ…"></a>å¼‚æ­¥é—­åŒ…</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¼‚æ­¥å‡½æ•°</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">fetch_data</span>() <span class="punctuation">-&gt;</span> <span class="type">u32</span> &#123;</span><br><span class="line">    <span class="number">42</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼‚æ­¥å—</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">fut</span> = <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Working...&quot;</span>);</span><br><span class="line">    <span class="number">100</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼‚æ­¥é—­åŒ…</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">async_func</span> = <span class="keyword">async</span> |x: <span class="type">i32</span>| x + <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h2 id="2-await-ç­‰å¾…-Future-å®Œæˆ"><a href="#2-await-ç­‰å¾…-Future-å®Œæˆ" class="headerlink" title="2. .await - ç­‰å¾… Future å®Œæˆ"></a>2. .await - ç­‰å¾… Future å®Œæˆ</h2><p><code>.await</code> æ˜¯ç”¨äºç­‰å¾… Future æ‰§è¡Œå®Œæˆçš„æ“ä½œç¬¦ï¼›åªèƒ½åœ¨ <code>async</code> å‡½æ•°æˆ– <code>async</code> å—å†…éƒ¨ä½¿ç”¨ã€‚</p>
<p>å¯¹ Future è°ƒç”¨ <code>.await</code>ï¼Œä¼šæš‚åœå½“å‰ Future çš„æ‰§è¡Œï¼ˆå¹¶å°†çº¿ç¨‹è®©ç»™å…¶ä»–å¯æ‰§è¡Œçš„ Futureï¼‰ï¼Œç›´åˆ°è¢«ç­‰å¾…çš„ Future å®Œæˆï¼Œç„¶åè¿”å›å…¶ <code>Output</code> ç»“æœã€‚</p>
<h3 id="await-å·¥ä½œåŸç†"><a href="#await-å·¥ä½œåŸç†" class="headerlink" title=".await å·¥ä½œåŸç†"></a>.await å·¥ä½œåŸç†</h3><p>Rustä¸­ä»£ç ç¼–è¯‘æ‰«ææ—¶ï¼ŒæŠŠæ¯ä¸€ä¸ªå¯èƒ½â€æŒ‚èµ·â€çš„ <code>.await</code> çœ‹ä½œä¸€ä¸ªè¾¹ç•Œï¼ŒæŠŠæ•´ä¸ªå‡½æ•°æ‹†æˆå‡ æ®µï¼›åŒæ—¶å®šä¹‰çŠ¶æ€æœºï¼ŒæŠŠåç»­è¦ç»§ç»­æ‰§è¡Œæ‰€éœ€çš„å±€éƒ¨å˜é‡ä¿å­˜ä¸‹æ¥ã€‚</p>
<h3 id="await-ç¤ºä¾‹"><a href="#await-ç¤ºä¾‹" class="headerlink" title=".await ç¤ºä¾‹"></a>.await ç¤ºä¾‹</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŸå§‹ç¤ºä¾‹å‡½æ•°</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">foo</span>() <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">y</span> = <span class="keyword">async</span> &#123; <span class="number">2</span> &#125;.<span class="keyword">await</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="variable">z</span> = x + y;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">w</span> = <span class="keyword">async</span> &#123; z * <span class="number">10</span> &#125;.<span class="keyword">await</span>;</span><br><span class="line">    </span><br><span class="line">    w</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¿»è¯‘çš„ä¼ªä»£ç </span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">FooState</span> &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹çŠ¶æ€</span></span><br><span class="line">    Start,</span><br><span class="line">    <span class="comment">// æ­£åœ¨ç­‰å¾…ç¬¬ä¸€ä¸ª .awaitï¼š async &#123; 2 &#125;</span></span><br><span class="line">    AwaitY &#123;</span><br><span class="line">        <span class="comment">// éœ€è¦ä¿å­˜ä»ç„¶ä¼šç”¨åˆ°çš„å±€éƒ¨å˜é‡</span></span><br><span class="line">        x: <span class="type">i32</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// æ­£åœ¨ç­‰å¾…ç¬¬äºŒä¸ª .awaitï¼š async &#123; z * 10 &#125;</span></span><br><span class="line">    AwaitW &#123;</span><br><span class="line">        z: <span class="type">i32</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    Done,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-Future-å¼‚æ­¥è®¡ç®—çš„æŠ½è±¡"><a href="#3-Future-å¼‚æ­¥è®¡ç®—çš„æŠ½è±¡" class="headerlink" title="3. Future - å¼‚æ­¥è®¡ç®—çš„æŠ½è±¡"></a>3. Future - å¼‚æ­¥è®¡ç®—çš„æŠ½è±¡</h2><p>Futureï¼ˆ<code>std::future::Future</code>ï¼‰æ˜¯ Rust å¼‚æ­¥ç¼–ç¨‹çš„åŸºç¡€ï¼Œ<code>async</code> è¯­æ³•çš„æœ¬è´¨æ˜¯ç”Ÿæˆ Futureï¼Œ<code>.await</code> åˆ™æ˜¯è§¦å‘ Future æ‰§è¡Œå¹¶ç­‰å¾…ç»“æœã€‚</p>
<h3 id="Future-Trait-å®šä¹‰"><a href="#Future-Trait-å®šä¹‰" class="headerlink" title="Future Trait å®šä¹‰"></a>Future Trait å®šä¹‰</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">trait</span> <span class="title class_">Future</span> &#123;</span><br><span class="line">    <span class="comment">// Future æœ€ç»ˆäº§ç”Ÿçš„ç»“æœç±»å‹</span></span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Output</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é©±åŠ¨ Future æ‰§è¡Œï¼šè¿”å› Poll&lt;Output&gt;</span></span><br><span class="line">    <span class="comment">// wakerï¼šç”¨äºå”¤é†’æš‚åœçš„ Future</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">poll</span>(<span class="keyword">self</span>: Pin&lt;&amp;<span class="keyword">mut</span> <span class="keyword">Self</span>&gt;, cx: &amp;<span class="keyword">mut</span> Context&lt;<span class="symbol">&#x27;_</span>&gt;) <span class="punctuation">-&gt;</span> Poll&lt;<span class="keyword">Self</span>::Output&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Poll æšä¸¾ï¼šè¡¨ç¤º Future çš„æ‰§è¡ŒçŠ¶æ€</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Poll</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="comment">// Future ä»åœ¨æ‰§è¡Œä¸­ï¼ˆéœ€è¦ç­‰å¾…æŸä¸ªäº‹ä»¶ï¼Œå¦‚ IO å®Œæˆï¼‰</span></span><br><span class="line">    Pending,</span><br><span class="line">    <span class="comment">// Future å·²å®Œæˆï¼Œè¿”å›ç»“æœ T</span></span><br><span class="line">    <span class="title function_ invoke__">Ready</span>(T),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Future-çš„ç‰¹æ€§"><a href="#Future-çš„ç‰¹æ€§" class="headerlink" title="Future çš„ç‰¹æ€§"></a>Future çš„ç‰¹æ€§</h3><p>Future æ˜¯æƒ°æ€§çš„â€”â€”å®šä¹‰åä¸ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œå¿…é¡»é€šè¿‡ <code>poll</code> æ–¹æ³•â€é©±åŠ¨â€å®ƒè¿è¡Œã€‚åªæœ‰å½“è°ƒç”¨è€…ï¼ˆé€šå¸¸æ˜¯å¼‚æ­¥æ‰§è¡Œå™¨ï¼‰è°ƒç”¨ <code>poll</code> æ—¶ï¼ŒFuture æ‰ä¼šæ¨è¿›æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°â€éœ€è¦ç­‰å¾…çš„äº‹ä»¶â€ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶IOï¼‰ï¼Œæ­¤æ—¶è¿”å› <code>Pending</code> å¹¶æš‚åœï¼Œç­‰å¾…è¢« <code>waker</code> å”¤é†’åå†æ¬¡æ‰§è¡Œã€‚</p>
<h2 id="4-æ‰§è¡Œå™¨ï¼ˆExecutorï¼‰"><a href="#4-æ‰§è¡Œå™¨ï¼ˆExecutorï¼‰" class="headerlink" title="4. æ‰§è¡Œå™¨ï¼ˆExecutorï¼‰"></a>4. æ‰§è¡Œå™¨ï¼ˆExecutorï¼‰</h2><p>è¦è¿è¡Œä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼ˆ<code>async fn</code>ï¼‰ï¼Œå¿…é¡»ä½¿ç”¨ä¸€ä¸ªæ‰§è¡Œå™¨ï¼ˆRuntime &#x2F; Executorï¼‰æ¥é©±åŠ¨å®ƒã€‚</p>
<h3 id="æ‰§è¡Œå™¨ä½¿ç”¨æ–¹å¼"><a href="#æ‰§è¡Œå™¨ä½¿ç”¨æ–¹å¼" class="headerlink" title="æ‰§è¡Œå™¨ä½¿ç”¨æ–¹å¼"></a>æ‰§è¡Œå™¨ä½¿ç”¨æ–¹å¼</h3><table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>æ–¹å¼</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td>åº”ç”¨ç¨‹åºå…¥å£</td>
<td>ä½¿ç”¨å®</td>
<td><code>#[tokio::main] async fn main() &#123; ... &#125;</code></td>
</tr>
<tr>
<td>æ™®é€šå‡½æ•°ä¸­</td>
<td>æ‰‹åŠ¨åˆ›å»º Runtime</td>
<td><code>Runtime::new().unwrap().block_on(future)</code></td>
</tr>
<tr>
<td>è½»é‡çº§&#x2F;æµ‹è¯•</td>
<td>ä½¿ç”¨ç®€å•æ‰§è¡Œå™¨</td>
<td><code>futures::executor::block_on(future)</code></td>
</tr>
</tbody></table>
<h3 id="å¹¶å‘æ‰§è¡Œå¤šä¸ª-Future"><a href="#å¹¶å‘æ‰§è¡Œå¤šä¸ª-Future" class="headerlink" title="å¹¶å‘æ‰§è¡Œå¤šä¸ª Future"></a>å¹¶å‘æ‰§è¡Œå¤šä¸ª Future</h3><p><code>async</code>&#x2F;<code>.await</code> æœ¬èº«æ˜¯ä¸²è¡Œçš„ï¼Œè‹¥è¦å¹¶å‘æ‰§è¡Œå¤šä¸ª Futureï¼Œéœ€ä½¿ç”¨å¹¶å‘å®ï¼š</p>
<ul>
<li><strong><code>tokio::join!</code></strong> &#x2F; **<code>async_std::future::join!</code>**ï¼šç­‰å¾…æ‰€æœ‰ Future å®Œæˆï¼ˆç±»ä¼¼ Promise.allï¼‰</li>
<li><strong><code>tokio::select!</code></strong> &#x2F; **<code>async_std::future::select!</code>**ï¼šç­‰å¾…ç¬¬ä¸€ä¸ªå®Œæˆçš„ Futureï¼ˆç±»ä¼¼ Promise.raceï¼‰</li>
<li>**<code>tokio::try_join!</code>**ï¼šå¹¶å‘æ‰§è¡Œï¼Œä¸”æ‰€æœ‰ Future å‡è¿”å› <code>Result</code>ï¼Œä¸€æ—¦æœ‰ä¸€ä¸ªå¤±è´¥åˆ™ç«‹å³è¿”å›é”™è¯¯</li>
</ul>
<h2 id="5-è¿è¡Œæ—¶ï¼ˆRuntimeï¼‰"><a href="#5-è¿è¡Œæ—¶ï¼ˆRuntimeï¼‰" class="headerlink" title="5. è¿è¡Œæ—¶ï¼ˆRuntimeï¼‰"></a>5. è¿è¡Œæ—¶ï¼ˆRuntimeï¼‰</h2><p>è¿è¡Œæ—¶æ˜¯é©±åŠ¨å¼‚æ­¥ä»»åŠ¡ï¼ˆFutureï¼‰æ‰§è¡Œçš„â€å¼•æ“â€ï¼Œè´Ÿè´£çº¿ç¨‹æ± ç®¡ç†ã€ä»»åŠ¡è°ƒåº¦ã€IOäº‹ä»¶å¤ç”¨ï¼ˆå¦‚ epoll&#x2F;kqueueï¼‰ç­‰åº•å±‚å·¥ä½œã€‚</p>
<h3 id="è¿è¡Œæ—¶çš„ä¸‰ä¸ªæ ¸å¿ƒéƒ¨åˆ†"><a href="#è¿è¡Œæ—¶çš„ä¸‰ä¸ªæ ¸å¿ƒéƒ¨åˆ†" class="headerlink" title="è¿è¡Œæ—¶çš„ä¸‰ä¸ªæ ¸å¿ƒéƒ¨åˆ†"></a>è¿è¡Œæ—¶çš„ä¸‰ä¸ªæ ¸å¿ƒéƒ¨åˆ†</h3><ol>
<li><p><strong>Executorï¼ˆæ‰§è¡Œå™¨ï¼‰</strong></p>
<ul>
<li>è´Ÿè´£ä¸æ–­è°ƒç”¨ <code>Future::poll()</code> æ¨è¿›ä»»åŠ¡æ‰§è¡Œ</li>
<li>æ”¯æŒä»»åŠ¡è°ƒåº¦ã€ä»»åŠ¡é˜Ÿåˆ—ã€çº¿ç¨‹æ± ç­‰</li>
</ul>
</li>
<li><p><strong>Reactorï¼ˆååº”å™¨ï¼‰</strong></p>
<ul>
<li>åŸºäºæ“ä½œç³»ç»Ÿçš„ IO å¤šè·¯å¤ç”¨æœºåˆ¶ï¼ˆepoll&#x2F;Linuxã€kqueue&#x2F;macOSã€IOCP&#x2F;Windowsï¼‰</li>
<li>å½“ socketã€æ–‡ä»¶æˆ–è®¡æ—¶å™¨å¯ç”¨æ—¶ï¼Œå”¤é†’å¯¹åº”ä»»åŠ¡</li>
</ul>
</li>
<li><p><strong>Concurrency Primitivesï¼ˆå¹¶å‘åŸè¯­ï¼‰</strong></p>
<ul>
<li>æä¾›å¼‚æ­¥é”ï¼ˆå¦‚ <code>Mutex</code>ï¼‰ã€é€šé“ï¼ˆ<code>Channel</code>ï¼‰ã€è®¡æ—¶å™¨ï¼ˆ<code>Timer</code>ï¼‰ç­‰å·¥å…·ï¼Œæ”¯æŒå¤šä»»åŠ¡å®‰å…¨é€šä¿¡</li>
</ul>
</li>
</ol>
<h3 id="å¸¸è§è¿è¡Œæ—¶åº“å¯¹æ¯”"><a href="#å¸¸è§è¿è¡Œæ—¶åº“å¯¹æ¯”" class="headerlink" title="å¸¸è§è¿è¡Œæ—¶åº“å¯¹æ¯”"></a>å¸¸è§è¿è¡Œæ—¶åº“å¯¹æ¯”</h3><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>Tokio</th>
<th>async-std</th>
<th>futures</th>
</tr>
</thead>
<tbody><tr>
<td>æ€§èƒ½</td>
<td>æœ€é«˜ï¼ˆå¤šçº¿ç¨‹è°ƒåº¦ï¼‰</td>
<td>ä¸­ç­‰</td>
<td>è½»é‡ï¼Œé€‚ä¸­</td>
</tr>
<tr>
<td>ä½¿ç”¨ä½“éªŒ</td>
<td>åå·¥ç¨‹åŒ–ã€é…ç½®ä¸°å¯Œ</td>
<td>æœ€æ¥è¿‘æ ‡å‡†åº“</td>
<td>æç®€ã€åº•å±‚</td>
</tr>
<tr>
<td>ç”Ÿæ€æ”¯æŒ</td>
<td>æœ€å¼ºï¼ˆhyper, tonic, reqwestï¼‰</td>
<td>ä¸­ç­‰</td>
<td>å°‘é‡æ ¸å¿ƒåº“</td>
</tr>
<tr>
<td>å†…éƒ¨å®ç°</td>
<td>work-stealing + reactor</td>
<td>smol å†…æ ¸</td>
<td>æ¨¡å—åŒ–ç»„ä»¶</td>
</tr>
<tr>
<td>é€‚åˆåœºæ™¯</td>
<td>é«˜å¹¶å‘æœåŠ¡ç«¯</td>
<td>å¿«é€Ÿå¼€å‘ã€æ•™å­¦</td>
<td>å°å‹åµŒå…¥å¼ã€è‡ªå®šä¹‰è¿è¡Œæ—¶</td>
</tr>
</tbody></table>
<h3 id="Tokio-ç¤ºä¾‹"><a href="#Tokio-ç¤ºä¾‹" class="headerlink" title="Tokio ç¤ºä¾‹"></a>Tokio ç¤ºä¾‹</h3><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> tokio::time::sleep;</span><br><span class="line"><span class="keyword">use</span> std::time::Duration;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[tokio::main]</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// å¹¶å‘æ‰§è¡Œä¸¤ä¸ªä»»åŠ¡</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">task1</span> = <span class="keyword">async</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_secs</span>(<span class="number">1</span>)).<span class="keyword">await</span>;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Task 1 done&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="variable">task2</span> = <span class="keyword">async</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_millis</span>(<span class="number">500</span>)).<span class="keyword">await</span>;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Task 2 done&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// join! ç­‰å¾…ä¸¤ä¸ªä»»åŠ¡éƒ½å®Œæˆ</span></span><br><span class="line">    tokio::join!(task1, task2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li><strong><code>async</code></strong> å°†å‡½æ•°æˆ–ä»£ç å—è½¬åŒ–ä¸º Future</li>
<li><strong><code>.await</code></strong> ç”¨äºæš‚åœæ‰§è¡Œå¹¶ç­‰å¾… Future å®Œæˆ</li>
<li><strong>Future</strong> æ˜¯ Rust å¼‚æ­¥ç¼–ç¨‹çš„åŸºç¡€ï¼Œéœ€è¦é€šè¿‡æ‰§è¡Œå™¨æ¥é©±åŠ¨</li>
<li><strong>æ‰§è¡Œå™¨</strong> è´Ÿè´£è°ƒåº¦å’Œè¿è¡Œ Futureï¼Œæ”¯æŒå•çº¿ç¨‹æˆ–å¤šçº¿ç¨‹å¹¶å‘</li>
<li><strong>è¿è¡Œæ—¶</strong> æä¾›äº†å®Œæ•´çš„å¼‚æ­¥ç”Ÿæ€ï¼ŒTokio æ˜¯æœ€æµè¡Œçš„é€‰æ‹©</li>
<li>å¼‚æ­¥ç¼–ç¨‹é€‚åˆ I&#x2F;O å¯†é›†å‹ä»»åŠ¡ï¼Œå¯åœ¨å•çº¿ç¨‹ä¸Šå®ç°é«˜å¹¶å‘</li>
</ul>
]]></content>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustç¼–è¯‘å‚æ•°ä¸ä¼˜åŒ–æ§åˆ¶</title>
    <url>/2023/11/26/Rust%E7%BC%96%E8%AF%91%E5%8F%82%E6%95%B0%E4%B8%8E%E4%BC%98%E5%8C%96%E6%8E%A7%E5%88%B6/</url>
    <content><![CDATA[<p>Rust çš„æ ¸å¿ƒå·¥å…·åŒ…æ‹¬ï¼š</p>
<ul>
<li>**<code>rustc</code>**ï¼šRust çš„åº•å±‚ç¼–è¯‘å™¨ã€‚<code>cargo</code> æœ€ç»ˆä¼šè°ƒç”¨ <code>rustc</code> æ¥ç¼–è¯‘ä»£ç ã€‚<code>rustc</code> æ¥å—å¤§é‡çš„å‘½ä»¤è¡Œå‚æ•°æ¥ç²¾ç¡®æ§åˆ¶ç¼–è¯‘è¿‡ç¨‹ã€‚</li>
<li>**<code>cargo</code>**ï¼šRust çš„å®˜æ–¹æ„å»ºå·¥å…·å’ŒåŒ…ç®¡ç†å™¨ã€‚æ ¹æ® <code>Cargo.toml</code> çš„é…ç½®ï¼Œè‡ªåŠ¨è°ƒç”¨ <code>rustc</code> å¹¶ä¼ é€’åˆé€‚çš„å‚æ•°ã€‚</li>
</ul>
<span id="more"></span>

<h2 id="1-Cargo-å·¥å…·"><a href="#1-Cargo-å·¥å…·" class="headerlink" title="1. Cargo å·¥å…·"></a>1. Cargo å·¥å…·</h2><p>Cargo æ˜¯ Rust å¼€å‘çš„æ ¸å¿ƒå·¥å…·ï¼Œç»Ÿä¸€äº†ã€Œé¡¹ç›®åˆ›å»ºã€ç¼–è¯‘ã€è¿è¡Œã€æµ‹è¯•ã€ä¾èµ–ç®¡ç†ã€å‘å¸ƒã€ç­‰å…¨æµç¨‹ã€‚</p>
<h3 id="Cargo-çš„æ ¸å¿ƒèŒè´£"><a href="#Cargo-çš„æ ¸å¿ƒèŒè´£" class="headerlink" title="Cargo çš„æ ¸å¿ƒèŒè´£"></a>Cargo çš„æ ¸å¿ƒèŒè´£</h3><ul>
<li><strong>é¡¹ç›®è„šæ‰‹æ¶</strong>ï¼šåˆ›å»ºæ ‡å‡† Rust é¡¹ç›®ï¼ˆäºŒè¿›åˆ¶&#x2F;åº“ï¼‰</li>
<li><strong>ä¾èµ–ç®¡ç†</strong>ï¼šä¸‹è½½ã€æ›´æ–°ã€ç¼–è¯‘ä¾èµ–ï¼ˆä» crates.io æˆ–è‡ªå®šä¹‰æºï¼‰</li>
<li><strong>æ„å»ºä¸è¿è¡Œ</strong>ï¼šè°ƒç”¨ <code>rustc</code> ç¼–è¯‘é¡¹ç›®ï¼Œè‡ªåŠ¨å¤„ç†é“¾æ¥ã€ä¼˜åŒ–å‚æ•°</li>
<li><strong>æµ‹è¯•ä¸åŸºå‡†</strong>ï¼šè¿è¡Œå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ€§èƒ½åŸºå‡†æµ‹è¯•</li>
<li><strong>å‘å¸ƒä¸åˆ†å‘</strong>ï¼šå°†åº“å‘å¸ƒåˆ° crates.ioï¼Œæˆ–ç”Ÿæˆå¯åˆ†å‘çš„äºŒè¿›åˆ¶æ–‡ä»¶</li>
</ul>
<h3 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h3><p>é€šè¿‡ cargo åˆ›å»ºçš„é¡¹ç›®ï¼Œä¼šåŒ…å«ï¼š</p>
<ul>
<li><strong>Cargo.toml</strong>ï¼šã€Œæ¸…å•æ–‡ä»¶ã€ï¼Œè®°å½•é¡¹ç›®åç§°ã€ç‰ˆæœ¬ã€ä¾èµ–ã€ç¼–è¯‘é…ç½®ç­‰ï¼›å¯æ‰‹åŠ¨ç¼–è¾‘</li>
<li><strong>Cargo.lock</strong>ï¼šã€Œç‰ˆæœ¬é”æ–‡ä»¶ã€ï¼Œç²¾ç¡®è®°å½•æ‰€æœ‰ä¾èµ–çš„å…·ä½“ç‰ˆæœ¬ï¼ˆç¡®ä¿å¤šäººåä½œ&#x2F;è·¨ç¯å¢ƒç¼–è¯‘ä¸€è‡´æ€§ï¼‰ï¼›è‡ªåŠ¨ç”Ÿæˆ</li>
</ul>
<h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><table>
<thead>
<tr>
<th>ç±»åˆ«</th>
<th>å‘½ä»¤</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>é¡¹ç›®åˆ›å»º</strong></td>
<td><code>cargo new &lt;name&gt;</code></td>
<td>åˆ›å»ºä¸€ä¸ªæ–°çš„äºŒè¿›åˆ¶é¡¹ç›®ï¼ˆ<code>--no-git</code> ä¸åˆå§‹åŒ–gitï¼‰</td>
</tr>
<tr>
<td></td>
<td><code>cargo new --lib &lt;name&gt;</code></td>
<td>åˆ›å»ºä¸€ä¸ªæ–°çš„åº“é¡¹ç›®</td>
</tr>
<tr>
<td></td>
<td><code>cargo init</code></td>
<td>åœ¨å½“å‰ç›®å½•åˆå§‹åŒ–ä¸€ä¸ª Cargo é¡¹ç›®</td>
</tr>
<tr>
<td><strong>ç¼–è¯‘æ„å»º</strong></td>
<td><code>cargo build</code></td>
<td>ç¼–è¯‘é¡¹ç›®ï¼ˆå¼€å‘æ¨¡å¼ï¼‰ï¼Œç”Ÿæˆåˆ° <code>target/debug/</code> ä¸‹</td>
</tr>
<tr>
<td></td>
<td><code>cargo build --release</code></td>
<td>ç¼–è¯‘é¡¹ç›®ï¼ˆå‘å¸ƒæ¨¡å¼ï¼‰ï¼Œç”Ÿæˆåˆ° <code>target/release/</code> ä¸‹</td>
</tr>
<tr>
<td></td>
<td><code>cargo check</code></td>
<td>å¿«é€Ÿæ£€æŸ¥ä»£ç æ˜¯å¦æœ‰ç¼–è¯‘é”™è¯¯ï¼Œä¸ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œé€Ÿåº¦æœ€å¿«</td>
</tr>
<tr>
<td></td>
<td><code>cargo check --release</code></td>
<td>åœ¨å‘å¸ƒæ¨¡å¼ä¸‹å¿«é€Ÿæ£€æŸ¥ä»£ç </td>
</tr>
<tr>
<td><strong>è¿è¡Œç¨‹åº</strong></td>
<td><code>cargo run</code></td>
<td>ä»¥å¼€å‘æ¨¡å¼ç¼–è¯‘å¹¶è¿è¡Œé¡¹ç›®</td>
</tr>
<tr>
<td></td>
<td><code>cargo run --release</code></td>
<td>ä»¥å‘å¸ƒæ¨¡å¼ç¼–è¯‘å¹¶è¿è¡Œé¡¹ç›®</td>
</tr>
<tr>
<td></td>
<td><code>cargo run -- &lt;args&gt;</code></td>
<td>å¸¦å‘½ä»¤è¡Œå‚æ•°ï¼ˆ<code>--</code> åçš„å†…å®¹ï¼‰æ–¹å¼è¿è¡Œ</td>
</tr>
<tr>
<td><strong>æµ‹è¯•</strong></td>
<td><code>cargo test</code></td>
<td>ç¼–è¯‘å¹¶è¿è¡Œé¡¹ç›®ä¸­çš„æ‰€æœ‰æµ‹è¯•</td>
</tr>
<tr>
<td></td>
<td><code>cargo test &lt;name&gt;</code></td>
<td>è¿è¡Œåç§°ä¸­åŒ…å« <code>&lt;name&gt;</code> çš„ç‰¹å®šæµ‹è¯•</td>
</tr>
<tr>
<td></td>
<td><code>cargo test -- --nocapture</code></td>
<td>è¿è¡Œæµ‹è¯•æ—¶ï¼Œæ˜¾ç¤º <code>println!</code> ç­‰è¾“å‡ºä¿¡æ¯</td>
</tr>
<tr>
<td></td>
<td><code>cargo test -- --ignored</code></td>
<td>è¿è¡Œè¢« <code>#[ignore]</code> æ ‡è®°çš„ï¼ˆé€šå¸¸è¢«å¿½ç•¥çš„ï¼‰æµ‹è¯•</td>
</tr>
<tr>
<td><strong>æ–‡æ¡£</strong></td>
<td><code>cargo doc</code></td>
<td>ä¸ºé¡¹ç›®ç”Ÿæˆ HTML æ–‡æ¡£</td>
</tr>
<tr>
<td></td>
<td><code>cargo doc --open</code></td>
<td>ç”Ÿæˆæ–‡æ¡£å¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€</td>
</tr>
<tr>
<td><strong>ä¾èµ–ç®¡ç†</strong></td>
<td><code>cargo add &lt;crate&gt;</code></td>
<td>å‘ Cargo.toml æ·»åŠ ä¸€ä¸ªä¾èµ–ï¼›<code>--features</code> æ·»åŠ åŒ…å±æ€§</td>
</tr>
<tr>
<td></td>
<td><code>cargo update</code></td>
<td>æ›´æ–° Cargo.lockï¼Œå°†ä¾èµ–å‡çº§åˆ°å…è®¸çš„æœ€æ–°ç‰ˆæœ¬</td>
</tr>
<tr>
<td></td>
<td><code>cargo search &lt;keyword&gt;</code></td>
<td>åœ¨ crates.io ä¸Šæœç´¢åŒ…</td>
</tr>
<tr>
<td><strong>å‘å¸ƒ</strong></td>
<td><code>cargo publish</code></td>
<td>å°†åº“å‘å¸ƒåˆ° crates.io</td>
</tr>
<tr>
<td><strong>æ¸…ç†</strong></td>
<td><code>cargo clean</code></td>
<td>åˆ é™¤ <code>target/</code> ç›®å½•ï¼Œæ¸…é™¤æ‰€æœ‰ç¼–è¯‘äº§ç‰©å’Œç¼“å­˜</td>
</tr>
<tr>
<td><strong>ä»£ç è´¨é‡</strong></td>
<td><code>cargo fmt</code></td>
<td>(éœ€å®‰è£… rustfmt) æ ¼å¼åŒ–ä»£ç ï¼Œä½¿å…¶ç¬¦åˆ Rust é£æ ¼æŒ‡å—</td>
</tr>
<tr>
<td></td>
<td><code>cargo clippy</code></td>
<td>(éœ€å®‰è£… clippy) è¿è¡Œ lint å·¥å…·ï¼Œå‘ç°ä»£ç ä¸­çš„ bugã€é”™è¯¯å’Œä¸è‰¯æ¨¡å¼</td>
</tr>
</tbody></table>
<h4 id="æ·»åŠ ä¾èµ–ç¤ºä¾‹"><a href="#æ·»åŠ ä¾èµ–ç¤ºä¾‹" class="headerlink" title="æ·»åŠ ä¾èµ–ç¤ºä¾‹"></a>æ·»åŠ ä¾èµ–ç¤ºä¾‹</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cargo add reqwest --features blocking</span><br></pre></td></tr></table></figure>

<p>ä¼šåœ¨ toml ä¸­æ·»åŠ ï¼š</p>
<figure class="highlight toml"><table><tr><td class="code"><pre><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">reqwest</span> = &#123; version = <span class="string">&quot;0.12.24&quot;</span>, features = [<span class="string">&quot;blocking&quot;</span>] &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Profileï¼ˆç¼–è¯‘è§„åˆ™é›†åˆï¼‰"><a href="#Profileï¼ˆç¼–è¯‘è§„åˆ™é›†åˆï¼‰" class="headerlink" title="Profileï¼ˆç¼–è¯‘è§„åˆ™é›†åˆï¼‰"></a>Profileï¼ˆç¼–è¯‘è§„åˆ™é›†åˆï¼‰</h3><p>Cargo çš„ <code>profile</code> æ˜¯ç¼–è¯‘è§„åˆ™çš„é›†åˆï¼Œæ ¸å¿ƒä½œç”¨æ˜¯å°†ã€Œä¼˜åŒ–ç­‰çº§ã€è°ƒè¯•ä¿¡æ¯ã€ç¼–è¯‘é€Ÿåº¦ã€é“¾æ¥ç­–ç•¥ã€ç­‰é…ç½®æŒ‰ã€Œåœºæ™¯ã€ï¼ˆå¼€å‘ã€æµ‹è¯•ã€å‘å¸ƒç­‰ï¼‰å½’ç±»ï¼Œé¿å…æ¯æ¬¡ç¼–è¯‘éƒ½æ‰‹åŠ¨ä¼ é€’å¤§é‡å‚æ•°ã€‚</p>
<h4 id="Profile-çš„æ ¸å¿ƒç‰¹ç‚¹"><a href="#Profile-çš„æ ¸å¿ƒç‰¹ç‚¹" class="headerlink" title="Profile çš„æ ¸å¿ƒç‰¹ç‚¹"></a>Profile çš„æ ¸å¿ƒç‰¹ç‚¹</h4><ul>
<li><strong>ç»Ÿä¸€ç®¡ç†ç¼–è¯‘é…ç½®</strong>ï¼šå°†åˆ†æ•£çš„ <code>rustc</code> å‚æ•°ï¼ˆå¦‚ä¼˜åŒ–ç­‰çº§ã€LTOï¼‰æ•´åˆä¸ºåœºæ™¯åŒ–é…ç½®</li>
<li><strong>ä¼˜å…ˆçº§æ˜ç¡®</strong>ï¼šå‘½ä»¤è¡Œå‚æ•°ï¼ˆå¦‚ <code>--release</code>ï¼‰&gt; <code>Cargo.toml</code> é…ç½® &gt; é»˜è®¤å€¼</li>
<li><strong>ç»§æ‰¿æœºåˆ¶</strong>ï¼šéƒ¨åˆ†é»˜è®¤ profile ä¼šç»§æ‰¿å…¶ä»– profile çš„é…ç½®<ul>
<li><code>test</code> â† <code>dev</code>ï¼šä¿®æ”¹ <code>dev</code> çš„é…ç½®ä¼šå½±å“ <code>test</code>ï¼ˆé™¤éå•ç‹¬è¦†ç›– <code>test</code> çš„å­—æ®µï¼‰</li>
<li><code>bench</code> â† <code>release</code>ï¼šä¿®æ”¹ <code>release</code> çš„é…ç½®ä¼šå½±å“ <code>bench</code>ï¼ˆé™¤éå•ç‹¬è¦†ç›– <code>bench</code> çš„å­—æ®µï¼‰</li>
</ul>
</li>
</ul>
<h4 id="äº”ä¸ªé»˜è®¤-Profile"><a href="#äº”ä¸ªé»˜è®¤-Profile" class="headerlink" title="äº”ä¸ªé»˜è®¤ Profile"></a>äº”ä¸ªé»˜è®¤ Profile</h4><table>
<thead>
<tr>
<th>Profile</th>
<th>åœºæ™¯</th>
<th>é»˜è®¤ opt-level</th>
<th>é»˜è®¤ debug</th>
</tr>
</thead>
<tbody><tr>
<td><code>dev</code></td>
<td>å¼€å‘è°ƒè¯•</td>
<td>0ï¼ˆæ— ä¼˜åŒ–ï¼‰</td>
<td>trueï¼ˆåŸºç¡€è°ƒè¯•ä¿¡æ¯ï¼‰</td>
</tr>
<tr>
<td><code>test</code></td>
<td>å•å…ƒæµ‹è¯•</td>
<td>0</td>
<td>true</td>
</tr>
<tr>
<td><code>bench</code></td>
<td>æ€§èƒ½åŸºå‡†æµ‹è¯•</td>
<td>3ï¼ˆæœ€é«˜ä¼˜åŒ–ï¼‰</td>
<td>false</td>
</tr>
<tr>
<td><code>release</code></td>
<td>å‘å¸ƒç”Ÿäº§</td>
<td>3ï¼ˆæœ€é«˜ä¼˜åŒ–ï¼‰</td>
<td>false</td>
</tr>
<tr>
<td><code>custom</code></td>
<td>è‡ªå®šä¹‰åœºæ™¯</td>
<td>çµæ´»é…ç½®</td>
<td>çµæ´»é…ç½®</td>
</tr>
</tbody></table>
<h4 id="é…ç½®é¡¹è¯¦è§£"><a href="#é…ç½®é¡¹è¯¦è§£" class="headerlink" title="é…ç½®é¡¹è¯¦è§£"></a>é…ç½®é¡¹è¯¦è§£</h4><h5 id="opt-levelï¼ˆä¼˜åŒ–çº§åˆ«ï¼‰"><a href="#opt-levelï¼ˆä¼˜åŒ–çº§åˆ«ï¼‰" class="headerlink" title="opt-levelï¼ˆä¼˜åŒ–çº§åˆ«ï¼‰"></a><code>opt-level</code>ï¼ˆä¼˜åŒ–çº§åˆ«ï¼‰</h5><p>å½±å“ç¨‹åºæ€§èƒ½æœ€å…³é”®çš„é€‰é¡¹ï¼Œç›´æ¥æ§åˆ¶ <code>rustc</code> çš„ä¼˜åŒ–çº§åˆ«ã€‚</p>
<ul>
<li><p><strong>å€¼ç±»å‹</strong>ï¼šå­—ç¬¦ä¸² (<code>&quot;0&quot;</code>, <code>&quot;1&quot;</code>, <code>&quot;2&quot;</code>, <code>&quot;3&quot;</code>, <code>&quot;s&quot;</code>, <code>&quot;z&quot;</code>) æˆ–æ•´æ•° (0, 1, 2, 3)</p>
</li>
<li><p><strong>å«ä¹‰</strong>ï¼š</p>
<ul>
<li><code>&quot;0&quot;</code>ï¼šæ— ä¼˜åŒ–ã€‚ç¼–è¯‘æœ€å¿«ï¼Œä½†æ€§èƒ½æœ€å·®ï¼›<code>dev</code> çš„é»˜è®¤å€¼</li>
<li><code>&quot;1&quot;</code>ï¼šå¯ç”¨åŸºæœ¬çš„ä¼˜åŒ–</li>
<li><code>&quot;2&quot;</code>ï¼šå¯ç”¨æ›´å¤šä¼˜åŒ–ï¼Œæ˜¯æ€§èƒ½å’Œç¼–è¯‘æ—¶é—´çš„è‰¯å¥½å¹³è¡¡</li>
<li><code>&quot;3&quot;</code>ï¼šæœ€é«˜çº§åˆ«çš„ä¼˜åŒ–ã€‚å¯ç”¨æ‰€æœ‰å¯ç”¨çš„ä¼˜åŒ–ï¼Œæ˜¾è‘—æå‡æ€§èƒ½ï¼Œä½†ç¼–è¯‘æ—¶é—´å¾ˆé•¿ï¼›<code>release</code> çš„é»˜è®¤å€¼</li>
<li><code>&quot;s&quot;</code>ï¼šåœ¨ <code>&quot;2&quot;</code> çš„åŸºç¡€ä¸Šï¼Œä¼˜å…ˆå‡å°ä»£ç å¤§å° (size)ã€‚é€‚ç”¨äºå¯¹äºŒè¿›åˆ¶ä½“ç§¯æ•æ„Ÿçš„åœºæ™¯</li>
<li><code>&quot;z&quot;</code>ï¼šåœ¨ <code>&quot;s&quot;</code> çš„åŸºç¡€ä¸Šï¼Œè¿›è¡Œæ›´æ¿€è¿›çš„å¤§å°ä¼˜åŒ–ï¼Œè¿½æ±‚æœ€å°çš„ä»£ç ä½“ç§¯ã€‚é€šå¸¸æ¯” <code>&quot;s&quot;</code> ç¼–è¯‘æ›´æ…¢</li>
</ul>
</li>
</ul>
<h5 id="debugï¼ˆè°ƒè¯•ä¿¡æ¯ï¼‰"><a href="#debugï¼ˆè°ƒè¯•ä¿¡æ¯ï¼‰" class="headerlink" title="debugï¼ˆè°ƒè¯•ä¿¡æ¯ï¼‰"></a><code>debug</code>ï¼ˆè°ƒè¯•ä¿¡æ¯ï¼‰</h5><p>æ§åˆ¶æ˜¯å¦ä¸ºç›®æ ‡æ–‡ä»¶ç”Ÿæˆè°ƒè¯•ä¿¡æ¯ã€‚</p>
<ul>
<li><p><strong>å€¼ç±»å‹</strong>ï¼šå¸ƒå°”å€¼ (<code>true</code>&#x2F;<code>false</code>) æˆ–æ•´æ•° (0, 1, 2)</p>
</li>
<li><p><strong>å«ä¹‰</strong>ï¼š</p>
<ul>
<li><code>true</code> &#x2F; <code>1</code>ï¼šç”ŸæˆåŸºç¡€çš„è°ƒè¯•ä¿¡æ¯ï¼ˆå¦‚è¡Œå·ï¼‰ï¼Œè¶³ä»¥æ”¯æŒ <code>gdb</code>&#x2F;<code>lldb</code> ç­‰è°ƒè¯•å™¨çš„åŸºæœ¬æ“ä½œ</li>
<li><code>2</code>ï¼šç”Ÿæˆå®Œæ•´çš„è°ƒè¯•ä¿¡æ¯ï¼Œæ”¯æŒæ›´å¤æ‚çš„è°ƒè¯•åŠŸèƒ½</li>
<li><code>false</code> &#x2F; <code>0</code>ï¼šä¸ç”Ÿæˆä»»ä½•è°ƒè¯•ä¿¡æ¯ï¼›ä¼šä½¿äºŒè¿›åˆ¶æ–‡ä»¶æ›´å°ï¼Œä½†å°†æ— æ³•ä½¿ç”¨è°ƒè¯•å™¨æˆ–ä»å´©æºƒä¸­è·å–æœ‰æ„ä¹‰çš„å›æº¯ï¼ˆbacktraceï¼‰</li>
</ul>
</li>
</ul>
<h5 id="ltoï¼ˆLink-Time-Optimizationï¼Œé“¾æ¥æ—¶ä¼˜åŒ–ï¼‰"><a href="#ltoï¼ˆLink-Time-Optimizationï¼Œé“¾æ¥æ—¶ä¼˜åŒ–ï¼‰" class="headerlink" title="ltoï¼ˆLink-Time Optimizationï¼Œé“¾æ¥æ—¶ä¼˜åŒ–ï¼‰"></a><code>lto</code>ï¼ˆLink-Time Optimizationï¼Œé“¾æ¥æ—¶ä¼˜åŒ–ï¼‰</h5><p>ä¸€ä¸ªå¼ºå¤§çš„å…¨å±€ä¼˜åŒ–æŠ€æœ¯ã€‚å…è®¸ç¼–è¯‘å™¨åœ¨é“¾æ¥é˜¶æ®µè¿›è¡Œè·¨ crate çš„æ·±åº¦ä¼˜åŒ–ï¼ˆå¦‚å‡½æ•°å†…è”ã€æ­»ä»£ç æ¶ˆé™¤ï¼‰ã€‚</p>
<ul>
<li><p><strong>å€¼ç±»å‹</strong>ï¼šå­—ç¬¦ä¸² (<code>&quot;off&quot;</code>, <code>&quot;on&quot;</code>, <code>&quot;fat&quot;</code>, <code>&quot;thin&quot;</code>, <code>&quot;thin-local&quot;</code>) æˆ–å¸ƒå°”å€¼</p>
</li>
<li><p><strong>å«ä¹‰</strong>ï¼š</p>
<ul>
<li><code>&quot;off&quot;</code> &#x2F; <code>false</code>ï¼šç¦ç”¨ LTOï¼›é»˜è®¤å€¼</li>
<li><code>&quot;on&quot;</code> &#x2F; <code>&quot;fat&quot;</code> &#x2F; <code>true</code>ï¼šå…¨é‡ LTO (Fat LTO)ã€‚æ•ˆæœæœ€å¥½ï¼Œèƒ½äº§ç”Ÿæœ€é«˜æ•ˆçš„ä»£ç ï¼Œä½†é“¾æ¥æ—¶é—´éå¸¸é•¿ï¼Œå†…å­˜æ¶ˆè€—å·¨å¤§</li>
<li><code>&quot;thin&quot;</code>ï¼šè–„ LTO (Thin LTO)ã€‚æ—¨åœ¨æä¾›æ¥è¿‘ Fat LTO çš„æ€§èƒ½æ”¶ç›Šï¼ŒåŒæ—¶æ˜¾è‘—å‡å°‘é“¾æ¥æ—¶é—´å’Œå†…å­˜å ç”¨ã€‚æ˜¯è¿½æ±‚é«˜æ€§èƒ½æ—¶çš„æ¨èé€‰æ‹©</li>
<li><code>&quot;thin-local&quot;</code>ï¼šThin LTO çš„ä¸€ä¸ªå˜ç§ï¼Œåªåœ¨å½“å‰ crate å†…éƒ¨è¿›è¡Œä¼˜åŒ–</li>
</ul>
</li>
</ul>
<h5 id="codegen-unitsï¼ˆä»£ç ç”Ÿæˆå•å…ƒï¼‰"><a href="#codegen-unitsï¼ˆä»£ç ç”Ÿæˆå•å…ƒï¼‰" class="headerlink" title="codegen-unitsï¼ˆä»£ç ç”Ÿæˆå•å…ƒï¼‰"></a><code>codegen-units</code>ï¼ˆä»£ç ç”Ÿæˆå•å…ƒï¼‰</h5><p>æ§åˆ¶å¹¶è¡Œä»£ç ç”Ÿæˆçš„å•å…ƒæ•°é‡ï¼›ä¼šå½±å“ç¼–è¯‘é€Ÿåº¦å’Œæœ€ç»ˆçš„ä¼˜åŒ–ç¨‹åº¦ã€‚</p>
<ul>
<li><p><strong>å€¼ç±»å‹</strong>ï¼šæ­£æ•´æ•°</p>
</li>
<li><p><strong>å«ä¹‰</strong>ï¼š</p>
<ul>
<li>æ•°å€¼è¶Šå¤§ï¼ˆå¦‚ <code>16</code>, <code>256</code>ï¼‰ï¼šç¼–è¯‘å¯ä»¥æ›´å¥½åœ°å¹¶è¡ŒåŒ–ï¼Œç¼–è¯‘é€Ÿåº¦æ›´å¿«ï¼Œä½†é™åˆ¶äº†è·¨å•å…ƒçš„ä¼˜åŒ–</li>
<li>æ•°å€¼è¶Šå°ï¼ˆç†æƒ³æ˜¯ <code>1</code>ï¼‰ï¼šç¼–è¯‘å™¨èƒ½çœ‹åˆ°æ›´å¤šçš„ä¸Šä¸‹æ–‡ï¼Œæœ‰åˆ©äº LTO å‘æŒ¥æœ€å¤§æ•ˆæœï¼Œç”Ÿæˆæ›´ä¼˜çš„ä»£ç ï¼Œä½†ç¼–è¯‘é€Ÿåº¦å˜æ…¢</li>
</ul>
</li>
<li><p><strong>é»˜è®¤</strong>ï¼š<code>16</code> (å¯¹äº <code>dev</code>), <code>16</code> (å¯¹äº <code>release</code>ï¼Œä½†åœ¨å¯ç”¨ LTO æ—¶å»ºè®®è®¾ä¸º <code>1</code>)</p>
</li>
</ul>
<h5 id="panicï¼ˆPanic-å¤„ç†ç­–ç•¥ï¼‰"><a href="#panicï¼ˆPanic-å¤„ç†ç­–ç•¥ï¼‰" class="headerlink" title="panicï¼ˆPanic å¤„ç†ç­–ç•¥ï¼‰"></a><code>panic</code>ï¼ˆPanic å¤„ç†ç­–ç•¥ï¼‰</h5><p>æŒ‡å®šå½“ <code>panic!</code> å®è¢«è§¦å‘æ—¶ï¼Œç¨‹åºçš„è¡Œä¸ºã€‚</p>
<ul>
<li><p><strong>å€¼ç±»å‹</strong>ï¼šå­—ç¬¦ä¸² (<code>&quot;unwind&quot;</code>, <code>&quot;abort&quot;</code>)</p>
</li>
<li><p><strong>å«ä¹‰</strong>ï¼š</p>
<ul>
<li><code>&quot;unwind&quot;</code>ï¼šæ ˆå±•å¼€ (Stack Unwinding)ã€‚ç¨‹åºä¼šæ²¿ç€è°ƒç”¨æ ˆå‘ä¸Šæ¸…ç†ï¼ˆæ‰§è¡Œææ„å‡½æ•°ï¼‰ï¼Œç„¶åç»ˆæ­¢ã€‚é»˜è®¤å€¼</li>
<li><code>&quot;abort&quot;</code>ï¼šç«‹å³ç»ˆæ­¢ (Abort)ã€‚ç¨‹åºç›´æ¥ç»ˆæ­¢ï¼Œä¸æ‰§è¡Œä»»ä½•ææ„å‡½æ•°ã€‚ç”Ÿæˆçš„ä»£ç æ›´å°ã€æ€§èƒ½ç•¥å¥½ï¼Œä½†èµ„æºï¼ˆå¦‚æ–‡ä»¶å¥æŸ„ã€å†…å­˜ï¼‰å¯èƒ½ä¸ä¼šè¢«æ­£ç¡®é‡Šæ”¾</li>
</ul>
</li>
</ul>
<h5 id="stripï¼ˆä¿¡æ¯å‰¥ç¦»ï¼‰"><a href="#stripï¼ˆä¿¡æ¯å‰¥ç¦»ï¼‰" class="headerlink" title="stripï¼ˆä¿¡æ¯å‰¥ç¦»ï¼‰"></a><code>strip</code>ï¼ˆä¿¡æ¯å‰¥ç¦»ï¼‰</h5><p>æ§åˆ¶ç§»é™¤å“ªäº›è°ƒè¯•å’Œç¬¦å·ä¿¡æ¯ã€‚</p>
<ul>
<li><code>&quot;none&quot;</code>ï¼šä¿ç•™æ‰€æœ‰ä¿¡æ¯ï¼›é»˜è®¤</li>
<li><code>&quot;debuginfo&quot;</code>ï¼šç§»é™¤è°ƒè¯•ä¿¡æ¯</li>
<li><code>&quot;symbols&quot;</code>ï¼šç§»é™¤ç¬¦å·è¡¨ä½†ä¿ç•™å¿…è¦çš„è°ƒè¯•ä¿¡æ¯</li>
<li><code>&quot;all&quot;</code>ï¼šç§»é™¤æ‰€æœ‰å¯é€‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬è°ƒè¯•å’Œç¬¦å·æ•°æ®</li>
</ul>
<h5 id="incrementalï¼ˆå¢é‡ç¼–è¯‘ï¼‰"><a href="#incrementalï¼ˆå¢é‡ç¼–è¯‘ï¼‰" class="headerlink" title="incrementalï¼ˆå¢é‡ç¼–è¯‘ï¼‰"></a><code>incremental</code>ï¼ˆå¢é‡ç¼–è¯‘ï¼‰</h5><p>æ§åˆ¶æ˜¯å¦å¯ç”¨å¢é‡ç¼–è¯‘ã€‚</p>
<ul>
<li><p><strong>å€¼ç±»å‹</strong>ï¼šå¸ƒå°”å€¼ (<code>true</code>&#x2F;<code>false</code>)</p>
</li>
<li><p><strong>å«ä¹‰</strong>ï¼š</p>
<ul>
<li><code>true</code>ï¼šå¯ç”¨å¢é‡ç¼–è¯‘ã€‚<code>cargo</code> ä¼šç¼“å­˜éƒ¨åˆ†ç¼–è¯‘ç»“æœï¼Œå½“ä¸‹æ¬¡ç¼–è¯‘åªæœ‰å°‘é‡æ–‡ä»¶æ”¹å˜æ—¶ï¼Œå¯ä»¥æå¤§åŠ å¿«ç¼–è¯‘é€Ÿåº¦</li>
<li><code>false</code>ï¼šç¦ç”¨å¢é‡ç¼–è¯‘ã€‚æ¯æ¬¡éƒ½æ˜¯ä»å¤´å¼€å§‹ç¼–è¯‘ï¼Œé€Ÿåº¦æ…¢ï¼Œä½†ç»“æœæ›´ç¡®å®š</li>
</ul>
</li>
</ul>
<h5 id="overflow-checksï¼ˆæ•´æ•°æº¢å‡ºæ£€æŸ¥ï¼‰"><a href="#overflow-checksï¼ˆæ•´æ•°æº¢å‡ºæ£€æŸ¥ï¼‰" class="headerlink" title="overflow-checksï¼ˆæ•´æ•°æº¢å‡ºæ£€æŸ¥ï¼‰"></a><code>overflow-checks</code>ï¼ˆæ•´æ•°æº¢å‡ºæ£€æŸ¥ï¼‰</h5><p>æ§åˆ¶æ˜¯å¦åœ¨è¿è¡Œæ—¶æ£€æŸ¥æ•´æ•°è¿ç®—çš„æº¢å‡ºã€‚</p>
<ul>
<li><p><strong>å€¼ç±»å‹</strong>ï¼šå¸ƒå°”å€¼ (<code>true</code>&#x2F;<code>false</code>)</p>
</li>
<li><p><strong>å«ä¹‰</strong>ï¼š</p>
<ul>
<li><code>true</code>ï¼šå¯ç”¨æº¢å‡ºæ£€æŸ¥ã€‚å¦‚æœå‘ç”Ÿæº¢å‡ºï¼ˆå¦‚ <code>u32::MAX + 1</code>ï¼‰ï¼Œç¨‹åºä¼š panicã€‚è¿™å¢åŠ äº†å®‰å…¨æ€§ï¼Œä½†æœ‰è½»å¾®çš„æ€§èƒ½å¼€é”€</li>
<li><code>false</code>ï¼šç¦ç”¨æº¢å‡ºæ£€æŸ¥ã€‚æº¢å‡ºæ—¶ä¼šè¿›è¡Œâ€ç¯ç»•â€ï¼ˆwrap aroundï¼‰ï¼Œä¾‹å¦‚ <code>u8::MAX + 1</code> ä¼šå˜æˆ <code>0</code>ã€‚æ€§èƒ½æ›´å¥½ï¼Œä½†å¯èƒ½å¼•å…¥å®‰å…¨æ¼æ´</li>
</ul>
</li>
</ul>
<h4 id="è‡ªå®šä¹‰-Profile"><a href="#è‡ªå®šä¹‰-Profile" class="headerlink" title="è‡ªå®šä¹‰ Profile"></a>è‡ªå®šä¹‰ Profile</h4><p>é™¤é»˜è®¤çš„ 5 ä¸ª profileï¼Œè¿˜å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰ profileï¼ˆå¦‚ <code>staging</code> é¢„å‘å¸ƒç¯å¢ƒã€<code>min-size</code> æè‡´ä½“ç§¯ç¯å¢ƒï¼‰ï¼Œæ»¡è¶³ç‰¹æ®Šéœ€æ±‚ã€‚</p>
<p>é€šè¿‡ <code>--profile</code> åœ¨å‘½ä»¤æŒ‡å®šè¦ä½¿ç”¨çš„ profileï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cargo build --profile staging</span><br></pre></td></tr></table></figure>

<h5 id="è‡ªå®šä¹‰-Profile-ç¤ºä¾‹"><a href="#è‡ªå®šä¹‰-Profile-ç¤ºä¾‹" class="headerlink" title="è‡ªå®šä¹‰ Profile ç¤ºä¾‹"></a>è‡ªå®šä¹‰ Profile ç¤ºä¾‹</h5><figure class="highlight toml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è‡ªå®šä¹‰é¢„å‘å¸ƒç¯å¢ƒï¼ˆstagingï¼‰ï¼šä»‹äº dev å’Œ release ä¹‹é—´</span></span><br><span class="line"><span class="section">[profile.staging]</span></span><br><span class="line"><span class="comment"># ç»§æ‰¿ release çš„åŸºç¡€é…ç½®ï¼ˆå¯é€‰ï¼Œå‡å°‘é‡å¤ï¼‰</span></span><br><span class="line"><span class="attr">inherits</span> = <span class="string">&quot;release&quot;</span></span><br><span class="line"><span class="comment"># è¦†ç›–ç»§æ‰¿çš„é…ç½®ï¼šä¸­çº§ä¼˜åŒ–ï¼Œä¿ç•™åŸºç¡€è°ƒè¯•ä¿¡æ¯</span></span><br><span class="line"><span class="attr">opt-level</span> = <span class="number">2</span></span><br><span class="line"><span class="attr">debug</span> = <span class="number">1</span></span><br><span class="line"><span class="comment"># å¯ç”¨ç˜¦ LTOï¼Œå¹³è¡¡æ€§èƒ½ä¸ç¼–è¯‘é€Ÿåº¦</span></span><br><span class="line"><span class="attr">lto</span> = <span class="string">&quot;thin&quot;</span></span><br><span class="line"><span class="comment"># å¯ç”¨å¢é‡ç¼–è¯‘ï¼ˆé¢„å‘å¸ƒç¯å¢ƒå¯èƒ½é¢‘ç¹ç¼–è¯‘ï¼‰</span></span><br><span class="line"><span class="attr">incremental</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="section">[profile.tiny]</span></span><br><span class="line"><span class="attr">inherits</span> = <span class="string">&quot;release&quot;</span></span><br><span class="line"><span class="attr">opt-level</span> = <span class="string">&quot;z&quot;</span></span><br><span class="line"><span class="attr">lto</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">strip</span> = <span class="string">&quot;all&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-rustc-ç¼–è¯‘å™¨"><a href="#2-rustc-ç¼–è¯‘å™¨" class="headerlink" title="2. rustc ç¼–è¯‘å™¨"></a>2. rustc ç¼–è¯‘å™¨</h2><p><code>rustc</code> æ˜¯ Rust çš„åº•å±‚ç¼–è¯‘å™¨ï¼ŒCargo çš„ç¼–è¯‘é€»è¾‘æœ€ç»ˆéƒ½ä¼šè½¬åŒ–ä¸º <code>rustc</code> å‘½ä»¤ä¸å‚æ•°ï¼ˆå¯é€šè¿‡ <code>cargo build -v</code> æŸ¥çœ‹å®é™…è°ƒç”¨çš„ <code>rustc</code> å‘½ä»¤ï¼‰ã€‚</p>
<h3 id="æ ¸å¿ƒç¼–è¯‘å‚æ•°"><a href="#æ ¸å¿ƒç¼–è¯‘å‚æ•°" class="headerlink" title="æ ¸å¿ƒç¼–è¯‘å‚æ•°"></a>æ ¸å¿ƒç¼–è¯‘å‚æ•°</h3><table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>-o &lt;out-name&gt;</code></td>
<td>æŒ‡å®šè¾“å‡ºæ–‡ä»¶åï¼ˆé»˜è®¤ç”Ÿæˆä¸ crate åç›¸åŒï¼‰</td>
<td><code>rustc src/main.rs -o target/my_app.exe</code></td>
</tr>
<tr>
<td><code>--crate-type &lt;type&gt;</code></td>
<td>æŒ‡å®šè¾“å‡ºç±»å‹ï¼ˆé»˜è®¤binï¼‰ï¼š<code>lib</code>&#x2F;<code>rlib</code>ï¼ˆRust é™æ€åº“ï¼‰ã€<code>staticlib</code>ï¼ˆåŸç”Ÿé™æ€åº“ï¼‰ã€<code>dylib</code>ï¼ˆRust åŠ¨æ€åº“ï¼‰ã€<code>cdylib</code>ï¼ˆåŸç”ŸåŠ¨æ€åº“ï¼‰ã€<code>bin</code>ï¼ˆå¯æ‰§è¡Œç¨‹åºï¼‰ã€<code>proc-macro</code>ï¼ˆè¿‡ç¨‹å®åº“ï¼‰</td>
<td><code>rustc src/lib.rs --crate-type lib</code></td>
</tr>
<tr>
<td><code>--edition &lt;2018/2021/2024&gt;</code></td>
<td>æŒ‡å®š Rust ç‰ˆæœ¬ï¼ˆé»˜è®¤è·Ÿéš Cargo.toml çš„ editionï¼‰</td>
<td><code>rustc src/main.rs --edition 2021</code></td>
</tr>
<tr>
<td><code>--extern &lt;name&gt;=&lt;path&gt;</code></td>
<td>å…³è”å¤–éƒ¨ä¾èµ–</td>
<td><code>rustc src/main.rs --extern serde=./target/debug/deps/libserde.rlib</code></td>
</tr>
<tr>
<td><code>-L &lt;dir&gt;</code></td>
<td>æ·»åŠ åº“æœç´¢è·¯å¾„ï¼ˆè®©ç¼–è¯‘å™¨æ‰¾åˆ°ä¾èµ–åº“æˆ–ç³»ç»Ÿåº“ï¼‰</td>
<td><code>rustc src/main.rs -L ./target/debug/deps</code></td>
</tr>
<tr>
<td><code>--print &lt;item&gt;</code></td>
<td>æ‰“å°ç¼–è¯‘å™¨ä¿¡æ¯ï¼ˆå¦‚ç›®æ ‡å¹³å°ã€é…ç½®å®ï¼‰</td>
<td><code>rustc --print target-list</code></td>
</tr>
</tbody></table>
<h3 id="ä¼˜åŒ–å‚æ•°ï¼ˆæ ¸å¿ƒé‡ç‚¹ï¼‰"><a href="#ä¼˜åŒ–å‚æ•°ï¼ˆæ ¸å¿ƒé‡ç‚¹ï¼‰" class="headerlink" title="ä¼˜åŒ–å‚æ•°ï¼ˆæ ¸å¿ƒé‡ç‚¹ï¼‰"></a>ä¼˜åŒ–å‚æ•°ï¼ˆæ ¸å¿ƒé‡ç‚¹ï¼‰</h3><p>ä¸ Cargo Profile çš„ <code>opt-level</code>ã€<code>lto</code> ç­‰å­—æ®µä¸€ä¸€å¯¹åº”ï¼Œæ˜¯æ§åˆ¶è¿è¡Œæ€§èƒ½ã€äºŒè¿›åˆ¶ä½“ç§¯çš„åº•å±‚å‚æ•°ã€‚</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
<th>å¯¹åº” Profile å­—æ®µ</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>-O0</code> &#x2F; <code>-O1</code> &#x2F; <code>-O2</code> &#x2F; <code>-O3</code> &#x2F; <code>-Os</code> &#x2F; <code>-Oz</code> æˆ– <code>-C opt-level=&lt;0-3/s/z&gt;</code></td>
<td>ä¼˜åŒ–ç­‰çº§</td>
<td><code>opt-level</code></td>
<td><code>rustc src/main.rs -O3</code></td>
</tr>
<tr>
<td><code>-C inline-threshold=&lt;n&gt;</code></td>
<td>è°ƒæ•´å‡½æ•°å†…è”é˜ˆå€¼ï¼ˆå€¼è¶Šå¤§è¶Šå¤šå‡½æ•°è¢«å†…è”ï¼Œé»˜è®¤ 225ï¼‰</td>
<td>-</td>
<td><code>rustc src/main.rs -C inline-threshold=300</code></td>
</tr>
<tr>
<td><code>-C lto</code> &#x2F; <code>-C lto=thin</code></td>
<td>å¯ç”¨é“¾æ¥æ—¶ä¼˜åŒ–</td>
<td><code>lto</code></td>
<td><code>rustc src/main.rs -O3 -C lto=thin</code></td>
</tr>
<tr>
<td><code>-C codegen-units=&lt;n&gt;</code></td>
<td>æŒ‡å®šä»£ç ç”Ÿæˆå•å…ƒï¼ˆå¹³è¡¡ç¼–è¯‘é€Ÿåº¦ä¸ä¼˜åŒ–æ•ˆæœï¼Œé»˜è®¤ dev&#x3D;16ã€release&#x3D;1ï¼‰</td>
<td><code>codegen-units</code></td>
<td><code>rustc src/main.rs -C codegen-units=4</code></td>
</tr>
<tr>
<td><code>-C target-cpu=&lt;cpu&gt;</code></td>
<td>é’ˆå¯¹ç‰¹å®š CPU æ¶æ„ä¼˜åŒ–ï¼ˆ<code>native</code>&#x3D; è‡ªåŠ¨é€‚é…æœ¬åœ° CPUï¼‰</td>
<td><code>rustflags = [&quot;-C target-cpu=native&quot;]</code></td>
<td><code>rustc src/main.rs -C target-cpu=aarch64</code></td>
</tr>
</tbody></table>
<h3 id="è°ƒè¯•ä¿¡æ¯ä¸ç¬¦å·å‚æ•°"><a href="#è°ƒè¯•ä¿¡æ¯ä¸ç¬¦å·å‚æ•°" class="headerlink" title="è°ƒè¯•ä¿¡æ¯ä¸ç¬¦å·å‚æ•°"></a>è°ƒè¯•ä¿¡æ¯ä¸ç¬¦å·å‚æ•°</h3><p>æ§åˆ¶äºŒè¿›åˆ¶æ–‡ä»¶çš„è°ƒè¯•ä¿¡æ¯ï¼ˆä¾› <code>gdb</code>&#x2F;<code>lldb</code> è°ƒè¯•ï¼‰å’Œç¬¦å·å‰¥ç¦»ï¼Œå½±å“æ–‡ä»¶ä½“ç§¯ã€‚</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
<th>å¯¹åº” Profile å­—æ®µ</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>-g / -g1 / -g2 / -g3</code></td>
<td>å¯ç”¨è°ƒè¯•ä¿¡æ¯ï¼ˆ<code>-g</code> ç­‰ä»·äº <code>-g2</code>ï¼‰</td>
<td><code>debug</code></td>
<td><code>rustc src/main.rs -g</code></td>
</tr>
<tr>
<td><code>-C debuginfo=&lt;0-3&gt;</code></td>
<td>ä¸ <code>-g</code> ç­‰ä»·ï¼Œæ˜¾å¼æŒ‡å®šè°ƒè¯•çº§åˆ«ï¼ˆ0 &#x3D; æ— ï¼Œ1 &#x3D; åŸºç¡€ï¼Œ2 &#x3D; å®Œæ•´ï¼Œ3 &#x3D; é¢å¤–ï¼‰</td>
<td><code>debug</code></td>
<td><code>rustc src/main.rs -C debuginfo=1</code></td>
</tr>
<tr>
<td><code>-C debuginfo-format=&lt;fmt&gt;</code></td>
<td>æŒ‡å®šè°ƒè¯•ä¿¡æ¯æ ¼å¼ï¼ˆ<code>rustc</code>&#x3D;Rust ä¸“ç”¨ï¼Œ<code>llvm</code>&#x3D;LLVM æ ¼å¼ï¼Œ<code>gdb</code>&#x3D; å…¼å®¹ GDBï¼‰</td>
<td>-</td>
<td><code>rustc src/main.rs -g -C debuginfo-format=gdb</code></td>
</tr>
<tr>
<td><code>-C strip=&lt;none/debuginfo/symbols&gt;</code></td>
<td>å‰¥ç¦»ç¬¦å·ä¿¡æ¯ï¼ˆ<code>debuginfo</code>&#x3D; ä»…å‰¥ç¦»è°ƒè¯•ä¿¡æ¯ï¼Œ<code>symbols</code>&#x3D; å‰¥ç¦»æ‰€æœ‰ç¬¦å·ï¼‰</td>
<td><code>strip</code></td>
<td><code>rustc src/main.rs -O3 -C strip=debuginfo</code></td>
</tr>
</tbody></table>
<h3 id="ç›®æ ‡å¹³å°ä¸äº¤å‰ç¼–è¯‘å‚æ•°"><a href="#ç›®æ ‡å¹³å°ä¸äº¤å‰ç¼–è¯‘å‚æ•°" class="headerlink" title="ç›®æ ‡å¹³å°ä¸äº¤å‰ç¼–è¯‘å‚æ•°"></a>ç›®æ ‡å¹³å°ä¸äº¤å‰ç¼–è¯‘å‚æ•°</h3><p>æ§åˆ¶ç¼–è¯‘çš„ç›®æ ‡å¹³å°ï¼ˆæ¶æ„&#x2F;æ“ä½œç³»ç»Ÿï¼‰ï¼Œç”¨äºäº¤å‰ç¼–è¯‘åœºæ™¯ï¼Œä¸ Cargo çš„ <code>--target</code> å¯¹åº”ã€‚</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>--target &lt;triple&gt;</code></td>
<td>æŒ‡å®šç›®æ ‡å¹³å°ä¸‰å…ƒç»„ï¼ˆå¦‚ <code>aarch64-unknown-linux-musl</code>ï¼‰</td>
<td><code>rustc src/main.rs --target aarch64-unknown-linux-musl</code>ï¼ˆäº¤å‰ç¼–è¯‘åˆ° ARM Linuxï¼‰</td>
</tr>
<tr>
<td><code>--print target-triple</code></td>
<td>æ‰“å°å½“å‰å¹³å°çš„ç›®æ ‡ä¸‰å…ƒç»„ï¼ˆç¡®è®¤ç¼–è¯‘ç¯å¢ƒï¼‰</td>
<td><code>rustc --print target-triple</code> # è¾“å‡º <code>x86_64-unknown-linux-gnu</code></td>
</tr>
<tr>
<td><code>--print target-spec-json</code></td>
<td>æ‰“å°ç›®æ ‡å¹³å°çš„è¯¦ç»†é…ç½®ï¼ˆJSON æ ¼å¼ï¼Œç”¨äºè‡ªå®šä¹‰ç›®æ ‡ï¼‰</td>
<td><code>rustc --target aarch64-unknown-linux-musl --print target-spec-json</code></td>
</tr>
<tr>
<td><code>-C linker=&lt;linker&gt;</code></td>
<td>æŒ‡å®šé“¾æ¥å™¨ï¼ˆäº¤å‰ç¼–è¯‘æ—¶éœ€é…ç½®ç›®æ ‡å¹³å°çš„é“¾æ¥å™¨ï¼‰</td>
<td><code>rustc src/main.rs --target aarch64-unknown-linux-musl -C linker=aarch64-linux-musl-gcc</code></td>
</tr>
</tbody></table>
<h3 id="é“¾æ¥å‚æ•°ï¼ˆå…³è”ç³»ç»Ÿåº“-x2F-è‡ªå®šä¹‰é“¾æ¥é€»è¾‘ï¼‰"><a href="#é“¾æ¥å‚æ•°ï¼ˆå…³è”ç³»ç»Ÿåº“-x2F-è‡ªå®šä¹‰é“¾æ¥é€»è¾‘ï¼‰" class="headerlink" title="é“¾æ¥å‚æ•°ï¼ˆå…³è”ç³»ç»Ÿåº“&#x2F;è‡ªå®šä¹‰é“¾æ¥é€»è¾‘ï¼‰"></a>é“¾æ¥å‚æ•°ï¼ˆå…³è”ç³»ç»Ÿåº“&#x2F;è‡ªå®šä¹‰é“¾æ¥é€»è¾‘ï¼‰</h3><p>ç”¨äºé“¾æ¥ç³»ç»Ÿåº“ï¼ˆå¦‚ <code>libc</code>ã€<code>openssl</code>ï¼‰æˆ–ä¼ é€’å‚æ•°ç»™é“¾æ¥å™¨ï¼ˆå¦‚ <code>ld</code>ã€<code>clang</code>ï¼‰ã€‚</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>-l &lt;lib&gt;</code></td>
<td>é“¾æ¥ç³»ç»Ÿåº“ï¼ˆçœç•¥å‰ç¼€ lib å’Œåç¼€ï¼Œå¦‚ libm å†™ä½œ mï¼‰</td>
<td><code>rustc src/main.rs -l m -l ssl</code></td>
</tr>
<tr>
<td><code>-L &lt;dir&gt;</code></td>
<td>æ·»åŠ åº“æœç´¢è·¯å¾„ï¼ˆè®©é“¾æ¥å™¨æ‰¾åˆ°ç³»ç»Ÿåº“æˆ–è‡ªå®šä¹‰åº“ï¼‰</td>
<td><code>rustc src/main.rs -L /usr/local/lib -l redis</code></td>
</tr>
<tr>
<td><code>-C link-arg=&lt;arg&gt;</code></td>
<td>ä¼ é€’å‚æ•°ç»™é“¾æ¥å™¨ï¼ˆå¦‚ ld çš„ <code>-s</code> å‰¥ç¦»ç¬¦å·ã€<code>-static</code> é™æ€é“¾æ¥ï¼‰</td>
<td><code>rustc src/main.rs -C link-arg=-s -C link-arg=-static</code></td>
</tr>
<tr>
<td><code>-C link-mode=&lt;static/dynamic&gt;</code></td>
<td>æŒ‡å®šé“¾æ¥æ¨¡å¼ï¼ˆé™æ€&#x2F;åŠ¨æ€ï¼Œé»˜è®¤è‡ªåŠ¨ï¼‰</td>
<td><code>rustc src/main.rs -C link-mode=static</code></td>
</tr>
</tbody></table>
<h3 id="ä»£ç ç”Ÿæˆä¸å®‰å…¨å‚æ•°"><a href="#ä»£ç ç”Ÿæˆä¸å®‰å…¨å‚æ•°" class="headerlink" title="ä»£ç ç”Ÿæˆä¸å®‰å…¨å‚æ•°"></a>ä»£ç ç”Ÿæˆä¸å®‰å…¨å‚æ•°</h3><p>æ›´ç²¾ç»†çš„ä»£ç ç”Ÿæˆæ§åˆ¶ï¼ŒåŒ…æ‹¬ panic ç­–ç•¥ã€æ ˆå¤§å°ã€å®‰å…¨æ£€æŸ¥ç­‰ã€‚</p>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
<th>å¯¹åº” Profile å­—æ®µ</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>-C panic=&lt;unwind/abort&gt;</code></td>
<td>æŒ‡å®š panic ç­–ç•¥ï¼ˆ<code>unwind</code>&#x3D; å±•å¼€æ ˆï¼Œ<code>abort</code>&#x3D; ç›´æ¥ç»ˆæ­¢ï¼‰</td>
<td><code>panic</code></td>
<td><code>rustc src/main.rs -C panic=abort</code></td>
</tr>
<tr>
<td><code>-C incremental=&lt;true/false&gt;</code></td>
<td>å¯ç”¨&#x2F;ç¦ç”¨å¢é‡ç¼–è¯‘ï¼ˆé»˜è®¤ dev&#x3D;trueã€release&#x3D;falseï¼‰</td>
<td><code>incremental</code></td>
<td><code>rustc src/main.rs -C incremental=false</code></td>
</tr>
<tr>
<td><code>-C stack-size=&lt;size&gt;</code></td>
<td>æŒ‡å®šä¸»çº¿ç¨‹æ ˆå¤§å°ï¼ˆå¦‚ 8MBã€16384 å­—èŠ‚ï¼‰</td>
<td>-</td>
<td><code>rustc src/main.rs -C stack-size=8388608</code></td>
</tr>
<tr>
<td><code>-C fstack-protector=&lt;all/strong/none&gt;</code></td>
<td>å¯ç”¨æ ˆä¿æŠ¤ï¼ˆé˜²æ­¢æ ˆæº¢å‡ºæ”»å‡»ï¼Œé»˜è®¤ noneï¼‰</td>
<td>-</td>
<td><code>rustc src/main.rs -C fstack-protector=strong</code></td>
</tr>
<tr>
<td><code>-C debug-assertions=&lt;true/false&gt;</code></td>
<td>å¯ç”¨&#x2F;ç¦ç”¨è°ƒè¯•æ–­è¨€ï¼ˆ<code>debug_assert!</code>ï¼‰</td>
<td><code>debug-assertions</code></td>
<td><code>rustc src/main.rs -C debug-assertions=false</code></td>
</tr>
</tbody></table>
<h2 id="å®è·µå»ºè®®"><a href="#å®è·µå»ºè®®" class="headerlink" title="å®è·µå»ºè®®"></a>å®è·µå»ºè®®</h2><h3 id="å¼€å‘é˜¶æ®µ"><a href="#å¼€å‘é˜¶æ®µ" class="headerlink" title="å¼€å‘é˜¶æ®µ"></a>å¼€å‘é˜¶æ®µ</h3><ul>
<li>ä½¿ç”¨é»˜è®¤ <code>dev</code> profileï¼ˆopt-level&#x3D;0ï¼‰</li>
<li>å¯ç”¨å¢é‡ç¼–è¯‘åŠ å¿«æ„å»ºé€Ÿåº¦</li>
<li>ä¿ç•™è°ƒè¯•ä¿¡æ¯ä¾¿äºè°ƒè¯•</li>
</ul>
<h3 id="æ€§èƒ½æµ‹è¯•"><a href="#æ€§èƒ½æµ‹è¯•" class="headerlink" title="æ€§èƒ½æµ‹è¯•"></a>æ€§èƒ½æµ‹è¯•</h3><ul>
<li>ä½¿ç”¨ <code>release</code> profile æˆ–åˆ›å»ºè‡ªå®šä¹‰ profile</li>
<li>å¯ç”¨ <code>lto = &quot;thin&quot;</code> è·å¾—æ›´å¥½çš„æ€§èƒ½</li>
<li>è®¾ç½® <code>codegen-units = 1</code> ä»¥å……åˆ†åˆ©ç”¨ LTO</li>
</ul>
<h3 id="ç”Ÿäº§å‘å¸ƒ"><a href="#ç”Ÿäº§å‘å¸ƒ" class="headerlink" title="ç”Ÿäº§å‘å¸ƒ"></a>ç”Ÿäº§å‘å¸ƒ</h3><ul>
<li>ä½¿ç”¨ <code>release</code> profileï¼ˆopt-level&#x3D;3ï¼‰</li>
<li>å¯ç”¨ LTOï¼ˆæ¨è <code>&quot;thin&quot;</code>ï¼‰</li>
<li>æ ¹æ®éœ€è¦å‰¥ç¦»è°ƒè¯•ä¿¡æ¯ä»¥å‡å°ä½“ç§¯</li>
</ul>
<h3 id="ä½“ç§¯ä¼˜åŒ–"><a href="#ä½“ç§¯ä¼˜åŒ–" class="headerlink" title="ä½“ç§¯ä¼˜åŒ–"></a>ä½“ç§¯ä¼˜åŒ–</h3><ul>
<li>è®¾ç½® <code>opt-level = &quot;z&quot;</code> å®ç°æœ€å°ä½“ç§¯</li>
<li>ä½¿ç”¨ <code>strip = &quot;all&quot;</code> å‰¥ç¦»æ‰€æœ‰ç¬¦å·</li>
<li>å¯ç”¨ LTO è¿›è¡Œå…¨å±€ä¼˜åŒ–</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li><strong>Cargo</strong> æ˜¯é«˜å±‚æŠ½è±¡ï¼Œæä¾›ç»Ÿä¸€çš„æ„å»ºç•Œé¢å’Œ Profile ç®¡ç†</li>
<li><strong>rustc</strong> æ˜¯åº•å±‚ç¼–è¯‘å™¨ï¼Œæ¥å—ç²¾ç»†åŒ–çš„ç¼–è¯‘å‚æ•°</li>
<li><strong>Profile</strong> æ˜¯æœ€å®ç”¨çš„ç¼–è¯‘é…ç½®ç®¡ç†æ–¹æ¡ˆï¼Œå»ºè®®ä¼˜å…ˆä½¿ç”¨</li>
<li>ç†è§£ <code>opt-level</code>ã€<code>lto</code>ã€<code>codegen-units</code> ç­‰å‚æ•°å¯ä»¥ç²¾ç»†è°ƒä¼˜æ€§èƒ½å’Œä½“ç§¯</li>
<li>ä½¿ç”¨ <code>cargo build -v</code> å¯ä»¥çœ‹åˆ°å®é™…çš„ rustc å‘½ä»¤ï¼Œä¾¿äºå­¦ä¹ å’Œè°ƒè¯•</li>
</ul>
]]></content>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Rustæ™ºèƒ½æŒ‡é’ˆ</title>
    <url>/2024/03/12/Rust%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88/</url>
    <content><![CDATA[<p>Rustçš„æ™ºèƒ½æŒ‡é’ˆï¼šå†…å­˜ç®¡ç†çš„åˆ©å™¨</p>
<p>Rustä»¥å…¶å†…å­˜å®‰å…¨å’Œæ— åƒåœ¾å›æ”¶çš„è®¾è®¡è€Œé—»åï¼Œè€Œæ™ºèƒ½æŒ‡é’ˆåˆ™æ˜¯Rustå†…å­˜ç®¡ç†çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚é€šè¿‡æ™ºèƒ½æŒ‡é’ˆï¼ŒRustèƒ½åœ¨ä¿è¯å†…å­˜å®‰å…¨çš„åŒæ—¶ï¼Œæä¾›çµæ´»ä¸”é«˜æ•ˆçš„å†…å­˜ç®¡ç†æœºåˆ¶ã€‚</p>
<p>æœ¬æ–‡å°†ä»‹ç»Rustä¸­çš„å‡ ç§å¸¸è§æ™ºèƒ½æŒ‡é’ˆï¼Œå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£Rustå¦‚ä½•ç®¡ç†å†…å­˜ä»¥åŠæ™ºèƒ½æŒ‡é’ˆå¦‚ä½•æå‡ä»£ç çš„å®‰å…¨æ€§å’Œå¯è¯»æ€§ã€‚</p>
<span id="more"></span>

<h2 id="ä»€ä¹ˆæ˜¯æ™ºèƒ½æŒ‡é’ˆï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ™ºèƒ½æŒ‡é’ˆï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ™ºèƒ½æŒ‡é’ˆï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ™ºèƒ½æŒ‡é’ˆï¼Ÿ</h2><p>æ™ºèƒ½æŒ‡é’ˆæ˜¯ä¸€ä¸ªåŒ…è£…ç±»å‹ï¼Œå®ƒæ¨¡æ‹Ÿäº†ä¼ ç»ŸæŒ‡é’ˆçš„è¡Œä¸ºï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼Œå°¤å…¶æ˜¯ä¸å†…å­˜ç®¡ç†ç›¸å…³çš„åŠŸèƒ½ã€‚åœ¨Rustä¸­ï¼Œæ™ºèƒ½æŒ‡é’ˆé€šå¸¸å®ç°äº†Drop traitï¼Œè¿™æ„å‘³ç€å®ƒä»¬èƒ½å¤Ÿåœ¨ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶è‡ªåŠ¨æ¸…ç†èµ„æºã€‚</p>
<p>Rustä¸­çš„æ™ºèƒ½æŒ‡é’ˆå¸¸è§çš„æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li><strong>Box<T></T></strong></li>
<li><strong>Rc<T></T></strong> å’Œ <strong>Arc<T></T></strong></li>
<li><strong>RefCell<T></T></strong> å’Œ <strong>Mutex<T></T></strong></li>
</ul>
<ol>
<li>Box<T> â€” åœ¨å †ä¸Šåˆ†é…å†…å­˜</T></li>
</ol>
<p>Box<T>æ˜¯Rustæœ€åŸºæœ¬çš„æ™ºèƒ½æŒ‡é’ˆä¹‹ä¸€ï¼Œå®ƒç”¨äºåœ¨å †ä¸Šåˆ†é…å†…å­˜å¹¶å­˜å‚¨æ•°æ®ã€‚Boxé€šè¿‡æ‰€æœ‰æƒç³»ç»Ÿç®¡ç†å †ä¸Šçš„æ•°æ®ï¼Œç¡®ä¿åœ¨Boxç¦»å¼€ä½œç”¨åŸŸæ—¶è‡ªåŠ¨æ¸…ç†å†…å­˜ã€‚</T></p>
<p><strong>ç¤ºä¾‹</strong></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">b</span> = <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(<span class="number">5</span>); <span class="comment">// åœ¨å †ä¸Šåˆ†é…æ•´æ•° 5</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;b = &#123;&#125;&quot;</span>, b);</span><br><span class="line">&#125; <span class="comment">// å½“ b ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå †ä¸Šçš„å†…å­˜ä¼šè‡ªåŠ¨è¢«é‡Šæ”¾</span></span><br></pre></td></tr></table></figure>


<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒBox::new(5)ä¼šåœ¨å †ä¸Šä¸ºæ•´æ•°5åˆ†é…å†…å­˜ï¼Œå¹¶è¿”å›ä¸€ä¸ªæŒ‡å‘è¯¥å†…å­˜çš„Boxã€‚å½“bç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼ŒBoxä¼šè‡ªåŠ¨é‡Šæ”¾å †ä¸Šçš„å†…å­˜ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</p>
<p>ä½¿ç”¨åœºæ™¯</p>
<ul>
<li>å½“ä½ æƒ³è¦åœ¨å †ä¸Šå­˜å‚¨å¤§å¯¹è±¡ï¼ˆä¾‹å¦‚å¤§å‹æ•°ç»„æˆ–ç»“æ„ä½“ï¼‰æ—¶ï¼Œ<code>Box&lt;T&gt;</code> æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</li>
<li>å½“ä½ éœ€è¦æ‹¥æœ‰æ•°æ®çš„å”¯ä¸€æ‰€æœ‰æƒæ—¶ï¼ŒBox æ˜¯ä¸€ä¸ªç®€æ´çš„è§£å†³æ–¹æ¡ˆã€‚</li>
</ul>
<h3 id="2-Rc-lt-T-gt-å’Œ-Arc-lt-T-gt-â€”-å¼•ç”¨è®¡æ•°"><a href="#2-Rc-lt-T-gt-å’Œ-Arc-lt-T-gt-â€”-å¼•ç”¨è®¡æ•°" class="headerlink" title="2. Rc&lt;T&gt; å’Œ Arc&lt;T&gt; â€” å¼•ç”¨è®¡æ•°"></a>2. Rc&lt;T&gt; å’Œ Arc&lt;T&gt; â€” å¼•ç”¨è®¡æ•°</h3><p>Rc<T>ï¼ˆReference Countedï¼‰å’ŒArc<T>ï¼ˆAtomic Reference Countedï¼‰éƒ½å®ç°äº†å¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆï¼Œç”¨äºå…±äº«å†…å­˜ã€‚ä¸Box<T>ä¸åŒï¼ŒRc<T>å’ŒArc<T>å…è®¸å¤šä¸ªæ‰€æœ‰è€…å…±äº«å¯¹æ•°æ®çš„å¼•ç”¨ã€‚</T></T></T></T></T></p>
<ul>
<li><code>Rc&lt;T&gt;</code>ï¼šåœ¨å•çº¿ç¨‹ä¸­ä½¿ç”¨ï¼Œæ€§èƒ½è¾ƒé«˜ã€‚</li>
<li><code>Arc&lt;T&gt;</code>ï¼šçº¿ç¨‹å®‰å…¨çš„ç‰ˆæœ¬ï¼Œé€‚ç”¨äºå¤šçº¿ç¨‹ç¯å¢ƒã€‚</li>
</ul>
<h4 id="ç¤ºä¾‹ï¼šä½¿ç”¨Rc-lt-T-gt"><a href="#ç¤ºä¾‹ï¼šä½¿ç”¨Rc-lt-T-gt" class="headerlink" title="ç¤ºä¾‹ï¼šä½¿ç”¨Rc&lt;T&gt;"></a>ç¤ºä¾‹ï¼šä½¿ç”¨Rc&lt;T&gt;</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::rc::Rc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s</span> = Rc::<span class="title function_ invoke__">new</span>(<span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;Hello, world!&quot;</span>));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">s2</span> = Rc::<span class="title function_ invoke__">clone</span>(&amp;s); <span class="comment">// å…‹éš† Rcï¼Œå¢åŠ å¼•ç”¨è®¡æ•°</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;s = &#123;&#125;, s2 = &#123;&#125;&quot;</span>, s, s2);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Reference count: &#123;&#125;&quot;</span>, Rc::<span class="title function_ invoke__">strong_count</span>(&amp;s)); <span class="comment">// æ‰“å°å¼•ç”¨è®¡æ•°</span></span><br><span class="line">&#125; <span class="comment">// å½“æ‰€æœ‰ Rc æŒ‡é’ˆç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå†…å­˜ä¼šè¢«é‡Šæ”¾</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨åœºæ™¯</p>
<ul>
<li><code>Rc&lt;T&gt;</code> é€‚åˆç”¨äºéœ€è¦å¤šä¸ªæ‰€æœ‰è€…å…±äº«æ•°æ®çš„åœºæ™¯ï¼Œä¸”åªåœ¨å•çº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</li>
<li><code>Arc&lt;T&gt;</code> é€‚ç”¨äºå¤šçº¿ç¨‹ç¯å¢ƒï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹å…±äº«æ•°æ®ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚</li>
</ul>
<h3 id="3-RefCell-lt-T-gt-å’Œ-Mutex-lt-T-gt-â€”-å¯å˜æ€§ä¸å†…éƒ¨å¯å˜æ€§"><a href="#3-RefCell-lt-T-gt-å’Œ-Mutex-lt-T-gt-â€”-å¯å˜æ€§ä¸å†…éƒ¨å¯å˜æ€§" class="headerlink" title="3. RefCell&lt;T&gt; å’Œ Mutex&lt;T&gt; â€” å¯å˜æ€§ä¸å†…éƒ¨å¯å˜æ€§"></a>3. RefCell&lt;T&gt; å’Œ Mutex&lt;T&gt; â€” å¯å˜æ€§ä¸å†…éƒ¨å¯å˜æ€§</h3><p>è™½ç„¶Rustçš„æ‰€æœ‰æƒå’Œå€Ÿç”¨ç³»ç»Ÿé€šå¸¸ä¸å…è®¸åŒæ—¶å­˜åœ¨å¤šä¸ªå¯å˜å¼•ç”¨ï¼Œä½†é€šè¿‡æ™ºèƒ½æŒ‡é’ˆï¼Œæˆ‘ä»¬å¯ä»¥ç»•è¿‡è¿™ä¸€é™åˆ¶ï¼Œæä¾›å†…éƒ¨å¯å˜æ€§ã€‚</p>
<ul>
<li><code>RefCell&lt;T&gt;</code>ï¼šå…è®¸åœ¨å•çº¿ç¨‹ä¸­è¿›è¡Œå¯å˜å€Ÿç”¨ï¼Œæä¾›è¿è¡Œæ—¶çš„å€Ÿç”¨æ£€æŸ¥ã€‚</li>
<li><code>Mutex&lt;T&gt;</code>ï¼šæä¾›å¤šçº¿ç¨‹ä¸­çš„å†…éƒ¨å¯å˜æ€§ï¼Œç¡®ä¿æ•°æ®åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å®‰å…¨å…±äº«ã€‚</li>
</ul>
<h4 id="ç¤ºä¾‹ï¼šä½¿ç”¨RefCell-lt-T-gt"><a href="#ç¤ºä¾‹ï¼šä½¿ç”¨RefCell-lt-T-gt" class="headerlink" title="ç¤ºä¾‹ï¼šä½¿ç”¨RefCell&lt;T&gt;"></a>ç¤ºä¾‹ï¼šä½¿ç”¨RefCell&lt;T&gt;</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::cell::RefCell;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = RefCell::<span class="title function_ invoke__">new</span>(<span class="number">5</span>);</span><br><span class="line">    *x.<span class="title function_ invoke__">borrow_mut</span>() = <span class="number">10</span>; <span class="comment">// å¯å˜å€Ÿç”¨</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;x = &#123;&#125;&quot;</span>, x.<span class="title function_ invoke__">borrow</span>()); <span class="comment">// ä¸å¯å˜å€Ÿç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒRefCellå…è®¸æˆ‘ä»¬é€šè¿‡borrow_mut()æ–¹æ³•è¿›è¡Œå¯å˜å€Ÿç”¨ï¼Œå¹¶åœ¨è¿è¡Œæ—¶æ£€æŸ¥å€Ÿç”¨è§„åˆ™ã€‚</p>
<h4 id="ç¤ºä¾‹ï¼šä½¿ç”¨Mutex-lt-T-gt"><a href="#ç¤ºä¾‹ï¼šä½¿ç”¨Mutex-lt-T-gt" class="headerlink" title="ç¤ºä¾‹ï¼šä½¿ç”¨Mutex&lt;T&gt;"></a>ç¤ºä¾‹ï¼šä½¿ç”¨Mutex&lt;T&gt;</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::sync::Mutex;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">m</span> = Mutex::<span class="title function_ invoke__">new</span>(<span class="number">5</span>);</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">num</span> = m.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>(); <span class="comment">// è·å–é”</span></span><br><span class="line">        *num = <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;m = &#123;&#125;&quot;</span>, m.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Mutex<T>ç¡®ä¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è®¿é—®æ•°æ®ï¼Œé¿å…æ•°æ®ç«äº‰ã€‚</T></p>
<p><strong>ä½¿ç”¨åœºæ™¯</strong></p>
<ul>
<li><code>RefCell&lt;T&gt;</code> é€‚åˆç”¨äºéœ€è¦åŠ¨æ€æ£€æŸ¥å’Œç®¡ç†å¯å˜å€Ÿç”¨çš„å•çº¿ç¨‹åº”ç”¨ã€‚</li>
<li><code>Mutex&lt;T&gt;</code> ç”¨äºå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œç¡®ä¿æ•°æ®çš„çº¿ç¨‹å®‰å…¨è®¿é—®ã€‚</li>
</ul>
<h3 id="4-Cell-lt-T-gt-â€”-ç®€å•çš„å†…éƒ¨å¯å˜æ€§"><a href="#4-Cell-lt-T-gt-â€”-ç®€å•çš„å†…éƒ¨å¯å˜æ€§" class="headerlink" title="4. Cell&lt;T&gt; â€” ç®€å•çš„å†…éƒ¨å¯å˜æ€§"></a>4. Cell&lt;T&gt; â€” ç®€å•çš„å†…éƒ¨å¯å˜æ€§</h3><p>Cell<T>æä¾›äº†ä¸€ç§éå¸¸è½»é‡çº§çš„æ–¹å¼æ¥å®ç°å†…éƒ¨å¯å˜æ€§ï¼Œé€‚ç”¨äºæ— éœ€å¼•ç”¨çš„æƒ…å†µä¸‹å­˜å‚¨æ•°æ®ã€‚å®ƒé€šå¸¸ç”¨äºå­˜å‚¨åŸºæœ¬ç±»å‹æ•°æ®ï¼Œå¦‚æ•´æ•°ã€å¸ƒå°”å€¼ç­‰ã€‚</T></p>
<h4 id="ç¤ºä¾‹ï¼šä½¿ç”¨Cell-lt-T-gt"><a href="#ç¤ºä¾‹ï¼šä½¿ç”¨Cell-lt-T-gt" class="headerlink" title="ç¤ºä¾‹ï¼šä½¿ç”¨Cell&lt;T&gt;"></a>ç¤ºä¾‹ï¼šä½¿ç”¨Cell&lt;T&gt;</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> std::cell::Cell;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">x</span> = Cell::<span class="title function_ invoke__">new</span>(<span class="number">5</span>);</span><br><span class="line">    x.<span class="title function_ invoke__">set</span>(<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;x = &#123;&#125;&quot;</span>, x.<span class="title function_ invoke__">get</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨åœºæ™¯</p>
<p><code>Cell&lt;T&gt;</code> é€‚åˆåœ¨å•çº¿ç¨‹ä¸­æä¾›ç®€å•çš„å¯å˜æ•°æ®å­˜å‚¨ï¼Œå°¤å…¶æ˜¯å¯¹äºåŸºç¡€æ•°æ®ç±»å‹ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Rustçš„æ™ºèƒ½æŒ‡é’ˆæä¾›äº†å¼ºå¤§çš„å†…å­˜ç®¡ç†èƒ½åŠ›ï¼Œå®ƒä»¬åœ¨ç¡®ä¿å†…å­˜å®‰å…¨çš„åŒæ—¶ï¼Œä¹Ÿä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿæ›´çµæ´»åœ°æ“ä½œæ•°æ®ã€‚åœ¨Rustä¸­ï¼Œæ™ºèƒ½æŒ‡é’ˆä¸ä»…ä»…æ˜¯å†…å­˜ç®¡ç†çš„å·¥å…·ï¼Œæ›´æ˜¯å€Ÿç”¨å’Œæ‰€æœ‰æƒç³»ç»Ÿçš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œå®ƒä»¬å¸®åŠ©å¼€å‘è€…é¿å…å†…å­˜æ³„æ¼å’Œæ•°æ®ç«äº‰çš„é—®é¢˜ã€‚</p>
<ul>
<li>**Box<T>**ï¼šé€‚ç”¨äºå †åˆ†é…æ•°æ®ï¼Œæ‹¥æœ‰å”¯ä¸€æ‰€æœ‰æƒã€‚</T></li>
<li><strong>Rc<T></T></strong> å’Œ **Arc<T>**ï¼šé€‚ç”¨äºå…±äº«æ•°æ®ï¼Œæä¾›å¼•ç”¨è®¡æ•°ã€‚</T></li>
<li><strong>RefCell<T></T></strong> å’Œ **Mutex<T>**ï¼šæä¾›å†…éƒ¨å¯å˜æ€§ï¼Œæ”¯æŒå•çº¿ç¨‹å’Œå¤šçº¿ç¨‹åœºæ™¯ã€‚</T></li>
<li>**Cell<T>**ï¼šé€‚ç”¨äºç®€å•ç±»å‹çš„æ•°æ®å­˜å‚¨ï¼Œæ”¯æŒå†…éƒ¨å¯å˜æ€§ã€‚</T></li>
</ul>
<p>é€šè¿‡åˆç†é€‰æ‹©åˆé€‚çš„æ™ºèƒ½æŒ‡é’ˆï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡ºæ—¢é«˜æ•ˆåˆå®‰å…¨çš„Rustç¨‹åºã€‚</p>
]]></content>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>Viewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶</title>
    <url>/2023/04/30/View%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<p>åœ¨è®²åˆ°Viewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶ä¹‹å‰è¦é¦–å…ˆäº†è§£ä¸€ä¸‹Activityçš„ç»„æˆï¼Œç„¶åä»æºç çš„è§’åº¦æ¥åˆ†æViewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶ã€‚</p>
<span id="more"></span>
<h2 id="ä¸€ã€æºç è§£æActivityçš„æ„æˆ"><a href="#ä¸€ã€æºç è§£æActivityçš„æ„æˆ" class="headerlink" title="ä¸€ã€æºç è§£æActivityçš„æ„æˆ"></a>ä¸€ã€æºç è§£æActivityçš„æ„æˆ</h2><p>ç‚¹å‡»äº‹ä»¶ç”¨MotionEventæ¥è¡¨ç¤ºï¼Œå½“ä¸€ä¸ªç‚¹å‡»äº‹ä»¶äº§ç”Ÿåï¼Œäº‹ä»¶æœ€å…ˆä¼ é€’ç»™Activityï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆäº†è§£ä¸€ä¸‹Activityçš„æ„æˆã€‚å½“æˆ‘ä»¬å†™Activityæ—¶ï¼Œä¼šè°ƒç”¨setContentView()<br>æ–¹æ³•æ¥åŠ è½½å¸ƒå±€ã€‚ç°åœ¨æ¥çœ‹çœ‹setContentView()æ–¹æ³•æ˜¯æ€ä¹ˆå®ç°çš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public void setContentView(@LayoutRes int layoutResID) &#123;</span><br><span class="line">	getWindow().setContentView(layoutResID);</span><br><span class="line">	initWindowDecorActionBar();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè°ƒç”¨äº†getWindow().setContentView(layoutResID)ï¼ŒgetWindow()æŒ‡çš„PhoneWindowï¼Œåœ¨PhoneWindowçš„setContentView()æ–¹æ³•é‡Œï¼Œå…ˆæ˜¯æœ‰installDecor()æ–¹æ³•<br>è¯¥æ–¹æ³•é‡Œé¢è°ƒç”¨äº†generateDecor()æ–¹æ³•ï¼Œåœ¨è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªDecorViewï¼Œè¿™ä¸ªDecorViewå°±æ˜¯Activityçš„æ ¹View.<br>åœ¨PhoneWindowä¸­çš„installDecor()æ–¹æ³•ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªgenerateLayout(mDecor)æ–¹æ³•ï¼Œå…¶ä¸»è¦å†…å®¹å°±æ˜¯æ ¹æ®ä¸åŒçš„æƒ…å†µåŠ è½½ä¸åŒçš„å¸ƒå±€ç»™layoutResourceã€‚</p>
<p>ä¸€ä¸ªActicityåŒ…å«ä¸€ä¸ªWindowå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯ç”±PhoneWindowæ¥å®ç°çš„ã€‚PhoneWindowå°†DecorViewä½œä¸ºæ•´ä¸ªåº”ç”¨çª—å£çš„æ ¹ï¼Œè€Œè¿™ä¸ªDecorViewåˆå°†å±å¹•<br>åˆ’åˆ†ä¸ºä¸¤ä¸ªåŒºåŸŸï¼Œä¸€ä¸ªæ˜¯TitleViewï¼Œå¦ä¸€ä¸ªæ˜¯ContentViewï¼Œè€Œæˆ‘ä»¬å¹³å¸¸åšåº”ç”¨æ‰€å†™çš„å¸ƒå±€æ­£æ˜¯å±•ç¤ºåœ¨ContentViewä¸­çš„ã€‚</p>
<h2 id="äºŒã€æºç è§£æViewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶"><a href="#äºŒã€æºç è§£æViewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶" class="headerlink" title="äºŒã€æºç è§£æViewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶"></a>äºŒã€æºç è§£æViewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶</h2><p>å½“æˆ‘ä»¬ç‚¹å‡»å±å¹•æ—¶ï¼Œå°±äº§ç”Ÿäº†ç‚¹å‡»äº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶è¢«å°è£…æˆä¸€ä¸ªç±»ï¼šMotionEventã€‚è€Œå½“è¿™ä¸ªMotionEventäº§ç”Ÿåï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ä¼šå°†è¿™ä¸ªMotionEventä¼ é€’ç»™Viewçš„å±‚çº§ï¼Œ<br>MotionEventåœ¨Viewä¸­çš„å±‚çº§ä¼ é€’å°±æ˜¯ç‚¹å‡»äº‹ä»¶åˆ†å‘ã€‚äº‹ä»¶åˆ†å‘çš„ä¸‰ä¸ªé‡è¦æ–¹æ³•ï¼š<br>dispatchTouchEvent(MotionEvent ev)â€”â€”ç”¨æ¥è¿›è¡Œäº‹ä»¶çš„åˆ†å‘ã€‚<br>onInterceptTouchEvent(MotionEvent ev)â€”â€”ç”¨æ¥è¿›è¡Œäº‹ä»¶çš„æ‹¦æˆªï¼Œåœ¨dispatchTouchEvent()æ–¹æ³•ä¸­è°ƒç”¨ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯Viewæ²¡æœ‰æä¾›è¯¥æ–¹æ³•ã€‚<br>onTouchEvent(MotionEvent ev)â€”â€”ç”¨æ¥å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼Œåœ¨dispatchTouchEvent()æ–¹æ³•ä¸­è°ƒç”¨ã€‚</p>
<h3 id="1-Viewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶"><a href="#1-Viewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶" class="headerlink" title="1.Viewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶"></a>1.Viewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶</h3><p>å½“ç‚¹å‡»äº‹ä»¶äº§ç”Ÿåï¼Œäº‹ä»¶é¦–å…ˆä¼šä¼ é€’ç»™å½“å‰çš„Activityï¼Œè¿™ä¼šè°ƒç”¨Activityçš„dispatchTouchEvent()æ–¹æ³•ï¼Œå½“ç„¶å…·ä½“çš„äº‹ä»¶å¤„ç†å·¥ä½œéƒ½æ˜¯äº¤ç”±Activityä¸­çš„PhoneWindowæ¥å®Œæˆçš„ï¼Œç„¶åPhoneWindowå†æŠŠäº‹ä»¶å¤„ç†å·¥ä½œäº¤ç»™DecorViewï¼Œä¹‹åå†ç”±<br>DecorViewå°†äº‹ä»¶å¤„ç†å·¥ä½œäº¤ç»™æ ¹ViewGroupã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä»ViewGroupçš„dispatchTouchEvent()æ–¹æ³•å¼€å§‹åˆ†æï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Override</span><br><span class="line">public boolean dispatchTouchEvent (MotionEvent ev) &#123;</span><br><span class="line">	...</span><br><span class="line">	if (actionMasked == MotionEvent.ACTION_ DOWN) &#123;</span><br><span class="line">		cancelAndClearTouchTargets (ev);</span><br><span class="line">		resetTouchState () ;</span><br><span class="line">	&#125;</span><br><span class="line">	if (actionMasked == MotionEvent.ACTION_DOWN</span><br><span class="line">|		|| mFirstTouchTarget != null) (//1</span><br><span class="line">		final boolean disallowIntercept = (GroupFlags &amp; FLAG_DISALLOW_</span><br><span class="line">		INTERCEPT) != 0;//2 if (!disallowIntercept) I</span><br><span class="line">		intercepted = onInterceptTouchEvent (ev);</span><br><span class="line">		ev. setAction (action);</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		intercepted = false;</span><br><span class="line">	&#125;</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		intercepted = true;</span><br><span class="line">	&#125;</span><br><span class="line">	...</span><br><span class="line">	return handled;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œé¦–å…ˆåˆ¤æ–­äº‹ä»¶æ˜¯å¦Downäº‹ä»¶ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿›è¡Œåˆå§‹åŒ–ï¼ŒresetTouchStateæ–¹æ³•ä¸­ä¼šæŠŠmFirstTouchTargetçš„å€¼ç½®ä¸ºnull<br>è¿™é‡Œä¸ºå•¥è¦åˆå§‹åŒ–å‘¢ï¼Ÿ<br>å› ä¸ºä¸€ä¸ªå®Œæ•´çš„äº‹ä»¶åºåˆ—æ˜¯ä»DOWNå¼€å§‹ï¼Œä»¥UPç»“æŸçš„ã€‚æ‰€ä»¥å¦‚æœæ˜¯DOWNäº‹ä»¶ï¼Œé‚£ä¹ˆè¯´æ˜è¿™æ˜¯ä¸€ä¸ªæ–°çš„äº‹ä»¶åºåˆ—ï¼Œæ•…è€Œéœ€è¦åˆå§‹åŒ–ä¹‹å‰çš„çŠ¶æ€ã€‚<br>å½“ViewGroupè¦æ‹¦æˆªäº‹ä»¶çš„æ—¶å€™ï¼Œé‚£ä¹ˆåç»­çš„äº‹ä»¶åºåˆ—éƒ½å°†äº¤ç»™å®ƒå¤„ç†ï¼Œè€Œä¸ç”¨å†è°ƒç”¨onInterceptTouchEvent()æ–¹æ³•äº†ï¼Œæ‰€ä»¥ï¼ŒonInterceptTouchEvent()<br>æ–¹æ³•å¹¶ä¸æ˜¯æ¯æ¬¡äº‹ä»¶éƒ½ä¼šè°ƒç”¨çš„ã€‚<br>onInterceptTouchEvent()æ–¹æ³•é»˜è®¤è¿”å›falseï¼Œä¸è¿›è¡Œæ‹¦æˆªã€‚å¦‚æœæƒ³è¦è®©ViewGroupæ‹¦æˆªäº‹ä»¶ï¼Œé‚£ä¹ˆåº”è¯¥åœ¨è‡ªå®šä¹‰çš„ViewGroupä¸­é‡å†™è¿™ä¸ªæ–¹æ³•ã€‚<br>åœ¨dispatchTouchEvent()æ–¹æ³•å‰©ä½™çš„éƒ¨åˆ†ï¼š<br>é¦–å…ˆéå†ViewGroupçš„å­å…ƒç´ ï¼Œåˆ¤æ–­å­å…ƒç´ æ˜¯å¦èƒ½å¤Ÿæ¥å—åˆ°ç‚¹å‡»äº‹ä»¶ï¼Œå¦‚æœå­å…ƒç´ èƒ½å¤Ÿæ¥æ”¶åˆ°ç‚¹å‡»äº‹ä»¶ï¼Œåˆ™äº¤ç”±å­å…ƒç´ æ¥å¤„ç†ã€‚éœ€è¦æ³¨æ„è¿™ä¸ªforå¾ªç¯<br>æ˜¯å€’åºéå†çš„ï¼Œå³ä»æœ€ä¸Šå±‚çš„å­Viewå¼€å§‹å¾€å†…å±‚éå†ã€‚ã€‚åŒæ—¶å®ƒä¹Ÿä¼šåˆ¤æ–­è§¦æ‘¸ç‚¹ä½ç½®æ˜¯å¦åœ¨å­viewçš„èŒƒå›´å†…æˆ–è€…å­Viewæ˜¯å¦æ­£åœ¨æ’­æ”¾åŠ¨ç”»ï¼Œå¦‚æœå‡ä¸ç¬¦åˆåˆ™<br>æ‰§è¡Œcontinueè¯­å¥ï¼Œè¡¨ç¤ºè¿™ä¸ªå­Viewä¸ç¬¦åˆæ¡ä»¶ï¼Œå¼€å§‹éå†ä¸‹ä¸€ä¸ªå­Viewã€‚<br>å¦‚æœæœ‰å­Viewï¼Œåˆ™è°ƒç”¨å­Viewçš„dispatchTouchEvent(event)æ–¹æ³•ï¼Œå¦‚æœViewGroupæ²¡æœ‰å­Viewï¼Œåˆ™è°ƒç”¨super.dispatchTouchEvent(event)æ–¹æ³•ã€‚viewgroupæ²¡æœ‰å­View<br>åˆ™è°ƒç”¨super.dispatchTouchEvent(event)æ–¹æ³•ã€‚ViewGroupæ˜¯é›†æˆViewçš„ã€‚åœ¨Viewçš„dispatchTouchEvent(event)ä¸­ï¼Œå¦‚æœOnTouchListenerä¸ä¸ºnullå¹¶ä¸”onTouchæ–¹æ³•è¿”å›trueï¼Œ<br>åˆ™è¡¨ç¤ºäº‹ä»¶è¢«æ¶ˆè´¹ï¼Œå°±ä¸ä¼šæ‰§è¡ŒonTouchEvent(event)ï¼Œå¦åˆ™å°±ä¼šæ‰§è¡Œï¼Œå¯ä»¥çœ‹å‡ºOnTouchListenerä¸­çš„onTouchæ–¹æ³•ä¼˜å…ˆçº§è¦é«˜äºonTouchEvent(event)ã€‚<br>åœ¨onTouchEvent()æ–¹æ³•ä¸­ï¼Œåªè¦Viewçš„Clickableå’ŒLong_clickableæœ‰ä¸€ä¸ªä¸ºtrueï¼Œé‚£ä¹ˆonTouchEvent()æ–¹æ³•å°±ä¼šè¿”å›trueæ¶ˆè€—è¿™ä¸ªäº‹ä»¶ã€‚å‰é¢ä¸¤ä¸ªå˜é‡åˆ†åˆ«ä»£è¡¨<br>viewå¯ä»¥è¢«ç‚¹å‡»å’Œé•¿æŒ‰ç‚¹å‡»ï¼Œå¯ä»¥é€šè¿‡Viewçš„setClickableå’ŒsetLongClickableæ–¹æ³•æ¥è®¾ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡Viewçš„setOnclickListenerå’ŒsetOnLongClickListeneræ¥è®¾ç½®ï¼Œå®ƒä»¬<br>ä¼šè‡ªåŠ¨å°†Viewè®¾ç½®ä¸ºLickableå’ŒLong_clickable<br>æ¥ç€åœ¨Action_UPäº‹ä»¶ä¼šè°ƒç”¨performClick()æ–¹æ³•ï¼Œå¦‚æœViewè®¾ç½®äº†OnClickListenerï¼Œé‚£ä¹ˆå®ƒçš„onClick()æ–¹æ³•å°±ä¼šè¢«æ‰§è¡Œã€‚</p>
<h3 id="ç‚¹å‡»äº‹ä»¶åˆ†å‘çš„ä¼ é€’è§„åˆ™"><a href="#ç‚¹å‡»äº‹ä»¶åˆ†å‘çš„ä¼ é€’è§„åˆ™" class="headerlink" title="ç‚¹å‡»äº‹ä»¶åˆ†å‘çš„ä¼ é€’è§„åˆ™"></a>ç‚¹å‡»äº‹ä»¶åˆ†å‘çš„ä¼ é€’è§„åˆ™</h3><p>å½“ç‚¹å‡»äº‹ä»¶äº§ç”Ÿåä¼šç”±Activityæ¥å¤„ç†ï¼Œä¼ é€’ç»™PhoneWindowï¼Œå†ä¼ é€’ç»™DecorViewï¼Œæœ€åä¼ é€’ç»™é¡¶å±‚çš„ViewGroupï¼Œä¸€èˆ¬åœ¨äº‹ä»¶ä¼ é€’ä¸­åªè€ƒè™‘ViewGroupçš„<br>onInterceptTouchEventæ–¹æ³•ï¼Œå› ä¸ºä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¸ä¼šé‡å†™dispatchTouchEvent()æ–¹æ³•ï¼Œå¯¹å‘€æ ¹ViewGroupï¼Œç‚¹å‡»äº‹ä»¶é¦–å…ˆä¼ é€’ç»™å®ƒdispatchTouchEvent()æ–¹æ³•ï¼Œå¦‚æœè¯¥ViewGroupçš„onInterceptTouchEvent()æ–¹æ³•è¿”å›trueï¼Œåˆ™è¡¨ç¤ºå®ƒ<br>è¦æ‹¦æˆªè¿™ä¸ªäº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶å°±ä¼šäº¤ç»™å®ƒçš„onTouchEvent()æ–¹æ³•å¤„ç†ï¼Œå¦‚æœonInterceptTouchEventï¼ˆï¼‰æ–¹æ³•è¿”å›falseï¼Œåˆ™è¡¨ç¤ºå®ƒä¸æ‹¦æˆªè¿™ä¸ªäº‹ä»¶ï¼Œåˆ™è¿™ä¸ªäº‹ä»¶ä¼šäº¤ç»™å®ƒçš„å­å…ƒç´ çš„dispatchTouchEventï¼ˆï¼‰æ¥å¤„ç†ï¼Œå¦‚æ­¤åå¤ä¸‹å»ã€‚å¦‚æœä¼ é€’ç»™åº•å±‚çš„Viewï¼Œ<br>Viewæ˜¯æ²¡æœ‰å­Viewçš„ï¼Œå°±ä¼šè°ƒç”¨Viewçš„dispatchTouchEventï¼ˆï¼‰æ–¹æ³•ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æœ€ç»ˆä¼šè°ƒç”¨Viewçš„onTouchEventï¼ˆï¼‰æ–¹æ³•ã€‚</p>
]]></content>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title>redis ç›¸å…³çŸ¥è¯†</title>
    <url>/2023/05/24/redis-%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/</url>
    <content><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>Redisæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„key-valueæ•°æ®åº“ã€‚</p>
<h3 id="Redisä¼˜åŠ¿"><a href="#Redisä¼˜åŠ¿" class="headerlink" title="Redisä¼˜åŠ¿"></a>Redisä¼˜åŠ¿</h3><ul>
<li>æ€§èƒ½æé«˜ â€“ Redisèƒ½è¯»çš„é€Ÿåº¦æ˜¯110000æ¬¡&#x2F;s,å†™çš„é€Ÿåº¦æ˜¯81000æ¬¡&#x2F;s ã€‚</li>
<li>ä¸°å¯Œçš„æ•°æ®ç±»å‹ â€“ Redisæ”¯æŒäºŒè¿›åˆ¶æ¡ˆä¾‹çš„ Strings, Lists, Hashes, Sets åŠ Ordered Sets æ•°æ®ç±»å‹æ“ä½œã€‚</li>
<li>åŸå­ â€“ Redisçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼Œæ„æ€å°±æ˜¯è¦ä¹ˆæˆåŠŸæ‰§è¡Œè¦ä¹ˆå¤±è´¥å®Œå…¨ä¸æ‰§è¡Œã€‚å•ä¸ªæ“ä½œæ˜¯åŸå­æ€§çš„ã€‚å¤šä¸ªæ“ä½œä¹Ÿæ”¯æŒäº‹åŠ¡ï¼Œå³åŸå­æ€§ï¼Œé€šè¿‡MULTIå’ŒEXECæŒ‡ä»¤åŒ…èµ·æ¥ã€‚</li>
<li>ä¸°å¯Œçš„ç‰¹æ€§ â€“ Redisè¿˜æ”¯æŒ publish&#x2F;subscribe, é€šçŸ¥, key è¿‡æœŸç­‰ç­‰ç‰¹æ€§ã€‚</li>
</ul>
<span id="more"></span>
<h2 id="redisçš„æ•°æ®ç»“æ„"><a href="#redisçš„æ•°æ®ç»“æ„" class="headerlink" title="redisçš„æ•°æ®ç»“æ„"></a>redisçš„æ•°æ®ç»“æ„</h2><p>Redisæ”¯æŒäº”ä¸­æ•°æ®ç±»å‹ï¼šStringã€hashã€listã€setå’Œzsetï¼ˆæœ‰åºé›†åˆï¼‰</p>
<h3 id="String-ç±»å‹"><a href="#String-ç±»å‹" class="headerlink" title="String ç±»å‹"></a>String ç±»å‹</h3><p>String ç±»å‹æ˜¯ä¸€ä¸ªï¼ˆkey&#x3D;&#x3D;&gt;valueï¼‰çš„é”®å€¼å¯¹</p>
<blockquote>
<p>set test â€œtestâ€<br>OK<br>get test<br>â€œtestâ€</p>
</blockquote>
<p>*æ³¨æ„ï¼šä¸€ä¸ªé”®æœ€å¤§èƒ½å­˜å‚¨512MB</p>
<h3 id="Hashï¼ˆå“ˆå¸Œï¼‰"><a href="#Hashï¼ˆå“ˆå¸Œï¼‰" class="headerlink" title="Hashï¼ˆå“ˆå¸Œï¼‰"></a>Hashï¼ˆå“ˆå¸Œï¼‰</h3><p>String ç±»å‹æ˜¯ä¸€ä¸ªï¼ˆkey&#x3D;&#x3D;&gt;valueï¼‰çš„é”®å€¼å¯¹é›†åˆï¼Œæ¯ä¸ªæœ€å¤–å±‚keyå¯¹åº”å¤šä¸ªï¼ˆkey&#x3D;&#x3D;&gt;valueï¼‰å½¢å¼çš„é”®å€¼å¯¹<br>ä½¿ç”¨æ—¶éœ€è¦ç”¨å‘½ä»¤HSET å’ŒHGETå‘½ä»¤ã€‚</p>
<blockquote>
<p>hset htest h1 â€œt1â€ h2 â€œt2â€<br>2<br>hget htest h1<br>â€œt1â€<br>hget htest h2<br>â€œt2â€</p>
</blockquote>
<h3 id="Listï¼ˆåˆ—è¡¨ï¼‰"><a href="#Listï¼ˆåˆ—è¡¨ï¼‰" class="headerlink" title="Listï¼ˆåˆ—è¡¨ï¼‰"></a>Listï¼ˆåˆ—è¡¨ï¼‰</h3><p>æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œæ’åºé»˜è®¤æŒ‰ç…§æ’å…¥é¡ºåºæ’åº<br>éœ€è¦ç”¨å‘½ä»¤LPUSH å’ŒLRANGE start end(ç»™å‡ºç´¢å¼•èµ·å§‹å’Œç»“æŸä½ç½®å·¦é—­åˆé—­åŒºé—´)å‘½ä»¤ã€‚<br> lpush ltest qq<br>(integer) 1</p>
<blockquote>
<p>lpush ltest ll<br>(integer) 2<br>lrange ltest 0 10</p>
</blockquote>
<ol>
<li>â€œllâ€</li>
<li>â€œqqâ€</li>
</ol>
<h3 id="setï¼ˆé›†åˆï¼‰"><a href="#setï¼ˆé›†åˆï¼‰" class="headerlink" title="setï¼ˆé›†åˆï¼‰"></a>setï¼ˆé›†åˆï¼‰</h3><p>æ·»åŠ ä¸€ä¸ªstringå¯¹è±¡åˆ°å¯¹åº”çš„seté›†åˆä¸­ï¼ŒæˆåŠŸè¿”å›1ï¼Œå¦‚æœå…ƒç´ å·²åœ¨é›†åˆä¸­è¿”å›0<br>æ·»åŠ å…ƒç´ ä½¿ç”¨ï¼šsaddï¼Œæ˜¾ç¤ºæ‰€æœ‰å…ƒç´ ä½¿ç”¨ smembers</p>
<blockquote>
<p>sadd stest 1<br>(integer) 1<br>sadd stest 2<br>(integer) 1<br>sadd stest 1<br>(integer) 0<br>smembers stest</p>
</blockquote>
<ol>
<li>â€œ1â€</li>
<li>â€œ2â€</li>
</ol>
<h3 id="zsetï¼ˆæœ‰åºé›†åˆï¼‰"><a href="#zsetï¼ˆæœ‰åºé›†åˆï¼‰" class="headerlink" title="zsetï¼ˆæœ‰åºé›†åˆï¼‰"></a>zsetï¼ˆæœ‰åºé›†åˆï¼‰</h3><p>Redis zset å’Œ set ä¸€æ ·ä¹Ÿæ˜¯stringç±»å‹å…ƒç´ çš„é›†åˆ,ä¸”ä¸å…è®¸é‡å¤çš„æˆå‘˜ã€‚<br>ä¸åŒçš„æ˜¯æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ªdoubleç±»å‹çš„åˆ†æ•°ã€‚redisæ­£æ˜¯é€šè¿‡åˆ†æ•°æ¥ä¸ºé›†åˆä¸­çš„æˆå‘˜è¿›è¡Œä»å°åˆ°å¤§çš„æ’åºã€‚<br>zsetçš„æˆå‘˜æ˜¯å”¯ä¸€çš„,ä½†åˆ†æ•°(score)å´å¯ä»¥é‡å¤ã€‚<br>éœ€è¦ä½¿ç”¨å‘½ä»¤</p>
<blockquote>
<p>zadd ztest 0 t1<br>(integer) 1<br>zadd ztest 1 t2<br>(integer) 1<br>zadd ztest 0 t3<br>(integer) 1<br>zrangebyscore ztest 0 3</p>
</blockquote>
<ol>
<li>â€œt1â€</li>
<li>â€œt3â€</li>
<li>â€œt2â€</li>
</ol>
<h2 id="redisæŒä¹…åŒ–"><a href="#redisæŒä¹…åŒ–" class="headerlink" title="redisæŒä¹…åŒ–"></a>redisæŒä¹…åŒ–</h2><p>ä¸ºä»€ä¹ˆéœ€è¦æŒä¹…åŒ–ï¼Ÿ<br>Redisçš„æ•°æ®éƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè‹¥æ²¡æœ‰é…ç½®æŒä¹…åŒ–ï¼Œredisé‡å¯åæ•°æ®å°±ä¸¢å¤±äº†ï¼Œäºæ˜¯éœ€è¦å¼€å¯redisçš„æŒä¹…åŒ–åŠŸèƒ½ï¼Œå°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œé‡å¯åä»ç£ç›˜æ¢å¤æ•°æ®ã€‚redisæä¾›äº†ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼š1.RDBæŒä¹…åŒ–ï¼ˆå®šæ—¶å°†redisåœ¨å†…å­˜ä¸­çš„æ•°æ®ç”Ÿæˆå¿«ç…§ï¼Œå…¨é‡åŒæ­¥åˆ°ç£ç›˜ï¼‰ã€‚2.AOFï¼ˆappend only fileï¼‰æŒä¹…åŒ–ï¼ˆå°†redisçš„æ“ä½œæ—¥å¿—ä»¥è¿½åŠ çš„æ–¹å¼å†™å…¥æ–‡ä»¶ï¼‰ã€‚</p>
<ol>
<li><p>RDBæŒä¹…åŒ–<br>è¿‡ç¨‹ï¼šåœ¨æŒ‡å®šæ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ï¼Œå®é™…æ“ä½œè¿‡ç¨‹å°±æ˜¯forkä¸€ä¸ªå­è¿›ç¨‹ï¼Œå…ˆå°†æ•°æ®é›†å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œå†™å…¥æˆåŠŸåï¼Œå†æ›¿æ¢ä¹‹å‰çš„æ–‡ä»¶ï¼Œç”¨äºäºŒè¿›åˆ¶å‹ç¼©å­˜å‚¨ã€‚<br><a href="https://imgse.com/i/pCtU9i9"><img src="https://s1.ax1x.com/2023/06/24/pCtU9i9.png" alt="pCtU9i9.png"></a><br>ä¼˜ç‚¹ï¼š<br>1.redisåªä¼šåŒ…å«ä¸€ä¸ªæ–‡ä»¶ï¼Œä¾¿äºæ–‡ä»¶å¤‡ä»½ã€‚å¯ä»¥é…ç½®æ¯å°æ—¶å½’æ¡£æœ€è¿‘24å°æ—¶çš„æ•°æ®ï¼ŒåŒæ—¶æ¯å¤©å½’æ¡£æœ€è¿‘30å¤©çš„æ•°æ®ï¼Œé€šè¿‡è¿™æ ·çš„ç­–ç•¥ï¼Œä¸€æ—¦ç³»ç»Ÿå‡ºç°ç¾éš¾æ€§æ•…éšœï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„è¿›è¡Œæ¢å¤ã€‚<br>2.RDBé€‚åˆäºç¾éš¾æ¢å¤ï¼Œå¯ä»¥å¾ˆè½»æ¾çš„å°†ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶å‹ç¼©åå†è½¬ç§»åˆ°å…¶ä»–å­˜å‚¨ä»‹è´¨ä¸Šã€‚<br>3.æ€§èƒ½æœ€å¤§åŒ–ã€‚forkå‡ºä¸€ä¸ªå­è¿›ç¨‹å®ŒæˆæŒä¹…åŒ–æ“ä½œï¼Œé¿å…äº†å•ä¸ªçº¿ç¨‹çš„IOé—®é¢˜ã€‚<br>4.ç›¸æ¯”äºAOFæœºåˆ¶ï¼Œå¦‚æœæ•°æ®é›†å¾ˆå¤§ï¼ŒRDBçš„å¯åŠ¨æ•ˆç‡æ›´é«˜ã€‚<br>ç¼ºç‚¹ï¼š<br>1.æ— æ³•ä¿è¯æ•°æ®çš„é«˜å¯ç”¨æ€§ï¼Œå³æœ€å¤§é™åº¦çš„é¿å…æ•°æ®ä¸¢å¤±ã€‚å¦‚æœåœ¨æŒä¹…åŒ–ä¹‹å‰å‡ºç°å®•æœºç°è±¡ï¼Œæ­¤å‰æœªæ¥å¾—åŠå†™å…¥ç£ç›˜çš„æ•°æ®éƒ½å°†ä¸¢å¤±ã€‚<br>2.forkå­è¿›ç¨‹å®ŒæˆæŒä¹…åŒ–æ“ä½œæ—¶ï¼Œå¦‚æœæ•°æ®é›†è¾ƒå¤§æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨åœæ­¢æœåŠ¡å‡ ç™¾æ¯«ç§’åˆ°1ç§’ã€‚</p>
</li>
<li><p>AOFæŒä¹…åŒ–<br>è¿‡ç¨‹ï¼šAOFä»¥æ—¥å¿—çš„å½¢å¼æ¥è®°å½•æ¯ä¸ªå†™æ“ä½œï¼Œå°†redisæ‰§è¡Œè¿‡çš„æ‰€æœ‰å†™æŒ‡ä»¤è®°å½•ä¸‹æ¥ï¼Œåªè®¸è¿½åŠ æ–‡ä»¶ä½†ä¸å…è®¸æ”¹å†™æ–‡ä»¶ï¼Œrediså¯åŠ¨ä¹‹åå°±ä¼šè¯»å–è¯¥æ–‡ä»¶é‡æ„æ•°æ®é›†ã€‚é»˜è®¤æ˜¯ä¸å¼€å¯çš„ï¼Œéœ€è¦å°†appendonlyæ”¹ä¸ºyeså°±å¼€å¯äº†aofï¼Œé‡å¯åç”Ÿæ•ˆã€‚<br><a href="https://imgse.com/i/pCtUCGR"><img src="https://s1.ax1x.com/2023/06/24/pCtUCGR.png" alt="pCtUCGR.png"></a><br>ä¼˜ç‚¹ï¼š<br>1.æ›´é«˜çš„æ•°æ®å®‰å…¨æ€§ï¼Œä¿è¯æ•°æ®åœ¨redisé‡å¯å‰åæ˜¯ä¸€è‡´çš„ã€‚<br>2.æ—¥å¿—å†™æ“ä½œé‡‡ç”¨çš„æ˜¯appendæ–¹å¼ï¼Œå†™å…¥è¿‡ç¨‹ä¸­å‡ºç°å®•æœºä¹Ÿä¸ä¼šç ´åæ—¥å¿—æ–‡ä»¶ä¸­å·²å­˜åœ¨çš„å†…å®¹ã€‚<br>3.å¦‚æœæ—¥å¿—è¿‡å¤§ï¼Œredisä¼šè‡ªåŠ¨å¯ç”¨rewriteæœºåˆ¶ã€‚å³Redisä»¥appendæ¨¡å¼ä¸æ–­çš„å°†ä¿®æ”¹æ•°æ®å†™å…¥åˆ°è€çš„ç£ç›˜æ–‡ä»¶ä¸­ï¼ŒåŒæ—¶Redisè¿˜ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç”¨äºè®°å½•æ­¤æœŸé—´æœ‰å“ªäº›ä¿®æ”¹å‘½ä»¤è¢«æ‰§è¡Œã€‚å› æ­¤åœ¨è¿›è¡Œrewriteåˆ‡æ¢æ—¶å¯ä»¥æ›´å¥½çš„ä¿è¯æ•°æ®å®‰å…¨æ€§ã€‚<br>4.AOFåŒ…å«ä¸€ä¸ªæ ¼å¼æ¸…æ™°ã€æ˜“äºç†è§£çš„æ—¥å¿—æ–‡ä»¶ç”¨äºè®°å½•æ‰€æœ‰çš„ä¿®æ”¹æ“ä½œã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¯¥æ–‡ä»¶å®Œæˆæ•°æ®çš„é‡å»ºã€‚<br>ç¼ºç‚¹ï¼š<br>1.å¯¹äºç›¸åŒæ•°é‡çš„æ•°æ®é›†è€Œè¨€ï¼ŒAOFæ–‡ä»¶é€šå¸¸è¦å¤§äºRDBæ–‡ä»¶ã€‚RDB åœ¨æ¢å¤å¤§æ•°æ®é›†æ—¶çš„é€Ÿåº¦æ¯” AOF çš„æ¢å¤é€Ÿåº¦è¦å¿«ã€‚<br>2.æ ¹æ®åŒæ­¥ç­–ç•¥çš„ä¸åŒï¼ŒAOFåœ¨è¿è¡Œæ•ˆç‡ä¸Šå¾€å¾€ä¼šæ…¢äºRDBã€‚æ€»ä¹‹ï¼Œæ¯ç§’åŒæ­¥ç­–ç•¥çš„æ•ˆç‡æ˜¯æ¯”è¾ƒé«˜çš„ï¼ŒåŒæ­¥ç¦ç”¨ç­–ç•¥çš„æ•ˆç‡å’ŒRDBä¸€æ ·é«˜æ•ˆã€‚</p>
</li>
</ol>
<h2 id="Redisé›†ç¾¤"><a href="#Redisé›†ç¾¤" class="headerlink" title="Redisé›†ç¾¤"></a>Redisé›†ç¾¤</h2><p>1.ä¸»ä»æ¨¡å¼<br>è‡³å°‘éœ€è¦ä¸¤å°æœåŠ¡å™¨ï¼Œä¸€å°ä¸»èŠ‚ç‚¹ï¼ˆmasterï¼‰ï¼Œä¸€å°ä»èŠ‚ç‚¹ï¼ˆslaveï¼‰ã€‚masterä¸»è¦è´Ÿè´£å†™ï¼Œslaveä¸»è¦è´Ÿè´£è¯»ï¼Œä¸»ä»æ¨¡å¼å®ç°äº†è¯»å†™åˆ†ç¦»ã€‚<br><a href="https://imgse.com/i/pCtUkM6"><img src="https://s1.ax1x.com/2023/06/24/pCtUkM6.png" alt="pCtUkM6.png"></a><br>ä¸»ä»å¤åˆ¶çš„ä½œç”¨ï¼š<br>æ•°æ®å†—ä½™ï¼šå®ç°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„å¦ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼<br>æ•…éšœæ¢å¤ï¼šmasteræ•…éšœæ—¶ï¼Œslaveå¯ä»¥æä¾›æœåŠ¡ï¼Œå®ç°æ•…éšœå¿«é€Ÿæ¢å¤<br>è´Ÿè½½å‡è¡¡ï¼šmasterè´Ÿè´£å†™ï¼Œslaveè´Ÿè´£è¯»ã€‚åœ¨å†™å°‘è¯»å¤šçš„åœºæ™¯ä¸‹å¯ä»¥æå¤§æé«˜redisååé‡<br>é«˜å¯ç”¨åŸºçŸ³ï¼šä¸»ä»å¤åˆ¶æ˜¯rediså“¨å…µæ¨¡å¼å’Œé›†ç¾¤æ¨¡å¼çš„åŸºç¡€ã€‚<br>ä¸»ä»å¤åˆ¶å®ç°åŸç†ï¼š<br>ä¸»ä»å¤åˆ¶è¿‡ç¨‹ä¸»è¦å¯ä»¥åˆ†ä¸º3ä¸ªé˜¶æ®µï¼šè¿æ¥å»ºç«‹é˜¶æ®µã€æ•°æ®åŒæ­¥é˜¶æ®µã€å‘½ä»¤ä¼ æ’­é˜¶æ®µã€‚<br>è¿æ¥å»ºç«‹é˜¶æ®µï¼šåœ¨ä¸»ä»èŠ‚ç‚¹ä¹‹é—´å»ºç«‹è¿æ¥ï¼Œä¸ºæ•°æ®åŒæ­¥åšå‡†å¤‡ã€‚<br>æ•°æ®åŒæ­¥é˜¶æ®µï¼šæ‰§è¡Œæ•°æ®çš„å…¨é‡ï¼ˆæˆ–å¢é‡ï¼‰å¤åˆ¶ï¼ˆå¤åˆ¶RDBæ–‡ä»¶ï¼‰<br>å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼šä¸»èŠ‚ç‚¹å°†å·²æ‰§è¡Œçš„å‘½ä»¤å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹æ¥æ”¶å‘½ä»¤å¹¶æ‰§è¡Œï¼Œä»è€Œå®ç°ä¸»ä»èŠ‚ç‚¹çš„æ•°æ®ä¸€è‡´æ€§<br>ä¸»ä»æ¨¡å¼ä¸­ï¼Œä¸€ä¸ªä¸»èŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªä»èŠ‚ç‚¹ã€‚ä¸ºäº†å‡å°‘ä¸»ä»å¤åˆ¶å¯¹ä¸»èŠ‚ç‚¹çš„æ€§èƒ½å½±å“ï¼Œä¸€ä¸ªä»èŠ‚ç‚¹å¯ä»¥ä½œä¸ºå¦å¤–ä¸€ä¸ªä»èŠ‚ç‚¹çš„ä¸»èŠ‚ç‚¹è¿›è¡Œä¸»ä»å¤åˆ¶ã€‚<br>ä¸è¶³ä¹‹å¤„ï¼šä¸»èŠ‚ç‚¹å®•æœºä¹‹åï¼Œéœ€è¦æ‰‹åŠ¨æ‹‰èµ·ä»èŠ‚ç‚¹æ¥æä¾›ä¸šåŠ¡ï¼Œä¸èƒ½è¾¾åˆ°é«˜å¯ç”¨ã€‚</p>
<p>2.å“¨å…µæ¨¡å¼<br><a href="https://imgse.com/i/pCtUZZD"><img src="https://s1.ax1x.com/2023/06/24/pCtUZZD.png" alt="pCtUZZD.png"></a><br>å“¨å…µæ¨¡å¼çš„åŸç†<br>Sentinelæ˜¯ä¸€ç§ç‰¹æ®Šçš„redisèŠ‚ç‚¹ï¼Œæ¯ä¸ªsentinelèŠ‚ç‚¹ä¼šç»´æŠ¤ä¸å…¶ä»–redisèŠ‚ç‚¹ï¼ˆåŒ…æ‹¬master&#x2F;slave&#x2F;sentinelï¼‰çš„å¿ƒè·³ã€‚<br>å½“ä¸€ä¸ªsentinelèŠ‚ç‚¹ä¸masterèŠ‚ç‚¹çš„å¿ƒè·³ä¸¢å¤±æ—¶ï¼Œè¿™ä¸ªsentinelèŠ‚ç‚¹å°±ä¼šè®¤ä¸ºmasterèŠ‚ç‚¹å‡ºç°äº†æ•…éšœï¼Œå¤„äºä¸å¯ç”¨çš„çŠ¶æ€ï¼Œè¿™ç§åˆ¤å®šå«ä½œä¸»è§‚ä¸‹çº¿ï¼ˆå³sentinelèŠ‚ç‚¹è‡ªå·±ä¸»è§‚è®¤ä¸ºmasterä¸‹çº¿äº†ï¼‰ï¼Œä¹‹åï¼Œè¿™ä¸ªsentinelèŠ‚ç‚¹ä¼šä¸å…¶ä»–sentinelèŠ‚ç‚¹äº¤æ¢ä¿¡æ¯ï¼Œå¦‚æœå‘ç°è®¤ä¸ºä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœçš„sentinelèŠ‚ç‚¹çš„ä¸ªæ•°è¶…è¿‡äº†æŸä¸ªé˜ˆå€¼ï¼ˆé€šå¸¸ä¸ºsentinelèŠ‚ç‚¹æ€»æ•°çš„1&#x2F;2+1ï¼Œå³è¶…è¿‡åŠæ•°ï¼‰ï¼Œåˆ™sentinelä¼šè®¤ä¸ºmasterèŠ‚ç‚¹å·²ç»å¤„äºå®¢è§‚ä¸‹çº¿çš„çŠ¶æ€ï¼Œå³å¤§å®¶éƒ½è®¤ä¸ºmasteræ•…éšœä¸å¯ç”¨äº†ã€‚<br>ä¹‹åï¼ŒsentinelèŠ‚ç‚¹ä¸­ä¼šé€‰ä¸¾å¤„ä¸€ä¸ªsentinel leaderæ¥æ‰§è¡Œredisä¸»èŠ‚ç‚¹çš„æ•…éšœè½¬ç§»ã€‚<br>è¢«é€‰ä¸¾å‡ºçš„ Sentinel é¢†å¯¼è€…è¿›è¡Œæ•…éšœè½¬ç§»çš„å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š<br>ï¼ˆ1ï¼‰åœ¨ä»èŠ‚ç‚¹åˆ—è¡¨ä¸­é€‰å‡ºä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºæ–°çš„ä¸»èŠ‚ç‚¹</p>
<ul>
<li>è¿‡æ»¤ä¸å¥åº·æˆ–è€…ä¸æ»¡è¶³è¦æ±‚çš„èŠ‚ç‚¹ï¼›</li>
<li>é€‰æ‹© slave-priorityï¼ˆä¼˜å…ˆçº§ï¼‰æœ€é«˜çš„ä»èŠ‚ç‚¹ï¼Œ å¦‚æœå­˜åœ¨åˆ™è¿”å›ï¼Œ ä¸å­˜åœ¨åˆ™ç»§ç»­ï¼›</li>
<li>é€‰æ‹©å¤åˆ¶åç§»é‡æœ€å¤§çš„ä»èŠ‚ç‚¹ ï¼Œ å¦‚æœå­˜åœ¨åˆ™è¿”å›ï¼Œ ä¸å­˜åœ¨åˆ™ç»§ç»­ï¼›</li>
<li>é€‰æ‹© runid æœ€å°çš„ä»èŠ‚ç‚¹ã€‚<br>ï¼ˆ2ï¼‰Sentinel é¢†å¯¼è€…èŠ‚ç‚¹ä¼šå¯¹é€‰å‡ºæ¥çš„ä»èŠ‚ç‚¹æ‰§è¡Œ slaveof no one å‘½ä»¤è®©å…¶æˆä¸ºä¸»èŠ‚ç‚¹ã€‚<br>ï¼ˆ3ï¼‰Sentinel é¢†å¯¼è€…èŠ‚ç‚¹ä¼šå‘å‰©ä½™çš„ä»èŠ‚ç‚¹å‘é€å‘½ä»¤ï¼Œè®©ä»–ä»¬ä»æ–°çš„ä¸»èŠ‚ç‚¹ä¸Šå¤åˆ¶æ•°æ®ã€‚<br>ï¼ˆ4ï¼‰Sentinel é¢†å¯¼è€…ä¼šå°†åŸæ¥çš„ä¸»èŠ‚ç‚¹æ›´æ–°ä¸ºä»èŠ‚ç‚¹ï¼Œ å¹¶å¯¹å…¶è¿›è¡Œç›‘æ§ï¼Œ å½“å…¶æ¢å¤åå‘½ä»¤å®ƒå»å¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹ã€‚</li>
</ul>
<p>3.é›†ç¾¤æ¨¡å¼<br>å¦‚å›¾æ‰€ç¤ºé›†ç¾¤æ¨¡å¼å…¶å®å°±æ˜¯å¤šä¸ªä¸»ä»å¤åˆ¶çš„ç»“æ„ç»„åˆèµ·æ¥çš„ï¼Œæ¯ä¸€ä¸ªä¸»ä»å¤åˆ¶ç»“æ„å¯ä»¥çœ‹æˆä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆä¸Šé¢çš„Clusteré›†ç¾¤ä¸­å°±æœ‰ä¸‰ä¸ªèŠ‚ç‚¹ã€‚<br><a href="https://imgse.com/i/pCtUmIH"><img src="https://s1.ax1x.com/2023/06/24/pCtUmIH.png" alt="pCtUmIH.png"></a></p>
]]></content>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>rustä¸­çš„Cargo.tomlæ–‡ä»¶</title>
    <url>/2023/08/28/rust%E4%B8%AD%E7%9A%84Cargo-toml%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<p><code>Cargo.toml</code>åˆç§°æ¸…å•ï¼ˆmanifestï¼‰ï¼Œæ˜¯ Rust é¡¹ç›®çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œé‡‡ç”¨TOMLæ ¼å¼ï¼ˆTomâ€™s Obvious Minimal Languageï¼‰ã€‚å®ƒå®šä¹‰äº†ä¸€ä¸ªåŒ…ï¼ˆcrateï¼‰çš„ï¼š</p>
<ul>
<li>åç§°ã€ç‰ˆæœ¬ã€ä½œè€…ã€è®¸å¯è¯</li>
<li>ä¾èµ–é¡¹</li>
<li>ç¼–è¯‘ç‰¹æ€§</li>
<li>ç›®æ ‡é…ç½®</li>
<li>æ„å»ºè„šæœ¬</li>
<li>å·¥ä½œåŒºè®¾ç½®ç­‰</li>
</ul>
<span id="more"></span>

<h2 id="1-Cargo-toml-vs-Cargo-lock"><a href="#1-Cargo-toml-vs-Cargo-lock" class="headerlink" title="1. Cargo.toml vs Cargo.lock"></a>1. Cargo.toml vs Cargo.lock</h2><table>
<thead>
<tr>
<th>å¯¹æ¯”é¡¹</th>
<th>Cargo.toml</th>
<th>Cargo.lock</th>
</tr>
</thead>
<tbody><tr>
<td>ä½œç”¨</td>
<td>æºé…ç½®ï¼ˆå£°æ˜æ„å›¾ï¼‰</td>
<td>é”å®šæ–‡ä»¶ï¼ˆè®°å½•å®é™…ä¾èµ–ç‰ˆæœ¬ï¼‰</td>
</tr>
<tr>
<td>æ‰‹åŠ¨ç¼–è¾‘</td>
<td>æ˜¯ï¼ˆå¼€å‘è€…ç¼–å†™&#x2F;ä¿®æ”¹ï¼‰</td>
<td>å¦ï¼ˆCargoè‡ªåŠ¨ç”Ÿæˆ&#x2F;æ›´æ–°ï¼‰</td>
</tr>
<tr>
<td>æäº¤ Git</td>
<td>éœ€æäº¤</td>
<td>åº“çš„ä¸éœ€æäº¤ï¼›äºŒè¿›åˆ¶çš„éœ€æäº¤</td>
</tr>
<tr>
<td>æ ¸å¿ƒå†…å®¹</td>
<td>é¡¹ç›®å…ƒä¿¡æ¯ã€ä¾èµ–ã€æ„å»ºè§„åˆ™</td>
<td>ç²¾ç¡®çš„ä¾èµ–ç‰ˆæœ¬æ ‘ã€æ ¡éªŒå’Œ</td>
</tr>
</tbody></table>
<h2 id="2-åŸºç¡€ç»“æ„"><a href="#2-åŸºç¡€ç»“æ„" class="headerlink" title="2. åŸºç¡€ç»“æ„"></a>2. åŸºç¡€ç»“æ„</h2><p>Cargo.toml æŒ‰ã€ŒåŒºæ®µï¼ˆSectionï¼‰ã€ç»„ç»‡ï¼Œæ¯ä¸ªåŒºæ®µç”¨ <code>[åŒºæ®µå]</code> æ ‡è¯†ï¼Œæ ¸å¿ƒåŒºæ®µåŒ…æ‹¬ï¼š</p>
<ul>
<li>**<code>[package]</code>**ï¼šå®šä¹‰é¡¹ç›®å…ƒä¿¡æ¯ï¼ˆå¿…é€‰ï¼‰</li>
<li>**<code>[dependencies]</code>**ï¼šç”Ÿäº§ä¾èµ–ï¼ˆå¿…é€‰&#x2F;å¯é€‰ï¼Œè§†é¡¹ç›®ç±»å‹ï¼‰</li>
<li>**<code>[dev-dependencies]</code>**ï¼šå¼€å‘ä¾èµ–ï¼ˆæµ‹è¯•ã€æ–‡æ¡£æµ‹è¯•ç”¨ï¼‰</li>
<li>**<code>[build-dependencies]</code>**ï¼šæ„å»ºè„šæœ¬ä¾èµ–</li>
<li>**<code>[lib]</code>**ï¼šåº“ç›®æ ‡é…ç½®</li>
<li>**<code>[[bin]]</code>**ï¼šäºŒè¿›åˆ¶ç›®æ ‡é…ç½®ï¼ˆæ”¯æŒå¤šä¸ªï¼‰</li>
<li>**<code>[profile.*]</code>**ï¼šæ„å»ºé…ç½®æ–‡ä»¶ï¼ˆç¼–è¯‘ä¼˜åŒ–ã€è°ƒè¯•ä¿¡æ¯ç­‰ï¼‰</li>
<li>**<code>[features]</code>**ï¼šç‰¹æ€§å¼€å…³ï¼ˆæ¡ä»¶ç¼–è¯‘ã€å¯é€‰ä¾èµ–ï¼‰</li>
<li>**<code>[workspace]</code>**ï¼šå·¥ä½œç©ºé—´é…ç½®ï¼ˆå¤šåŒ…é¡¹ç›®ï¼‰</li>
</ul>
<h3 id="2-1-package-å…ƒä¿¡æ¯"><a href="#2-1-package-å…ƒä¿¡æ¯" class="headerlink" title="2.1 package å…ƒä¿¡æ¯"></a>2.1 package å…ƒä¿¡æ¯</h3><p>å®šä¹‰é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯ã€‚</p>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>è¯´æ˜</th>
<th>å€¼ç±»å‹</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>name</code></td>
<td>é¡¹ç›®åç§°ï¼ˆcrates.ioå”¯ä¸€ï¼‰</td>
<td>å­—ç¬¦ä¸²ï¼šå°å†™å­—æ¯+è¿å­—ç¬¦</td>
<td><code>name = &quot;my-rust-project&quot;</code></td>
</tr>
<tr>
<td><code>version</code></td>
<td>ç‰ˆæœ¬å·ï¼ˆè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼‰</td>
<td>éµå¾ª MAJOR.MINOR.PATCH</td>
<td><code>version = &quot;0.1.0&quot;</code></td>
</tr>
<tr>
<td><code>edition</code></td>
<td>Rustç‰ˆæœ¬ edition</td>
<td>æ”¯æŒ 2018&#x2F;2021&#x2F;2024</td>
<td><code>edition = &quot;2024&quot;</code></td>
</tr>
<tr>
<td><code>maintainers</code></td>
<td>ç»´æŠ¤è€…ä¿¡æ¯ï¼ˆæ›¿ä»£ authorsï¼Œæ¨èï¼‰</td>
<td>æ•°ç»„ï¼Œæ ¼å¼ [â€œå§“å &lt;é‚®ç®±&gt;â€]</td>
<td><code>maintainers = [&quot;Bob &lt;bob@example.com&gt;&quot;]</code></td>
</tr>
<tr>
<td><code>description</code></td>
<td>é¡¹ç›®æè¿°ï¼ˆcrates.ioå±•ç¤ºï¼‰</td>
<td>å­—ç¬¦ä¸²ï¼Œç®€æ´æ˜äº†ï¼ˆâ‰¤100å­—ç¬¦ï¼‰</td>
<td><code>description = &quot;A simple Rust utility&quot;</code></td>
</tr>
<tr>
<td><code>license</code></td>
<td>å¼€æºè®¸å¯è¯ï¼ˆSPDXæ ‡è¯†ç¬¦ï¼‰</td>
<td>å­—ç¬¦ä¸²ï¼Œå¦‚ MITã€Apache-2.0ã€GPL-3.0</td>
<td><code>license = &quot;MIT&quot;</code></td>
</tr>
<tr>
<td><code>license-file</code></td>
<td>è‡ªå®šä¹‰è®¸å¯è¯æ–‡ä»¶è·¯å¾„</td>
<td>å­—ç¬¦ä¸²ï¼Œå½“ license æ— æ³•ç”¨ SPDX æ ‡è¯†æ—¶ä½¿ç”¨</td>
<td><code>license-file = &quot;LICENSE.txt&quot;</code></td>
</tr>
<tr>
<td><code>repository</code></td>
<td>ä»£ç ä»“åº“åœ°å€</td>
<td>å­—ç¬¦ä¸²ï¼ˆGitåœ°å€æˆ–ç½‘é¡µé“¾æ¥ï¼‰</td>
<td><code>repository = &quot;https://github.com/foo/bar&quot;</code></td>
</tr>
<tr>
<td><code>homepage</code></td>
<td>é¡¹ç›®ä¸»é¡µ</td>
<td>å­—ç¬¦ä¸²ï¼ˆHTTP&#x2F;HTTPSé“¾æ¥ï¼‰</td>
<td><code>homepage = &quot;https://foo.example.com&quot;</code></td>
</tr>
<tr>
<td><code>readme</code></td>
<td>READMEæ–‡ä»¶è·¯å¾„</td>
<td>å­—ç¬¦ä¸²ï¼Œé»˜è®¤ README.md&#x2F;README.rstï¼Œå¯çœç•¥è·¯å¾„</td>
<td><code>readme = &quot;README.md&quot;</code></td>
</tr>
<tr>
<td><code>keywords</code></td>
<td>æœç´¢å…³é”®è¯ï¼ˆcrates.ioç”¨ï¼‰</td>
<td>å­—ç¬¦ä¸²æ•°ç»„ï¼Œæœ€å¤š5ä¸ª</td>
<td><code>keywords = [&quot;rust&quot;, &quot;utility&quot;, &quot;cli&quot;]</code></td>
</tr>
<tr>
<td><code>categories</code></td>
<td>åˆ†ç±»ï¼ˆcrates.ioç”¨ï¼‰</td>
<td>å­—ç¬¦ä¸²æ•°ç»„ï¼Œéœ€ä»å®˜æ–¹åˆ†ç±»é€‰æ‹©</td>
<td><code>categories = [&quot;command-line-utilities&quot;]</code></td>
</tr>
<tr>
<td><code>exclude</code></td>
<td>æ„å»º&#x2F;å‘å¸ƒæ—¶æ’é™¤çš„æ–‡ä»¶</td>
<td>å­—ç¬¦ä¸²æ•°ç»„ï¼ˆæ”¯æŒglobæ¨¡å¼ï¼‰</td>
<td><code>exclude = [&quot;docs/*&quot;, &quot;tests/*.txt&quot;]</code></td>
</tr>
<tr>
<td><code>include</code></td>
<td>æ„å»º&#x2F;å‘å¸ƒæ—¶å¼ºåˆ¶åŒ…å«çš„æ–‡ä»¶</td>
<td>å­—ç¬¦ä¸²æ•°ç»„ï¼ˆä¼˜å…ˆçº§é«˜äºexcludeï¼‰</td>
<td><code>include = [&quot;src/**/*&quot;, &quot;Cargo.toml&quot;]</code></td>
</tr>
<tr>
<td><code>publish</code></td>
<td>æ˜¯å¦å…è®¸å‘å¸ƒåˆ° crates.io</td>
<td>å¸ƒå°”å€¼ï¼ˆtrue&#x2F;falseï¼‰</td>
<td><code>publish = false</code>ï¼ˆç§æœ‰é¡¹ç›®ï¼‰</td>
</tr>
<tr>
<td><code>rust-version</code></td>
<td>æœ€ä½æ”¯æŒçš„ Rust ç‰ˆæœ¬</td>
<td>å­—ç¬¦ä¸²ï¼ˆå¦‚ 1.70.0ï¼‰</td>
<td><code>rust-version = &quot;1.70.0&quot;</code></td>
</tr>
</tbody></table>
<h3 id="2-2-dependencies-æ™®é€šä¾èµ–"><a href="#2-2-dependencies-æ™®é€šä¾èµ–" class="headerlink" title="2.2 dependencies æ™®é€šä¾èµ–"></a>2.2 dependencies æ™®é€šä¾èµ–</h3><p>å®šä¹‰é¡¹ç›®çš„è¿è¡Œæ—¶ä¾èµ–ï¼Œæ”¯æŒå¤šç§ç‰ˆæœ¬çº¦æŸè¯­æ³•ã€‚</p>
<h4 id="ç‰ˆæœ¬çº¦æŸè¯­æ³•"><a href="#ç‰ˆæœ¬çº¦æŸè¯­æ³•" class="headerlink" title="ç‰ˆæœ¬çº¦æŸè¯­æ³•"></a>ç‰ˆæœ¬çº¦æŸè¯­æ³•</h4><table>
<thead>
<tr>
<th>è¯­æ³•</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
<th>èŒƒå›´</th>
</tr>
</thead>
<tbody><tr>
<td><code>^x.y.z</code></td>
<td>å…¼å®¹æ›´æ–°ï¼ˆé»˜è®¤ï¼Œæ¨èï¼‰</td>
<td><code>serde = &quot;^1.0.188&quot;</code></td>
<td>1.0.188 â‰¤ ç‰ˆæœ¬ &lt; 2.0.0</td>
</tr>
<tr>
<td><code>~x.y.z</code></td>
<td>è¡¥ä¸æ›´æ–°ï¼ˆä»…å…è®¸PATCHç‰ˆæœ¬å‡çº§ï¼‰</td>
<td><code>rand = &quot;~0.8.5&quot;</code></td>
<td>0.8.5 â‰¤ ç‰ˆæœ¬ &lt; 0.9.0</td>
</tr>
<tr>
<td><code>&gt;=x.y.z</code></td>
<td>æœ€ä½ç‰ˆæœ¬ï¼ˆå…è®¸æ‰€æœ‰æ›´é«˜ç‰ˆæœ¬ï¼‰</td>
<td><code>tokio = &quot;&gt;=1.20.0&quot;</code></td>
<td>1.20.0åŠä»¥ä¸Š</td>
</tr>
<tr>
<td><code>=x.y.z</code></td>
<td>ç²¾ç¡®ç‰ˆæœ¬ï¼ˆç¦æ­¢ä»»ä½•å‡çº§ï¼‰</td>
<td><code>log = &quot;=0.4.20&quot;</code></td>
<td>ä»…0.4.20</td>
</tr>
<tr>
<td><code>*</code></td>
<td>ä»»æ„ç‰ˆæœ¬ï¼ˆä¸æ¨èï¼Œé£é™©é«˜ï¼‰</td>
<td><code>foo = &quot;*&quot;</code></td>
<td>æ‰€æœ‰ç‰ˆæœ¬</td>
</tr>
</tbody></table>
<h4 id="ä¾èµ–å£°æ˜æ–¹å¼"><a href="#ä¾èµ–å£°æ˜æ–¹å¼" class="headerlink" title="ä¾èµ–å£°æ˜æ–¹å¼"></a>ä¾èµ–å£°æ˜æ–¹å¼</h4><figure class="highlight toml"><table><tr><td class="code"><pre><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="comment"># ç®€æ´ç‰ˆæœ¬çº¦æŸï¼ˆç­‰ä»·äº ^1.0ï¼‰</span></span><br><span class="line"><span class="attr">serde</span> = <span class="string">&quot;1.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜ç¡®æŒ‡å®šç‰ˆæœ¬çº¦æŸ</span></span><br><span class="line"><span class="attr">rand</span> = <span class="string">&quot;=0.8.5&quot;</span>              <span class="comment"># ç²¾ç¡®ç‰ˆæœ¬</span></span><br><span class="line"><span class="attr">tokio</span> = <span class="string">&quot;~1.0&quot;</span>               <span class="comment"># å…è®¸patchç‰ˆæœ¬æ›´æ–°ï¼ˆ1.0 &lt;= version &lt; 1.1ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ç‰¹æ€§ï¼ˆfeaturesï¼‰</span></span><br><span class="line"><span class="attr">serde</span> = &#123; version = <span class="string">&quot;1.0&quot;</span>, features = [<span class="string">&quot;derive&quot;</span>] &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾èµ–æ¥è‡ªGitä»“åº“</span></span><br><span class="line"><span class="attr">custom-fork</span> = &#123; git = <span class="string">&quot;https://github.com/user/repo&quot;</span>, branch = <span class="string">&quot;fix&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ¬åœ°è·¯å¾„ä¾èµ–</span></span><br><span class="line"><span class="attr">my-lib</span> = &#123; path = <span class="string">&quot;../my-lib&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="å…¶ä»–ä¾èµ–ç±»å‹"><a href="#å…¶ä»–ä¾èµ–ç±»å‹" class="headerlink" title="å…¶ä»–ä¾èµ–ç±»å‹"></a>å…¶ä»–ä¾èµ–ç±»å‹</h4><ul>
<li>**<code>[dev-dependencies]</code>**ï¼šä»…åœ¨ <code>cargo test</code>ã€<code>cargo bench</code> ç­‰å¼€å‘æ¨¡å¼ä¸‹ä½¿ç”¨</li>
<li>**<code>[build-dependencies]</code>**ï¼šåœ¨ <code>build.rs</code> æ–‡ä»¶ä¸­ä½¿ç”¨çš„ä¾èµ–</li>
<li>**<code>[target.&#39;cfg(windows)&#39;.dependencies]</code> &#x2F; <code>[target.&#39;cfg(unix)&#39;.dependencies]</code>**ï¼šæŒ‡å®šç‰¹å®šå¹³å°ä¾èµ–</li>
</ul>
<h3 id="2-3-Features-ç‰¹æ€§"><a href="#2-3-Features-ç‰¹æ€§" class="headerlink" title="2.3 Features ç‰¹æ€§"></a>2.3 Features ç‰¹æ€§</h3><p>Features æ˜¯ Cargo æä¾›çš„ä¸€ç§æ¡ä»¶ç¼–è¯‘æœºåˆ¶ã€‚</p>
<h4 id="ç‰¹æ€§é…ç½®"><a href="#ç‰¹æ€§é…ç½®" class="headerlink" title="ç‰¹æ€§é…ç½®"></a>ç‰¹æ€§é…ç½®</h4><figure class="highlight toml"><table><tr><td class="code"><pre><span class="line"><span class="section">[features]</span></span><br><span class="line"><span class="attr">default</span> = [<span class="string">&quot;tls-rustls&quot;</span>]     <span class="comment"># é»˜è®¤å¯ç”¨çš„ç‰¹æ€§</span></span><br><span class="line"><span class="attr">tls-rustls</span> = [<span class="string">&quot;rustls&quot;</span>, <span class="string">&quot;reqwest-rustls&quot;</span>]  <span class="comment"># å¯ç”¨Rustls TLSå®ç°</span></span><br><span class="line"><span class="attr">tls-native</span> = [<span class="string">&quot;native-tls&quot;</span>, <span class="string">&quot;reqwest-native&quot;</span>]  <span class="comment"># å¯ç”¨ç³»ç»ŸTLSå®ç°</span></span><br><span class="line"><span class="attr">compression</span> = [<span class="string">&quot;dep:flate2&quot;</span>] <span class="comment"># ä¾èµ–å…¶ä»–åŒ…çš„ç‰¹æ€§</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç©ºç‰¹æ€§ï¼ˆä»…ç”¨äºæ¡ä»¶ç¼–è¯‘ï¼Œä¸å…³è”ä¾èµ–ï¼‰</span></span><br><span class="line"><span class="attr">feat1</span> = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç‰¹æ€§ç»§æ‰¿ï¼ˆfeat2 å¯ç”¨æ—¶ï¼Œè‡ªåŠ¨å¯ç”¨ feat1 å’Œ &quot;advanced-dep&quot; ä¾èµ–ï¼‰</span></span><br><span class="line"><span class="attr">feat2</span> = [<span class="string">&quot;feat1&quot;</span>, <span class="string">&quot;dep:advanced-dep&quot;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="ä½¿ç”¨ç‰¹æ€§"><a href="#ä½¿ç”¨ç‰¹æ€§" class="headerlink" title="ä½¿ç”¨ç‰¹æ€§"></a>ä½¿ç”¨ç‰¹æ€§</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯ç”¨æŒ‡å®šç‰¹æ€§</span></span><br><span class="line">cargo build --features <span class="string">&quot;async,json&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­é»˜è®¤ç‰¹æ€§</span></span><br><span class="line">cargo build --no-default-features</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ç”¨æ‰€æœ‰ç‰¹æ€§</span></span><br><span class="line">cargo build --all-features</span><br></pre></td></tr></table></figure>

<h4 id="ä»£ç ä¸­ä½¿ç”¨ç‰¹æ€§"><a href="#ä»£ç ä¸­ä½¿ç”¨ç‰¹æ€§" class="headerlink" title="ä»£ç ä¸­ä½¿ç”¨ç‰¹æ€§"></a>ä»£ç ä¸­ä½¿ç”¨ç‰¹æ€§</h4><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»…å½“ &quot;feat1&quot; ç‰¹æ€§å¯ç”¨æ—¶ç¼–è¯‘æ­¤æ¨¡å—</span></span><br><span class="line"><span class="meta">#[cfg(feature = <span class="string">&quot;feat1&quot;</span>)]</span></span><br><span class="line"><span class="keyword">mod</span> feat1_module &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç‰¹æ€§å¯ç”¨æ—¶æ‰§è¡Œä¸åŒé€»è¾‘</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">do_something</span>() &#123;</span><br><span class="line">    <span class="meta">#[cfg(feature = <span class="string">&quot;feat2&quot;</span>)]</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Feat2 is enabled!&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">#[cfg(not(feature = <span class="string">&quot;feat2&quot;</span>))]</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Feat2 is disabled!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-ç›®æ ‡é…ç½®"><a href="#3-ç›®æ ‡é…ç½®" class="headerlink" title="3. ç›®æ ‡é…ç½®"></a>3. ç›®æ ‡é…ç½®</h2><p>Rusté¡¹ç›®æ”¯æŒä¸¤ç§ç›®æ ‡ç±»å‹ï¼šåº“ï¼ˆlibï¼‰å’ŒäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆbinï¼‰ã€‚</p>
<h3 id="3-1-lib-åº“é…ç½®"><a href="#3-1-lib-åº“é…ç½®" class="headerlink" title="3.1 lib åº“é…ç½®"></a>3.1 lib åº“é…ç½®</h3><p>ä»…å½“é¡¹ç›®æ˜¯åº“ï¼ˆæˆ–åŒæ—¶æ˜¯åº“+äºŒè¿›åˆ¶ï¼‰æ—¶éœ€è¦ï¼Œå®šä¹‰åº“çš„æ„å»ºè§„åˆ™ã€‚</p>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>name</code></td>
<td>åº“åç§°ï¼ˆé»˜è®¤ä¸ package.nameä¸€è‡´ï¼‰</td>
<td><code>name = &quot;my-lib&quot;</code></td>
</tr>
<tr>
<td><code>path</code></td>
<td>åº“æºæ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤ src&#x2F;lib.rsï¼‰</td>
<td><code>path = &quot;src/my_lib.rs&quot;</code></td>
</tr>
<tr>
<td><code>crate_type</code></td>
<td>ç”Ÿæˆçš„åº“ç±»å‹ï¼ˆæ”¯æŒå¤šä¸ªï¼‰</td>
<td><code>crate_type = [&quot;rlib&quot;, &quot;cdylib&quot;]</code></td>
</tr>
<tr>
<td><code>crate_name</code></td>
<td>ç¼–è¯‘åçš„ crate åç§°ï¼ˆé“¾æ¥æ—¶ä½¿ç”¨ï¼‰</td>
<td><code>crate_name = &quot;my_custom_lib&quot;</code></td>
</tr>
</tbody></table>
<h4 id="åº“ç±»å‹è¯´æ˜"><a href="#åº“ç±»å‹è¯´æ˜" class="headerlink" title="åº“ç±»å‹è¯´æ˜"></a>åº“ç±»å‹è¯´æ˜</h4><ul>
<li>**<code>rlib</code>**ï¼šRusté™æ€åº“ï¼ˆé»˜è®¤ï¼Œä¾›Rusté¡¹ç›®ä¾èµ–ï¼‰</li>
<li>**<code>dylib</code>**ï¼šRuståŠ¨æ€åº“ï¼ˆä¾›Rusté¡¹ç›®åŠ¨æ€é“¾æ¥ï¼‰</li>
<li>**<code>cdylib</code>**ï¼šCå…¼å®¹åŠ¨æ€åº“ï¼ˆä¾›C&#x2F;C++ç­‰å…¶ä»–è¯­è¨€è°ƒç”¨ï¼‰</li>
<li>**<code>staticlib</code>**ï¼šCå…¼å®¹é™æ€åº“ï¼ˆä¾›å…¶ä»–è¯­è¨€é™æ€é“¾æ¥ï¼‰</li>
<li>**<code>proc-macro</code>**ï¼šè¿‡ç¨‹å®åº“ï¼ˆä»…å½“é¡¹ç›®æ˜¯è¿‡ç¨‹å®æ—¶ä½¿ç”¨ï¼‰</li>
</ul>
<h3 id="3-2-bin-äºŒè¿›åˆ¶é…ç½®"><a href="#3-2-bin-äºŒè¿›åˆ¶é…ç½®" class="headerlink" title="3.2 bin äºŒè¿›åˆ¶é…ç½®"></a>3.2 bin äºŒè¿›åˆ¶é…ç½®</h3><p>å®šä¹‰å¯æ‰§è¡Œæ–‡ä»¶çš„æ„å»ºè§„åˆ™ï¼Œ<code>[[bin]]</code> æ˜¯æ•°ç»„è¯­æ³•ï¼ˆ<code>[[ ]]</code>ï¼‰ï¼Œæ”¯æŒå¤šä¸ªäºŒè¿›åˆ¶ç›®æ ‡ï¼ˆä¸€ä¸ªé¡¹ç›®å¯ç”Ÿæˆå¤šä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼‰ã€‚</p>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>name</code></td>
<td>å¯æ‰§è¡Œæ–‡ä»¶åç§°ï¼ˆé»˜è®¤ä¸æºæ–‡ä»¶åç§°ä¸€è‡´ï¼‰</td>
<td><code>name = &quot;my-cli&quot;</code></td>
</tr>
<tr>
<td><code>path</code></td>
<td>æºæ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤ src&#x2F;bin&#x2F;*.rsï¼‰</td>
<td><code>path = &quot;src/cli/main.rs&quot;</code></td>
</tr>
<tr>
<td><code>required-features</code></td>
<td>å¯ç”¨è¯¥äºŒè¿›åˆ¶ç›®æ ‡æ‰€éœ€çš„ç‰¹æ€§</td>
<td><code>required-features = [&quot;cli&quot;]</code></td>
</tr>
</tbody></table>
<h4 id="é»˜è®¤çº¦å®š"><a href="#é»˜è®¤çº¦å®š" class="headerlink" title="é»˜è®¤çº¦å®š"></a>é»˜è®¤çº¦å®š</h4><ul>
<li><strong>å•ä¸ªäºŒè¿›åˆ¶ç›®æ ‡</strong>ï¼šæºæ–‡ä»¶æ”¾åœ¨ <code>src/main.rs</code>ï¼Œæ— éœ€é…ç½® <code>[[bin]]</code></li>
<li><strong>å¤šä¸ªäºŒè¿›åˆ¶ç›®æ ‡</strong>ï¼šæºæ–‡ä»¶æ”¾åœ¨ <code>src/bin/</code> ç›®å½•ä¸‹ï¼ˆå¦‚ <code>src/bin/cli.rs</code>ã€<code>src/bin/utils.rs</code>ï¼‰ï¼ŒCargoè‡ªåŠ¨è¯†åˆ«ï¼Œæ— éœ€é…ç½® <code>[[bin]]</code>ï¼ˆé™¤ééœ€è¦è‡ªå®šä¹‰åç§°&#x2F;è·¯å¾„ï¼‰</li>
</ul>
<h4 id="äºŒè¿›åˆ¶é…ç½®ç¤ºä¾‹"><a href="#äºŒè¿›åˆ¶é…ç½®ç¤ºä¾‹" class="headerlink" title="äºŒè¿›åˆ¶é…ç½®ç¤ºä¾‹"></a>äºŒè¿›åˆ¶é…ç½®ç¤ºä¾‹</h4><figure class="highlight toml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è‡ªå®šä¹‰å•ä¸ªäºŒè¿›åˆ¶ç›®æ ‡ï¼ˆæºæ–‡ä»¶ä¸æ˜¯ src/main.rsï¼‰</span></span><br><span class="line"><span class="section">[[bin]]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;my-cli&quot;</span></span><br><span class="line"><span class="attr">path</span> = <span class="string">&quot;src/custom_main.rs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤šä¸ªäºŒè¿›åˆ¶ç›®æ ‡ï¼ˆè‡ªå®šä¹‰åç§°å’Œè·¯å¾„ï¼‰</span></span><br><span class="line"><span class="section">[[bin]]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;cli&quot;</span></span><br><span class="line"><span class="attr">path</span> = <span class="string">&quot;src/cli.rs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[[bin]]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;daemon&quot;</span></span><br><span class="line"><span class="attr">path</span> = <span class="string">&quot;src/daemon.rs&quot;</span></span><br><span class="line"><span class="attr">required-features</span> = [<span class="string">&quot;daemon&quot;</span>] <span class="comment"># ä»…å½“å¯ç”¨ &quot;daemon&quot; ç‰¹æ€§æ—¶æ‰æ„å»º</span></span><br></pre></td></tr></table></figure>

<h2 id="4-profile-æ„å»ºé…ç½®"><a href="#4-profile-æ„å»ºé…ç½®" class="headerlink" title="4. profile.* æ„å»ºé…ç½®"></a>4. profile.* æ„å»ºé…ç½®</h2><p>æ§åˆ¶ç¼–è¯‘ä¼˜åŒ–ã€è°ƒè¯•ä¿¡æ¯ã€ä»£ç ç”Ÿæˆç­‰è§„åˆ™ã€‚Cargoæä¾›5ä¸ªé»˜è®¤é…ç½®æ–‡ä»¶ã€‚</p>
<h3 id="é¢„è®¾é…ç½®"><a href="#é¢„è®¾é…ç½®" class="headerlink" title="é¢„è®¾é…ç½®"></a>é¢„è®¾é…ç½®</h3><table>
<thead>
<tr>
<th>Profile</th>
<th>é»˜è®¤è®¾ç½®</th>
<th>opt-level</th>
<th>ä½¿ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td><code>dev</code></td>
<td>å¼€å‘æ¨¡å¼ï¼ˆcargo buildé»˜è®¤ï¼‰</td>
<td>0ï¼ˆæ— ä¼˜åŒ–ï¼‰</td>
<td>æœ¬åœ°å¼€å‘ã€è°ƒè¯•ï¼ˆç¼–è¯‘å¿«ï¼‰</td>
</tr>
<tr>
<td><code>release</code></td>
<td>å‘å¸ƒæ¨¡å¼ï¼ˆcargo build â€“releaseï¼‰</td>
<td>3ï¼ˆå…¨ä¼˜åŒ–ï¼‰</td>
<td>ç”Ÿäº§ç¯å¢ƒï¼ˆè¿è¡Œå¿«ï¼Œç¼–è¯‘æ…¢ï¼‰</td>
</tr>
<tr>
<td><code>test</code></td>
<td>æµ‹è¯•æ¨¡å¼ï¼ˆcargo testé»˜è®¤ï¼‰</td>
<td>0</td>
<td>è¿è¡Œæµ‹è¯•ï¼ˆå…¼é¡¾ç¼–è¯‘é€Ÿåº¦ï¼‰</td>
</tr>
<tr>
<td><code>bench</code></td>
<td>åŸºå‡†æµ‹è¯•æ¨¡å¼ï¼ˆcargo benchï¼‰</td>
<td>3</td>
<td>æ€§èƒ½æµ‹è¯•ï¼ˆéœ€è¦æœ€ä¼˜æ€§èƒ½ï¼‰</td>
</tr>
<tr>
<td><code>doc</code></td>
<td>æ–‡æ¡£æ¨¡å¼ï¼ˆcargo docï¼‰</td>
<td>0</td>
<td>ç”Ÿæˆæ–‡æ¡£ï¼ˆç¼–è¯‘ä¾èµ–å¿«ï¼‰</td>
</tr>
</tbody></table>
<h3 id="å¯é…ç½®å­—æ®µï¼ˆå¸¸ç”¨ï¼‰"><a href="#å¯é…ç½®å­—æ®µï¼ˆå¸¸ç”¨ï¼‰" class="headerlink" title="å¯é…ç½®å­—æ®µï¼ˆå¸¸ç”¨ï¼‰"></a>å¯é…ç½®å­—æ®µï¼ˆå¸¸ç”¨ï¼‰</h3><table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>è¯´æ˜</th>
<th>å¯ç”¨å€¼</th>
</tr>
</thead>
<tbody><tr>
<td><code>opt-level</code></td>
<td>ä¼˜åŒ–çº§åˆ«</td>
<td>0&#x2F;1&#x2F;2&#x2F;3ï¼ˆä¼˜åŒ–ç¨‹åº¦ï¼‰ã€s&#x2F;zï¼ˆä½“ç§¯ä¼˜åŒ–ï¼‰</td>
</tr>
<tr>
<td><code>debug</code></td>
<td>æ˜¯å¦ç”Ÿæˆè°ƒè¯•ä¿¡æ¯</td>
<td>true&#x2F;falseï¼ˆdevé»˜è®¤ä¸ºtrueï¼Œreleaseé»˜è®¤ä¸ºfalseï¼‰</td>
</tr>
<tr>
<td><code>debug-assertions</code></td>
<td>æ˜¯å¦å¯ç”¨è°ƒè¯•æ–­è¨€</td>
<td>true&#x2F;falseï¼ˆdevé»˜è®¤ä¸ºtrueï¼Œreleaseé»˜è®¤ä¸ºfalseï¼‰</td>
</tr>
<tr>
<td><code>strip</code></td>
<td>æ˜¯å¦å‰¥ç¦»ç¬¦å·ä¿¡æ¯ï¼ˆå‡å°äºŒè¿›åˆ¶ä½“ç§¯ï¼‰</td>
<td>â€œnoneâ€ã€â€debuginfoâ€ã€â€allâ€</td>
</tr>
<tr>
<td><code>lto</code></td>
<td>é“¾æ¥æ—¶ä¼˜åŒ–ï¼ˆLTOï¼Œæå‡æ€§èƒ½&#x2F;å‡å°ä½“ç§¯ï¼‰</td>
<td>false&#x2F;true&#x2F;â€œthinâ€</td>
</tr>
<tr>
<td><code>codegen-units</code></td>
<td>ä»£ç ç”Ÿæˆå•å…ƒæ•°é‡ï¼ˆå½±å“ç¼–è¯‘é€Ÿåº¦&#x2F;ä¼˜åŒ–ï¼‰</td>
<td>æ•´æ•°ï¼ˆé»˜è®¤ dev&#x3D;256ï¼Œrelease&#x3D;16ï¼‰</td>
</tr>
<tr>
<td><code>panic</code></td>
<td>panicå¤„ç†æ–¹å¼</td>
<td>â€œunwindâ€ï¼ˆé»˜è®¤ï¼‰ã€â€abortâ€</td>
</tr>
<tr>
<td><code>incremental</code></td>
<td>æ˜¯å¦å¯ç”¨å¢é‡ç¼–è¯‘</td>
<td>true&#x2F;falseï¼ˆdevé»˜è®¤ä¸ºtrueï¼Œreleaseé»˜è®¤ä¸ºfalseï¼‰</td>
</tr>
</tbody></table>
<h3 id="æ„å»ºé…ç½®ç¤ºä¾‹"><a href="#æ„å»ºé…ç½®ç¤ºä¾‹" class="headerlink" title="æ„å»ºé…ç½®ç¤ºä¾‹"></a>æ„å»ºé…ç½®ç¤ºä¾‹</h3><figure class="highlight toml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¼€å‘é…ç½®ï¼šå¿«é€Ÿç¼–è¯‘ï¼Œä¾¿äºè°ƒè¯•</span></span><br><span class="line"><span class="section">[profile.dev]</span></span><br><span class="line"><span class="attr">opt-level</span> = <span class="number">0</span></span><br><span class="line"><span class="attr">debug</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">debug-assertions</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">incremental</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘å¸ƒé…ç½®ï¼šå…¨ä¼˜åŒ–</span></span><br><span class="line"><span class="section">[profile.release]</span></span><br><span class="line"><span class="attr">opt-level</span> = <span class="number">3</span></span><br><span class="line"><span class="attr">debug</span> = <span class="literal">false</span></span><br><span class="line"><span class="attr">debug-assertions</span> = <span class="literal">false</span></span><br><span class="line"><span class="attr">lto</span> = <span class="string">&quot;thin&quot;</span>          <span class="comment"># å¢é‡LTOï¼Œæ¯”å…¨LTOç¼–è¯‘æ›´å¿«</span></span><br><span class="line"><span class="attr">codegen-units</span> = <span class="number">16</span></span><br><span class="line"><span class="attr">strip</span> = <span class="string">&quot;debuginfo&quot;</span>   <span class="comment"># å‰¥ç¦»è°ƒè¯•ä¿¡æ¯ï¼Œå‡å°ä½“ç§¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªå®šä¹‰é…ç½®ï¼šå…¼é¡¾æ€§èƒ½å’Œç¼–è¯‘é€Ÿåº¦</span></span><br><span class="line"><span class="section">[profile.release-fast]</span></span><br><span class="line"><span class="attr">inherits</span> = <span class="string">&quot;release&quot;</span></span><br><span class="line"><span class="attr">codegen-units</span> = <span class="number">128</span>   <span class="comment"># é™ä½codegen-unitsï¼ŒåŠ å¿«ç¼–è¯‘</span></span><br><span class="line"><span class="attr">lto</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½“ç§¯ä¼˜åŒ–</span></span><br><span class="line"><span class="section">[profile.release-small]</span></span><br><span class="line"><span class="attr">inherits</span> = <span class="string">&quot;release&quot;</span></span><br><span class="line"><span class="attr">opt-level</span> = <span class="string">&quot;z&quot;</span>       <span class="comment"># æè‡´ä½“ç§¯ä¼˜åŒ–</span></span><br><span class="line"><span class="attr">strip</span> = <span class="string">&quot;all&quot;</span>         <span class="comment"># å‰¥ç¦»æ‰€æœ‰ç¬¦å·</span></span><br></pre></td></tr></table></figure>

<h2 id="5-å®Œæ•´çš„-Cargo-toml-ç¤ºä¾‹"><a href="#5-å®Œæ•´çš„-Cargo-toml-ç¤ºä¾‹" class="headerlink" title="5. å®Œæ•´çš„ Cargo.toml ç¤ºä¾‹"></a>5. å®Œæ•´çš„ Cargo.toml ç¤ºä¾‹</h2><figure class="highlight toml"><table><tr><td class="code"><pre><span class="line"><span class="section">[package]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;my-rust-app&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"><span class="attr">edition</span> = <span class="string">&quot;2024&quot;</span></span><br><span class="line"><span class="attr">description</span> = <span class="string">&quot;A full-featured Rust application&quot;</span></span><br><span class="line"><span class="attr">license</span> = <span class="string">&quot;MIT&quot;</span></span><br><span class="line"><span class="attr">repository</span> = <span class="string">&quot;https://github.com/foo/my-rust-app&quot;</span></span><br><span class="line"><span class="attr">readme</span> = <span class="string">&quot;README.md&quot;</span></span><br><span class="line"><span class="attr">keywords</span> = [<span class="string">&quot;rust&quot;</span>, <span class="string">&quot;app&quot;</span>, <span class="string">&quot;cli&quot;</span>]</span><br><span class="line"><span class="attr">categories</span> = [<span class="string">&quot;command-line-utilities&quot;</span>]</span><br><span class="line"><span class="attr">rust-version</span> = <span class="string">&quot;1.75.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[workspace]</span></span><br><span class="line"><span class="attr">members</span> = [<span class="string">&quot;crates/*&quot;</span>, <span class="string">&quot;cli&quot;</span>]</span><br><span class="line"><span class="attr">default-members</span> = [<span class="string">&quot;cli&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="section">[workspace.dependencies]</span></span><br><span class="line"><span class="attr">serde</span> = &#123; version = <span class="string">&quot;1.0&quot;</span>, features = [<span class="string">&quot;derive&quot;</span>] &#125;</span><br><span class="line"><span class="attr">rand</span> = <span class="string">&quot;0.8&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">serde</span> = &#123; workspace = <span class="literal">true</span> &#125;</span><br><span class="line"><span class="attr">tokio</span> = &#123; version = <span class="string">&quot;1.0&quot;</span>, features = [<span class="string">&quot;full&quot;</span>] &#125;</span><br><span class="line"><span class="attr">anyhow</span> = <span class="string">&quot;1.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dev-dependencies]</span></span><br><span class="line"><span class="attr">criterion</span> = <span class="string">&quot;0.5&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[build-dependencies]</span></span><br><span class="line"><span class="attr">prost-build</span> = <span class="string">&quot;0.11&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[features]</span></span><br><span class="line"><span class="attr">default</span> = [<span class="string">&quot;async&quot;</span>]</span><br><span class="line"><span class="attr">async</span> = []</span><br><span class="line"><span class="attr">cli</span> = []</span><br><span class="line"></span><br><span class="line"><span class="section">[[bin]]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;my-app&quot;</span></span><br><span class="line"><span class="attr">path</span> = <span class="string">&quot;src/main.rs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[profile.dev]</span></span><br><span class="line"><span class="attr">opt-level</span> = <span class="number">0</span></span><br><span class="line"><span class="attr">debug</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">incremental</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="section">[profile.release]</span></span><br><span class="line"><span class="attr">opt-level</span> = <span class="number">3</span></span><br><span class="line"><span class="attr">debug</span> = <span class="literal">false</span></span><br><span class="line"><span class="attr">lto</span> = <span class="string">&quot;thin&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="6-Workspace-å·¥ä½œåŒº"><a href="#6-Workspace-å·¥ä½œåŒº" class="headerlink" title="6. Workspace å·¥ä½œåŒº"></a>6. Workspace å·¥ä½œåŒº</h2><p>å½“é¡¹ç›®åŒ…å«å¤šä¸ªcrateï¼ˆå¦‚æ ¸å¿ƒåº“ã€CLIå·¥å…·ã€æµ‹è¯•å·¥å…·ï¼‰æ—¶ï¼Œç”¨å·¥ä½œç©ºé—´ç»Ÿä¸€ç®¡ç†ä¾èµ–å’Œæ„å»ºã€‚</p>
<h3 id="å·¥ä½œåŒºé…ç½®"><a href="#å·¥ä½œåŒºé…ç½®" class="headerlink" title="å·¥ä½œåŒºé…ç½®"></a>å·¥ä½œåŒºé…ç½®</h3><figure class="highlight toml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å·¥ä½œç©ºé—´æ ¹ç›®å½•çš„ Cargo.toml</span></span><br><span class="line"><span class="section">[workspace]</span></span><br><span class="line"><span class="comment"># åŒ…å«çš„å­åŒ…ï¼ˆæ”¯æŒ glob æ¨¡å¼ï¼‰</span></span><br><span class="line"><span class="attr">members</span> = [</span><br><span class="line">    <span class="string">&quot;crates/*&quot;</span>,      <span class="comment"># æ‰€æœ‰ crates ç›®å½•ä¸‹çš„å­åŒ…</span></span><br><span class="line">    <span class="string">&quot;cli&quot;</span>,           <span class="comment"># å•ä¸ªå­åŒ…</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># é»˜è®¤æ„å»ºçš„å­åŒ…ï¼ˆcargo build æ—¶é»˜è®¤æ„å»ºè¿™äº›ï¼‰</span></span><br><span class="line"><span class="attr">default-members</span> = [<span class="string">&quot;crates/core&quot;</span>, <span class="string">&quot;cli&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å·¥ä½œç©ºé—´å…±äº«ä¾èµ–ç‰ˆæœ¬ï¼ˆå­åŒ…å¯ç›´æ¥å¼•ç”¨ï¼Œé¿å…ç‰ˆæœ¬é‡å¤ï¼‰</span></span><br><span class="line"><span class="section">[workspace.dependencies]</span></span><br><span class="line"><span class="attr">serde</span> = &#123; version = <span class="string">&quot;1.0&quot;</span>, features = [<span class="string">&quot;derive&quot;</span>] &#125;</span><br><span class="line"><span class="attr">rand</span> = <span class="string">&quot;0.8&quot;</span></span><br><span class="line"><span class="attr">tokio</span> = <span class="string">&quot;1.0&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="å­åŒ…ä¸­å¼•ç”¨å·¥ä½œåŒºä¾èµ–"><a href="#å­åŒ…ä¸­å¼•ç”¨å·¥ä½œåŒºä¾èµ–" class="headerlink" title="å­åŒ…ä¸­å¼•ç”¨å·¥ä½œåŒºä¾èµ–"></a>å­åŒ…ä¸­å¼•ç”¨å·¥ä½œåŒºä¾èµ–</h3><figure class="highlight toml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å­åŒ…ï¼ˆcrates/core/Cargo.tomlï¼‰</span></span><br><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="comment"># ç›´æ¥å¼•ç”¨å·¥ä½œç©ºé—´å®šä¹‰çš„ä¾èµ–ç‰ˆæœ¬</span></span><br><span class="line"><span class="attr">serde</span> = &#123; workspace = <span class="literal">true</span> &#125;</span><br><span class="line"><span class="attr">rand</span> = &#123; workspace = <span class="literal">true</span>, features = [<span class="string">&quot;small_rng&quot;</span>] &#125; <span class="comment"># è¿½åŠ ç‰¹æ€§</span></span><br><span class="line"><span class="attr">tokio</span> = &#123; workspace = <span class="literal">true</span>, features = [<span class="string">&quot;rt&quot;</span>] &#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul>
<li><strong>package</strong>ï¼šå®šä¹‰é¡¹ç›®å…ƒä¿¡æ¯ã€ç‰ˆæœ¬ã€è®¸å¯è¯ç­‰</li>
<li><strong>dependencies</strong>ï¼šç®¡ç†é¡¹ç›®ä¾èµ–ï¼Œæ”¯æŒcrates.ioã€Gitã€æœ¬åœ°è·¯å¾„å¤šç§æ¥æº</li>
<li><strong>features</strong>ï¼šå®ç°æ¡ä»¶ç¼–è¯‘å’Œå¯é€‰ä¾èµ–</li>
<li>**[lib] å’Œ [[bin]]**ï¼šå®šä¹‰åº“å’ŒäºŒè¿›åˆ¶ç›®æ ‡</li>
<li>**profile.***ï¼šæ§åˆ¶ç¼–è¯‘ä¼˜åŒ–ç­–ç•¥</li>
<li><strong>workspace</strong>ï¼šå¤šåŒ…é¡¹ç›®çš„ç»Ÿä¸€ç®¡ç†</li>
<li><strong>Cargo.lock</strong>ï¼šè®°å½•ç²¾ç¡®çš„ä¾èµ–ç‰ˆæœ¬ï¼ŒäºŒè¿›åˆ¶é¡¹ç›®åº”æäº¤åˆ°Git</li>
</ul>
]]></content>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>web3-æ™ºèƒ½åˆçº¦</title>
    <url>/2025/11/27/web3-%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/</url>
    <content><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯æ™ºèƒ½åˆçº¦"><a href="#ä»€ä¹ˆæ˜¯æ™ºèƒ½åˆçº¦" class="headerlink" title="ä»€ä¹ˆæ˜¯æ™ºèƒ½åˆçº¦"></a>ä»€ä¹ˆæ˜¯æ™ºèƒ½åˆçº¦</h2><p>æ™ºèƒ½åˆçº¦ï¼ˆSmart Contractï¼‰æ˜¯éƒ¨ç½²åœ¨åŒºå—é“¾ä¸Šçš„è‡ªæ‰§è¡Œç¨‹åºï¼Œç”¨ä»£ç å½¢å¼ç¼–å†™åˆçº¦æ¡æ¬¾å’Œè§„åˆ™ã€‚å½“é¢„å®šæ¡ä»¶æ»¡è¶³æ—¶ï¼Œæ™ºèƒ½åˆçº¦ä¼šè‡ªåŠ¨æ‰§è¡Œå¯¹åº”çš„é€»è¾‘ï¼Œæ— éœ€ä¸­ä»‹å‚ä¸ï¼Œå…·æœ‰é€æ˜æ€§ã€ä¸å¯ç¯¡æ”¹æ€§å’Œè‡ªåŠ¨åŒ–æ‰§è¡Œçš„ç‰¹ç‚¹ã€‚</p>
<span id="more"></span>

<h3 id="æ ¸å¿ƒç‰¹å¾"><a href="#æ ¸å¿ƒç‰¹å¾" class="headerlink" title="æ ¸å¿ƒç‰¹å¾"></a>æ ¸å¿ƒç‰¹å¾</h3><ul>
<li><strong>è‡ªåŠ¨æ‰§è¡Œ</strong>ï¼šå½“æ¡ä»¶æ»¡è¶³æ—¶ï¼Œæ— éœ€äººå·¥å¹²é¢„å³å¯è‡ªåŠ¨æ‰§è¡Œ</li>
<li><strong>é€æ˜æ€§</strong>ï¼šæ‰€æœ‰å‚ä¸è€…éƒ½èƒ½æŸ¥çœ‹åˆçº¦ä»£ç å’Œæ‰§è¡Œè¿‡ç¨‹</li>
<li><strong>ä¸å¯ç¯¡æ”¹</strong>ï¼šéƒ¨ç½²åˆ°åŒºå—é“¾åï¼Œä»£ç å’Œæ•°æ®æ— æ³•æ›´æ”¹</li>
<li><strong>å»ä¸­å¿ƒåŒ–</strong>ï¼šç”±ç½‘ç»œä¸­çš„èŠ‚ç‚¹å…±åŒæ‰§è¡Œå’ŒéªŒè¯ï¼Œæ— ä¸­å¿ƒåŒ–æœºæ„</li>
<li><strong>ç¡®å®šæ€§</strong>ï¼šç›¸åŒçš„è¾“å…¥åœ¨ç›¸åŒçš„æ‰§è¡Œç¯å¢ƒä¸‹æ€»èƒ½äº§ç”Ÿç›¸åŒçš„ç»“æœ</li>
</ul>
<h2 id="æ™ºèƒ½åˆçº¦çš„å·¥ä½œåŸç†"><a href="#æ™ºèƒ½åˆçº¦çš„å·¥ä½œåŸç†" class="headerlink" title="æ™ºèƒ½åˆçº¦çš„å·¥ä½œåŸç†"></a>æ™ºèƒ½åˆçº¦çš„å·¥ä½œåŸç†</h2><h3 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h3><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">ç¼–å†™ä»£ç  â†’ ç¼–è¯‘ â†’ éƒ¨ç½² â†’ äº¤äº’ â†’ æ‰§è¡Œ â†’ è®°å½•</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>ç¼–å†™</strong>ï¼šç”¨ Solidityã€Rustã€Go ç­‰è¯­è¨€ç¼–å†™åˆçº¦ä»£ç </li>
<li><strong>ç¼–è¯‘</strong>ï¼šç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼ˆbytecodeï¼‰</li>
<li><strong>éƒ¨ç½²</strong>ï¼šå°†å­—èŠ‚ç å‘é€åˆ°åŒºå—é“¾ç½‘ç»œï¼Œåˆ›å»ºåˆçº¦è´¦æˆ·</li>
<li><strong>äº¤äº’</strong>ï¼šç”¨æˆ·é€šè¿‡äº¤æ˜“ä¸åˆçº¦äº¤äº’ï¼Œè§¦å‘åˆçº¦å‡½æ•°</li>
<li><strong>æ‰§è¡Œ</strong>ï¼šèŠ‚ç‚¹æ‰§è¡Œåˆçº¦ä»£ç ï¼Œä¿®æ”¹çŠ¶æ€</li>
<li><strong>è®°å½•</strong>ï¼šæ‰§è¡Œç»“æœè¢«è®°å½•åœ¨åŒºå—é“¾ä¸Š</li>
</ol>
<h3 id="æ™ºèƒ½åˆçº¦çš„åˆ›å»ºå’Œè¿è¡Œ"><a href="#æ™ºèƒ½åˆçº¦çš„åˆ›å»ºå’Œè¿è¡Œ" class="headerlink" title="æ™ºèƒ½åˆçº¦çš„åˆ›å»ºå’Œè¿è¡Œ"></a>æ™ºèƒ½åˆçº¦çš„åˆ›å»ºå’Œè¿è¡Œ</h3><ol>
<li>æ™ºèƒ½åˆçº¦çš„ä»£ç å†™å®Œåï¼Œè¦ç¼–è¯‘æˆbytecode;</li>
<li>åˆ›å»ºåˆçº¦ï¼šå¤–éƒ¨è´¦æˆ·å‘èµ·ä¸€ä¸ªè½¬è´¦äº¤æ˜“åˆ°0x0çš„åœ°å€ï¼›è½¬è´¦çš„é‡‘é¢æ˜¯0ï¼Œä½†æ˜¯è¦æ”¯ä»˜æ±½æ²¹è´¹ï¼›åˆçº¦çš„ä»£ç æ”¾åœ¨dataåŸŸä¸­ï¼›</li>
<li>æ™ºèƒ½åˆçº¦è¿è¡Œåœ¨EVMï¼ˆEthereum Virtual Machineï¼‰ä¸Š</li>
<li>ä»¥å¤ªåŠæ˜¯ä¸€ä¸ªäº¤æ˜“é©±åŠ¨çš„çŠ¶æ€æœºï¼Œè°ƒç”¨æ™ºèƒ½åˆçº¦çš„äº¤æ˜“å‘å¸ƒåˆ°åŒºå—é“¾ä¸Šä¹‹åï¼Œæ¯ä¸ªçŸ¿å·¥éƒ½ä¼šæ‰§è¡Œè¿™ä¸ªäº¤æ˜“ï¼Œä»å½“å‰çŠ¶æ€ç¡®å®šæ€§çš„è½¬ç§»åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼›</li>
</ol>
<h3 id="æ‰§è¡Œæ¨¡å¼"><a href="#æ‰§è¡Œæ¨¡å¼" class="headerlink" title="æ‰§è¡Œæ¨¡å¼"></a>æ‰§è¡Œæ¨¡å¼</h3><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">ç”¨æˆ·å‘èµ·äº¤æ˜“ â†’ èŠ‚ç‚¹æ¥æ”¶äº¤æ˜“ â†’ EVM æ‰§è¡Œåˆçº¦ â†’ çŠ¶æ€æ›´æ–° â†’ å†™å…¥åŒºå— â†’ å…±è¯†ç¡®è®¤</span><br></pre></td></tr></table></figure>

<h2 id="ä¸»æµæ™ºèƒ½åˆçº¦å¹³å°"><a href="#ä¸»æµæ™ºèƒ½åˆçº¦å¹³å°" class="headerlink" title="ä¸»æµæ™ºèƒ½åˆçº¦å¹³å°"></a>ä¸»æµæ™ºèƒ½åˆçº¦å¹³å°</h2><h3 id="Ethereumï¼ˆä»¥å¤ªåŠï¼‰"><a href="#Ethereumï¼ˆä»¥å¤ªåŠï¼‰" class="headerlink" title="Ethereumï¼ˆä»¥å¤ªåŠï¼‰"></a>Ethereumï¼ˆä»¥å¤ªåŠï¼‰</h3><ul>
<li><strong>è¯­è¨€</strong>ï¼šSolidityï¼ˆé¦–é€‰ï¼‰ã€Vyper</li>
<li><strong>è™šæ‹Ÿæœº</strong>ï¼šEVMï¼ˆä»¥å¤ªåŠè™šæ‹Ÿæœºï¼‰</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šæœ€æˆç†Ÿã€ç”Ÿæ€æœ€æ´»è·ƒã€Gas è´¹ç”¨ç›¸å¯¹è¾ƒé«˜</li>
<li><strong>ç”¨é€”</strong>ï¼šDeFiã€NFTã€DAOã€Token æ ‡å‡†ï¼ˆERC-20ã€ERC-721 ç­‰ï¼‰</li>
</ul>
<h3 id="Solana"><a href="#Solana" class="headerlink" title="Solana"></a>Solana</h3><ul>
<li><strong>è¯­è¨€</strong>ï¼šRustã€C</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šé«˜ååé‡ã€ä½äº¤æ˜“è´¹ç”¨ã€å¹¶è¡Œå¤„ç†èƒ½åŠ›å¼º</li>
<li><strong>ç”¨é€”</strong>ï¼šé«˜é¢‘äº¤æ˜“ã€å®æ—¶åº”ç”¨ã€å¤§è§„æ¨¡ NFT ç”Ÿæˆ</li>
</ul>
<h3 id="Polygonï¼ˆä»¥å¤ªåŠä¾§é“¾ï¼‰"><a href="#Polygonï¼ˆä»¥å¤ªåŠä¾§é“¾ï¼‰" class="headerlink" title="Polygonï¼ˆä»¥å¤ªåŠä¾§é“¾ï¼‰"></a>Polygonï¼ˆä»¥å¤ªåŠä¾§é“¾ï¼‰</h3><ul>
<li><strong>è¯­è¨€</strong>ï¼šSolidity</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šEVM å…¼å®¹ã€æ›´ä½è´¹ç”¨ã€æ›´å¿«äº¤æ˜“ç¡®è®¤</li>
<li><strong>ç”¨é€”</strong>ï¼šä»¥å¤ªåŠåº”ç”¨çš„æ‰©å±•æ–¹æ¡ˆ</li>
</ul>
<h3 id="Cosmos-x2F-Tendermint"><a href="#Cosmos-x2F-Tendermint" class="headerlink" title="Cosmos &#x2F; Tendermint"></a>Cosmos &#x2F; Tendermint</h3><ul>
<li><strong>è¯­è¨€</strong>ï¼šGoã€Rust</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šæ¨¡å—åŒ–è®¾è®¡ã€è·¨é“¾é€šä¿¡ã€çµæ´»çš„å…±è¯†æœºåˆ¶</li>
<li><strong>ç”¨é€”</strong>ï¼šä¸“ä¸šçº§åº”ç”¨ã€è·¨é“¾åè®®</li>
</ul>
<h3 id="NEAR-Protocol"><a href="#NEAR-Protocol" class="headerlink" title="NEAR Protocol"></a>NEAR Protocol</h3><ul>
<li><strong>è¯­è¨€</strong>ï¼šRustã€AssemblyScript</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šåˆ†ç‰‡æŠ€æœ¯ã€æ˜“äºæ‰©å±•ã€å¼€å‘è€…å‹å¥½</li>
<li><strong>ç”¨é€”</strong>ï¼šGameFiã€ç¤¾äº¤åº”ç”¨ã€ä¼ä¸šåº”ç”¨</li>
</ul>
<h2 id="Solidity-æ™ºèƒ½åˆçº¦åŸºç¡€"><a href="#Solidity-æ™ºèƒ½åˆçº¦åŸºç¡€" class="headerlink" title="Solidity æ™ºèƒ½åˆçº¦åŸºç¡€"></a>Solidity æ™ºèƒ½åˆçº¦åŸºç¡€</h2><h3 id="åŸºæœ¬ç»“æ„"><a href="#åŸºæœ¬ç»“æ„" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">contract MyContract &#123;</span><br><span class="line">    // çŠ¶æ€å˜é‡</span><br><span class="line">    uint256 public count;</span><br><span class="line">    address public owner;</span><br><span class="line">    </span><br><span class="line">    // äº‹ä»¶</span><br><span class="line">    event CountChanged(uint256 newCount);</span><br><span class="line">    </span><br><span class="line">    // ä¿®é¥°ç¬¦</span><br><span class="line">    modifier onlyOwner() &#123;</span><br><span class="line">        require(msg.sender == owner, &quot;Only owner can call this&quot;);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // æ„é€ å‡½æ•°</span><br><span class="line">    constructor() &#123;</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">        count = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // å…¬å¼€å‡½æ•°</span><br><span class="line">    function increment() public &#123;</span><br><span class="line">        count += 1;</span><br><span class="line">        emit CountChanged(count);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // ä»…æ‰€æœ‰è€…å¯è°ƒç”¨</span><br><span class="line">    function reset() public onlyOwner &#123;</span><br><span class="line">        count = 0;</span><br><span class="line">        emit CountChanged(count);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // åªè¯»å‡½æ•°ï¼ˆä¸ä¿®æ”¹çŠ¶æ€ï¼‰</span><br><span class="line">    function getCount() public view returns (uint256) &#123;</span><br><span class="line">        return count;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // çº¯å‡½æ•°ï¼ˆä¸è¯»å–çŠ¶æ€ï¼‰</span><br><span class="line">    function add(uint256 a, uint256 b) public pure returns (uint256) &#123;</span><br><span class="line">        return a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å…³é”®æ¦‚å¿µ"><a href="#å…³é”®æ¦‚å¿µ" class="headerlink" title="å…³é”®æ¦‚å¿µ"></a>å…³é”®æ¦‚å¿µ</h3><h4 id="çŠ¶æ€å˜é‡"><a href="#çŠ¶æ€å˜é‡" class="headerlink" title="çŠ¶æ€å˜é‡"></a>çŠ¶æ€å˜é‡</h4><p>æŒä¹…åŒ–å­˜å‚¨åœ¨åŒºå—é“¾ä¸Šçš„æ•°æ®ï¼Œæ¯æ¬¡ä¿®æ”¹éƒ½ä¼šæ¶ˆè€— Gas è´¹ç”¨ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uint256 public balance;           // æ— ç¬¦å·æ•´æ•°</span><br><span class="line">address public owner;              // è´¦æˆ·åœ°å€</span><br><span class="line">bool public isActive;              // å¸ƒå°”å€¼</span><br><span class="line">string public name;                // å­—ç¬¦ä¸²</span><br><span class="line">bytes32 public hash;               // å­—èŠ‚æ•°æ®</span><br></pre></td></tr></table></figure>

<h4 id="å‡½æ•°å¯è§æ€§"><a href="#å‡½æ•°å¯è§æ€§" class="headerlink" title="å‡½æ•°å¯è§æ€§"></a>å‡½æ•°å¯è§æ€§</h4><table>
<thead>
<tr>
<th>ä¿®é¥°ç¬¦</th>
<th>è¯´æ˜</th>
<th>è°ƒç”¨æ–¹å¼</th>
</tr>
</thead>
<tbody><tr>
<td><code>public</code></td>
<td>å…¬å¼€å¯è§ï¼Œä»»ä½•äººå¯è°ƒç”¨</td>
<td>å¤–éƒ¨ã€å†…éƒ¨</td>
</tr>
<tr>
<td><code>internal</code></td>
<td>ä»…åˆçº¦å†…éƒ¨å’Œç»§æ‰¿åˆçº¦å¯è°ƒç”¨</td>
<td>å†…éƒ¨</td>
</tr>
<tr>
<td><code>external</code></td>
<td>ä»…ä»åˆçº¦å¤–éƒ¨è°ƒç”¨</td>
<td>å¤–éƒ¨</td>
</tr>
<tr>
<td><code>private</code></td>
<td>ä»…å½“å‰åˆçº¦å†…éƒ¨å¯è°ƒç”¨</td>
<td>å†…éƒ¨</td>
</tr>
</tbody></table>
<h4 id="å‡½æ•°ä¿®é¥°ç¬¦"><a href="#å‡½æ•°ä¿®é¥°ç¬¦" class="headerlink" title="å‡½æ•°ä¿®é¥°ç¬¦"></a>å‡½æ•°ä¿®é¥°ç¬¦</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// viewï¼šè¯»å–çŠ¶æ€ï¼Œä¸æ¶ˆè€— Gas</span><br><span class="line">function getBalance() public view returns (uint256) &#123;</span><br><span class="line">    return balance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// pureï¼šä¸è¯»å–çŠ¶æ€ï¼Œä¸æ¶ˆè€— Gas</span><br><span class="line">function multiply(uint256 a, uint256 b) public pure returns (uint256) &#123;</span><br><span class="line">    return a * b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// payableï¼šå…è®¸æ¥æ”¶ä»¥å¤ªå¸ï¼ˆETHï¼‰</span><br><span class="line">function deposit() public payable &#123;</span><br><span class="line">    require(msg.value &gt; 0, &quot;Must send ETH&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è‡ªå®šä¹‰ä¿®é¥°ç¬¦</span><br><span class="line">modifier onlyOwner() &#123;</span><br><span class="line">    require(msg.sender == owner);</span><br><span class="line">    _;  // æ‰§è¡Œå‡½æ•°ä½“</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function withdraw() public onlyOwner &#123;</span><br><span class="line">    // åªæœ‰ owner èƒ½è°ƒç”¨</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="äº‹ä»¶ï¼ˆEventsï¼‰"><a href="#äº‹ä»¶ï¼ˆEventsï¼‰" class="headerlink" title="äº‹ä»¶ï¼ˆEventsï¼‰"></a>äº‹ä»¶ï¼ˆEventsï¼‰</h4><p>å…è®¸ç¦»é“¾ç³»ç»Ÿç›‘å¬å’Œå“åº”åˆçº¦æ‰§è¡Œæƒ…å†µã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// äº‹ä»¶å£°æ˜</span><br><span class="line">event Transfer(address indexed from, address indexed to, uint256 value);</span><br><span class="line">event Approval(address indexed owner, address indexed spender, uint256 value);</span><br><span class="line"></span><br><span class="line">// è§¦å‘äº‹ä»¶</span><br><span class="line">function transfer(address to, uint256 amount) public &#123;</span><br><span class="line">    balance -= amount;</span><br><span class="line">    emit Transfer(msg.sender, to, amount);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¸¸è§æ¨¡å¼"><a href="#å¸¸è§æ¨¡å¼" class="headerlink" title="å¸¸è§æ¨¡å¼"></a>å¸¸è§æ¨¡å¼</h3><h4 id="ERC-20-Token-æ ‡å‡†"><a href="#ERC-20-Token-æ ‡å‡†" class="headerlink" title="ERC-20 Token æ ‡å‡†"></a>ERC-20 Token æ ‡å‡†</h4><p>æœ€å¸¸è§çš„ä»£å¸æ ‡å‡†ï¼Œå®šä¹‰äº†ä»£å¸çš„åŸºæœ¬æ¥å£ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">interface IERC20 &#123;</span><br><span class="line">    function transfer(address to, uint256 amount) external returns (bool);</span><br><span class="line">    function approve(address spender, uint256 amount) external returns (bool);</span><br><span class="line">    function transferFrom(address from, address to, uint256 amount) external returns (bool);</span><br><span class="line">    function balanceOf(address account) external view returns (uint256);</span><br><span class="line">    function allowance(address owner, address spender) external view returns (uint256);</span><br><span class="line">    </span><br><span class="line">    event Transfer(address indexed from, address indexed to, uint256 value);</span><br><span class="line">    event Approval(address indexed owner, address indexed spender, uint256 value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ERC-721-NFT-æ ‡å‡†"><a href="#ERC-721-NFT-æ ‡å‡†" class="headerlink" title="ERC-721 NFT æ ‡å‡†"></a>ERC-721 NFT æ ‡å‡†</h4><p>éåŒè´¨åŒ–ä»£å¸ï¼ˆNFTï¼‰æ ‡å‡†ï¼Œæ¯ä¸ªä»£å¸éƒ½æ˜¯å”¯ä¸€çš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">interface IERC721 &#123;</span><br><span class="line">    function safeTransferFrom(address from, address to, uint256 tokenId) external;</span><br><span class="line">    function transferFrom(address from, address to, uint256 tokenId) external;</span><br><span class="line">    function approve(address to, uint256 tokenId) external;</span><br><span class="line">    function setApprovalForAll(address operator, bool approved) external;</span><br><span class="line">    function balanceOf(address owner) external view returns (uint256);</span><br><span class="line">    function ownerOf(uint256 tokenId) external view returns (address);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å§”æ‰˜æ¨¡å¼ï¼ˆDelegationï¼‰"><a href="#å§”æ‰˜æ¨¡å¼ï¼ˆDelegationï¼‰" class="headerlink" title="å§”æ‰˜æ¨¡å¼ï¼ˆDelegationï¼‰"></a>å§”æ‰˜æ¨¡å¼ï¼ˆDelegationï¼‰</h4><p>åˆçº¦é€šè¿‡å§”æ‰˜è°ƒç”¨æ‰§è¡Œå…¶ä»–åˆçº¦çš„é€»è¾‘ï¼Œä¿æŒæ•°æ®å­˜å‚¨åœ¨å½“å‰åˆçº¦ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ä»£ç†åˆçº¦</span><br><span class="line">contract Proxy &#123;</span><br><span class="line">    address implementation;</span><br><span class="line">    </span><br><span class="line">    fallback() external payable &#123;</span><br><span class="line">        (bool success, ) = implementation.delegatecall(msg.data);</span><br><span class="line">        require(success);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ™ºèƒ½åˆçº¦çš„å®‰å…¨è€ƒè™‘"><a href="#æ™ºèƒ½åˆçº¦çš„å®‰å…¨è€ƒè™‘" class="headerlink" title="æ™ºèƒ½åˆçº¦çš„å®‰å…¨è€ƒè™‘"></a>æ™ºèƒ½åˆçº¦çš„å®‰å…¨è€ƒè™‘</h2><h3 id="å¸¸è§æ¼æ´"><a href="#å¸¸è§æ¼æ´" class="headerlink" title="å¸¸è§æ¼æ´"></a>å¸¸è§æ¼æ´</h3><h4 id="é‡å…¥æ”»å‡»ï¼ˆReentrancyï¼‰"><a href="#é‡å…¥æ”»å‡»ï¼ˆReentrancyï¼‰" class="headerlink" title="é‡å…¥æ”»å‡»ï¼ˆReentrancyï¼‰"></a>é‡å…¥æ”»å‡»ï¼ˆReentrancyï¼‰</h4><p>æ”»å‡»è€…åœ¨å‡½æ•°æ‰§è¡Œå®Œæˆå‰å†æ¬¡è°ƒç”¨è¯¥å‡½æ•°ï¼Œå¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// æ˜“å—æ”»å‡»çš„ä»£ç </span><br><span class="line">function withdraw() public &#123;</span><br><span class="line">    uint amount = balances[msg.sender];</span><br><span class="line">    (bool success, ) = msg.sender.call&#123;value: amount&#125;(&quot;&quot;);</span><br><span class="line">    require(success);</span><br><span class="line">    balances[msg.sender] = 0;  // çŠ¶æ€æ›´æ–°å»¶è¿Ÿï¼Œå¯è¢«é‡å…¥</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å®‰å…¨çš„ä»£ç ï¼ˆæ£€æŸ¥-ä¿®æ”¹-äº¤äº’æ¨¡å¼ï¼‰</span><br><span class="line">function withdraw() public &#123;</span><br><span class="line">    uint amount = balances[msg.sender];</span><br><span class="line">    balances[msg.sender] = 0;  // å…ˆæ›´æ–°çŠ¶æ€</span><br><span class="line">    (bool success, ) = msg.sender.call&#123;value: amount&#125;(&quot;&quot;);</span><br><span class="line">    require(success);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ•´æ•°æº¢å‡º-x2F-ä¸‹æº¢"><a href="#æ•´æ•°æº¢å‡º-x2F-ä¸‹æº¢" class="headerlink" title="æ•´æ•°æº¢å‡º&#x2F;ä¸‹æº¢"></a>æ•´æ•°æº¢å‡º&#x2F;ä¸‹æº¢</h4><p>åœ¨ Solidity 0.8.0 ä¹‹å‰ï¼Œéœ€è¦æ‰‹åŠ¨æ£€æŸ¥æˆ–ä½¿ç”¨ SafeMath åº“ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// SafeMath åº“ä½¿ç”¨</span><br><span class="line">import &quot;@openzeppelin/contracts/utils/math/SafeMath.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract Safe &#123;</span><br><span class="line">    using SafeMath for uint256;</span><br><span class="line">    </span><br><span class="line">    function add(uint256 a, uint256 b) public pure returns (uint256) &#123;</span><br><span class="line">        return a.add(b);  // è‡ªåŠ¨æ£€æŸ¥æº¢å‡º</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è®¿é—®æ§åˆ¶æ¼æ´"><a href="#è®¿é—®æ§åˆ¶æ¼æ´" class="headerlink" title="è®¿é—®æ§åˆ¶æ¼æ´"></a>è®¿é—®æ§åˆ¶æ¼æ´</h4><p>å‡½æ•°ç¼ºå°‘æƒé™æ£€æŸ¥ï¼Œå¯¼è‡´ä»»ä½•äººéƒ½èƒ½è°ƒç”¨ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ä¸å®‰å…¨ï¼šä»»ä½•äººéƒ½èƒ½è½¬è´¦</span><br><span class="line">function transfer(address to, uint256 amount) public &#123;</span><br><span class="line">    balances[msg.sender] -= amount;</span><br><span class="line">    balances[to] += amount;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å®‰å…¨ï¼šæ£€æŸ¥æƒé™</span><br><span class="line">modifier onlyOwner() &#123;</span><br><span class="line">    require(msg.sender == owner, &quot;Only owner&quot;);</span><br><span class="line">    _;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function transfer(address to, uint256 amount) public onlyOwner &#123;</span><br><span class="line">    balances[msg.sender] -= amount;</span><br><span class="line">    balances[to] += amount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h3><ul>
<li><strong>å®¡è®¡ä»£ç </strong>ï¼šåœ¨éƒ¨ç½²å‰è¿›è¡Œä¸“ä¸šå®‰å…¨å®¡è®¡</li>
<li><strong>ä½¿ç”¨æˆç†Ÿåº“</strong>ï¼šä¼˜å…ˆä½¿ç”¨ OpenZeppelin ç­‰ç»è¿‡å®¡è®¡çš„åº“</li>
<li><strong>éµå¾ªè®¾è®¡æ¨¡å¼</strong>ï¼šä½¿ç”¨æ£€æŸ¥-ä¿®æ”¹-äº¤äº’ï¼ˆCEIï¼‰æ¨¡å¼</li>
<li><strong>é™åˆ¶æƒé™</strong>ï¼šæœ€å°æƒé™åŸåˆ™ï¼Œå®šä¹‰æ˜ç¡®çš„è®¿é—®æ§åˆ¶</li>
<li><strong>æµ‹è¯•å……åˆ†</strong>ï¼šç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•</li>
<li><strong>ç‰ˆæœ¬é”å®š</strong>ï¼šæ˜ç¡®æŒ‡å®š Solidity ç‰ˆæœ¬ï¼Œé¿å…æ„å¤–å‡çº§</li>
<li><strong>ç›‘æ§ Gas ä½¿ç”¨</strong>ï¼šä¼˜åŒ–åˆçº¦ä»¥å‡å°‘ Gas æ¶ˆè€—</li>
<li><strong>åº”æ€¥æ–¹æ¡ˆ</strong>ï¼šè®¾è®¡æš‚åœæœºåˆ¶å’Œå‡çº§æœºåˆ¶</li>
</ul>
<h2 id="æ™ºèƒ½åˆçº¦å¼€å‘å·¥å…·"><a href="#æ™ºèƒ½åˆçº¦å¼€å‘å·¥å…·" class="headerlink" title="æ™ºèƒ½åˆçº¦å¼€å‘å·¥å…·"></a>æ™ºèƒ½åˆçº¦å¼€å‘å·¥å…·</h2><h3 id="å¼€å‘æ¡†æ¶"><a href="#å¼€å‘æ¡†æ¶" class="headerlink" title="å¼€å‘æ¡†æ¶"></a>å¼€å‘æ¡†æ¶</h3><table>
<thead>
<tr>
<th>æ¡†æ¶</th>
<th>ç‰¹ç‚¹</th>
<th>ä¸»è¦åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Hardhat</strong></td>
<td>Node.js ç¯å¢ƒã€çµæ´»ã€æ’ä»¶ä¸°å¯Œ</td>
<td>ç¼–è¯‘ã€æµ‹è¯•ã€è°ƒè¯•ã€éƒ¨ç½²</td>
</tr>
<tr>
<td><strong>Truffle</strong></td>
<td>å®Œæ•´å·¥å…·å¥—ä»¶ã€ç”Ÿæ€æˆç†Ÿ</td>
<td>ç¼–è¯‘ã€è¿ç§»ã€æµ‹è¯•ã€éƒ¨ç½²</td>
</tr>
<tr>
<td><strong>Foundry</strong></td>
<td>Rust å®ç°ã€æ€§èƒ½é«˜ã€å®éªŒç‰¹æ€§</td>
<td>å¿«é€Ÿå¼€å‘ã€æ¨¡ç³Šæµ‹è¯•ã€Gas åˆ†æ</td>
</tr>
<tr>
<td><strong>Brownie</strong></td>
<td>Python ç¯å¢ƒã€æ˜“äºå­¦ä¹ </td>
<td>ç¼–è¯‘ã€æµ‹è¯•ã€éƒ¨ç½²ã€äº¤äº’</td>
</tr>
</tbody></table>
<h3 id="å¼€å‘æµç¨‹ç¤ºä¾‹ï¼ˆHardhatï¼‰"><a href="#å¼€å‘æµç¨‹ç¤ºä¾‹ï¼ˆHardhatï¼‰" class="headerlink" title="å¼€å‘æµç¨‹ç¤ºä¾‹ï¼ˆHardhatï¼‰"></a>å¼€å‘æµç¨‹ç¤ºä¾‹ï¼ˆHardhatï¼‰</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆå§‹åŒ–é¡¹ç›®</span></span><br><span class="line">npm install -g hardhat</span><br><span class="line">npx hardhat</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–å†™åˆçº¦</span></span><br><span class="line"><span class="comment"># contracts/Token.sol</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–å†™æµ‹è¯•</span></span><br><span class="line"><span class="comment"># test/Token.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘</span></span><br><span class="line">npx hardhat compile</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•</span></span><br><span class="line">npx hardhat <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># éƒ¨ç½²</span></span><br><span class="line">npx hardhat run scripts/deploy.js --network mainnet</span><br></pre></td></tr></table></figure>

<h3 id="éªŒè¯å’Œç›‘æ§"><a href="#éªŒè¯å’Œç›‘æ§" class="headerlink" title="éªŒè¯å’Œç›‘æ§"></a>éªŒè¯å’Œç›‘æ§</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Etherscan ä¸ŠéªŒè¯åˆçº¦æºç </span></span><br><span class="line">npx hardhat verify --network mainnet CONTRACT_ADDRESS <span class="string">&quot;constructor args&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ Tenderly è¿›è¡Œäº¤æ˜“æ¨¡æ‹Ÿå’Œè°ƒè¯•</span></span><br><span class="line">npx tenderly <span class="built_in">export</span> CONTRACT_ADDRESS</span><br></pre></td></tr></table></figure>

<h2 id="Gas-ä¼˜åŒ–"><a href="#Gas-ä¼˜åŒ–" class="headerlink" title="Gas ä¼˜åŒ–"></a>Gas ä¼˜åŒ–</h2><h3 id="ä»€ä¹ˆæ˜¯-Gas"><a href="#ä»€ä¹ˆæ˜¯-Gas" class="headerlink" title="ä»€ä¹ˆæ˜¯ Gas"></a>ä»€ä¹ˆæ˜¯ Gas</h3><p>Gas æ˜¯åœ¨ä»¥å¤ªåŠä¸Šæ‰§è¡Œæ“ä½œæ‰€éœ€çš„è®¡ç®—è´¹ç”¨å•ä½ï¼Œç”¨æˆ·éœ€è¦æ”¯ä»˜ Gas è´¹ç”¨æ¥æ‰§è¡Œäº¤æ˜“ã€‚</p>
<h3 id="Gas-æˆæœ¬ç¤ºä¾‹"><a href="#Gas-æˆæœ¬ç¤ºä¾‹" class="headerlink" title="Gas æˆæœ¬ç¤ºä¾‹"></a>Gas æˆæœ¬ç¤ºä¾‹</h3><table>
<thead>
<tr>
<th>æ“ä½œ</th>
<th>Gas æ¶ˆè€—</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>è¯»å–å­˜å‚¨</td>
<td>2,100</td>
<td>å…è´¹è¯»å–</td>
</tr>
<tr>
<td>å†™å…¥å­˜å‚¨</td>
<td>20,000</td>
<td>é¦–æ¬¡å†™å…¥</td>
</tr>
<tr>
<td>æ›´æ–°å­˜å‚¨</td>
<td>5,000</td>
<td>å·²å­˜åœ¨çš„å€¼æ›´æ–°</td>
</tr>
<tr>
<td>ç®—æœ¯è¿ç®—</td>
<td>3-5</td>
<td>åŠ ã€å‡ã€ä¹˜</td>
</tr>
<tr>
<td>äº‹ä»¶æ—¥å¿—</td>
<td>375+</td>
<td>æ¯ä¸ªæ—¥å¿—æ¡ç›®</td>
</tr>
<tr>
<td>åˆ›å»ºåˆçº¦</td>
<td>53,000</td>
<td>åˆ›å»ºæ–°åˆçº¦</td>
</tr>
</tbody></table>
<h3 id="ä¼˜åŒ–æŠ€å·§"><a href="#ä¼˜åŒ–æŠ€å·§" class="headerlink" title="ä¼˜åŒ–æŠ€å·§"></a>ä¼˜åŒ–æŠ€å·§</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 1. å‡å°‘å­˜å‚¨å†™å…¥</span><br><span class="line">function batchUpdate(uint256[] memory values) public &#123;</span><br><span class="line">    uint256 length = values.length;</span><br><span class="line">    for (uint256 i = 0; i &lt; length; i++) &#123;</span><br><span class="line">        // åœ¨å†…å­˜ä¸­è®¡ç®—ï¼Œæœ€åä¸€æ¬¡å†™å…¥å­˜å‚¨</span><br><span class="line">    &#125;</span><br><span class="line">    result = calculateOnce(values);  // ä¸€æ¬¡å†™å…¥</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 2. ä½¿ç”¨ç´§å‡‘çš„æ•°æ®ç±»å‹</span><br><span class="line">struct Packed &#123;</span><br><span class="line">    uint8 flag;      // 1 å­—èŠ‚</span><br><span class="line">    uint8 status;    // 1 å­—èŠ‚</span><br><span class="line">    uint128 value;   // 16 å­—èŠ‚</span><br><span class="line">    // æ€»å…± 18 å­—èŠ‚ï¼Œå…±äº«ä¸€ä¸ª 32 å­—èŠ‚çš„å­˜å‚¨æ§½</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 3. é¿å…ä¸å¿…è¦çš„è®¡ç®—</span><br><span class="line">function getDiscount(uint256 amount) public view returns (uint256) &#123;</span><br><span class="line">    // ä¸å¥½ï¼šæ¯æ¬¡éƒ½è®¡ç®—</span><br><span class="line">    // return amount * 10 / 100;</span><br><span class="line">    </span><br><span class="line">    // æ›´å¥½ï¼šé¢„å…ˆè®¡ç®—å¸¸æ•°</span><br><span class="line">    return amount * DISCOUNT_PERCENT / 100;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 4. ä½¿ç”¨ calldata ä»£æ›¿ memory</span><br><span class="line">function process(bytes calldata data) public pure &#123;</span><br><span class="line">    // calldata æ˜¯åªè¯»çš„ï¼Œä¸éœ€è¦å¤åˆ¶åˆ°å†…å­˜</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ™ºèƒ½åˆçº¦çš„çœŸå®åº”ç”¨"><a href="#æ™ºèƒ½åˆçº¦çš„çœŸå®åº”ç”¨" class="headerlink" title="æ™ºèƒ½åˆçº¦çš„çœŸå®åº”ç”¨"></a>æ™ºèƒ½åˆçº¦çš„çœŸå®åº”ç”¨</h2><h3 id="DeFiï¼ˆå»ä¸­å¿ƒåŒ–é‡‘èï¼‰"><a href="#DeFiï¼ˆå»ä¸­å¿ƒåŒ–é‡‘èï¼‰" class="headerlink" title="DeFiï¼ˆå»ä¸­å¿ƒåŒ–é‡‘èï¼‰"></a>DeFiï¼ˆå»ä¸­å¿ƒåŒ–é‡‘èï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// Uniswap é£æ ¼çš„äº¤æ¢åˆçº¦ç®€åŒ–ç‰ˆ</span><br><span class="line">contract SimpleSwap &#123;</span><br><span class="line">    mapping(address =&gt; uint256) public tokenABalance;</span><br><span class="line">    mapping(address =&gt; uint256) public tokenBBalance;</span><br><span class="line">    </span><br><span class="line">    event Swap(address indexed user, uint256 amountA, uint256 amountB);</span><br><span class="line">    </span><br><span class="line">    // x * y = k æ’å®šä¹˜ç§¯å…¬å¼</span><br><span class="line">    function swap(address tokenFrom, uint256 amountIn) public returns (uint256) &#123;</span><br><span class="line">        uint256 balanceIn = (tokenFrom == tokenA) ? tokenABalance[address(this)] : tokenBBalance[address(this)];</span><br><span class="line">        uint256 balanceOut = (tokenFrom == tokenA) ? tokenBBalance[address(this)] : tokenABalance[address(this)];</span><br><span class="line">        </span><br><span class="line">        uint256 amountOut = (amountIn * balanceOut) / (balanceIn + amountIn);</span><br><span class="line">        </span><br><span class="line">        emit Swap(msg.sender, amountIn, amountOut);</span><br><span class="line">        return amountOut;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="NFT-å¸‚åœº"><a href="#NFT-å¸‚åœº" class="headerlink" title="NFT å¸‚åœº"></a>NFT å¸‚åœº</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ç®€åŒ–çš„ NFT å¸‚åœºåˆçº¦</span><br><span class="line">contract NFTMarketplace &#123;</span><br><span class="line">    IERC721 public nftContract;</span><br><span class="line">    </span><br><span class="line">    struct Listing &#123;</span><br><span class="line">        address seller;</span><br><span class="line">        uint256 price;</span><br><span class="line">        bool active;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    mapping(uint256 =&gt; Listing) public listings;</span><br><span class="line">    </span><br><span class="line">    event Listed(uint256 indexed tokenId, address indexed seller, uint256 price);</span><br><span class="line">    event Purchased(uint256 indexed tokenId, address indexed buyer, uint256 price);</span><br><span class="line">    </span><br><span class="line">    function list(uint256 tokenId, uint256 price) public &#123;</span><br><span class="line">        require(nftContract.ownerOf(tokenId) == msg.sender);</span><br><span class="line">        listings[tokenId] = Listing(msg.sender, price, true);</span><br><span class="line">        emit Listed(tokenId, msg.sender, price);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function purchase(uint256 tokenId) public payable &#123;</span><br><span class="line">        Listing memory listing = listings[tokenId];</span><br><span class="line">        require(listing.active);</span><br><span class="line">        require(msg.value &gt;= listing.price);</span><br><span class="line">        </span><br><span class="line">        listings[tokenId].active = false;</span><br><span class="line">        nftContract.transferFrom(listing.seller, msg.sender, tokenId);</span><br><span class="line">        </span><br><span class="line">        (bool success, ) = listing.seller.call&#123;value: msg.value&#125;(&quot;&quot;);</span><br><span class="line">        require(success);</span><br><span class="line">        </span><br><span class="line">        emit Purchased(tokenId, msg.sender, msg.value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="DAOï¼ˆå»ä¸­å¿ƒåŒ–è‡ªæ²»ç»„ç»‡ï¼‰"><a href="#DAOï¼ˆå»ä¸­å¿ƒåŒ–è‡ªæ²»ç»„ç»‡ï¼‰" class="headerlink" title="DAOï¼ˆå»ä¸­å¿ƒåŒ–è‡ªæ²»ç»„ç»‡ï¼‰"></a>DAOï¼ˆå»ä¸­å¿ƒåŒ–è‡ªæ²»ç»„ç»‡ï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ç®€åŒ–çš„ DAO æŠ•ç¥¨åˆçº¦</span><br><span class="line">contract SimpleDAO &#123;</span><br><span class="line">    IERC20 public governanceToken;</span><br><span class="line">    </span><br><span class="line">    struct Proposal &#123;</span><br><span class="line">        string description;</span><br><span class="line">        uint256 voteCount;</span><br><span class="line">        bool executed;</span><br><span class="line">        mapping(address =&gt; bool) voted;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Proposal[] public proposals;</span><br><span class="line">    </span><br><span class="line">    function createProposal(string memory description) public &#123;</span><br><span class="line">        proposals.push();</span><br><span class="line">        proposals[proposals.length - 1].description = description;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function vote(uint256 proposalId) public &#123;</span><br><span class="line">        require(governanceToken.balanceOf(msg.sender) &gt; 0, &quot;No voting power&quot;);</span><br><span class="line">        require(!proposals[proposalId].voted[msg.sender], &quot;Already voted&quot;);</span><br><span class="line">        </span><br><span class="line">        proposals[proposalId].voted[msg.sender] = true;</span><br><span class="line">        proposals[proposalId].voteCount += 1;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function executeProposal(uint256 proposalId) public &#123;</span><br><span class="line">        require(proposals[proposalId].voteCount &gt; THRESHOLD);</span><br><span class="line">        require(!proposals[proposalId].executed);</span><br><span class="line">        </span><br><span class="line">        proposals[proposalId].executed = true;</span><br><span class="line">        // æ‰§è¡Œææ¡ˆé€»è¾‘</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ™ºèƒ½åˆçº¦çš„å‘å±•è¶‹åŠ¿"><a href="#æ™ºèƒ½åˆçº¦çš„å‘å±•è¶‹åŠ¿" class="headerlink" title="æ™ºèƒ½åˆçº¦çš„å‘å±•è¶‹åŠ¿"></a>æ™ºèƒ½åˆçº¦çš„å‘å±•è¶‹åŠ¿</h2><h3 id="1-è·¨é“¾äº’æ“ä½œæ€§"><a href="#1-è·¨é“¾äº’æ“ä½œæ€§" class="headerlink" title="1. è·¨é“¾äº’æ“ä½œæ€§"></a>1. è·¨é“¾äº’æ“ä½œæ€§</h3><ul>
<li><strong>è·¨é“¾æ¡¥æ¥</strong>ï¼šå…è®¸åˆçº¦è·¨è¶Šä¸åŒåŒºå—é“¾äº¤äº’</li>
<li><strong>åŸå­äº¤æ¢</strong>ï¼šä¸åŒåŒºå—é“¾é—´çš„åŸå­äº¤æ˜“</li>
<li><strong>é€šç”¨èµ„äº§</strong>ï¼šç»Ÿä¸€çš„è·¨é“¾èµ„äº§è¡¨ç¤º</li>
</ul>
<h3 id="2-é›¶çŸ¥è¯†è¯æ˜ï¼ˆZKï¼‰"><a href="#2-é›¶çŸ¥è¯†è¯æ˜ï¼ˆZKï¼‰" class="headerlink" title="2. é›¶çŸ¥è¯†è¯æ˜ï¼ˆZKï¼‰"></a>2. é›¶çŸ¥è¯†è¯æ˜ï¼ˆZKï¼‰</h3><ul>
<li><strong>éšç§ä¿æŠ¤</strong>ï¼šåœ¨ä¸æš´éœ²æ•°æ®çš„æƒ…å†µä¸‹è¯æ˜æ­£ç¡®æ€§</li>
<li><strong>å¯æ‰©å±•æ€§</strong>ï¼šé€šè¿‡ ZK-rollup æ‰©å±•äº¤æ˜“ååé‡</li>
<li><strong>åˆè§„æ€§</strong>ï¼šæ»¡è¶³ç›‘ç®¡è¦æ±‚çš„éšç§äº¤æ˜“</li>
</ul>
<h3 id="3-å½¢å¼åŒ–éªŒè¯"><a href="#3-å½¢å¼åŒ–éªŒè¯" class="headerlink" title="3. å½¢å¼åŒ–éªŒè¯"></a>3. å½¢å¼åŒ–éªŒè¯</h3><ul>
<li><strong>æ•°å­¦è¯æ˜</strong>ï¼šè¯æ˜åˆçº¦ä»£ç çš„æ­£ç¡®æ€§</li>
<li><strong>å‡å°‘æ¼æ´</strong>ï¼šæ—©æœŸå‘ç°é€»è¾‘é”™è¯¯</li>
<li><strong>æé«˜å®‰å…¨æ€§</strong>ï¼šå…³é”®åˆçº¦çš„å¼ºåˆ¶éªŒè¯</li>
</ul>
<h3 id="4-é«˜çº§è¯­è¨€å’Œæ¡†æ¶"><a href="#4-é«˜çº§è¯­è¨€å’Œæ¡†æ¶" class="headerlink" title="4. é«˜çº§è¯­è¨€å’Œæ¡†æ¶"></a>4. é«˜çº§è¯­è¨€å’Œæ¡†æ¶</h3><ul>
<li><strong>æ›´å¥½çš„å¼€å‘è€…ä½“éªŒ</strong>ï¼šDSL å’Œç°ä»£è¯­è¨€æ”¯æŒ</li>
<li><strong>æ›´é«˜çš„æŠ½è±¡åº¦</strong>ï¼šå‡å°‘ä½çº§é”™è¯¯</li>
<li><strong>è‡ªåŠ¨åŒ–å®¡è®¡</strong>ï¼šå†…ç½®çš„å®‰å…¨æ£€æŸ¥</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ™ºèƒ½åˆçº¦æ˜¯ Web3 çš„åŸºçŸ³ï¼Œé€šè¿‡ä»£ç å½¢å¼çš„è‡ªåŠ¨åŒ–åè®®ï¼Œå®ç°äº†å»ä¸­å¿ƒåŒ–åº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½ã€‚å¼€å‘æ™ºèƒ½åˆçº¦éœ€è¦æŒæ¡ï¼š</p>
<ul>
<li><strong>åŸºç¡€çŸ¥è¯†</strong>ï¼šåŒºå—é“¾åŸç†ã€EVMã€Gas æœºåˆ¶</li>
<li><strong>ç¼–ç¨‹æŠ€èƒ½</strong>ï¼šSolidity æˆ–å…¶ä»–åˆçº¦è¯­è¨€</li>
<li><strong>å®‰å…¨æ„è¯†</strong>ï¼šå¸¸è§æ¼æ´ã€æœ€ä½³å®è·µã€å®¡è®¡æµç¨‹</li>
<li><strong>å¼€å‘å·¥å…·</strong>ï¼šç¼–è¯‘ã€æµ‹è¯•ã€éƒ¨ç½²ã€éªŒè¯å·¥å…·</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šGas ä¼˜åŒ–ã€ç®—æ³•ä¼˜åŒ–ã€æ¶æ„è®¾è®¡</li>
<li><strong>å®æˆ˜åº”ç”¨</strong>ï¼šDeFiã€NFTã€DAO ç­‰å®é™…åœºæ™¯</li>
</ul>
<p>åªæœ‰å……åˆ†ç†è§£è¿™äº›è¦ç´ ï¼Œæ‰èƒ½å¼€å‘å®‰å…¨ã€é«˜æ•ˆã€æœ‰ä»·å€¼çš„æ™ºèƒ½åˆçº¦åº”ç”¨ã€‚</p>
<h2 id="å¸¸è§é—®é¢˜è§£ç­”"><a href="#å¸¸è§é—®é¢˜è§£ç­”" class="headerlink" title="å¸¸è§é—®é¢˜è§£ç­”"></a>å¸¸è§é—®é¢˜è§£ç­”</h2><h3 id="1-ä»€ä¹ˆæ˜¯æ™ºèƒ½åˆçº¦ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯æ™ºèƒ½åˆçº¦ï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯æ™ºèƒ½åˆçº¦ï¼Ÿ"></a>1. ä»€ä¹ˆæ˜¯æ™ºèƒ½åˆçº¦ï¼Ÿ</h3><p>æ™ºèƒ½åˆçº¦æ˜¯è¿è¡Œåœ¨åŒºå—é“¾ä¸Šçš„ä¸€æ®µä»£ç ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li><strong>ä»£ç å®šä¹‰é€»è¾‘</strong>ï¼šä»£ç é€»è¾‘å®šä¹‰äº†åˆçº¦çš„æ‰§è¡Œè§„åˆ™å’Œæ¡æ¬¾</li>
<li><strong>è´¦æˆ·çŠ¶æ€</strong>ï¼šæ™ºèƒ½åˆçº¦çš„è´¦æˆ·ä¿å­˜äº†åˆçº¦å½“å‰çš„çŠ¶æ€ï¼š<ul>
<li><code>balance</code>ï¼šå½“å‰ä½™é¢</li>
<li><code>nonce</code>ï¼šäº¤æ˜“æ¬¡æ•°</li>
<li><code>code</code>ï¼šåˆçº¦ä»£ç </li>
<li><code>storage</code>ï¼šå­˜å‚¨æ•°æ®ï¼Œæ•°æ®ç»“æ„æ˜¯ä¸€é¢— MPTï¼ˆMerkle Patricia Treeï¼‰</li>
</ul>
</li>
<li><strong>ç¼–ç¨‹è¯­è¨€</strong>ï¼šSolidity æ˜¯æ™ºèƒ½åˆçº¦æœ€å¸¸ç”¨çš„è¯­è¨€ï¼Œè¯­æ³•ä¸Šå’Œ JavaScript å¾ˆæ¥è¿‘</li>
</ul>
<h3 id="2-å¤–éƒ¨è´¦æˆ·å¦‚ä½•è°ƒç”¨æ™ºèƒ½åˆçº¦ï¼Ÿ"><a href="#2-å¤–éƒ¨è´¦æˆ·å¦‚ä½•è°ƒç”¨æ™ºèƒ½åˆçº¦ï¼Ÿ" class="headerlink" title="2. å¤–éƒ¨è´¦æˆ·å¦‚ä½•è°ƒç”¨æ™ºèƒ½åˆçº¦ï¼Ÿ"></a>2. å¤–éƒ¨è´¦æˆ·å¦‚ä½•è°ƒç”¨æ™ºèƒ½åˆçº¦ï¼Ÿ</h3><p>å¤–éƒ¨è´¦æˆ·ï¼ˆEOAï¼‰é€šè¿‡åˆ›å»ºä¸€ä¸ªäº¤æ˜“æ¥è°ƒç”¨æ™ºèƒ½åˆçº¦ï¼š</p>
<ul>
<li><strong>æ¥æ”¶åœ°å€</strong>ï¼šäº¤æ˜“çš„æ¥æ”¶åœ°å€ä¸ºè¦è°ƒç”¨çš„æ™ºèƒ½åˆçº¦çš„åœ°å€</li>
<li><strong>data åŸŸ</strong>ï¼šå¡«å†™è¦è°ƒç”¨çš„å‡½æ•°åŠå…¶å‚æ•°çš„ç¼–ç å€¼ï¼ˆABI ç¼–ç ï¼‰</li>
<li><strong>æ‰§è¡Œè¿‡ç¨‹</strong>ï¼šèŠ‚ç‚¹æ¥æ”¶äº¤æ˜“åï¼Œè§£æ data åŸŸï¼Œè°ƒç”¨å¯¹åº”çš„åˆçº¦å‡½æ•°</li>
</ul>
<h4 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// åˆçº¦ä¸­çš„å‡½æ•°</span><br><span class="line">contract Counter &#123;</span><br><span class="line">    uint256 public count;</span><br><span class="line">    </span><br><span class="line">    function increment(uint256 amount) public &#123;</span><br><span class="line">        count += amount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å¤–éƒ¨è°ƒç”¨ï¼ˆé€šè¿‡äº¤æ˜“ï¼‰</span><br><span class="line">// äº¤æ˜“æ ¼å¼ï¼š</span><br><span class="line">// to: 0x1234...ï¼ˆåˆçº¦åœ°å€ï¼‰</span><br><span class="line">// data: 0x3ad0f3f6 + å‚æ•°ç¼–ç ï¼ˆincrement(10) çš„ç¼–ç ï¼‰</span><br><span class="line">// value: 0ï¼ˆä¸å‘é€ ETHï¼‰</span><br></pre></td></tr></table></figure>

<h3 id="3-ä¸€ä¸ªåˆçº¦å¦‚ä½•è°ƒç”¨å¦ä¸€ä¸ªåˆçº¦ä¸­çš„å‡½æ•°ï¼Ÿ"><a href="#3-ä¸€ä¸ªåˆçº¦å¦‚ä½•è°ƒç”¨å¦ä¸€ä¸ªåˆçº¦ä¸­çš„å‡½æ•°ï¼Ÿ" class="headerlink" title="3. ä¸€ä¸ªåˆçº¦å¦‚ä½•è°ƒç”¨å¦ä¸€ä¸ªåˆçº¦ä¸­çš„å‡½æ•°ï¼Ÿ"></a>3. ä¸€ä¸ªåˆçº¦å¦‚ä½•è°ƒç”¨å¦ä¸€ä¸ªåˆçº¦ä¸­çš„å‡½æ•°ï¼Ÿ</h3><p>æ³¨ï¼šä»¥å¤ªåŠä¸­è§„å®šï¼Œä¸€ä¸ªäº¤æ˜“åªæœ‰å¤–éƒ¨è´¦æˆ·æ‰èƒ½å¤Ÿå‘èµ·ï¼Œåˆçº¦è´¦æˆ·ä¸èƒ½å¤Ÿè‡ªå·±ä¸»åŠ¨å‘èµ·ä¸€ä¸ªäº¤æ˜“ã€‚</p>
<p>åˆçº¦é—´è°ƒç”¨åˆ†ä¸ºä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p>
<h4 id="æ–¹å¼-1ï¼šç›´æ¥è°ƒç”¨ï¼ˆCallï¼‰"><a href="#æ–¹å¼-1ï¼šç›´æ¥è°ƒç”¨ï¼ˆCallï¼‰" class="headerlink" title="æ–¹å¼ 1ï¼šç›´æ¥è°ƒç”¨ï¼ˆCallï¼‰"></a>æ–¹å¼ 1ï¼šç›´æ¥è°ƒç”¨ï¼ˆCallï¼‰</h4><p>æœ€å¸¸ç”¨çš„æ–¹å¼ï¼Œæ‰§è¡Œç›®æ ‡åˆçº¦çš„å‡½æ•°ï¼ŒçŠ¶æ€å˜åŒ–åœ¨ç›®æ ‡åˆçº¦ä¸­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ç›®æ ‡åˆçº¦</span><br><span class="line">contract TargetContract &#123;</span><br><span class="line">    uint256 public value = 0;</span><br><span class="line">    </span><br><span class="line">    function setValue(uint256 newValue) public &#123;</span><br><span class="line">        value = newValue;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function getValue() public view returns (uint256) &#123;</span><br><span class="line">        return value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è°ƒç”¨åˆçº¦</span><br><span class="line">contract CallerContract &#123;</span><br><span class="line">    TargetContract target;</span><br><span class="line">    </span><br><span class="line">    constructor(address _target) &#123;</span><br><span class="line">        target = TargetContract(_target);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // æ–¹å¼ 1ï¼šç›´æ¥è°ƒç”¨</span><br><span class="line">    function callTarget(uint256 newValue) public &#123;</span><br><span class="line">        target.setValue(newValue);  // çŠ¶æ€å˜åŒ–åœ¨ target ä¸­</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // æŸ¥è¯¢ç›®æ ‡åˆçº¦çš„çŠ¶æ€</span><br><span class="line">    function queryTarget() public view returns (uint256) &#123;</span><br><span class="line">        return target.getValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ–¹å¼-2ï¼šå§”æ‰˜è°ƒç”¨ï¼ˆDelegatecallï¼‰"><a href="#æ–¹å¼-2ï¼šå§”æ‰˜è°ƒç”¨ï¼ˆDelegatecallï¼‰" class="headerlink" title="æ–¹å¼ 2ï¼šå§”æ‰˜è°ƒç”¨ï¼ˆDelegatecallï¼‰"></a>æ–¹å¼ 2ï¼šå§”æ‰˜è°ƒç”¨ï¼ˆDelegatecallï¼‰</h4><p>æ‰§è¡Œç›®æ ‡åˆçº¦çš„ä»£ç ï¼Œä½†çŠ¶æ€å˜åŒ–åœ¨<strong>è°ƒç”¨åˆçº¦</strong>ä¸­ã€‚å¸¸ç”¨äºä»£ç†æ¨¡å¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// é€»è¾‘åˆçº¦</span><br><span class="line">contract Logic &#123;</span><br><span class="line">    uint256 public counter;</span><br><span class="line">    </span><br><span class="line">    function increment() public &#123;</span><br><span class="line">        counter += 1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ä»£ç†åˆçº¦</span><br><span class="line">contract Proxy &#123;</span><br><span class="line">    uint256 public counter;  // ä¸ Logic åˆçº¦çš„çŠ¶æ€å˜é‡ç›¸åŒ</span><br><span class="line">    address public implementation;</span><br><span class="line">    </span><br><span class="line">    constructor(address _logic) &#123;</span><br><span class="line">        implementation = _logic;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // ä½¿ç”¨ delegatecall è°ƒç”¨é€»è¾‘åˆçº¦</span><br><span class="line">    function increment() public &#123;</span><br><span class="line">        (bool success, ) = implementation.delegatecall(</span><br><span class="line">            abi.encodeWithSignature(&quot;increment()&quot;)</span><br><span class="line">        );</span><br><span class="line">        require(success, &quot;Delegatecall failed&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // çŠ¶æ€å˜åŒ–åœ¨ Proxy ä¸­ï¼Œä¸åœ¨ Logic ä¸­</span><br><span class="line">    function getCounter() public view returns (uint256) &#123;</span><br><span class="line">        return counter;  // è¿”å› Proxy çš„ counter</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ–¹å¼-3ï¼šä½çº§è°ƒç”¨ï¼ˆLow-level-Callï¼‰"><a href="#æ–¹å¼-3ï¼šä½çº§è°ƒç”¨ï¼ˆLow-level-Callï¼‰" class="headerlink" title="æ–¹å¼ 3ï¼šä½çº§è°ƒç”¨ï¼ˆLow-level Callï¼‰"></a>æ–¹å¼ 3ï¼šä½çº§è°ƒç”¨ï¼ˆLow-level Callï¼‰</h4><p>ä½¿ç”¨ <code>call</code> æ–¹æ³•è¿›è¡Œä½çº§è°ƒç”¨ï¼Œé€‚åˆä¸çŸ¥é“ç›®æ ‡åˆçº¦ ABI çš„åœºæ™¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract Caller &#123;</span><br><span class="line">    // ä½çº§è°ƒç”¨ï¼šå‘é€ ETH å¹¶è°ƒç”¨å‡½æ•°</span><br><span class="line">    function lowLevelCall(address target, bytes memory data) public payable returns (bool) &#123;</span><br><span class="line">        (bool success, bytes memory result) = target.call&#123;value: msg.value&#125;(data);</span><br><span class="line">        return success;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // ä½¿ç”¨ç¤ºä¾‹</span><br><span class="line">    function callWithData(address target) public &#123;</span><br><span class="line">        // å‡†å¤‡å‡½æ•°è°ƒç”¨æ•°æ®ï¼šsetValue(42)</span><br><span class="line">        bytes memory payload = abi.encodeWithSignature(&quot;setValue(uint256)&quot;, 42);</span><br><span class="line">        </span><br><span class="line">        (bool success, ) = target.call(payload);</span><br><span class="line">        require(success, &quot;Call failed&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ–¹å¼-4ï¼šæ¥å£è°ƒç”¨ï¼ˆæ¨èï¼‰"><a href="#æ–¹å¼-4ï¼šæ¥å£è°ƒç”¨ï¼ˆæ¨èï¼‰" class="headerlink" title="æ–¹å¼ 4ï¼šæ¥å£è°ƒç”¨ï¼ˆæ¨èï¼‰"></a>æ–¹å¼ 4ï¼šæ¥å£è°ƒç”¨ï¼ˆæ¨èï¼‰</h4><p>å®šä¹‰æ¥å£ï¼Œé€šè¿‡æ¥å£è°ƒç”¨ç›®æ ‡åˆçº¦ï¼Œæœ€å®‰å…¨å’Œæ¸…æ™°çš„æ–¹å¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ç›®æ ‡åˆçº¦æ¥å£</span><br><span class="line">interface ITarget &#123;</span><br><span class="line">    function setValue(uint256 newValue) external;</span><br><span class="line">    function getValue() external view returns (uint256);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è°ƒç”¨åˆçº¦</span><br><span class="line">contract SafeCaller &#123;</span><br><span class="line">    ITarget target;</span><br><span class="line">    </span><br><span class="line">    constructor(address _target) &#123;</span><br><span class="line">        target = ITarget(_target);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // é€šè¿‡æ¥å£è°ƒç”¨ï¼ˆæœ€æ¨èï¼‰</span><br><span class="line">    function updateTarget(uint256 newValue) public &#123;</span><br><span class="line">        target.setValue(newValue);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function readTarget() public view returns (uint256) &#123;</span><br><span class="line">        return target.getValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-åˆçº¦è°ƒç”¨çš„æˆæœ¬å’Œé™åˆ¶"><a href="#4-åˆçº¦è°ƒç”¨çš„æˆæœ¬å’Œé™åˆ¶" class="headerlink" title="4. åˆçº¦è°ƒç”¨çš„æˆæœ¬å’Œé™åˆ¶"></a>4. åˆçº¦è°ƒç”¨çš„æˆæœ¬å’Œé™åˆ¶</h3><h4 id="Gas-æˆæœ¬"><a href="#Gas-æˆæœ¬" class="headerlink" title="Gas æˆæœ¬"></a>Gas æˆæœ¬</h4><table>
<thead>
<tr>
<th>è°ƒç”¨æ–¹å¼</th>
<th>Gas æ¶ˆè€—</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Call</strong></td>
<td>~600-700</td>
<td>æ™®é€šå¤–éƒ¨è°ƒç”¨</td>
</tr>
<tr>
<td><strong>Delegatecall</strong></td>
<td>~600-700</td>
<td>å§”æ‰˜è°ƒç”¨ï¼Œä»£ç†æ¨¡å¼</td>
</tr>
<tr>
<td><strong>Static Call</strong></td>
<td>~600-700</td>
<td>åªè¯»è°ƒç”¨ï¼ˆview&#x2F;pureï¼‰</td>
</tr>
<tr>
<td><strong>Create</strong></td>
<td>~53,000</td>
<td>åˆ›å»ºæ–°åˆçº¦</td>
</tr>
</tbody></table>
<h4 id="é™åˆ¶æ¡ä»¶"><a href="#é™åˆ¶æ¡ä»¶" class="headerlink" title="é™åˆ¶æ¡ä»¶"></a>é™åˆ¶æ¡ä»¶</h4><ol>
<li><strong>è°ƒç”¨æ·±åº¦é™åˆ¶</strong>ï¼šæœ€å¤š 1024 å±‚åµŒå¥—è°ƒç”¨</li>
<li><strong>Gas é™åˆ¶</strong>ï¼šè°ƒç”¨æ–¹å¿…é¡»æä¾›è¶³å¤Ÿçš„ Gas</li>
<li><strong>å¼‚å¸¸å¤„ç†</strong>ï¼šè°ƒç”¨å¤±è´¥éœ€è¦å¦¥å–„å¤„ç†</li>
<li><strong>çŠ¶æ€ä¸€è‡´æ€§</strong>ï¼šDelegatecall éœ€è¦ç¡®ä¿å­˜å‚¨å¸ƒå±€ä¸€è‡´</li>
</ol>
<h4 id="é”™è¯¯å¤„ç†ç¤ºä¾‹"><a href="#é”™è¯¯å¤„ç†ç¤ºä¾‹" class="headerlink" title="é”™è¯¯å¤„ç†ç¤ºä¾‹"></a>é”™è¯¯å¤„ç†ç¤ºä¾‹</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract SafeCallExample &#123;</span><br><span class="line">    function safeCall(address target, bytes memory data) public returns (bool) &#123;</span><br><span class="line">        // æ–¹å¼ 1ï¼šä½¿ç”¨ try-catchï¼ˆSolidity 0.6.0+ï¼‰</span><br><span class="line">        try &#123;</span><br><span class="line">            (bool success, ) = target.call(data);</span><br><span class="line">            return success;</span><br><span class="line">        &#125; catch &#123;</span><br><span class="line">            // å¤„ç†è°ƒç”¨å¤±è´¥</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // æ–¹å¼ 2ï¼šæ£€æŸ¥è¿”å›å€¼</span><br><span class="line">    function checkedCall(address target, bytes memory data) public returns (bool) &#123;</span><br><span class="line">        (bool success, bytes memory result) = target.call(data);</span><br><span class="line">        if (!success) &#123;</span><br><span class="line">            // è§£æé”™è¯¯ä¿¡æ¯</span><br><span class="line">            if (result.length &gt; 0) &#123;</span><br><span class="line">                // ç›®æ ‡åˆçº¦è¿”å›äº†é”™è¯¯</span><br><span class="line">                assembly &#123;</span><br><span class="line">                    revert(add(32, result), mload(result))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                revert(&quot;Call failed&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-è°ƒç”¨æ–¹å¼å¯¹æ¯”è¡¨"><a href="#5-è°ƒç”¨æ–¹å¼å¯¹æ¯”è¡¨" class="headerlink" title="5. è°ƒç”¨æ–¹å¼å¯¹æ¯”è¡¨"></a>5. è°ƒç”¨æ–¹å¼å¯¹æ¯”è¡¨</h3><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>Call</th>
<th>Delegatecall</th>
<th>Interface</th>
<th>Low-level</th>
</tr>
</thead>
<tbody><tr>
<td><strong>å®‰å…¨æ€§</strong></td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…</td>
</tr>
<tr>
<td><strong>å¯è¯»æ€§</strong></td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…</td>
</tr>
<tr>
<td><strong>çµæ´»æ€§</strong></td>
<td>â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
</tr>
<tr>
<td><strong>éœ€è¦ ABI</strong></td>
<td>æ˜¯</td>
<td>æ˜¯</td>
<td>æ˜¯</td>
<td>å¦</td>
</tr>
<tr>
<td><strong>å…¸å‹ç”¨é€”</strong></td>
<td>æ™®é€šè°ƒç”¨</td>
<td>ä»£ç†æ¨¡å¼</td>
<td>æ ‡å‡†è°ƒç”¨</td>
<td>åŠ¨æ€è°ƒç”¨</td>
</tr>
<tr>
<td><strong>æ¨èåº¦</strong></td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…â˜…â˜…â˜…</td>
<td>â˜…â˜…</td>
</tr>
</tbody></table>
<h3 id="6-æœ€ä½³å®è·µ"><a href="#6-æœ€ä½³å®è·µ" class="headerlink" title="6. æœ€ä½³å®è·µ"></a>6. æœ€ä½³å®è·µ</h3><ul>
<li><strong>ä¼˜å…ˆä½¿ç”¨æ¥å£è°ƒç”¨</strong>ï¼šæä¾›ç±»å‹å®‰å…¨å’Œæ¸…æ™°çš„ API</li>
<li><strong>éªŒè¯è°ƒç”¨è¿”å›å€¼</strong>ï¼šå§‹ç»ˆæ£€æŸ¥è°ƒç”¨æ˜¯å¦æˆåŠŸ</li>
<li><strong>é¿å…è¿‡æ·±çš„è°ƒç”¨</strong>ï¼šæ³¨æ„å †æ ˆæ·±åº¦é™åˆ¶</li>
<li><strong>æ–‡æ¡£åŒ–åˆçº¦ä¾èµ–</strong>ï¼šè¯´æ˜ä¸å…¶ä»–åˆçº¦çš„äº¤äº’æ–¹å¼</li>
<li><strong>è°¨æ…ä½¿ç”¨ Delegatecall</strong>ï¼šç¡®ä¿å­˜å‚¨å¸ƒå±€å…¼å®¹</li>
<li><strong>è®¾ç½®åˆé€‚çš„ Gas é™åˆ¶</strong>ï¼šæä¾›è¶³å¤Ÿä½†ä¸è¿‡å¤šçš„ Gas</li>
<li><strong>å®ç°é‡å…¥ä¿æŠ¤</strong>ï¼šåœ¨å¿…è¦æ—¶ä½¿ç”¨ ReentrancyGuard</li>
</ul>
<h3 id="7-æ™ºèƒ½åˆçº¦æ˜¯å¦æ”¯æŒå¤šçº¿ç¨‹ï¼Ÿ"><a href="#7-æ™ºèƒ½åˆçº¦æ˜¯å¦æ”¯æŒå¤šçº¿ç¨‹ï¼Ÿ" class="headerlink" title="7. æ™ºèƒ½åˆçº¦æ˜¯å¦æ”¯æŒå¤šçº¿ç¨‹ï¼Ÿ"></a>7. æ™ºèƒ½åˆçº¦æ˜¯å¦æ”¯æŒå¤šçº¿ç¨‹ï¼Ÿ</h3><p><strong>ç­”æ¡ˆï¼šæ™ºèƒ½åˆçº¦ä¸æ”¯æŒå¤šçº¿ç¨‹ã€‚</strong></p>
<h4 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h4><ol>
<li><p><strong>ç¡®å®šæ€§è¦æ±‚</strong></p>
<ul>
<li>åŒºå—é“¾éœ€è¦ç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹éƒ½èƒ½æŒ‰ç…§ç›¸åŒçš„æ–¹å¼æ‰§è¡Œåˆçº¦</li>
<li>å¤šçº¿ç¨‹ä¼šå¼•å…¥ä¸ç¡®å®šæ€§ï¼ˆçº¿ç¨‹è°ƒåº¦ã€ç«æ€æ¡ä»¶ç­‰ï¼‰</li>
<li>æ— æ³•ä¿è¯æ‰€æœ‰èŠ‚ç‚¹çš„æ‰§è¡Œç»“æœä¸€è‡´</li>
</ul>
</li>
<li><p><strong>å•çº¿ç¨‹æ‰§è¡Œæ¨¡å‹</strong></p>
<ul>
<li>æ™ºèƒ½åˆçº¦åœ¨ EVM ä¸Šä»¥å•çº¿ç¨‹æ–¹å¼é¡ºåºæ‰§è¡Œ</li>
<li>æ¯ä¸ªäº¤æ˜“çš„æ‰§è¡Œæ˜¯åŸå­çš„ï¼Œä¸ä¼šè¢«ä¸­æ–­</li>
<li>ä¸€ä¸ªäº¤æ˜“å®Œå…¨æ‰§è¡Œå®Œæ¯•åï¼Œæ‰ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªäº¤æ˜“</li>
</ul>
</li>
<li><p><strong>çŠ¶æ€ä¸€è‡´æ€§</strong></p>
<ul>
<li>å¤šçº¿ç¨‹ä¼šå¯¼è‡´å…±äº«çŠ¶æ€çš„ç«äº‰é—®é¢˜</li>
<li>åŒºå—é“¾æ— æ³•é€šè¿‡é”æˆ–ä¿¡å·é‡ç­‰æœºåˆ¶æ¥åŒæ­¥</li>
<li>å•çº¿ç¨‹æ‰§è¡Œä¿è¯äº†çŠ¶æ€çš„ä¸€è‡´æ€§</li>
</ul>
</li>
</ol>
<h4 id="ä»£ç ç¤ºä¾‹å¯¹æ¯”"><a href="#ä»£ç ç¤ºä¾‹å¯¹æ¯”" class="headerlink" title="ä»£ç ç¤ºä¾‹å¯¹æ¯”"></a>ä»£ç ç¤ºä¾‹å¯¹æ¯”</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// å•çº¿ç¨‹æ‰§è¡Œç¤ºä¾‹</span><br><span class="line">contract Counter &#123;</span><br><span class="line">    uint256 public count = 0;</span><br><span class="line">    </span><br><span class="line">    // è¿™ä¸ªå‡½æ•°æ€»æ˜¯åŸå­åœ°æ‰§è¡Œï¼Œä¸ä¼šè¢«ä¸­æ–­</span><br><span class="line">    function increment() public &#123;</span><br><span class="line">        uint256 temp = count;      // æ­¥éª¤ 1</span><br><span class="line">        temp = temp + 1;           // æ­¥éª¤ 2</span><br><span class="line">        count = temp;              // æ­¥éª¤ 3</span><br><span class="line">        // æ‰§è¡Œè¿‡ç¨‹ä¸ä¼šè¢«å…¶ä»–äº¤æ˜“æ‰“æ–­</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å¦‚æœæ”¯æŒå¤šçº¿ç¨‹ï¼ˆç†è®ºï¼‰- ä¼šå¯¼è‡´é—®é¢˜</span><br><span class="line">// å‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ increment()</span><br><span class="line">// çº¿ç¨‹ 1: è¯»å– count = 0 â†’ åŠ  1 â†’ å†™å…¥ count = 1</span><br><span class="line">// çº¿ç¨‹ 2: è¯»å– count = 0 â†’ åŠ  1 â†’ å†™å…¥ count = 1</span><br><span class="line">// ç»“æœï¼šcount = 1ï¼ˆè€Œä¸æ˜¯ 2ï¼‰- è¿™æ˜¯ç«æ€æ¡ä»¶</span><br></pre></td></tr></table></figure>

<h4 id="å¹¶å‘æ€§çš„è§£å†³æ–¹æ¡ˆ"><a href="#å¹¶å‘æ€§çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å¹¶å‘æ€§çš„è§£å†³æ–¹æ¡ˆ"></a>å¹¶å‘æ€§çš„è§£å†³æ–¹æ¡ˆ</h4><p>è™½ç„¶æ™ºèƒ½åˆçº¦æœ¬èº«ä¸æ”¯æŒå¤šçº¿ç¨‹ï¼Œä½†å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°å¹¶å‘ï¼š</p>
<ol>
<li><p><strong>å¤šä¸ªäº¤æ˜“å¹¶å‘æäº¤</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ç”¨æˆ· A æäº¤äº¤æ˜“ 1</span><br><span class="line">await contract.increment();</span><br><span class="line"></span><br><span class="line">// ç”¨æˆ· B æäº¤äº¤æ˜“ 2ï¼ˆä¸äº¤æ˜“ 1 å¹¶å‘æäº¤ï¼‰</span><br><span class="line">await contract.increment();</span><br><span class="line"></span><br><span class="line">// çŸ¿å·¥ä¼šä¾æ¬¡æ‰§è¡Œè¿™ä¸¤ä¸ªäº¤æ˜“ï¼Œæœ€ç»ˆ count = 2</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>çŠ¶æ€é€šé“ï¼ˆState Channelsï¼‰</strong></p>
<ul>
<li>å‚ä¸è€…åœ¨é“¾å¤–æ‰§è¡Œå¤šä¸ªäº¤æ˜“</li>
<li>æœ€åä¸€æ¬¡æ€§æäº¤åˆ°åŒºå—é“¾</li>
<li>å®ç°é«˜å¹¶å‘å’Œä½è´¹ç”¨</li>
</ul>
</li>
<li><p><strong>ä¾§é“¾&#x2F;Rollup</strong></p>
<ul>
<li>ä½¿ç”¨ Layer 2 è§£å†³æ–¹æ¡ˆå¤„ç†å¤§é‡äº¤æ˜“</li>
<li>å®šæœŸå°†çŠ¶æ€åŒæ­¥å›ä¸»é“¾</li>
</ul>
</li>
</ol>
<h4 id="å¤šçº¿ç¨‹æ‰§è¡Œçš„é™åˆ¶ä¸è§£å†³æ–¹æ¡ˆæ€»ç»“"><a href="#å¤šçº¿ç¨‹æ‰§è¡Œçš„é™åˆ¶ä¸è§£å†³æ–¹æ¡ˆæ€»ç»“" class="headerlink" title="å¤šçº¿ç¨‹æ‰§è¡Œçš„é™åˆ¶ä¸è§£å†³æ–¹æ¡ˆæ€»ç»“"></a>å¤šçº¿ç¨‹æ‰§è¡Œçš„é™åˆ¶ä¸è§£å†³æ–¹æ¡ˆæ€»ç»“</h4><ul>
<li><strong>æ™ºèƒ½åˆçº¦é‡‡ç”¨å•çº¿ç¨‹æ‰§è¡Œæ¨¡å‹</strong></li>
<li><strong>ä¿è¯äº†åŒºå—é“¾çš„ä¸€è‡´æ€§å’Œç¡®å®šæ€§</strong></li>
<li><strong>äº¤æ˜“æŒ‰é¡ºåºæ‰§è¡Œï¼Œæ¯ä¸ªäº¤æ˜“æ˜¯åŸå­çš„</strong></li>
<li><strong>å¹¶å‘é€šè¿‡å¤šä¸ªäº¤æ˜“çš„é¡ºåºæ‰§è¡Œæ¥å®ç°</strong></li>
</ul>
<h2 id="é”™è¯¯å¤„ç†æœºåˆ¶"><a href="#é”™è¯¯å¤„ç†æœºåˆ¶" class="headerlink" title="é”™è¯¯å¤„ç†æœºåˆ¶"></a>é”™è¯¯å¤„ç†æœºåˆ¶</h2><p>æ™ºèƒ½åˆçº¦ä¸­çš„é”™è¯¯å¤„ç†æœºåˆ¶ç¡®ä¿äº†çŠ¶æ€çš„ä¸€è‡´æ€§å’Œå®‰å…¨æ€§ã€‚</p>
<h3 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h3><ol>
<li><strong>åŸå­æ€§ä¿è¯</strong>ï¼šä¸€æ—¦é‡åˆ°å¼‚å¸¸ï¼Œé™¤ç‰¹æ®Šæƒ…å†µå¤–ï¼Œæœ¬æ¬¡æ‰§è¡Œæ“ä½œå…¨éƒ¨å›æ»š</li>
<li><strong>çŠ¶æ€æ¢å¤</strong>ï¼šæ‰€æœ‰çŠ¶æ€å˜æ›´éƒ½ä¼šè¢«æ’¤é”€ï¼Œå°±åƒäº¤æ˜“ä»æœªå‘ç”Ÿ</li>
<li><strong>Gas æ¶ˆè€—</strong>ï¼šå·²æ¶ˆè€—çš„ Gas ä¸ä¼šé€€å›ï¼ˆä½œä¸ºæ‰§è¡Œæˆæœ¬çš„ä¸€éƒ¨åˆ†ï¼‰</li>
</ol>
<h3 id="æŠ›å‡ºé”™è¯¯çš„è¯­å¥"><a href="#æŠ›å‡ºé”™è¯¯çš„è¯­å¥" class="headerlink" title="æŠ›å‡ºé”™è¯¯çš„è¯­å¥"></a>æŠ›å‡ºé”™è¯¯çš„è¯­å¥</h3><h4 id="1-require-æ¡ä»¶æ£€æŸ¥"><a href="#1-require-æ¡ä»¶æ£€æŸ¥" class="headerlink" title="1. require() - æ¡ä»¶æ£€æŸ¥"></a>1. <code>require()</code> - æ¡ä»¶æ£€æŸ¥</h4><p>ç”¨äºæ£€æŸ¥è¾“å…¥æˆ–å¤–éƒ¨ç»„ä»¶å¼•èµ·çš„é”™è¯¯ï¼Œ<strong>ä¼šé€€å›å‰©ä½™ Gas</strong>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract SafeTransfer &#123;</span><br><span class="line">    mapping(address =&gt; uint256) public balances;</span><br><span class="line">    </span><br><span class="line">    function withdraw(uint256 amount) public &#123;</span><br><span class="line">        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰è¶³å¤Ÿçš„ä½™é¢</span><br><span class="line">        require(balances[msg.sender] &gt;= amount, &quot;Insufficient balance&quot;);</span><br><span class="line">        </span><br><span class="line">        // æ£€æŸ¥è½¬è´¦æ˜¯å¦æˆåŠŸ</span><br><span class="line">        require(msg.sender.send(amount), &quot;Transfer failed&quot;);</span><br><span class="line">        </span><br><span class="line">        balances[msg.sender] -= amount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Gas æˆæœ¬</strong>ï¼šçº¦ 3 Gasï¼ˆå¦‚æœæ¡ä»¶æ»¡è¶³ï¼‰æˆ– 3 + å†…å­˜æˆæœ¬ï¼ˆå¦‚æœå¤±è´¥ï¼‰</p>
<h4 id="2-assert-å†…éƒ¨æ£€æŸ¥"><a href="#2-assert-å†…éƒ¨æ£€æŸ¥" class="headerlink" title="2. assert() - å†…éƒ¨æ£€æŸ¥"></a>2. <code>assert()</code> - å†…éƒ¨æ£€æŸ¥</h4><p>ç”¨äºæ£€æŸ¥å†…éƒ¨é”™è¯¯å’Œä¸å˜é‡ï¼Œ<strong>ä¸ä¼šé€€å›å‰©ä½™ Gas</strong>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract MathSafe &#123;</span><br><span class="line">    function add(uint256 a, uint256 b) public pure returns (uint256) &#123;</span><br><span class="line">        uint256 c = a + b;</span><br><span class="line">        </span><br><span class="line">        // æ£€æŸ¥æ˜¯å¦å‘ç”Ÿæº¢å‡ºï¼ˆå†…éƒ¨é€»è¾‘é”™è¯¯ï¼‰</span><br><span class="line">        assert(c &gt;= a);  // è¿™ä¸ªæ¡ä»¶å¿…é¡»æ€»æ˜¯çœŸçš„</span><br><span class="line">        </span><br><span class="line">        return c;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function updateState(uint256 newValue) public &#123;</span><br><span class="line">        uint256 oldValue = state;</span><br><span class="line">        state = newValue;</span><br><span class="line">        </span><br><span class="line">        // éªŒè¯å†…éƒ¨ä¸å˜é‡</span><br><span class="line">        assert(state != oldValue || newValue == oldValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Gas æˆæœ¬</strong>ï¼šçº¦ 3 Gasï¼ˆå¦‚æœæ¡ä»¶æ»¡è¶³ï¼‰æˆ– Gas å…¨éƒ¨æ¶ˆè€—ï¼ˆå¦‚æœå¤±è´¥ï¼‰</p>
<h4 id="3-revert-æ‰‹åŠ¨ç»ˆæ­¢"><a href="#3-revert-æ‰‹åŠ¨ç»ˆæ­¢" class="headerlink" title="3. revert() - æ‰‹åŠ¨ç»ˆæ­¢"></a>3. <code>revert()</code> - æ‰‹åŠ¨ç»ˆæ­¢</h4><p>æ— æ¡ä»¶åœ°ç»ˆæ­¢è¿è¡Œå¹¶å›æ»šçŠ¶æ€å˜åŠ¨ï¼Œ<strong>ä¼šé€€å›å‰©ä½™ Gas</strong>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract RoleBasedAccess &#123;</span><br><span class="line">    address public owner;</span><br><span class="line">    </span><br><span class="line">    modifier onlyOwner() &#123;</span><br><span class="line">        if (msg.sender != owner) &#123;</span><br><span class="line">            revert(&quot;Only owner can call this function&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function criticalAction() public onlyOwner &#123;</span><br><span class="line">        // æ‰‹åŠ¨æ£€æŸ¥å¹¶å›æ»š</span><br><span class="line">        if (msg.value &lt; 1 ether) &#123;</span><br><span class="line">            revert(&quot;Minimum 1 ETH required&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // æ‰§è¡Œæ“ä½œ</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Gas æˆæœ¬</strong>ï¼šçº¦ 0 Gasï¼ˆæ— æ¡ä»¶å›æ»šï¼‰</p>
<h4 id="4-try-catch-å¼‚å¸¸æ•è·ï¼ˆSolidity-0-6-0-ï¼‰"><a href="#4-try-catch-å¼‚å¸¸æ•è·ï¼ˆSolidity-0-6-0-ï¼‰" class="headerlink" title="4. try-catch - å¼‚å¸¸æ•è·ï¼ˆSolidity 0.6.0+ï¼‰"></a>4. <code>try-catch</code> - å¼‚å¸¸æ•è·ï¼ˆSolidity 0.6.0+ï¼‰</h4><p>æ•è·å¤–éƒ¨è°ƒç”¨çš„å¼‚å¸¸ï¼Œå…è®¸åˆçº¦ç»§ç»­æ‰§è¡Œã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract TryCatchExample &#123;</span><br><span class="line">    OtherContract other;</span><br><span class="line">    </span><br><span class="line">    function callOther(uint256 value) public returns (bool) &#123;</span><br><span class="line">        try other.riskyFunction(value) returns (uint256 result) &#123;</span><br><span class="line">            // è°ƒç”¨æˆåŠŸ</span><br><span class="line">            emit Success(result);</span><br><span class="line">            return true;</span><br><span class="line">        &#125; catch Error(string memory reason) &#123;</span><br><span class="line">            // æ•è· require/revert çš„é”™è¯¯ä¿¡æ¯</span><br><span class="line">            emit Error(&quot;Require failed&quot;, reason);</span><br><span class="line">            return false;</span><br><span class="line">        &#125; catch Panic(uint errorCode) &#123;</span><br><span class="line">            // æ•è· assert å¤±è´¥</span><br><span class="line">            emit Error(&quot;Assertion failed&quot;, errorCode);</span><br><span class="line">            return false;</span><br><span class="line">        &#125; catch &#123;</span><br><span class="line">            // æ•è·å…¶ä»–é”™è¯¯ï¼ˆå¦‚ä½çº§è°ƒç”¨å¤±è´¥ï¼‰</span><br><span class="line">            emit Error(&quot;Unknown error&quot;, &quot;&quot;);</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é”™è¯¯å¤„ç†å¯¹æ¯”è¡¨"><a href="#é”™è¯¯å¤„ç†å¯¹æ¯”è¡¨" class="headerlink" title="é”™è¯¯å¤„ç†å¯¹æ¯”è¡¨"></a>é”™è¯¯å¤„ç†å¯¹æ¯”è¡¨</h3><table>
<thead>
<tr>
<th>é”™è¯¯ç±»å‹</th>
<th>è¯´æ˜</th>
<th>Gas é€€å›</th>
<th>å…¸å‹ç”¨é€”</th>
<th>é”™è¯¯ä¿¡æ¯</th>
</tr>
</thead>
<tbody><tr>
<td><strong>require</strong></td>
<td>æ¡ä»¶æ£€æŸ¥</td>
<td>âœ“ æ˜¯</td>
<td>è¾“å…¥éªŒè¯ã€æƒé™æ£€æŸ¥</td>
<td>æ”¯æŒè‡ªå®šä¹‰æ¶ˆæ¯</td>
</tr>
<tr>
<td><strong>assert</strong></td>
<td>å†…éƒ¨éªŒè¯</td>
<td>âœ— å¦</td>
<td>æ£€æŸ¥ä¸å˜é‡ã€å†…éƒ¨é€»è¾‘</td>
<td>æ— æ¶ˆæ¯</td>
</tr>
<tr>
<td><strong>revert</strong></td>
<td>ä¸»åŠ¨å›æ»š</td>
<td>âœ“ æ˜¯</td>
<td>å¤æ‚æ¡ä»¶æ£€æŸ¥ã€è‡ªå®šä¹‰é”™è¯¯</td>
<td>æ”¯æŒè‡ªå®šä¹‰æ¶ˆæ¯</td>
</tr>
<tr>
<td><strong>try-catch</strong></td>
<td>å¼‚å¸¸æ•è·</td>
<td>âœ“ éƒ¨åˆ†</td>
<td>å¤–éƒ¨è°ƒç”¨ä¿æŠ¤</td>
<td>å¯æ•è·è¯¦ç»†é”™è¯¯</td>
</tr>
</tbody></table>
<h3 id="å®ç°æœ€ä½³å®è·µ"><a href="#å®ç°æœ€ä½³å®è·µ" class="headerlink" title="å®ç°æœ€ä½³å®è·µ"></a>å®ç°æœ€ä½³å®è·µ</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract ErrorHandlingBestPractices &#123;</span><br><span class="line">    // 1. ä½¿ç”¨è‡ªå®šä¹‰é”™è¯¯ï¼ˆSolidity 0.8.4+ï¼‰- æœ€çœ Gas</span><br><span class="line">    error InsufficientBalance(uint256 available, uint256 required);</span><br><span class="line">    error Unauthorized(address caller);</span><br><span class="line">    </span><br><span class="line">    uint256 public balance;</span><br><span class="line">    address public owner;</span><br><span class="line">    </span><br><span class="line">    // 2. åœ¨å‡½æ•°å¼€å¤´æ£€æŸ¥æ¡ä»¶ï¼ˆfail-fast åŸåˆ™ï¼‰</span><br><span class="line">    function withdraw(uint256 amount) public &#123;</span><br><span class="line">        require(msg.sender == owner, &quot;Only owner&quot;);</span><br><span class="line">        require(balance &gt;= amount, &quot;Insufficient balance&quot;);</span><br><span class="line">        </span><br><span class="line">        // ä¿®æ”¹çŠ¶æ€</span><br><span class="line">        balance -= amount;</span><br><span class="line">        </span><br><span class="line">        // æœ€åæ‰è¿›è¡Œå¤–éƒ¨è°ƒç”¨</span><br><span class="line">        (bool success, ) = msg.sender.call&#123;value: amount&#125;(&quot;&quot;);</span><br><span class="line">        require(success, &quot;Transfer failed&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 3. ä½¿ç”¨è‡ªå®šä¹‰é”™è¯¯ç±»å‹</span><br><span class="line">    function transfer(address to, uint256 amount) public &#123;</span><br><span class="line">        if (balance &lt; amount) &#123;</span><br><span class="line">            revert InsufficientBalance(balance, amount);</span><br><span class="line">        &#125;</span><br><span class="line">        if (msg.sender != owner) &#123;</span><br><span class="line">            revert Unauthorized(msg.sender);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        balance -= amount;</span><br><span class="line">        // ... transfer logic</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 4. ä¿æŠ¤å¤–éƒ¨è°ƒç”¨</span><br><span class="line">    function safeLowLevelCall(address target) public returns (bool) &#123;</span><br><span class="line">        (bool success, bytes memory data) = target.call(&quot;&quot;);</span><br><span class="line">        </span><br><span class="line">        if (!success) &#123;</span><br><span class="line">            // è§£æé”™è¯¯ä¿¡æ¯</span><br><span class="line">            if (data.length &gt; 0) &#123;</span><br><span class="line">                assembly &#123;</span><br><span class="line">                    revert(add(32, data), mload(data))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="åµŒå¥—è°ƒç”¨ä¸åŸå­æ€§"><a href="#åµŒå¥—è°ƒç”¨ä¸åŸå­æ€§" class="headerlink" title="åµŒå¥—è°ƒç”¨ä¸åŸå­æ€§"></a>åµŒå¥—è°ƒç”¨ä¸åŸå­æ€§</h2><h3 id="ä»€ä¹ˆæ˜¯åµŒå¥—è°ƒç”¨"><a href="#ä»€ä¹ˆæ˜¯åµŒå¥—è°ƒç”¨" class="headerlink" title="ä»€ä¹ˆæ˜¯åµŒå¥—è°ƒç”¨"></a>ä»€ä¹ˆæ˜¯åµŒå¥—è°ƒç”¨</h3><p>åµŒå¥—è°ƒç”¨æ˜¯æŒ‡ä¸€ä¸ªåˆçº¦è°ƒç”¨å¦ä¸€ä¸ªåˆçº¦ä¸­çš„å‡½æ•°ã€‚åœ¨åŒºå—é“¾ä¸­ï¼ŒåµŒå¥—è°ƒç”¨çš„å¤„ç†æ–¹å¼ç›´æ¥å½±å“åˆ°æ•´ä¸ªäº¤æ˜“çš„åŸå­æ€§ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// åˆçº¦ A è°ƒç”¨åˆçº¦ B çš„å‡½æ•°</span><br><span class="line">contract A &#123;</span><br><span class="line">    B contractB;</span><br><span class="line">    </span><br><span class="line">    function callB() public &#123;</span><br><span class="line">        contractB.doSomething();  // è¿™å°±æ˜¯åµŒå¥—è°ƒç”¨</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract B &#123;</span><br><span class="line">    function doSomething() public &#123;</span><br><span class="line">        // æ‰§è¡Œé€»è¾‘</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åŸå­æ€§ä¿è¯"><a href="#åŸå­æ€§ä¿è¯" class="headerlink" title="åŸå­æ€§ä¿è¯"></a>åŸå­æ€§ä¿è¯</h3><p><strong>æ™ºèƒ½åˆçº¦çš„æ‰§è¡Œå…·æœ‰åŸå­æ€§</strong>ï¼šæ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œä¼šå¯¼è‡´æ•´ä¸ªäº¤æ˜“å›æ»šã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract AtomicExample &#123;</span><br><span class="line">    uint256 public value1 = 0;</span><br><span class="line">    uint256 public value2 = 0;</span><br><span class="line">    </span><br><span class="line">    function transferAssets(address other) public &#123;</span><br><span class="line">        value1 -= 100;</span><br><span class="line">        other.transfer(msg.value);  // å¦‚æœè¿™é‡Œå¤±è´¥...</span><br><span class="line">        value2 -= 50;               // ...è¿™é‡Œä¸ä¼šæ‰§è¡Œ</span><br><span class="line">        </span><br><span class="line">        // æ•´ä¸ªäº¤æ˜“ä¼šå›æ»šï¼Œvalue1 å’Œ value2 éƒ½æ¢å¤åˆ°åŸå§‹çŠ¶æ€</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åµŒå¥—è°ƒç”¨çš„è¿é”å›æ»š"><a href="#åµŒå¥—è°ƒç”¨çš„è¿é”å›æ»š" class="headerlink" title="åµŒå¥—è°ƒç”¨çš„è¿é”å›æ»š"></a>åµŒå¥—è°ƒç”¨çš„è¿é”å›æ»š</h3><h4 id="ä¼šè§¦å‘è¿é”å¼å›æ»šçš„è°ƒç”¨æ–¹å¼"><a href="#ä¼šè§¦å‘è¿é”å¼å›æ»šçš„è°ƒç”¨æ–¹å¼" class="headerlink" title="ä¼šè§¦å‘è¿é”å¼å›æ»šçš„è°ƒç”¨æ–¹å¼"></a>ä¼šè§¦å‘è¿é”å¼å›æ»šçš„è°ƒç”¨æ–¹å¼</h4><h5 id="ç›´æ¥è°ƒç”¨ï¼ˆæœ€å¸¸è§ï¼‰"><a href="#ç›´æ¥è°ƒç”¨ï¼ˆæœ€å¸¸è§ï¼‰" class="headerlink" title="ç›´æ¥è°ƒç”¨ï¼ˆæœ€å¸¸è§ï¼‰"></a>ç›´æ¥è°ƒç”¨ï¼ˆæœ€å¸¸è§ï¼‰</h5><p>è¢«è°ƒç”¨åˆçº¦çš„å¼‚å¸¸ä¼šå¯¼è‡´è°ƒç”¨åˆçº¦ä¹Ÿä¸€èµ·å›æ»šã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract CallerA &#123;</span><br><span class="line">    BContractB b;</span><br><span class="line">    uint256 public state = 0;</span><br><span class="line">    </span><br><span class="line">    function callB() public &#123;</span><br><span class="line">        state = 1;</span><br><span class="line">        b.riskyFunction();  // å¦‚æœè¿™ä¸ªå‡½æ•° revertï¼Œæ•´ä¸ªäº¤æ˜“å›æ»š</span><br><span class="line">        state = 2;          // è¿™è¡Œä¸ä¼šæ‰§è¡Œ</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract B &#123;</span><br><span class="line">    function riskyFunction() public &#123;</span><br><span class="line">        require(false, &quot;Error in B&quot;);  // B ä¸­å‡ºé”™</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ç»“æœï¼šstate æ¢å¤ä¸º 0ï¼ˆæœªå‘ç”Ÿä»»ä½•æ”¹å˜ï¼‰</span><br></pre></td></tr></table></figure>

<h5 id="å§”æ‰˜è°ƒç”¨ï¼ˆDelegatecallï¼‰"><a href="#å§”æ‰˜è°ƒç”¨ï¼ˆDelegatecallï¼‰" class="headerlink" title="å§”æ‰˜è°ƒç”¨ï¼ˆDelegatecallï¼‰"></a>å§”æ‰˜è°ƒç”¨ï¼ˆDelegatecallï¼‰</h5><p>è¢«è°ƒç”¨å‡½æ•°åœ¨è°ƒç”¨åˆçº¦çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œï¼Œå¼‚å¸¸åŒæ ·ä¼šå¯¼è‡´å…¨éƒ¨å›æ»šã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract ProxyA &#123;</span><br><span class="line">    address implementation;</span><br><span class="line">    uint256 public count = 0;</span><br><span class="line">    </span><br><span class="line">    function executeLogic() public &#123;</span><br><span class="line">        count = 10;</span><br><span class="line">        (bool success, ) = implementation.delegatecall(</span><br><span class="line">            abi.encodeWithSignature(&quot;increment()&quot;)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        if (!success) &#123;</span><br><span class="line">            // å³ä½¿æ£€æŸ¥äº† successï¼Œcount å·²ç»è¢«æ”¹å˜äº†</span><br><span class="line">            // delegatecall åœ¨åŒä¸€äº¤æ˜“ä¸Šä¸‹æ–‡ä¸­</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ä¸ä¼šè§¦å‘è¿é”å¼å›æ»šçš„è°ƒç”¨æ–¹å¼"><a href="#ä¸ä¼šè§¦å‘è¿é”å¼å›æ»šçš„è°ƒç”¨æ–¹å¼" class="headerlink" title="ä¸ä¼šè§¦å‘è¿é”å¼å›æ»šçš„è°ƒç”¨æ–¹å¼"></a>ä¸ä¼šè§¦å‘è¿é”å¼å›æ»šçš„è°ƒç”¨æ–¹å¼</h4><h5 id="ä½çº§-call-è°ƒç”¨"><a href="#ä½çº§-call-è°ƒç”¨" class="headerlink" title="ä½çº§ call() è°ƒç”¨"></a>ä½çº§ <code>call()</code> è°ƒç”¨</h5><p>è¢«è°ƒç”¨åˆçº¦çš„å¼‚å¸¸ä¸ä¼šè‡ªåŠ¨å¯¼è‡´è°ƒç”¨åˆçº¦å›æ»šï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract CallerA &#123;</span><br><span class="line">    uint256 public state = 0;</span><br><span class="line">    </span><br><span class="line">    function safeCall(address target) public &#123;</span><br><span class="line">        state = 1;</span><br><span class="line">        </span><br><span class="line">        // ä½¿ç”¨ä½çº§ callï¼Œè¿”å›æˆåŠŸ/å¤±è´¥æ ‡å¿—</span><br><span class="line">        (bool success, ) = target.call(</span><br><span class="line">            abi.encodeWithSignature(&quot;riskyFunction()&quot;)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        if (!success) &#123;</span><br><span class="line">            // å¯ä»¥é€‰æ‹©ç»§ç»­æ‰§è¡Œæˆ–å›æ»š</span><br><span class="line">            state = 999;  // è¿™è¡Œä¼šæ‰§è¡Œ</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        state = 2;  // è¿™è¡Œä¹Ÿä¼šæ‰§è¡Œ</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract B &#123;</span><br><span class="line">    function riskyFunction() public &#123;</span><br><span class="line">        require(false, &quot;Error&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ç»“æœï¼šstate æœ€ç»ˆä¸º 999 æˆ– 2ï¼ˆæ²¡æœ‰è¿é”å›æ»šï¼‰</span><br></pre></td></tr></table></figure>

<h5 id="transfer-x2F-send-æ–¹æ³•"><a href="#transfer-x2F-send-æ–¹æ³•" class="headerlink" title="transfer() &#x2F; send() æ–¹æ³•"></a><code>transfer()</code> &#x2F; <code>send()</code> æ–¹æ³•</h5><p>è¿™äº›æ–¹æ³•æœ‰ Gas é™åˆ¶ï¼ˆé€šå¸¸ 2300 Gasï¼‰ï¼Œå¤±è´¥æ—¶ä¸ä¼šå¯¼è‡´è°ƒç”¨åˆçº¦å›æ»šã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract Wallet &#123;</span><br><span class="line">    mapping(address =&gt; uint256) public balances;</span><br><span class="line">    </span><br><span class="line">    function withdraw(uint256 amount) public &#123;</span><br><span class="line">        balances[msg.sender] -= amount;</span><br><span class="line">        </span><br><span class="line">        // ä½¿ç”¨ transferï¼Œå³ä½¿å¤±è´¥ä¹Ÿä¸ä¼šå›æ»šå‰é¢çš„çŠ¶æ€æ”¹å˜</span><br><span class="line">        // ï¼ˆç°åœ¨æ›´æ¨èä½¿ç”¨ callï¼‰</span><br><span class="line">        msg.sender.transfer(amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è½¬è´¦å¼•èµ·çš„åµŒå¥—è°ƒç”¨"><a href="#è½¬è´¦å¼•èµ·çš„åµŒå¥—è°ƒç”¨" class="headerlink" title="è½¬è´¦å¼•èµ·çš„åµŒå¥—è°ƒç”¨"></a>è½¬è´¦å¼•èµ·çš„åµŒå¥—è°ƒç”¨</h3><p><strong>ä¸€ä¸ªåˆçº¦ç›´æ¥å‘å¦ä¸€ä¸ªåˆçº¦è´¦æˆ·è½¬è´¦ï¼Œæ²¡æœ‰æŒ‡æ˜è°ƒç”¨å“ªä¸ªå‡½æ•°ï¼Œä»ç„¶ä¼šå¼•èµ·åµŒå¥—è°ƒç”¨ã€‚</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract Sender &#123;</span><br><span class="line">    function sendETH(address receiver) public payable &#123;</span><br><span class="line">        // å‘é€ ETH åˆ° receiver</span><br><span class="line">        (bool success, ) = receiver.call&#123;value: msg.value&#125;(&quot;&quot;);</span><br><span class="line">        require(success, &quot;Transfer failed&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Receiver &#123;</span><br><span class="line">    // å¦‚æœ receiver æ˜¯åˆçº¦ï¼Œæ¥æ”¶ ETH ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°</span><br><span class="line">    receive() external payable &#123;</span><br><span class="line">        // è¿™æ˜¯ä¸€ä¸ªåµŒå¥—è°ƒç”¨ï¼</span><br><span class="line">        // å¦‚æœè¿™é‡Œ revertï¼Œæ•´ä¸ªè½¬è´¦äº¤æ˜“ä¼šå›æ»š</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // æˆ–è€…è¿™ä¸ªå‡½æ•°ï¼ˆå¦‚æœ receive ä¸å­˜åœ¨ï¼‰</span><br><span class="line">    fallback() external payable &#123;</span><br><span class="line">        // åŒæ ·æ˜¯åµŒå¥—è°ƒç”¨</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åµŒå¥—è°ƒç”¨çš„æœ€ä½³å®è·µ"><a href="#åµŒå¥—è°ƒç”¨çš„æœ€ä½³å®è·µ" class="headerlink" title="åµŒå¥—è°ƒç”¨çš„æœ€ä½³å®è·µ"></a>åµŒå¥—è°ƒç”¨çš„æœ€ä½³å®è·µ</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract SafeNestedCalls &#123;</span><br><span class="line">    // 1. ä½¿ç”¨ Checks-Effects-Interactionsï¼ˆCEIï¼‰æ¨¡å¼</span><br><span class="line">    function withdraw(uint256 amount) public &#123;</span><br><span class="line">        // Checksï¼ˆæ£€æŸ¥ï¼‰</span><br><span class="line">        require(balances[msg.sender] &gt;= amount, &quot;Insufficient balance&quot;);</span><br><span class="line">        </span><br><span class="line">        // Effectsï¼ˆä¿®æ”¹çŠ¶æ€ï¼‰</span><br><span class="line">        balances[msg.sender] -= amount;</span><br><span class="line">        </span><br><span class="line">        // Interactionsï¼ˆå¤–éƒ¨è°ƒç”¨ï¼‰- æ”¾åœ¨æœ€å</span><br><span class="line">        (bool success, ) = msg.sender.call&#123;value: amount&#125;(&quot;&quot;);</span><br><span class="line">        require(success, &quot;Transfer failed&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 2. å¤„ç†ä½çº§è°ƒç”¨çš„å¤±è´¥</span><br><span class="line">    function safeExternalCall(address target) public &#123;</span><br><span class="line">        (bool success, bytes memory result) = target.call(&quot;&quot;);</span><br><span class="line">        </span><br><span class="line">        if (!success) &#123;</span><br><span class="line">            // æ‰‹åŠ¨å¤„ç†é”™è¯¯ï¼Œè€Œä¸æ˜¯ä¾èµ–è‡ªåŠ¨å›æ»š</span><br><span class="line">            if (result.length &gt; 0) &#123;</span><br><span class="line">                assembly &#123;</span><br><span class="line">                    revert(add(32, result), mload(result))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 3. ä½¿ç”¨ try-catch æ•è·å¼‚å¸¸</span><br><span class="line">    function robustCall(address target) public returns (bool) &#123;</span><br><span class="line">        try this.callHelper(target) &#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125; catch &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function callHelper(address target) external &#123;</span><br><span class="line">        // å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„è°ƒç”¨</span><br><span class="line">        (bool success, ) = target.call(&quot;&quot;);</span><br><span class="line">        require(success, &quot;Call failed&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 4. å®ç°é‡å…¥ä¿æŠ¤</span><br><span class="line">    bool private locked;</span><br><span class="line">    </span><br><span class="line">    modifier noReentrancy() &#123;</span><br><span class="line">        require(!locked, &quot;No reentrancy&quot;);</span><br><span class="line">        locked = true;</span><br><span class="line">        _;</span><br><span class="line">        locked = false;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function protectedWithdraw(uint256 amount) public noReentrancy &#123;</span><br><span class="line">        // é˜²æ­¢é‡å…¥æ”»å‡»çš„åµŒå¥—è°ƒç”¨</span><br><span class="line">        require(balances[msg.sender] &gt;= amount);</span><br><span class="line">        balances[msg.sender] -= amount;</span><br><span class="line">        </span><br><span class="line">        (bool success, ) = msg.sender.call&#123;value: amount&#125;(&quot;&quot;);</span><br><span class="line">        require(success, &quot;Transfer failed&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åµŒå¥—è°ƒç”¨çš„è°ƒç”¨æ·±åº¦é™åˆ¶"><a href="#åµŒå¥—è°ƒç”¨çš„è°ƒç”¨æ·±åº¦é™åˆ¶" class="headerlink" title="åµŒå¥—è°ƒç”¨çš„è°ƒç”¨æ·±åº¦é™åˆ¶"></a>åµŒå¥—è°ƒç”¨çš„è°ƒç”¨æ·±åº¦é™åˆ¶</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ä»¥å¤ªåŠè§„å®šæœ€å¤š 1024 å±‚åµŒå¥—è°ƒç”¨</span><br><span class="line">// å¦‚æœè¶…è¿‡è¿™ä¸ªé™åˆ¶ï¼Œä¼šè¿”å› &quot;out of stack&quot; é”™è¯¯</span><br><span class="line"></span><br><span class="line">contract DepthExample &#123;</span><br><span class="line">    address public next;</span><br><span class="line">    </span><br><span class="line">    function callNext() public &#123;</span><br><span class="line">        // å¦‚æœè¿™æ˜¯ç¬¬ 1024 æ¬¡è°ƒç”¨ï¼Œä¸‹ä¸€æ¬¡è°ƒç”¨ä¼šå¤±è´¥</span><br><span class="line">        next.call(abi.encodeWithSignature(&quot;callNext()&quot;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å…³é”®æ€»ç»“"><a href="#å…³é”®æ€»ç»“" class="headerlink" title="å…³é”®æ€»ç»“"></a>å…³é”®æ€»ç»“</h2><p>æ™ºèƒ½åˆçº¦çš„æ‰§è¡Œæ¨¡å‹è®¾è®¡ç¡®ä¿äº†åŒºå—é“¾çš„ä¸€è‡´æ€§å’Œå®‰å…¨æ€§ï¼š</p>
<ul>
<li><strong>å•çº¿ç¨‹æ‰§è¡Œ</strong>ï¼šä¿è¯ç¡®å®šæ€§ï¼Œæ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œç»“æœä¸€è‡´</li>
<li><strong>åŸå­æ€§</strong>ï¼šè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»š</li>
<li><strong>é”™è¯¯å¤„ç†</strong>ï¼šé€šè¿‡ require&#x2F;assert&#x2F;revert æœºåˆ¶ç¡®ä¿çŠ¶æ€æ­£ç¡®</li>
<li><strong>åµŒå¥—è°ƒç”¨</strong>ï¼šéœ€è¦äº†è§£ä¸åŒè°ƒç”¨æ–¹å¼çš„å›æ»šè¡Œä¸º</li>
<li><strong>CEI æ¨¡å¼</strong>ï¼šæŒ‰â€æ£€æŸ¥-ä¿®æ”¹-äº¤äº’â€çš„é¡ºåºç¼–å†™ä»£ç ï¼Œæé«˜å®‰å…¨æ€§</li>
</ul>
]]></content>
      <tags>
        <tag>web3</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨Android sharesheetåœ¨Androidåº”ç”¨ç¨‹åºä¸­åˆ†äº«å†…å®¹å’Œé“¾æ¥</title>
    <url>/2023/03/22/%E4%BD%BF%E7%94%A8Android-sharesheet%E5%9C%A8Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E4%B8%AD%E5%88%86%E4%BA%AB%E5%86%85%E5%AE%B9%E5%92%8C%E9%93%BE%E6%8E%A5/</url>
    <content><![CDATA[<p>ä¸ºä½•è¦ä½¿ç”¨Android sharesheet<br>ä¸»è¦æœ‰ä¸‰ç‚¹åŸå› ï¼š</p>
<ol>
<li>è°·æ­Œå®˜æ–¹æ¨èä½¿ç”¨</li>
<li>Target SDK 30 ä»¥ä¸Šï¼ŒåŒ…åå¯è§æ€§å‘ç”Ÿäº†å˜æ›´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œåº”ç”¨ä¸åº”ç”¨æ˜¯ä¸å¯è§çš„ï¼Œæ¢å¥è¯è¯´ï¼Œå¦‚æœä½¿ç”¨queryIntentActivities()æ–¹æ³•ï¼Œä¸ä¸€å®šèƒ½å¤Ÿè·å–åˆ°æ‰€æœ‰intentå¯¹åº”çš„activityï¼Œè¿™æ ·å°±ç»™åˆ†äº«intenté€ æˆäº†éº»çƒ¦ã€‚</li>
<li>Android sharesheetæä¾›äº†åŒ…æ‹¬ç•Œé¢ã€ç»“æœæ”¶é›†ã€å›ºå®šå‰ç½®å’Œå±è”½æŒ‡å®šappåœ¨å†…çš„å…¨å¥—åŠŸèƒ½ï¼Œå¯ä»¥èŠ‚çœè®¾è®¡å’Œå¼€å‘èµ„æº<span id="more"></span></li>
</ol>
<h2 id="ä½¿ç”¨Android-sharesheetçš„åŸºç¡€æ­¥éª¤"><a href="#ä½¿ç”¨Android-sharesheetçš„åŸºç¡€æ­¥éª¤" class="headerlink" title="ä½¿ç”¨Android sharesheetçš„åŸºç¡€æ­¥éª¤"></a>ä½¿ç”¨Android sharesheetçš„åŸºç¡€æ­¥éª¤</h2><p>Android sharesheetçš„ä½¿ç”¨ååˆ†ç®€å•ï¼Œå¤§è‡´åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼šå‡†å¤‡intentï¼Œä½¿ç”¨intentè°ƒèµ·åˆ†äº«å¼¹çª—ã€‚<br>å°†ä¼šä½¿ç”¨3ä¸ªä¾‹å­æ¥å±•ç°sharesheetçš„ä½¿ç”¨ï¼Œæœ¬åˆ«æ˜¯ï¼šåˆ†äº«ä¸€æ®µæ–‡å­—(å¯ä»¥åŒ…å«æŸä¸ªé“¾æ¥)ï¼Œåˆ†äº«ä¸€ä¸ªè§†é¢‘ï¼Œåˆ†äº«å¤šä¸ªè§†é¢‘</p>
<h3 id="å‡†å¤‡intentï¼š"><a href="#å‡†å¤‡intentï¼š" class="headerlink" title="å‡†å¤‡intentï¼š"></a>å‡†å¤‡intentï¼š</h3><h3 id="åˆ†äº«ä¸€æ®µæ–‡å­—ï¼š"><a href="#åˆ†äº«ä¸€æ®µæ–‡å­—ï¼š" class="headerlink" title="åˆ†äº«ä¸€æ®µæ–‡å­—ï¼š"></a>åˆ†äº«ä¸€æ®µæ–‡å­—ï¼š</h3><p>å¦‚æœåªæ˜¯æƒ³åˆ†äº«ä¸€æ®µæ–‡å­—ï¼Œå¹¶ä¸”æ–‡å­—ä¸­åŒ…å«äº†ä¸€ä¸ªè·³è½¬é“¾æ¥ï¼Œæ˜¯æ¯”è¾ƒç®€å•çš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//linkWtihText å°±æ˜¯æƒ³è¦åˆ†äº«çš„æ–‡å­—ï¼Œå®é™…ä½¿ç”¨æ—¶å¸¸å¸¸åŒ…å«ä¸€æ®µè·³è½¬é“¾æ¥</span><br><span class="line">val sendIntent: Intent = Intent().apply &#123;</span><br><span class="line">    action = Intent.ACTION_SEND</span><br><span class="line">    putExtra(Intent.EXTRA_TEXT, linkWtihText)</span><br><span class="line">    type = &quot;text/plain&quot;</span><br><span class="line">&#125;</span><br><span class="line">//ä½¿ç”¨sendIntentæ¥åˆ¶ä½œåˆ†äº«è·³è½¬ä½¿ç”¨çš„intent</span><br><span class="line">val shareIntent = Intent.createChooser(sendIntent, &quot;null&quot;, &quot;null&quot;)</span><br><span class="line">//æ·»åŠ flag</span><br><span class="line">shareIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK)</span><br></pre></td></tr></table></figure>

<h3 id="åˆ†äº«ä¸€ä¸ªè§†é¢‘ï¼š"><a href="#åˆ†äº«ä¸€ä¸ªè§†é¢‘ï¼š" class="headerlink" title="åˆ†äº«ä¸€ä¸ªè§†é¢‘ï¼š"></a>åˆ†äº«ä¸€ä¸ªè§†é¢‘ï¼š</h3><p>å…¶å®è´¨æ˜¯åˆ†äº«ä¸€ä¸ªè§†é¢‘åª’ä½“æ–‡ä»¶ï¼Œæ‰€ä»¥åˆ†äº«ä¸€ä¸ªéŸ³ä¹ã€ä¸€å¼ å›¾ç‰‡ç­‰ä¹Ÿæ˜¯ç±»ä¼¼çš„æ­¥éª¤ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ¶ä½œä¸€ä¸ªå¾…åˆ†äº«çš„æ–‡ä»¶çš„uriï¼Œæ­¤å¤„ä½¿ç”¨FileProviderï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//æŠŠè·¯å¾„è½¬æ¢æˆå¯ä»¥ç”¨æ¥åˆ†äº«çš„Uriï¼Œpathï¼šå¾…åˆ†äº«çš„æ–‡ä»¶è·¯å¾„</span><br><span class="line">private fun createFileUriWithPath(context: Context, path: String): Uri &#123;</span><br><span class="line">    val shareFile = File(path)</span><br><span class="line">    return FileProvider.getUriForFile(</span><br><span class="line">        context,</span><br><span class="line">        &quot;com.miui.localvideoplayer.shareprovider&quot;,</span><br><span class="line">        shareFile</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼ŒåŸºäºä»¥ä¸Šæ–¹æ³•åˆ¶ä½œçš„uriï¼Œåˆ¶ä½œåˆ†äº«intentï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">val shareUri = createFileUriWithPath(appContext, path)</span><br><span class="line">val sendIntent = Intent()</span><br><span class="line">sendIntent.action = Intent.ACTION_SEND</span><br><span class="line">sendIntent.putExtra(Intent.EXTRA_STREAM, shareUri)</span><br><span class="line">sendIntent.data = shareUri</span><br><span class="line">//æ­¤å¤„éœ€è¦å¯¹urièµ‹äºˆå¯è¯»å–çš„æƒé™</span><br><span class="line">sendIntent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION)</span><br><span class="line">sendIntent.type = &quot;video/*&quot;</span><br><span class="line">//ä½¿ç”¨sendIntentæ¥åˆ¶ä½œåˆ†äº«è·³è½¬ä½¿ç”¨çš„intent</span><br><span class="line">val shareIntent = Intent.createChooser(sendIntent, &quot;null&quot;, &quot;null&quot;)</span><br><span class="line">//æ·»åŠ flag</span><br><span class="line">shareIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK)</span><br></pre></td></tr></table></figure>

<h3 id="åˆ†äº«å¤šä¸ªè§†é¢‘ï¼š"><a href="#åˆ†äº«å¤šä¸ªè§†é¢‘ï¼š" class="headerlink" title="åˆ†äº«å¤šä¸ªè§†é¢‘ï¼š"></a>åˆ†äº«å¤šä¸ªè§†é¢‘ï¼š</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//shareList: ArrayList&lt;String&gt; å¾…åˆ†äº«çš„æ–‡ä»¶è·¯å¾„åˆ—è¡¨</span><br><span class="line"></span><br><span class="line">if (shareList.size == 1) &#123;</span><br><span class="line">    //å¦‚æœåˆ—è¡¨ä¸­åªæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆè¯·å°†å…¶å½“ä½œå•ä¸ªæ–‡ä»¶åˆ†äº«ï¼Œä»¥è·å–æ›´å¤šçš„æ¥å—æ–¹</span><br><span class="line">    shareSingleVideoFile(context, shareList[0])</span><br><span class="line">    return</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">val shareUriList = java.util.ArrayList&lt;Uri&gt;()</span><br><span class="line">for (path in shareList) &#123;</span><br><span class="line">    //ä»ç„¶éœ€è¦ç”¨åˆ°ä¸Šæ–‡æåˆ°çš„åˆ¶ä½œuriçš„æ–¹æ³•ï¼Œå°†uriä»¬ä¿å­˜åœ¨ä¸€ä¸ªlisté‡Œ</span><br><span class="line">    val shareUri = createFileUriWithPath(appContext, path)</span><br><span class="line">    shareUriList.add(shareUri)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">val sendIntent = Intent()</span><br><span class="line">//æ­¤å¤„çš„actionä¸ºACTION_SEND_MULTIPLE</span><br><span class="line">sendIntent.action = Intent.ACTION_SEND_MULTIPLE</span><br><span class="line">sendIntent.putParcelableArrayListExtra(Intent.EXTRA_STREAM, shareUriList)</span><br><span class="line">sendIntent.type = &quot;video/*&quot;</span><br><span class="line">sendIntent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION)</span><br><span class="line">val shareIntent = Intent.createChooser(sendIntent, &quot;null&quot;, &quot;null&quot;)</span><br><span class="line">shareIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK)</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨intentè°ƒèµ·åˆ†äº«å¼¹çª—ï¼š"><a href="#ä½¿ç”¨intentè°ƒèµ·åˆ†äº«å¼¹çª—ï¼š" class="headerlink" title="ä½¿ç”¨intentè°ƒèµ·åˆ†äº«å¼¹çª—ï¼š"></a>ä½¿ç”¨intentè°ƒèµ·åˆ†äº«å¼¹çª—ï¼š</h3><p>ä½¿ç”¨context.startActivityæ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mContext.startActivity(shareIntent)</span><br></pre></td></tr></table></figure>

<h2 id="å°†æŸäº›æ¥æ”¶ç«¯å›ºå®šå‰ç½®-x2F-å°†æŸäº›æ¥æ”¶ç«¯å±è”½"><a href="#å°†æŸäº›æ¥æ”¶ç«¯å›ºå®šå‰ç½®-x2F-å°†æŸäº›æ¥æ”¶ç«¯å±è”½" class="headerlink" title="å°†æŸäº›æ¥æ”¶ç«¯å›ºå®šå‰ç½®&#x2F;å°†æŸäº›æ¥æ”¶ç«¯å±è”½"></a>å°†æŸäº›æ¥æ”¶ç«¯å›ºå®šå‰ç½®&#x2F;å°†æŸäº›æ¥æ”¶ç«¯å±è”½</h2><p>åœ¨å®é™…çš„ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸æƒ³è¦å°†æŸäº›åº”ç”¨å‰ç½®åœ¨æˆ‘ä»¬çš„åˆ†äº«å¼¹çª—ä¸­ï¼Œä¾‹å¦‚ï¼Œæˆ‘å¸Œæœ›ç”¨æˆ·æŠŠæˆ‘ä»¬çš„é“¾æ¥åˆ†äº«åˆ°facebook,whatsapp,messenger,telegramä¸­ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œè£‚å˜è½¬æ’­ï¼Œsharesheetä¹Ÿå¯ä»¥åšåˆ°ã€‚<br>å®ç°æ–¹æ³•ä¹Ÿååˆ†ç®€å•ï¼Œåªè¦ç»™shareInentå¢åŠ ä¸€ä¸ªkeyä¸ºIntent.EXTRA_INITIAL_INTENTSçš„extraï¼Œå¹¶ä¸”å¾€é‡Œä¼ å…¥ä¸€ä¸ªsendIntentçš„typedArrayï¼Œå°±å¯ä»¥äº†<br>é¦–å…ˆï¼Œåˆ¶ä½œéœ€è¦å‰ç½®åˆ†äº«çš„appçš„intent list</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">fun getExtraInitialIntent(text: String): ArrayList&lt;Intent&gt; &#123;</span><br><span class="line">    val intentShareList = ArrayList&lt;Intent&gt;()</span><br><span class="line">    //éœ€è¦å‰ç½®çš„receiver appçš„åŒ…å</span><br><span class="line">    var shareItems = </span><br><span class="line">        arrayOf(</span><br><span class="line">            &quot;com.facebook.katana&quot;,</span><br><span class="line">            &quot;com.whatsapp&quot;,</span><br><span class="line">            &quot;com.facebook.orca&quot;,</span><br><span class="line">            &quot;org.telegram.messenger&quot;</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">    for (packageName in shareItems) &#123;</span><br><span class="line">        val intent = Intent()</span><br><span class="line">        intent.action = Intent.ACTION_SEND</span><br><span class="line">        intent.type = &quot;text/plain&quot;</span><br><span class="line">        intent.setPackage(packageName)</span><br><span class="line">        intent.putExtra(Intent.EXTRA_TEXT, text)</span><br><span class="line">        intentShareList.add(intent)</span><br><span class="line">    &#125;</span><br><span class="line">    return intentShareList</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œå°†å…¶è½¬æ¢ä¸ºTypedArrayå¹¶ä¸”æºå¸¦ç»™shareIntent</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">shareIntent.putExtra(</span><br><span class="line">    Intent.EXTRA_INITIAL_INTENTS,</span><br><span class="line">    getExtraInitialIntent(arrayListOf(path)).toTypedArray()</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨sharesheetä¸­æ’é™¤æŸä¸ªreceiverï¼Œæ¯”å¦‚ï¼Œå¦‚æœé€‰æ‹©å°ç±³æ–‡æ¡£æŸ¥çœ‹å™¨ä½œä¸ºreceiverï¼Œé‚£ä¹ˆå®ƒå°†æŠŠåˆ†äº«çš„æ–‡å­—å†…å®¹å½“ä½œä¸€æ®µåœ°å€æ¥å°è¯•è¯»å–æŸä¸ªæ–‡ä»¶ï¼Œæ˜¾ç„¶ï¼Œè¿™ä¸ç¬¦åˆæˆ‘ä»¬çš„ä¸šåŠ¡éœ€æ±‚ï¼Œå¹¶ä¸”ä¼šé€ æˆbugã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">private fun getExtraExcludeComponents(intent: Intent): ArrayList&lt;ComponentName&gt; &#123;</span><br><span class="line">    val excludeList = ArrayList&lt;ComponentName&gt;()</span><br><span class="line">    val extraExcludedItems = arrayOf(&quot;cn.wps.xiaomi.abroad.lite&quot;)</span><br><span class="line">    val pm = FrameworkApplication.getAppContext().packageManager</span><br><span class="line">    val targets = pm.queryIntentActivities(intent, 0)</span><br><span class="line">    for (resolveInfo in targets) &#123;</span><br><span class="line">        val targetPackage = resolveInfo.activityInfo.packageName</span><br><span class="line">        val appName = resolveInfo.activityInfo.name</span><br><span class="line">        for (packageName in extraExcludedItems) &#123;</span><br><span class="line">            if (packageName.equals(targetPackage, true)) &#123;</span><br><span class="line">                excludeList.add(ComponentName(targetPackage, appName))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return excludeList</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨åˆ¶ä½œshareIntentæ—¶ï¼ŒåŠ å…¥extraï¼Œä½¿ç”¨EXTRA_EXCLUDE_COMPONENTSå…³é”®å­—ï¼Œå°†å…¶æ’é™¤ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">shareIntent.putExtra(</span><br><span class="line">                    Intent.EXTRA_EXCLUDE_COMPONENTS,</span><br><span class="line">                    getExtraExcludeComponents(sendIntent).toTypedArray()</span><br><span class="line">                )</span><br></pre></td></tr></table></figure>

<h2 id="æ”¶é›†åˆ†äº«çš„ç»“æœ"><a href="#æ”¶é›†åˆ†äº«çš„ç»“æœ" class="headerlink" title="æ”¶é›†åˆ†äº«çš„ç»“æœ"></a>æ”¶é›†åˆ†äº«çš„ç»“æœ</h2><p>ç”¨æˆ·åœ¨ç‚¹å‡»åˆ†äº«åï¼Œéœ€è¦åœ¨åˆ†äº«å¼¹çª—ä¸­é€‰æ‹©ä¸€ä¸ªæ¸ é“è¿›è¡Œåˆ†äº«ï¼Œä¾‹å¦‚ï¼Œé€‰æ‹©Facebookè¿›è¡Œåˆ†äº«ï¼Œè€Œæˆ‘ä»¬å¦‚æœæƒ³è¦æ”¶é›†ç”¨æˆ·æœ€åç‚¹å‡»çš„é€‰é¡¹ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨Intent.createChooser(sendIntent, â€œnullâ€, â€œnullâ€)æ–¹æ³•ä¸­ä¼ å…¥ä¸€ä¸ªå¹¿æ’­æ¥æ”¶å™¨ï¼Œä»è€Œå¯ä»¥æ¥å—ç”¨æˆ·ç‚¹å‡»åå‘å‡ºçš„å¹¿æ’­ã€‚<br>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¹¿æ’­æ¥æ”¶å™¨ç±»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">class LocalShareBroadCastReceiver : BroadcastReceiver() &#123;</span><br><span class="line">    override fun onReceive(context: Context?, intent: Intent?) &#123;</span><br><span class="line">        val clickedComponentName = intent?.getParcelableExtra&lt;ComponentName&gt;(Intent.EXTRA_CHOSEN_COMPONENT)</span><br><span class="line">        val packageName = clickedComponentName?.packageName</span><br><span class="line">        //packageNameå°±æ˜¯ç”¨æˆ·æœ€ç»ˆç‚¹é€‰çš„åŒ…åï¼Œæ­¤å¤„å¯ä»¥è¿›è¡Œæ‰“ç‚¹ç­‰ç»Ÿè®¡æ“ä½œ</span><br><span class="line">        context?.unregisterReceiver(this)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶æ¬¡ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ¥æ”¶å™¨å®ä¾‹ï¼Œå¹¶ä¸”åŠ¨æ€æ³¨å†Œï¼Œä¹‹åå†è¿”å›ä¸€ä¸ªintentSenderç”¨äºæ„é€ shareIntent</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//å»ºè®®å°†localShareBroadCastReceiver ä¿å­˜æˆä¸ºstatic finalå¸¸é‡ï¼Œåœ¨æ¯æ¬¡åˆ†äº«æ“ä½œæ—¶ï¼Œæ£€æŸ¥æ˜¯å¦è¢«æ³¨å†Œã€‚å¤šæ¬¡æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨ä¼šä½¿å¾—ç”¨æˆ·åœ¨ç¬¬äºŒæ¬¡åˆ†äº«çš„æ—¶å€™æ‰§è¡Œä¸¤æ¬¡onReceiveä¸­çš„æ“ä½œ</span><br><span class="line">val localShareBroadCastReceiver = LocalShareBroadCastReceiver()</span><br><span class="line"></span><br><span class="line">val sender = registerShareReceiver(</span><br><span class="line">    appContext, &quot;com.videoplayer.SHARE_ACTION_LOCAL&quot;,</span><br><span class="line">    localShareBroadCastReceiver</span><br><span class="line">)</span><br><span class="line">val shareIntent = Intent.createChooser(sendIntent, &quot;null&quot;, sender)</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼ŒregisterShareReceiveræ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">fun registerShareReceiver(</span><br><span class="line">    context: Context,</span><br><span class="line">    action: String,</span><br><span class="line">    receiver: BroadcastReceiver</span><br><span class="line">): IntentSender &#123;</span><br><span class="line">    val receiverIntent = Intent(action)</span><br><span class="line">    receiverIntent.putExtra(&quot;test&quot;, &quot;test&quot;)</span><br><span class="line">    val pi = PendingIntent.getBroadcast(</span><br><span class="line">        FrameworkApplication.getAppContext(),</span><br><span class="line">        10000,</span><br><span class="line">        receiverIntent,</span><br><span class="line">        //Android 12 ä»¥ä¸Šï¼Œä¸€å®šè¦åŠ PendingIntent.FLAG_MUTABLEï¼Œä¸ç„¶å°†ä¸ä¼šæ”¶åˆ°å›è°ƒ</span><br><span class="line">        PendingIntent.FLAG_UPDATE_CURRENT or PendingIntent.FLAG_MUTABLE</span><br><span class="line">    )</span><br><span class="line">    context.registerReceiver(</span><br><span class="line">        receiver,</span><br><span class="line">        IntentFilter(action)</span><br><span class="line">    )</span><br><span class="line">    return pi.intentSender;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚å‰æ–‡æ³¨é‡Šä¸­æåˆ°çš„ï¼Œå¤šæ¬¡æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨ä¼šä½¿å¾—ç”¨æˆ·åœ¨ç¬¬äºŒæ¬¡åˆ†äº«çš„æ—¶å€™æ‰§è¡Œä¸¤æ¬¡onReceiveä¸­çš„æ“ä½œï¼Œå› æ­¤å»ºè®®å°†localShareBroadCastReceiver ä¿å­˜æˆä¸ºstatic finalå¸¸é‡ï¼Œåœ¨æ¯æ¬¡åˆ†äº«æ“ä½œæ—¶ï¼Œå°è¯•åæ³¨å†Œï¼Œä¿è¯æ¯æ¬¡åˆ†äº«æ“ä½œä»…æœ‰1ä¸ªreceiverè¿›è¡Œç›‘å¬ã€‚<br>Androidå¼€å‘è€…ï¼šåº”ç”¨æ•°æ®å’Œæ–‡ä»¶<br><a href="https://developer.android.google.cn/training/sharing">https://developer.android.google.cn/training/sharing</a> </p>
]]></content>
      <categories>
        <category>android</category>
      </categories>
      <tags>
        <tag>android</tag>
      </tags>
  </entry>
  <entry>
    <title>å‡½æ•°å“åº”å¼ç¼–ç¨‹â€”â€”RxJava</title>
    <url>/2023/04/30/%E5%87%BD%E6%95%B0%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B%E2%80%94%E2%80%94RxJava/</url>
    <content><![CDATA[<p>å‡½æ•°å“åº”å¼ç¼–ç¨‹æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ã€‚æˆ‘ä»¬å¸¸è§çš„ç¼–ç¨‹èŒƒå¼ç”±å‘½ä»¤å¼ç¼–ç¨‹ã€å‡½æ•°å¼ç¼–ç¨‹å’Œé€»è¾‘å¼ç¼–ç¨‹ã€‚æˆ‘ä»¬å¸¸è§çš„é¢å‘å¯¹è±¡ç¼–ç¨‹æ˜¯ä¸€ç§å‘½ä»¤å¼ç¼–ç¨‹ã€‚å‘½ä»¤å¼ç¼–ç¨‹æ˜¯é¢å‘è®¡ç®—æœºç¡¬ä»¶çš„æŠ½è±¡ï¼Œ<br>æœ‰å˜é‡ã€èµ‹å€¼è¯­å¥ã€è¡¨è¾¾å¼å’Œæ§åˆ¶è¯­å¥ã€‚è€Œå‡½æ•°å¼ç¼–ç¨‹æ˜¯é¢å‘æ•°å­¦çš„æŠ½è±¡ï¼Œå°†è®¡ç®—æè¿°ä¸ºä¸€ç§è¡¨è¾¾å¼æ±‚èŒï¼Œå‡½æ•°å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹å®šä¹‰ï¼Œå¹¶ä¸”å¯ä»¥å¯¹å‡½æ•°è¿›è¡Œç»„åˆã€‚<br>å“åº”å¼ç¼–ç¨‹æ˜¯ä¸€ç§é¢å‘æ•°æ®æµå’Œå˜åŒ–ä¼ æ’­çš„ç¼–ç¨‹èŒƒå¼ï¼Œæ•°æ®æ›´æ–°æ˜¯ç›¸å…³è”çš„ã€‚æŠŠå‡½æ•°å¼ç¼–ç¨‹é‡Œçš„ä¸€å¥—æ€è·¯å’Œå“åº”å¼ç¼–ç¨‹åˆèµ·æ¥å°±æ˜¯å‡½æ•°å“åº”å¼ç¼–ç¨‹ã€‚<br>åœ¨Androidå¼€å‘ä¸­ä½¿ç”¨å‡½æ•°å“åº”å¼ç¼–ç¨‹çš„ä¸»è¦æœ‰ä¸¤å¤§æ¡†æ¶ï¼šä¸€ä¸ªæ˜¯RxJavaï¼Œå¦ä¸€ä¸ªæ˜¯Googleæ¨å‡ºçš„Ageraã€‚</p>
<span id="more"></span>
<p>RxJavaæ˜¯ReactiveXçš„ä¸€ç§Javaå®ç°ï¼ŒReactiveXæ˜¯Reactive Extensionsçš„ç¼©å†™ï¼Œä¸€èˆ¬ç®€å†™ä¸ºRxã€‚<br>å¾®è½¯çš„å®šä¹‰æ˜¯ï¼šRxæ˜¯ä¸€ä¸ªå‡½æ•°åº“ï¼Œè®©å¼€å‘è€…å¯ä»¥åˆ©ç”¨å¯è§‚å¯Ÿåºåˆ—å’ŒLINQé£æ ¼æŸ¥è¯¢æ“ä½œç¬¦æ¥ç¼–å†™å¼‚æ­¥å’ŒåŸºäºäº‹ä»¶çš„ç¨‹åºã€‚å¼€å‘è€…å¯ä»¥ç”¨Observablesè¡¨ç¤ºå¼‚æ­¥æ•°æ®æµï¼Œç”¨<br>LINQæ“ä½œç¬¦æŸ¥è¯¢ä¸€éƒ¨æ•°æ®æµï¼Œç”¨Schedulerså‚æ•°åŒ–ä¸€éƒ¨æ•°æ®æµçš„å¹¶å‘å¤„ç†ï¼ŒRxå¯ä»¥è¿™æ ·å®šä¹‰ï¼šRx &#x3D; Observables+LINQ+Schedulersã€‚</p>
<p>1.ä¸ºä½•è¦ç”¨RxJava<br>è¯´åˆ°å¼‚æ­¥æ“ä½œï¼Œæˆ‘ä»¬ä¼šæƒ³åˆ°Androidçš„AsyncTaskå’ŒHandlerã€‚ä½†æ˜¯éšç€è¯·æ±‚çš„æ•°é‡è¶Šæ¥è¶Šå¤šï¼Œä»£ç é€»è¾‘å°†ä¼šå˜å¾—è¶Šæ¥è¶Šå¤æ‚è€ŒRxJavaå´ä»æ—§èƒ½ä¿æŒæ¸…æ™°çš„é€»è¾‘ã€‚<br>RxJavaçš„åŸç†å°±æ˜¯åˆ›å»ºä¸€ä¸ªObservableå¯¹è±¡æ¥å¹²æ´»ï¼Œç„¶åä½¿ç”¨å„ç§æ“ä½œç¬¦å»ºç«‹èµ·æ¥çš„é“¾å¼æ“ä½œï¼Œå°±å¦‚åŒæµæ°´çº¿ä¸€æ ·ï¼ŒæŠŠä½ æƒ³è¦å¤„ç†çš„æ•°æ®ä¸€æ­¥ä¸€æ­¥åœ°åŠ å·¥æˆä½ <br>æƒ³è¦çš„æˆå“ï¼Œç„¶åå‘å°„ç»™Subscriberå¤„ç†</p>
<p>2.RxJavaä¸è§‚å¯Ÿè€…æ¨¡å¼<br>RxJavaçš„å¼‚æ­¥æ“ä½œæ˜¯é€šè¿‡æ‰©å±•çš„è§‚å¯Ÿè€…æ¨¡å¼æ¥å®ç°çš„ã€‚RxJavaæœ‰4ä¸ªè§’è‰²Observableã€Observerã€Subscriberå’ŒSujectï¼Œè¿™4ä¸ªè§’è‰²åé¢ä¼šå…·ä½“è®²è§£ã€‚<br>Observableå’ŒObserver é€šè¿‡subscribeæ–¹æ³•å®ç°è®¢é˜…å…³ç³»ï¼ŒObservableå°±å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™é€šçŸ¥Observer</p>
<p>3.RxJavaçš„åŸºæœ¬å®ç°<br>1ï¼‰åˆ›å»ºObserver(è§‚å¯Ÿè€…)<br>å®ƒå†³å®šäº‹ä»¶è§¦å‘çš„æ—¶å€™å°†æœ‰æ€æ ·çš„è¡Œä¸ºï¼Œå…¶ä¸­onCompletedã€onErrorå’ŒonNextæ˜¯å¿…é¡»è¦å®ç°çš„æ–¹æ³•ã€‚<br>2ï¼‰åˆ›å»ºObservable(è¢«è§‚å¯Ÿè€…)<br>å®ƒå†³å®šä»€ä¹ˆæ—¶å€™è§¦å‘äº‹ä»¶ä»¥åŠè§¦å‘æ€æ ·çš„äº‹ä»¶ã€‚RxJavaä½¿ç”¨createæ–¹æ³•ï¼Œjustæ–¹æ³•ï¼Œæˆ–è€…fromæ–¹æ¥åˆ›å»ºä¸€ä¸ªObservable<br>2ï¼‰Subscribe(è®¢é˜…)<br>è®¢é˜…åªéœ€è¦ä¸€è¡Œä»£ç å°±å¯ä»¥äº†<br>observable.subscribe(subscriber)</p>
<p>3.Subject<br>subjectæ—¢å¯ä»¥æ˜¯ä¸€ä¸ªObserverï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªObserverable,å®ƒæ˜¯è¿æ¥Observerå’ŒObserverableçš„æ¡¥æ¢ï¼Œå› æ­¤ï¼ŒSubjectå¯ä»¥è¢«ç†è§£ä¸ºSubject&#x3D;Observable+Observerã€‚<br>RxJavaæä¾›äº†ä»¥ä¸‹4ç§Subject:</p>
<ol>
<li>PublishSubject<br>publishsubjectåªä¼šæŠŠåœ¨è®¢é˜…å‘ç”Ÿçš„äº‹ä»¶ç‚¹ä¹‹åæ¥è‡ªåŸå§‹Observableçš„æ•°æ®å‘ç”Ÿç»™è§‚å¯Ÿè€…ã€‚å¦‚æœè¦ç¡®ä¿æ¥è‡ªåŸå§‹Observableçš„æ‰€æœ‰æ•°æ®éƒ½è¢«åˆ†å‘ï¼Œ<br>åˆ™å¯ä»¥å½“æ‰€æœ‰è§‚å¯Ÿè€…éƒ½å·²ç»è®¢é˜…æ—¶æ‰å¼€å§‹å‘å°„æ•°æ®ï¼Œæˆ–è€…æ”¹ç”¨ReplaySubjectã€‚<br>2ï¼‰BehaviorSubject<br>å½“Observerè®¢é˜…BehaviorSubjectæ—¶ï¼Œå®ƒå¼€å§‹å‘å°„åŸå§‹Observableæœ€è¿‘å‘å°„çš„æ•°æ®<br>3ï¼‰ReplaySubject<br>ä¸ç®¡Observerä½•æ—¶è®¢é˜…ReplaySubjectï¼ŒReplaySubjectå‡ä¼šå‘å°„æ‰€æœ‰æ¥è‡ªåŸå§‹Observableçš„æ•°æ®ç»™Observerã€‚å¦‚æœä½¿ç”¨ReplaySubjectä½œä¸ºObserverï¼Œæ³¨æ„ä¸è¦åœ¨å¤šä¸ªçº¿ç¨‹ä¸­è°ƒç”¨onNextã€onCompleteå’ŒonErroræ–¹æ³•ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´é¡ºåºé”™ä¹±ï¼Œå¹¶ä¸”è¿åäº†Observerè§„åˆ™ã€‚<br>4ï¼‰AsyncSubject<br>å½“Observableå®Œæˆæ—¶ï¼ŒAsyncSubjectåªä¼šå‘å°„æ¥è‡ªåŸå§‹Observableçš„æœ€åä¸€ä¸ªæ•°æ®</li>
</ol>
<p>4.RxJavaæ“ä½œç¬¦<br>RxJavaæ“ä½œç¬¦çš„ç±»å‹åˆ†ä¸ºåˆ›å»ºæ“ä½œç¬¦ã€å˜æ¢æ“ä½œç¬¦ã€è¿‡æ»¤æ“ä½œç¬¦ã€ç»„åˆæ“ä½œç¬¦ã€é”™è¯¯å¤„ç†æ“ä½œç¬¦ã€è¾…åŠ©æ“ä½œç¬¦ã€æ¡ä»¶å’Œå¸ƒå°”æ“ä½œç¬¦ã€ç®—æœ¯å’Œèšåˆæ“ä½œç¬¦åŠè¿æ¥æ“ä½œç¬¦ç­‰ï¼Œ<br>è€Œè¿™äº›æ“ä½œç¬¦ç±»å‹ä¸‹åˆæœ‰å¾ˆå¤šæ“ä½œç¬¦ï¼Œæ¯ä¸ªæ“ä½œç¬¦å¯èƒ½è¿˜æœ‰å¾ˆå¤šå˜ä½“ã€‚</p>
<p>åˆ›å»ºæ“ä½œç¬¦ï¼šcreate,just,from,defer,range,interval,start,repeat,timer<br>å˜æ¢æ“ä½œç¬¦ï¼šmap,flatMap,concatMap,switchMapç­‰<br>è¿‡æ»¤æ“ä½œç¬¦ï¼šfilter,elementAt,distince,skip,take<br>ç»„åˆæ“ä½œç¬¦ï¼šstartWith,merge,concat,zip</p>
]]></content>
      <tags>
        <tag>RxJava</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•è§£å†³hexoé¦–é¡µæ˜¾ç¤ºåšå®¢çš„å…¨éƒ¨æ–‡ç« </title>
    <url>/2022/09/25/%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3hexo%E9%A6%96%E9%A1%B5%E6%98%BE%E7%A4%BA%E5%8D%9A%E5%AE%A2%E7%9A%84%E5%85%A8%E9%83%A8%E6%96%87%E7%AB%A0/</url>
    <content><![CDATA[<p>åœ¨ç¬¬ä¸€æ¬¡ä¹¦å†™åšå®¢åï¼Œåº”è¯¥ä¼šå‘ç°è‡ªå·±æ•´ç¯‡åšå®¢çš„æ–‡ç« éƒ½åœ¨è¿™ä¸ªé¦–é¡µä¸­æ˜¾ç¤ºï¼Œå¯èƒ½ä¸€ä¸ªä¸¤ä¸ªè¿˜å¥½ï¼Œä½†æ˜¯è¶Šå¾€åï¼Œè‡ªå·±å†™çš„åšå®¢è¶Šå¤šï¼Œå…¨éƒ½æ”¾åœ¨é¦–é¡µå †ç§¯ï¼Œå°±ä¼šæ˜¾å¾—ååˆ†è‡ƒè‚¿</p>
<span id="more"></span>

<h3 id="ä¿®æ”¹é…ç½®"><a href="#ä¿®æ”¹é…ç½®" class="headerlink" title="ä¿®æ”¹é…ç½®"></a>ä¿®æ”¹é…ç½®</h3><p><code>é¦–é¡µåœ¨ä¸»é¢˜çš„_config.ymlä¸­æŠŠè®¾ç½®æ‰“å¼€ï¼šï¼ˆå®‰è£…æ—¶é»˜è®¤å°±æ‰“å¼€äº†ï¼‰ excerpt_description: true</code></p>
<h3 id="æ–¹æ³•ä¸€ï¼šå†™æ¦‚è¿°"><a href="#æ–¹æ³•ä¸€ï¼šå†™æ¦‚è¿°" class="headerlink" title="æ–¹æ³•ä¸€ï¼šå†™æ¦‚è¿°"></a>æ–¹æ³•ä¸€ï¼šå†™æ¦‚è¿°</h3><p>åœ¨æ–‡ç« çš„front-matterä¸­ï¼ˆå³newä¸€ä¸ªåšå®¢æ—¶ç”Ÿæˆçš„å†…å®¹é‡Œï¼‰æ·»åŠ descriptionï¼Œå…¶ä¸­descriptionä¸­çš„å†…å®¹å°±ä¼šè¢«æ˜¾ç¤ºåˆ°é¦–é¡µä¸Šï¼Œå…¶ä½™ä¸€å¾‹ä¸æ˜¾ç¤ºã€‚<br><code>title: è®©é¦–é¡µæ˜¾ç¤ºéƒ¨åˆ†å†…å®¹ date: 2020-02-23 22:55:10 description: è¿™æ˜¯æ˜¾ç¤ºåœ¨é¦–é¡µçš„æ¦‚è¿°ï¼Œæ­£æ–‡å†…å®¹å‡ä¼šè¢«éšè—ã€‚</code><br>æ¯”è¾ƒä¸æ–¹ä¾¿çš„æ˜¯è¿˜éœ€è¦å†™ä¸€ä¸ªæ¦‚è¿°ï¼Œå¾ˆå¤šæ—¶å€™æ‡’å¾—å†™æ¦‚è¿°ï¼Œäºæ˜¯å°±éœ€è¦ç¬¬äºŒç§æ–¹æ³•äº†ã€‚</p>
<h3 id="æ–¹æ³•äºŒï¼šæ–‡ç« æˆªæ–­"><a href="#æ–¹æ³•äºŒï¼šæ–‡ç« æˆªæ–­" class="headerlink" title="æ–¹æ³•äºŒï¼šæ–‡ç« æˆªæ–­"></a>æ–¹æ³•äºŒï¼šæ–‡ç« æˆªæ–­</h3><p>åœ¨éœ€è¦æˆªæ–­çš„åœ°æ–¹åŠ å…¥ï¼š<br><code>&lt;!--more--&gt;</code><br>é¦–é¡µå°±ä¼šæ˜¾ç¤ºè¿™æ¡ä»¥ä¸Šçš„æ‰€æœ‰å†…å®¹ï¼Œéšè—æ¥ä¸‹æ¥çš„å†…å®¹ã€‚æ¯”å¦‚æœ¬æ–‡å°±æ˜¯ä½¿ç”¨äº†è¿™ç§æ–¹æ³•<br>è¿™ä¸ªæ˜æ˜¾å°±æ–¹ä¾¿è®¸å¤šï¼Œå½“ç„¶æœ‰åˆ©æœ‰å¼Šï¼Œæ¯”å¦‚å¼€å¤´éƒ½æ˜¯åºŸè¯çš„é¦–é¡µå¼€ç€å°±ä¸æ˜¯å¾ˆçˆ½ï¼Œå› æ­¤æˆ‘ä¸€èˆ¬ä¼šå…ˆé€‰æ‹©æ–¹æ³•äºŒï¼Œå¦‚æœæ„Ÿè§‰æ–‡ç« å‰é¢å†™çš„ä¸å¥½å°±ç”¨æ–¹æ³•ä¸€ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>æ¯”ç‰¹å¸çš„è¾“å…¥è¾“å‡ºè¯¦è§£</title>
    <url>/2025/06/01/%E6%AF%94%E7%89%B9%E5%B8%81%E7%9A%84%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h2 id="æ¯”ç‰¹å¸ç®€ä»‹"><a href="#æ¯”ç‰¹å¸ç®€ä»‹" class="headerlink" title="æ¯”ç‰¹å¸ç®€ä»‹"></a>æ¯”ç‰¹å¸ç®€ä»‹</h2><p>æ¯”ç‰¹å¸ï¼ˆBitcoinï¼‰æ˜¯ç”±ä¸­æœ¬èªï¼ˆSatoshi Nakamotoï¼‰äº2008å¹´æå‡ºã€2009å¹´æ­£å¼ä¸Šçº¿çš„å»ä¸­å¿ƒåŒ–æ•°å­—è´§å¸ã€‚å®ƒåŸºäºåŒºå—é“¾æŠ€æœ¯ï¼Œé€šè¿‡ç‚¹å¯¹ç‚¹ç½‘ç»œå®ç°æ— éœ€ä¿¡ä»»çš„ä»·å€¼è½¬ç§»ã€‚æ¯”ç‰¹å¸çš„æ ¸å¿ƒç‰¹æ€§åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>å»ä¸­å¿ƒåŒ–</strong>ï¼šæ²¡æœ‰ä¸­å¤®æœºæ„æˆ–ç¬¬ä¸‰æ–¹ï¼Œæ‰€æœ‰èŠ‚ç‚¹å¹³ç­‰å‚ä¸ã€‚</li>
<li><strong>æ€»é‡æœ‰é™</strong>ï¼šæ€»å‘è¡Œé‡ä¸º2100ä¸‡æšï¼Œé€šèƒ€å¯æ§ã€‚</li>
<li><strong>å…¬å¼€é€æ˜</strong>ï¼šæ‰€æœ‰äº¤æ˜“éƒ½è®°å½•åœ¨åŒºå—é“¾ä¸Šï¼Œä»»ä½•äººå¯æŸ¥éªŒã€‚</li>
<li><strong>æŠ—å®¡æŸ¥æ€§</strong>ï¼šäº¤æ˜“éš¾ä»¥è¢«å•ä¸€å®ä½“é˜»æ–­æˆ–ç¯¡æ”¹ã€‚</li>
<li><strong>åŒ¿åæ€§</strong>ï¼šç”¨æˆ·é€šè¿‡åœ°å€è¿›è¡Œäº¤æ˜“ï¼Œæ— éœ€å®åã€‚</li>
</ul>
<p>æ¯”ç‰¹å¸çš„å‡ºç°ä¸ä»…æ¨åŠ¨äº†æ•°å­—è´§å¸å’ŒåŒºå—é“¾æŠ€æœ¯çš„å‘å±•ï¼Œä¹Ÿä¸ºå…¨çƒé‡‘èä½“ç³»å¸¦æ¥äº†æ–°çš„æ€è€ƒå’Œå˜é©æ–¹å‘ã€‚</p>
<h2 id="æ¯”ç‰¹å¸çš„è¾“å…¥è¾“å‡ºï¼ˆUTXOï¼‰æœºåˆ¶è¯¦è§£"><a href="#æ¯”ç‰¹å¸çš„è¾“å…¥è¾“å‡ºï¼ˆUTXOï¼‰æœºåˆ¶è¯¦è§£" class="headerlink" title="æ¯”ç‰¹å¸çš„è¾“å…¥è¾“å‡ºï¼ˆUTXOï¼‰æœºåˆ¶è¯¦è§£"></a>æ¯”ç‰¹å¸çš„è¾“å…¥è¾“å‡ºï¼ˆUTXOï¼‰æœºåˆ¶è¯¦è§£</h2><p>æ¯”ç‰¹å¸é‡‡ç”¨<strong>UTXOï¼ˆUnspent Transaction Outputï¼ŒæœªèŠ±è´¹äº¤æ˜“è¾“å‡ºï¼‰æ¨¡å‹</strong>ï¼Œè¿™æ˜¯ç†è§£æ¯”ç‰¹å¸äº¤æ˜“å’Œè´¦æœ¬ç»“æ„çš„æ ¸å¿ƒã€‚</p>
<h3 id="1-UTXO-æ¨¡å‹æ¦‚è¿°"><a href="#1-UTXO-æ¨¡å‹æ¦‚è¿°" class="headerlink" title="1. UTXO æ¨¡å‹æ¦‚è¿°"></a>1. UTXO æ¨¡å‹æ¦‚è¿°</h3><ul>
<li><strong>UTXO</strong>ï¼šæ¯ä¸€ç¬”æ¯”ç‰¹å¸äº¤æ˜“çš„è¾“å‡ºï¼ˆoutputï¼‰éƒ½å¯ä»¥ä½œä¸ºåç»­äº¤æ˜“çš„è¾“å…¥ï¼ˆinputï¼‰ã€‚æœªè¢«èŠ±è´¹çš„è¾“å‡ºå³ä¸º UTXOã€‚</li>
<li><strong>è´¦æˆ·ä½“ç³» vs. UTXO</strong>ï¼šä»¥å¤ªåŠç­‰é‡‡ç”¨è´¦æˆ·ä½™é¢æ¨¡å‹ï¼Œè€Œæ¯”ç‰¹å¸é‡‡ç”¨ UTXO æ¨¡å‹ï¼Œæ¯ä¸ª UTXO éƒ½æ˜¯ç‹¬ç«‹çš„â€œé›¶é’±â€ã€‚</li>
</ul>
<h3 id="2-æ¯”ç‰¹å¸äº¤æ˜“ç»“æ„"><a href="#2-æ¯”ç‰¹å¸äº¤æ˜“ç»“æ„" class="headerlink" title="2. æ¯”ç‰¹å¸äº¤æ˜“ç»“æ„"></a>2. æ¯”ç‰¹å¸äº¤æ˜“ç»“æ„</h3><p>ä¸€ç¬”æ¯”ç‰¹å¸äº¤æ˜“ï¼ˆTransactionï¼‰ç”±<strong>è¾“å…¥ï¼ˆInputsï¼‰</strong>å’Œ<strong>è¾“å‡ºï¼ˆOutputsï¼‰</strong>ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">+-------------------+</span><br><span class="line">|   Transaction     |</span><br><span class="line">+-------------------+</span><br><span class="line">| Inputs  | Outputs |</span><br><span class="line">+-------------------+</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>è¾“å…¥ï¼ˆInputï¼‰</strong>ï¼šå¼•ç”¨ä¹‹å‰æŸç¬”äº¤æ˜“çš„è¾“å‡ºï¼ˆå³ UTXOï¼‰ï¼Œå¹¶æä¾›è§£é”è„šæœ¬è¯æ˜æ‰€æœ‰æƒã€‚</li>
<li><strong>è¾“å‡ºï¼ˆOutputï¼‰</strong>ï¼šæŒ‡å®šæ¯”ç‰¹å¸çš„æ¥æ”¶æ–¹å’Œé‡‘é¢ï¼Œå½¢æˆæ–°çš„ UTXOã€‚</li>
</ul>
<h4 id="äº¤æ˜“ç»“æ„ç¤ºæ„"><a href="#äº¤æ˜“ç»“æ„ç¤ºæ„" class="headerlink" title="äº¤æ˜“ç»“æ„ç¤ºæ„"></a>äº¤æ˜“ç»“æ„ç¤ºæ„</h4><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">Inputs: [</span><br><span class="line">  &#123; prev_txid, output_index, unlocking_script &#125;,</span><br><span class="line">  ...</span><br><span class="line">]</span><br><span class="line">Outputs: [</span><br><span class="line">  &#123; value, locking_script &#125;,</span><br><span class="line">  ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="3-è¾“å…¥ï¼ˆInputï¼‰è¯¦è§£"><a href="#3-è¾“å…¥ï¼ˆInputï¼‰è¯¦è§£" class="headerlink" title="3. è¾“å…¥ï¼ˆInputï¼‰è¯¦è§£"></a>3. è¾“å…¥ï¼ˆInputï¼‰è¯¦è§£</h3><p>æ¯ä¸ªè¾“å…¥åŒ…å«ï¼š</p>
<ul>
<li><strong>å¼•ç”¨çš„ UTXO</strong>ï¼šå‰ä¸€ç¬”äº¤æ˜“çš„ txid å’Œè¾“å‡ºåºå·ï¼ˆoutput_indexï¼‰ã€‚</li>
<li><strong>è§£é”è„šæœ¬ï¼ˆscriptSigï¼‰</strong>ï¼šè¯æ˜ä½ æœ‰æƒèŠ±è´¹è¯¥ UTXOï¼ˆé€šå¸¸æ˜¯ç­¾å+å…¬é’¥ï¼‰ã€‚</li>
</ul>
<h3 id="4-è¾“å‡ºï¼ˆOutputï¼‰è¯¦è§£"><a href="#4-è¾“å‡ºï¼ˆOutputï¼‰è¯¦è§£" class="headerlink" title="4. è¾“å‡ºï¼ˆOutputï¼‰è¯¦è§£"></a>4. è¾“å‡ºï¼ˆOutputï¼‰è¯¦è§£</h3><p>æ¯ä¸ªè¾“å‡ºåŒ…å«ï¼š</p>
<ul>
<li><strong>é‡‘é¢ï¼ˆvalueï¼‰</strong>ï¼šè¯¥è¾“å‡ºåŒ…å«çš„æ¯”ç‰¹å¸æ•°é‡ï¼ˆå•ä½ï¼šèªï¼Œ1 BTC &#x3D; 1äº¿èªï¼‰ã€‚</li>
<li><strong>é”å®šè„šæœ¬ï¼ˆscriptPubKeyï¼‰</strong>ï¼šè§„å®šè°èƒ½èŠ±è´¹è¯¥è¾“å‡ºï¼ˆé€šå¸¸æ˜¯æ¥æ”¶æ–¹åœ°å€çš„å“ˆå¸Œï¼‰ã€‚</li>
</ul>
<h3 id="5-UTXO-çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#5-UTXO-çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="5. UTXO çš„ç”Ÿå‘½å‘¨æœŸ"></a>5. UTXO çš„ç”Ÿå‘½å‘¨æœŸ</h3><ol>
<li>äº¤æ˜“ A äº§ç”Ÿä¸€ä¸ªè¾“å‡º O1ï¼ŒO1 æˆä¸º UTXOã€‚</li>
<li>äº¤æ˜“ B çš„è¾“å…¥å¼•ç”¨ O1ï¼ŒO1 è¢«èŠ±è´¹ï¼Œä¸å†æ˜¯ UTXOã€‚</li>
<li>äº¤æ˜“ B äº§ç”Ÿæ–°çš„è¾“å‡º O2ã€O3ï¼Œæˆä¸ºæ–°çš„ UTXOã€‚</li>
</ol>
<h3 id="6-äº¤æ˜“ä¸¾ä¾‹"><a href="#6-äº¤æ˜“ä¸¾ä¾‹" class="headerlink" title="6. äº¤æ˜“ä¸¾ä¾‹"></a>6. äº¤æ˜“ä¸¾ä¾‹</h3><p>å‡è®¾ Alice æœ‰ä¸¤ä¸ª UTXOï¼ˆ0.3 BTC å’Œ 0.7 BTCï¼‰ï¼Œæƒ³è½¬è´¦ 0.5 BTC ç»™ Bobï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">Inputs:</span><br><span class="line">  - 0.3 BTC (UTXO1)</span><br><span class="line">  - 0.7 BTC (UTXO2)</span><br><span class="line">Outputs:</span><br><span class="line">  - 0.5 BTC (Bob)</span><br><span class="line">  - 0.4999 BTC (æ‰¾é›¶ç»™ Alice)</span><br><span class="line">  - 0.0001 BTC (çŸ¿å·¥æ‰‹ç»­è´¹)</span><br></pre></td></tr></table></figure>

<ul>
<li>Alice éœ€è¦æŠŠä¸¤ä¸ª UTXO ä½œä¸ºè¾“å…¥ï¼Œè¾“å‡ºä¸€éƒ¨åˆ†ç»™ Bobï¼Œä¸€éƒ¨åˆ†æ‰¾é›¶ç»™è‡ªå·±ï¼Œå‰©ä¸‹çš„ä½œä¸ºæ‰‹ç»­è´¹ã€‚</li>
</ul>
<h3 id="7-è„šæœ¬ç³»ç»Ÿï¼ˆScriptï¼‰"><a href="#7-è„šæœ¬ç³»ç»Ÿï¼ˆScriptï¼‰" class="headerlink" title="7. è„šæœ¬ç³»ç»Ÿï¼ˆScriptï¼‰"></a>7. è„šæœ¬ç³»ç»Ÿï¼ˆScriptï¼‰</h3><p>æ¯”ç‰¹å¸çš„è¾“å…¥è¾“å‡ºé€šè¿‡ä¸€ç§ç®€å•çš„è„šæœ¬è¯­è¨€ï¼ˆScriptï¼‰å®ç°çµæ´»çš„æ”¯ä»˜æ§åˆ¶ã€‚</p>
<ul>
<li><strong>é”å®šè„šæœ¬ï¼ˆscriptPubKeyï¼‰</strong>ï¼šå¦‚ <code>OP_DUP OP_HASH160 &lt;å…¬é’¥å“ˆå¸Œ&gt; OP_EQUALVERIFY OP_CHECKSIG</code>ï¼Œè§„å®šè°èƒ½èŠ±è´¹ã€‚</li>
<li><strong>è§£é”è„šæœ¬ï¼ˆscriptSigï¼‰</strong>ï¼šå¦‚ <code>&lt;ç­¾å&gt; &lt;å…¬é’¥&gt;</code>ï¼Œç”¨äºè§£é”å¯¹åº”çš„ UTXOã€‚</li>
</ul>
<h4 id="å¸¸è§è„šæœ¬ç±»å‹"><a href="#å¸¸è§è„šæœ¬ç±»å‹" class="headerlink" title="å¸¸è§è„šæœ¬ç±»å‹"></a>å¸¸è§è„šæœ¬ç±»å‹</h4><ul>
<li><strong>P2PKH</strong>ï¼ˆPay to Public Key Hashï¼‰ï¼šæœ€å¸¸è§çš„â€œæ¯”ç‰¹å¸åœ°å€â€æ”¶æ¬¾æ–¹å¼ã€‚</li>
<li><strong>P2SH</strong>ï¼ˆPay to Script Hashï¼‰ï¼šå¤šç­¾åã€å¤æ‚æ¡ä»¶ç­‰ã€‚</li>
<li><strong>P2WPKH&#x2F;P2WSH</strong>ï¼šéš”ç¦»è§è¯ï¼ˆSegWitï¼‰è„šæœ¬ã€‚</li>
</ul>
<h3 id="8-UTXO-æ¨¡å‹çš„ä¼˜ç¼ºç‚¹"><a href="#8-UTXO-æ¨¡å‹çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="8. UTXO æ¨¡å‹çš„ä¼˜ç¼ºç‚¹"></a>8. UTXO æ¨¡å‹çš„ä¼˜ç¼ºç‚¹</h3><p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>å¹¶å‘æ€§å¼ºï¼Œæ˜“äºå¹¶è¡ŒéªŒè¯ã€‚</li>
<li>éšç§æ€§è¾ƒå¥½ï¼Œéš¾ä»¥è¿½è¸ªè´¦æˆ·ä½™é¢ã€‚</li>
<li>é˜²æ­¢åŒèŠ±ï¼Œå¤©ç„¶æŠ—éƒ¨åˆ†æ”»å‡»ã€‚</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>éœ€è¦ç®¡ç†å¤§é‡ UTXOï¼Œå­˜å‚¨å’ŒåŒæ­¥å‹åŠ›å¤§ã€‚</li>
<li>æ‰¾é›¶æœºåˆ¶å¯¼è‡´ UTXO ç¢ç‰‡åŒ–ã€‚</li>
<li>äº¤æ˜“ç¡®è®¤æ—¶é—´é•¿ï¼ŒçŸ¿å·¥æ‰‹ç»­è´¹é«˜ã€‚</li>
</ul>
<h3 id="9-æ€»ç»“"><a href="#9-æ€»ç»“" class="headerlink" title="9. æ€»ç»“"></a>9. æ€»ç»“</h3><ul>
<li>UTXO æ˜¯æ¯”ç‰¹å¸çš„æ ¸å¿ƒæ¦‚å¿µï¼Œæ¯ä¸ªè¾“å‡ºéƒ½æ˜¯æœªèŠ±è´¹çš„äº¤æ˜“è¾“å‡ºï¼ˆUTXOï¼‰ã€‚</li>
<li>è¾“å…¥å’Œè¾“å‡ºé€šè¿‡è§£é”è„šæœ¬å’Œé”å®šè„šæœ¬å®ç°æ”¯ä»˜æ§åˆ¶ã€‚</li>
<li>UTXO æ¨¡å‹å…·æœ‰é«˜å¹¶å‘æ€§ã€éšç§æ€§å’ŒæŠ—åŒèŠ±èƒ½åŠ›ï¼Œä½†å­˜åœ¨å­˜å‚¨å’Œç¢ç‰‡åŒ–é—®é¢˜ã€‚</li>
</ul>
]]></content>
      <tags>
        <tag>web3</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ç†è§£è¿›ç¨‹å’Œçº¿ç¨‹</title>
    <url>/2022/09/21/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/</url>
    <content><![CDATA[<span id="more"></span>

<h2 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h2><p>å¹³æ—¶helloworldè¿™æ ·çš„ç¨‹åºåœ¨ç°ä»£ç³»ç»Ÿä¸Šè¿è¡Œæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šæä¾›ä¸€ç§å‡è±¡ï¼Œå°±å¥½åƒç³»ç»Ÿä¸Šåªæœ‰è¿™ä¸ªç¨‹åºåœ¨è¿è¡Œã€‚ç¨‹åºçœ‹ä¸Šå»æ˜¯ç‹¬å åœ°ä½¿ç”¨å¤„ç†å™¨ã€ä¸»å­˜å’ŒIOè®¾å¤‡ã€‚å¤„ç†å™¨çœ‹ä¸Šå»å°±åƒåœ¨ä¸é—´æ–­åœ°ä¸€æ¡æ¥ä¸€æ¡æ‰§è¡Œç¨‹åºä¸­çš„æŒ‡ä»¤ï¼Œå³è¯¥ç¨‹åºçš„ä»£ç å’Œæ•°æ®æ˜¯ç³»ç»Ÿå†…å­˜ä¸­å”¯ä¸€çš„å¯¹è±¡ï¼Œè¿™äº›å‡è±¡æ˜¯é€šè¿‡è¿›ç¨‹çš„æ¦‚å¿µæ¥å®ç°çš„ï¼Œè¿›ç¨‹æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­æœ€é‡è¦å’Œæœ€æˆåŠŸçš„æ¦‚å¿µä¹‹ä¸€ã€‚<br>è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿå¯¹ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„ä¸€ç§æŠ½è±¡ã€‚åœ¨ä¸€ä¸ªç³»ç»Ÿä¸Šå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªè¿›ç¨‹ï¼Œè€Œæ¯ä¸ªè¿›ç¨‹éƒ½å¥½åƒåœ¨ç‹¬å åœ°ä½¿ç”¨ç¡¬ä»¶ã€‚è€Œå¹¶å‘è¿è¡Œï¼Œåˆ™æ˜¯è¯´ä¸€ä¸ªè¿›ç¨‹çš„æŒ‡ä»¤å’Œå¦ä¸€ä¸ªè¿›ç¨‹çš„æŒ‡ä»¤æ˜¯äº¤é”™æ‰§è¡Œçš„ã€‚åœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸­ã€‚éœ€è¦è¿è¡Œçš„è¿›ç¨‹æ•°æ˜¯å¤šäºå¯ä»¥è¿è¡Œå®ƒä»¬çš„CPUä¸ªæ•°çš„ã€‚ä¼ ç»Ÿç³»ç»Ÿåœ¨ä¸€ä¸ªæ—¶åˆ»åªèƒ½æ‰§è¡Œä¸€ä¸ªç¨‹åºï¼Œè€Œå…ˆè¿›çš„å¤šæ ¸å¤„ç†å™¨åŒæ—¶èƒ½å¤Ÿæ‰§è¡Œå¤šä¸ªç¨‹åºã€‚æ— è®ºæ˜¯åœ¨å•æ ¸è¿˜æ˜¯åœ¨å¤šæ ¸ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªCPUçœ‹ä¸Šå»éƒ½åƒæ˜¯åœ¨å¹¶å‘æ‰§è¡Œå¤šä¸ªè¿›ç¨‹ï¼Œè¿™æ˜¯é€šè¿‡å¤„ç†å™¨åœ¨è¿›ç¨‹é—´åˆ‡æ¢æ¥å®ç°çš„ã€‚æ“ä½œç³»ç»Ÿå®ç°è¿™ç§äº¤é”™æ‰§è¡Œçš„æœºåˆ¶ç§°ä¸ºä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ï¼ˆä¸ºäº†ç®€åŒ–ï¼Œä¸‹é¢çš„è®¨è®ºæˆ‘ä»¬åªè€ƒè™‘åŒ…å«ä¸€ä¸ªCPUçš„å•å¤„ç†å™¨ç³»ç»Ÿçš„æƒ…å†µï¼‰<br>æ“ä½œç³»ç»Ÿä¿æŒè·Ÿè¸ªè¿›ç¨‹è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰çŠ¶æ€ä¿¡æ¯ã€‚è¿™ç§çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬è®¸å¤šä¿¡æ¯ï¼Œæ¯”å¦‚PCå’Œå¯„å­˜å™¨æ–‡ä»¶çš„å½“å‰å€¼ï¼Œä»¥åŠä¸»å­˜çš„å†…å®¹ã€‚åœ¨ä»»ä½•ä¸€ä¸ªæ—¶åˆ»ï¼Œå•å¤„ç†å™¨ç³»ç»Ÿéƒ½åªèƒ½æ‰§è¡Œä¸€ä¸ªè¿›ç¨‹çš„çš„ä»£ç ï¼Œå½“æ“ä½œç³»ç»Ÿå†³å®šè¦æŠŠæ§åˆ¶æƒä»å½“å‰è¿›ç¨‹è½¬ç§»åˆ°æŸä¸ªæ–°è¿›ç¨‹æ—¶ï¼Œå°±ä¼šè¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ŒåŠä¿å­˜å½“å‰è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œæ¢å¤æ–°è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œç„¶åå°†æ§åˆ¶æƒä¼ é€’åˆ°æ–°è¿›ç¨‹ã€‚æ–°è¿›ç¨‹å°±ä¼šä»å®ƒä¸Šæ¬¡åœæ­¢çš„åœ°æ–¹å¼€å§‹ã€‚ä¸‹å›¾å±•ç¤ºäº†ç¨‹åºè¿è¡Œåœºæ™¯çš„åŸºæœ¬ç†å¿µã€‚<br><img src="https://s3.bmp.ovh/imgs/2022/09/25/9a7e5808598c7948.jpg"><br>ç¤ºä¾‹åœºæ™¯ä¸­æœ‰ä¸¤ä¸ªå¹¶å‘çš„è¿›ç¨‹ï¼šshellè¿›ç¨‹å’Œhelloè¿›ç¨‹ã€‚æœ€å¼€å§‹ï¼Œåªæœ‰shellè¿›ç¨‹åœ¨è¿è¡Œï¼Œå³ç­‰å¾…å‘½ä»¤è¡Œä¸Šçš„è¾“å…¥ã€‚å½“æˆ‘ä»¬è®©å®ƒè¿è¡Œhelloç¨‹åºæ—¶ï¼Œshellé€šè¿‡è°ƒç”¨ä¸€ä¸ªä¸“é—¨çš„å‡½æ•°ï¼Œå³ç³»ç»Ÿè°ƒç”¨ï¼Œæ¥æ‰§è¡Œæˆ‘ä»¬çš„è¯·æ±‚ï¼Œç³»ç»Ÿè°ƒç”¨ä¼šå°†æ§åˆ¶æƒä¼ é€’ç»™æ“ä½œç³»ç»Ÿã€‚æ“ä½œç³»ç»Ÿä¿å­˜shellè¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„helloè¿›ç¨‹ä»¥åŠå…¶ä¸Šä¸‹æ–‡ï¼Œç„¶åå°†æ§åˆ¶æƒä¼ ç»™æ–°çš„hellå’¯è¿›ç¨‹ã€‚helloè¿›ç¨‹ç»ˆæ­¢åï¼Œæ“ä½œç³»ç»Ÿæ¢å¤shellè¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œå¹¶å°†æ§åˆ¶æƒä¼ å›ç»™å®ƒï¼Œshellè¿›ç¨‹ä¼šç»§ç»­ç­‰å¾…ä¸‹ä¸€ä¸ªå‘½ä»¤è¡Œè¾“å…¥ã€‚<br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä»ä¸€ä¸ªè¿›ç¨‹åˆ°å¦ä¸€ä¸ªè¿›ç¨‹çš„è½¬æ¢æ˜¯ç”±æ“ä½œç³»ç»Ÿå†…æ ¸ç®¡ç†çš„ï¼Œå†…æ ¸æ—¶æ“ä½œç³»ç»Ÿä»£ç å¸¸é©»ä¸»å­˜çš„éƒ¨åˆ†ã€‚å½“åº”ç”¨ç¨‹åºéœ€è¦æ“ä½œç³»ç»Ÿçš„æŸäº›æ“ä½œæ—¶ï¼Œæ¯”å¦‚è¯»å†™æ–‡ä»¶ï¼Œå®ƒå°±æ‰§è¡Œä¸€æ¡ç‰¹æ®Šçš„ç³»ç»Ÿè°ƒç”¨ï¼ˆsystem callï¼‰æŒ‡ä»¤ï¼Œå°†æ§åˆ¶æƒä¼ é€’ç»™å†…æ ¸ã€‚ç„¶åå†…æ ¸æ‰§è¡Œè¢«è¯·æ±‚çš„æ“ä½œå¹¶è¿”å›åº”ç”¨ç¨‹åºã€‚æ³¨æ„ï¼Œå†…æ ¸ä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ã€‚ç›¸åï¼Œå®ƒæ˜¯ç³»ç»Ÿç®¡ç†å…¨éƒ¨è¿›ç¨‹æ‰€ç”¨ä»£ç å’Œæ•°æ®ç»“æ„çš„é›†åˆã€‚<br>å®ç°è¿›ç¨‹è¿™ä¸ªæŠ½è±¡æ¦‚å¿µéœ€è¦ä½çº§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿè½¯ä»¶ä¹‹é—´ç´§å¯†åˆä½œã€‚</p>
<h2 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h2><p>å°½ç®¡é€šå¸¸æˆ‘ä»¬è®¤ä¸ºä¸€ä¸ªè¿›ç¨‹åªæœ‰å•ä¸€çš„æ§åˆ¶æµï¼Œä½†æ˜¯åœ¨ç°ä»£ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªè¿›ç¨‹å®é™…ä¸Šå¯ä»¥ç”±å¤šä¸ªç§°ä¸ºçº¿ç¨‹çš„æ‰§è¡Œå•å…ƒç»„æˆï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½è¿è¡Œåœ¨è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå¹¶å…±äº«åŒæ ·çš„ä»£ç å’Œå…¨å±€æ•°æ®ã€‚ç”±äºç½‘ç»œæœåŠ¡å™¨ä¸­å¯¹å¹¶è¡Œå¤„ç†çš„éœ€æ±‚ï¼Œçº¿ç¨‹ç§°ä¸ºè¶Šæ¥è¶Šé‡è¦çš„ç¼–ç¨‹æ¨¡å‹ï¼Œå› ä¸ºå¤šçº¿ç¨‹ä¹‹é—´æ¯”å¤šè¿›ç¨‹ä¹‹é—´æ›´å®¹æ˜“å…±äº«æ•°æ®ï¼Œä¹Ÿå› ä¸ºçº¿ç¨‹ä¸€èˆ¬æ¥è¯´éƒ½æ¯”è¿›ç¨‹æ›´é«˜æ•ˆã€‚å½“æœ‰å¤šå¤„ç†å™¨å¯ç”¨çš„æ—¶å€™ï¼Œå¤šçº¿ç¨‹ä¹Ÿæ˜¯ä¸€ç§ä½¿å¾—ç¨‹åºå¯ä»¥è¿è¡Œå¾—æ›´å¿«å¾—æ–¹æ³•ã€‚</p>
<h2 id="è™šæ‹Ÿå†…å­˜"><a href="#è™šæ‹Ÿå†…å­˜" class="headerlink" title="è™šæ‹Ÿå†…å­˜"></a>è™šæ‹Ÿå†…å­˜</h2><p>è™šæ‹Ÿå†…å­˜æ˜¯ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå®ƒä¸ºæ¯ä¸ªè¿›ç¨‹æä¾›ä¸€ä¸ªå‡è±¡ï¼Œå³æ¯ä¸ªè¿›ç¨‹éƒ½åœ¨ç‹¬å åœ°ä½¿ç”¨ä¸»å­˜ã€‚æ¯ä¸ªè¿›ç¨‹çœ‹åˆ°å†…å­˜éƒ½æ˜¯ä¸€è‡´å¾—ï¼Œç§°ä¸ºè™šæ‹Ÿåœ°å€ç©ºé—´ã€‚ä¸‹å›¾æ‰€ç¤ºæ˜¯Linuxè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼ˆå…¶ä»–Unixç³»ç»Ÿçš„è®¾è®¡ä¹Ÿä¸æ­¤ç±»ä¼¼ï¼‰ã€‚åœ¨Linuxä¸­ï¼Œåœ°å€ç©ºé—´æœ€ä¸Šé¢çš„åŒºåŸŸæ˜¯ä¿ç•™ç»™æ“ä½œç³»ç»Ÿä¸­çš„ä»£ç å’Œæ•°æ®çš„ï¼Œè¿™å¯¹æ‰€æœ‰è¿›ç¨‹æ¥è¯´éƒ½æ˜¯ä¸€æ ·çš„ã€‚åœ°å€ç©ºé—´çš„åº•éƒ¨åŒºåŸŸå­˜æ”¾ç”¨æˆ·è¿›ç¨‹å®šä¹‰çš„ä»£ç å’Œæ•°æ®ã€‚è¯·æ³¨æ„ï¼Œé€”ä¸­çš„åœ°å€æ˜¯ä»ä¸‹å¾€ä¸Šå¢å¤§çš„ã€‚<br><img src="https://s3.bmp.ovh/imgs/2022/09/25/39151a55fce31299.png"><br>æ¯ä¸ªè¿›ç¨‹çœ‹åˆ°çš„è™šæ‹Ÿåœ°å€ç©ºé—´ç”±å¤§é‡å‡†ç¡®å®šä¹‰çš„åŒºæ„æˆï¼Œæ¯ä¸ªåŒºéƒ½æœ‰ä¸“é—¨çš„åŠŸèƒ½ï¼Œä»¥ä¸‹ä»æœ€ä½çš„åœ°å€å¼€å§‹ï¼Œé€æ­¥å‘ä¸Šä»‹ç»ï¼š</p>
<h3 id="ç¨‹åºä»£ç å’Œæ•°æ®"><a href="#ç¨‹åºä»£ç å’Œæ•°æ®" class="headerlink" title="ç¨‹åºä»£ç å’Œæ•°æ®"></a>ç¨‹åºä»£ç å’Œæ•°æ®</h3><p>å¯¹æ‰€æœ‰çš„è¿›ç¨‹æ¥è¯´ï¼Œä»£ç æ˜¯ä»åŒä¸€å›ºå®šåœ°å€å¼€å§‹ï¼Œç´§æ¥ç€çš„æ˜¯å’ŒPCå…¨å±€å˜é‡ç›¸å¯¹åº”çš„æ•°æ®ä½ç½®ã€‚ä»£ç å’Œæ•°æ®åŒºæ˜¯ç›´æ¥æŒ‰ç…§å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶çš„å†…å®¹åˆå§‹åŒ–çš„ï¼Œåœ¨ç¤ºä¾‹ä¸­å°±æ˜¯å¯æ‰§è¡Œæ–‡ä»¶helloï¼Œ</p>
<h3 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h3><p>ä»£ç å’Œæ•°æ®åŒºåç´§éšç€çš„æ˜¯è¿è¡Œæ—¶å †ã€‚ä»£ç å’Œæ•°æ®åŒºåœ¨è¿›ç¨‹ä¸€å¼€å§‹è¿è¡Œæ—¶å°±è¢«åˆ¶å®šäº†å¤§å°ï¼Œä¸æ­¤ä¸åŒï¼Œå½“è°ƒç”¨åƒmallocå’Œfreeè¿™æ ·çš„Cæ ‡å‡†åº“å‡½æ•°æ—¶ï¼Œå †å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æ‰©å±•å’Œæ”¶ç¼©ã€‚</p>
<h3 id="å…±äº«åº“"><a href="#å…±äº«åº“" class="headerlink" title="å…±äº«åº“"></a>å…±äº«åº“</h3><p>å¤§çº¦åœ¨åœ°å€ç©ºé—´ä¸­çš„ä¸­é—´éƒ¨åˆ†æ˜¯ä¸€å—ç”¨æ¥å­˜æ”¾åƒCæ ‡å‡†åº“å’Œæ•°å­¦åº“è¿™æ ·çš„å…±äº«åº“çš„ä»£ç å’Œæ•°æ®çš„åŒºåŸŸï¼Œå…±äº«åº“çš„æ¦‚å¿µéå¸¸å¼ºå¤§ï¼Œ</p>
<h3 id="æ ˆ"><a href="#æ ˆ" class="headerlink" title="æ ˆ"></a>æ ˆ</h3><p>ä½äºç”¨æˆ·è™šæ‹Ÿåœ°å€ç©ºé—´é¡¶éƒ¨çš„æ˜¯ç”¨æˆ·æ ˆï¼Œç¼–è¯‘å™¨ç”¨å®ƒæ¥å®ç°å‡½æ•°è°ƒç”¨ï¼Œå’Œå †ä¸€æ ·ï¼Œç”¨æˆ·æ ˆåœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´å¯ä»¥åŠ¨æ€åœ°æ‰©å±•å’Œæ”¶ç¼©ã€‚ç‰¹åˆ«åœ°ï¼Œæ¯æ¬¡æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œæ ˆå°±ä¼šå¢é•¿ï¼›ä»ä¸€ä¸ªå‡½æ•°è¿”å›æ—¶ï¼Œæ ˆå°±ä¼šæ”¶ç¼©ã€‚</p>
<h3 id="å†…å­˜è™šæ‹Ÿå†…å­˜"><a href="#å†…å­˜è™šæ‹Ÿå†…å­˜" class="headerlink" title="å†…å­˜è™šæ‹Ÿå†…å­˜"></a>å†…å­˜è™šæ‹Ÿå†…å­˜</h3><p>åœ°å€ç©ºé—´é¡¶éƒ¨çš„åŒºåŸŸæ˜¯ä¸ºå†…æ ¸ä¿ç•™çš„ï¼Œä¸å…è®¸åº”ç”¨ç¨‹åºè¯»å†™è¿™ä¸ªåŒºåŸŸçš„å†…å®¹æˆ–è€…ç›´æ¥è°ƒç”¨å‘¢è€¦åˆä»£ç å®šä¹‰çš„å‡½æ•°ã€‚ç›¸åï¼Œå®ƒä»¬å¿…é¡»è°ƒç”¨å†…æ ¸æ¥æ‰§è¡Œè¿™äº›æ“ä½œ</p>
<p>è™šæ‹Ÿå†…å­˜çš„è¿ä½œéœ€è¦ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿè½¯ä»¶ä¹‹é—´ç²¾å¯†å¤æ‚çš„äº¤äº’ï¼ŒåŒ…æ‹¬å¯¹å¤„ç†å™¨ç”Ÿæˆçš„æ¯ä¸ªåœ°å€çš„ç¡¬ä»¶ç¼–è¯‘ã€‚å…¶åŸºæœ¬æ€æƒ³æ˜¯æŠŠä¸€ä¸ªè¿›ç¨‹è™šæ‹Ÿå†…å­˜çš„å†…å®¹å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œç„¶åä¸»å­˜ä½œä¸ºç£ç›˜çš„é«˜é€Ÿç¼“å­˜ï¼Œ</p>
<h3 id="æ–‡ä»¶"><a href="#æ–‡ä»¶" class="headerlink" title="æ–‡ä»¶"></a>æ–‡ä»¶</h3><p>æ–‡ä»¶å°±æ˜¯å­—èŠ‚åºåˆ—ï¼Œä»…æ­¤è€Œå·²ã€‚æ¯ä¸ªIOè®¾å¤‡ï¼ŒåŒ…æ‹¬ç£ç›˜ï¼Œé”®ç›˜ï¼Œæ˜¾ç¤ºå™¨ï¼Œç”šè‡³ç½‘ç»œï¼Œéƒ½å¯ä»¥çœ‹æˆæ˜¯æ–‡ä»¶ï¼Œç³»ç»Ÿä¸­æ‰€æœ‰è¾“å…¥è¾“å‡ºéƒ½æ˜¯é€šè¿‡ä½¿ç”¨ä¸€å°ç»„ç§°ä¸ºUnix I&#x2F;Oçš„ç³»ç»Ÿå‡½æ•°è°ƒç”¨è¯»å†™æ–‡ä»¶æŒ‰æ¥å®ç°çš„<br>æ–‡ä»¶è¿™ä¸ªç®€å•è€Œç²¾è‡´çš„æ¦‚å¿µæ˜¯éå¸¸å¼ºå¤§çš„ï¼Œå› ä¸ºå®ƒå‘åº”ç”¨ç¨‹åºä¸­æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„è¯•å›¾ï¼Œæ¥çœ‹å¾…ç³»ç»Ÿä¸­å¯èƒ½å«æœ‰çš„æ‰€æœ‰å„å¼å„æ ·çš„I&#x2F;Oè®¾å¤‡ã€‚ä¾‹å¦‚ï¼Œå¤„ç†ç£ç›˜æ–‡ä»¶å†…å®¹çš„åº”ç”¨ç¨‹åºå‘˜å¯ä»¥éå¸¸å¹¸ç¦ï¼Œå› ä¸ºä»–ä»¬æ— éœ€äº†è§£å…·ä½“çš„ç£ç›˜æŠ€æœ¯ï¼Œè¿›ä¸€æ­¥è¯´ï¼ŒåŒä¸€ä¸ªç¨‹åºå¯ä»¥åœ¨ä½¿ç”¨ä¸åŒç£ç›˜æŠ€æœ¯çš„ä¸åŒç³»ç»Ÿä¸Šè¿è¡Œã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>ç†è§£ Tokioï¼šRust å¼‚æ­¥ç¼–ç¨‹å…¥é—¨æŒ‡å—</title>
    <url>/2025/04/02/%E7%90%86%E8%A7%A3-Tokio%EF%BC%9ARust-%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<h2 id="ç†è§£-Tokioï¼šRust-å¼‚æ­¥ç¼–ç¨‹å…¥é—¨æŒ‡å—ï¼ˆæ‘˜è¦ä¸å®ç”¨ç¤ºä¾‹ï¼‰"><a href="#ç†è§£-Tokioï¼šRust-å¼‚æ­¥ç¼–ç¨‹å…¥é—¨æŒ‡å—ï¼ˆæ‘˜è¦ä¸å®ç”¨ç¤ºä¾‹ï¼‰" class="headerlink" title="ç†è§£ Tokioï¼šRust å¼‚æ­¥ç¼–ç¨‹å…¥é—¨æŒ‡å—ï¼ˆæ‘˜è¦ä¸å®ç”¨ç¤ºä¾‹ï¼‰"></a>ç†è§£ Tokioï¼šRust å¼‚æ­¥ç¼–ç¨‹å…¥é—¨æŒ‡å—ï¼ˆæ‘˜è¦ä¸å®ç”¨ç¤ºä¾‹ï¼‰</h2><p>Tokio æ˜¯ Rust ç”Ÿæ€ä¸­æœ€æµè¡Œçš„å¼‚æ­¥è¿è¡Œæ—¶ï¼ˆasync runtimeï¼‰ä¹‹ä¸€ï¼Œä¸ºåŸºäº <code>async</code>&#x2F;<code>.await</code> çš„å¹¶å‘ç¨‹åºæä¾›æ‰§è¡Œå™¨ã€IO é©±åŠ¨ã€å®šæ—¶å™¨ã€ä»»åŠ¡è°ƒåº¦å’Œå®ç”¨å·¥å…·ã€‚æœ¬æ–‡æ€»ç»“äº† Tokio çš„æ ¸å¿ƒæ¦‚å¿µã€å¸¸ç”¨ APIã€å®æˆ˜ç¤ºä¾‹åŠæœ€ä½³å®è·µã€‚</p>
<span id="more"></span>

<h3 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h3><ul>
<li>Runtimeï¼šTokio çš„æ‰§è¡Œç¯å¢ƒï¼ŒåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ï¼ˆmulti-threaded runtimeï¼‰æˆ–å•çº¿ç¨‹ï¼ˆcurrent-thread runtimeï¼‰ã€‚è´Ÿè´£è°ƒåº¦ Future çš„æ‰§è¡Œã€‚</li>
<li>Reactor &#x2F; I&#x2F;O é©±åŠ¨ï¼šåŸºäºæ“ä½œç³»ç»Ÿçš„äº‹ä»¶é€šçŸ¥ï¼ˆå¦‚ epoll&#x2F;kqueueï¼‰ï¼Œéé˜»å¡åœ°å¤„ç†å¥—æ¥å­—&#x2F;æ–‡ä»¶ç­‰ I&#x2F;O äº‹ä»¶ã€‚</li>
<li>Executorï¼šå°†å°±ç»ªçš„ä»»åŠ¡æ’å…¥æ‰§è¡Œé˜Ÿåˆ—å¹¶åœ¨ runtime çº¿ç¨‹ä¸Šè¿è¡Œã€‚</li>
<li>Taskï¼šç”± Future å°è£…ã€ç”± runtime è°ƒåº¦çš„æ‰§è¡Œå•å…ƒï¼ˆç±»ä¼¼è½»é‡çº¿ç¨‹ï¼‰ã€‚</li>
<li>Wakerï¼šå½“ Future å¯ç»§ç»­æ‰§è¡Œæ—¶å”¤é†’å¯¹åº” taskã€‚</li>
<li>spawn vs spawn_blockingï¼šéé˜»å¡ä»»åŠ¡ï¼ˆasyncï¼‰ç”¨ spawnï¼Œé˜»å¡&#x2F;CPU å¯†é›†ä»»åŠ¡ç”¨ spawn_blockingã€‚</li>
</ul>
<h3 id="å¯åŠ¨-runtime"><a href="#å¯åŠ¨-runtime" class="headerlink" title="å¯åŠ¨ runtime"></a>å¯åŠ¨ runtime</h3><ul>
<li>å¤šçº¿ç¨‹è¿è¡Œæ—¶ï¼ˆé»˜è®¤ï¼Œé€‚åˆå¹¶å‘åœºæ™¯ï¼‰ï¼š<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> tokio::runtime::Runtime;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[tokio::main]</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// åœ¨å¤šçº¿ç¨‹ runtime ä¸Šè¿è¡Œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>å•çº¿ç¨‹è¿è¡Œæ—¶ï¼š<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> tokio::runtime::Builder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">rt</span> = Builder::<span class="title function_ invoke__">new_current_thread</span>().<span class="title function_ invoke__">enable_all</span>().<span class="title function_ invoke__">build</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">rt.<span class="title function_ invoke__">block_on</span>(<span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="comment">// å•çº¿ç¨‹æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="ä»»åŠ¡è°ƒåº¦ä¸-spawn"><a href="#ä»»åŠ¡è°ƒåº¦ä¸-spawn" class="headerlink" title="ä»»åŠ¡è°ƒåº¦ä¸ spawn"></a>ä»»åŠ¡è°ƒåº¦ä¸ spawn</h3><ul>
<li><code>tokio::spawn</code> åœ¨ runtime ä¸Šå¯åŠ¨ä¸€ä¸ªåå°å¼‚æ­¥ä»»åŠ¡ï¼Œè¿”å› <code>JoinHandle</code>ï¼š<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">handle</span> = tokio::<span class="title function_ invoke__">spawn</span>(<span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="comment">// å¼‚æ­¥ä»»åŠ¡</span></span><br><span class="line">    <span class="number">42</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">let</span> <span class="variable">res</span> = handle.<span class="keyword">await</span>.<span class="title function_ invoke__">unwrap</span>();</span><br></pre></td></tr></table></figure></li>
<li>ä½¿ç”¨ <code>spawn_blocking</code> å°†é˜»å¡æ“ä½œç§»å‡º async runtime çº¿ç¨‹æ± ï¼Œé¿å…é˜»å¡ reactorï¼š<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">res</span> = tokio::task::<span class="title function_ invoke__">spawn_blocking</span>(|| &#123;</span><br><span class="line">    <span class="comment">// é˜»å¡çš„è®¡ç®—æˆ–åŒæ­¥ IO</span></span><br><span class="line">    <span class="title function_ invoke__">heavy_computation</span>()</span><br><span class="line">&#125;).<span class="keyword">await</span>.<span class="title function_ invoke__">unwrap</span>();</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="å¼‚æ­¥-I-x2F-O-ç¤ºä¾‹ï¼ˆTCP-Echo-Serverï¼‰"><a href="#å¼‚æ­¥-I-x2F-O-ç¤ºä¾‹ï¼ˆTCP-Echo-Serverï¼‰" class="headerlink" title="å¼‚æ­¥ I&#x2F;O ç¤ºä¾‹ï¼ˆTCP Echo Serverï¼‰"></a>å¼‚æ­¥ I&#x2F;O ç¤ºä¾‹ï¼ˆTCP Echo Serverï¼‰</h3><p>ç®€è¦ç¤ºä¾‹å±•ç¤ºå¦‚ä½•ä½¿ç”¨ <code>TcpListener</code>&#x2F;<code>TcpStream</code> å®ç°å¹¶å‘ echo serverï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> tokio::net::&#123;TcpListener, TcpStream&#125;;</span><br><span class="line"><span class="keyword">use</span> tokio::io::&#123;AsyncReadExt, AsyncWriteExt&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[tokio::main]</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">main</span>() <span class="punctuation">-&gt;</span> anyhow::<span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">listener</span> = TcpListener::<span class="title function_ invoke__">bind</span>(<span class="string">&quot;127.0.0.1:8080&quot;</span>).<span class="keyword">await</span>?;</span><br><span class="line">    <span class="keyword">loop</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> (<span class="keyword">mut</span> socket, _) = listener.<span class="title function_ invoke__">accept</span>().<span class="keyword">await</span>?;</span><br><span class="line">        tokio::<span class="title function_ invoke__">spawn</span>(<span class="keyword">async</span> <span class="keyword">move</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">buf</span> = <span class="built_in">vec!</span>[<span class="number">0u8</span>; <span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">loop</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> <span class="variable">n</span> = <span class="keyword">match</span> socket.<span class="title function_ invoke__">read</span>(&amp;<span class="keyword">mut</span> buf).<span class="keyword">await</span> &#123;</span><br><span class="line">                    <span class="title function_ invoke__">Ok</span>(<span class="number">0</span>) =&gt; <span class="keyword">return</span>,</span><br><span class="line">                    <span class="title function_ invoke__">Ok</span>(n) =&gt; n,</span><br><span class="line">                    <span class="title function_ invoke__">Err</span>(_) =&gt; <span class="keyword">return</span>,</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">let</span> <span class="variable">_</span> = socket.<span class="title function_ invoke__">write_all</span>(&amp;buf[..n]).<span class="keyword">await</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å®šæ—¶å™¨ä¸å»¶æ—¶"><a href="#å®šæ—¶å™¨ä¸å»¶æ—¶" class="headerlink" title="å®šæ—¶å™¨ä¸å»¶æ—¶"></a>å®šæ—¶å™¨ä¸å»¶æ—¶</h3><ul>
<li><code>tokio::time::sleep</code>ã€<code>interval</code> ç­‰ï¼š<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> tokio::time::&#123;sleep, Duration&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">sleep</span>(Duration::<span class="title function_ invoke__">from_secs</span>(<span class="number">1</span>)).<span class="keyword">await</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="é€šä¿¡ï¼šChannel"><a href="#é€šä¿¡ï¼šChannel" class="headerlink" title="é€šä¿¡ï¼šChannel"></a>é€šä¿¡ï¼šChannel</h3><ul>
<li><code>tokio::sync::mpsc</code> ç”¨äºå¼‚æ­¥ä»»åŠ¡é—´æ¶ˆæ¯ä¼ é€’ï¼›<code>oneshot</code> ç”¨äºä¸€æ¬¡æ€§é€šçŸ¥ï¼š<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> tokio::sync::mpsc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> (tx, <span class="keyword">mut</span> rx) = mpsc::<span class="title function_ invoke__">channel</span>(<span class="number">32</span>);</span><br><span class="line">tokio::<span class="title function_ invoke__">spawn</span>(<span class="keyword">async</span> <span class="keyword">move</span> &#123;</span><br><span class="line">    tx.<span class="title function_ invoke__">send</span>(<span class="number">1</span>).<span class="keyword">await</span>.<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(v) = rx.<span class="title function_ invoke__">recv</span>().<span class="keyword">await</span> &#123; <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, v); &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="åŒæ­¥åŸè¯­ï¼ˆåœ¨-async-ä¸­ä½¿ç”¨ï¼‰"><a href="#åŒæ­¥åŸè¯­ï¼ˆåœ¨-async-ä¸­ä½¿ç”¨ï¼‰" class="headerlink" title="åŒæ­¥åŸè¯­ï¼ˆåœ¨ async ä¸­ä½¿ç”¨ï¼‰"></a>åŒæ­¥åŸè¯­ï¼ˆåœ¨ async ä¸­ä½¿ç”¨ï¼‰</h3><ul>
<li><code>tokio::sync::Mutex</code>&#x2F;<code>RwLock</code>ï¼šå¼‚æ­¥å‹å¥½ï¼ˆ.await æ—¶ä¸ä¼šé˜»å¡çº¿ç¨‹ï¼‰ã€‚</li>
<li><code>std::sync::Mutex</code> åœ¨ async ä¸Šæ…ç”¨ï¼ˆä¼šé˜»å¡çº¿ç¨‹æ± ï¼‰ã€‚<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> tokio::sync::Mutex;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">m</span> = Mutex::<span class="title function_ invoke__">new</span>(<span class="number">0</span>);</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">guard</span> = m.<span class="title function_ invoke__">lock</span>().<span class="keyword">await</span>;</span><br><span class="line">    *guard += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="select-ä¸å¹¶å‘æ§åˆ¶"><a href="#select-ä¸å¹¶å‘æ§åˆ¶" class="headerlink" title="select! ä¸å¹¶å‘æ§åˆ¶"></a>select! ä¸å¹¶å‘æ§åˆ¶</h3><ul>
<li><code>tokio::select!</code> æ”¯æŒåœ¨å¤šä¸ªå¼‚æ­¥åˆ†æ”¯ä¹‹é—´ç«æ€ï¼Œç¬¬ä¸€å®Œæˆçš„åˆ†æ”¯æ‰§è¡Œï¼š<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">tokio::<span class="built_in">select!</span> &#123;</span><br><span class="line">    _ = <span class="title function_ invoke__">async_task1</span>() =&gt; <span class="built_in">println!</span>(<span class="string">&quot;task1 done&quot;</span>),</span><br><span class="line">    _ = <span class="title function_ invoke__">async_task2</span>() =&gt; <span class="built_in">println!</span>(<span class="string">&quot;task2 done&quot;</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="é”™è¯¯å¤„ç†ä¸å–æ¶ˆ"><a href="#é”™è¯¯å¤„ç†ä¸å–æ¶ˆ" class="headerlink" title="é”™è¯¯å¤„ç†ä¸å–æ¶ˆ"></a>é”™è¯¯å¤„ç†ä¸å–æ¶ˆ</h3><ul>
<li><code>JoinHandle::abort()</code> å¯å–æ¶ˆä»»åŠ¡ï¼Œä½†éœ€æ³¨æ„èµ„æºæ¸…ç†ã€‚</li>
<li>ä»»åŠ¡å–æ¶ˆä¼šåœ¨ <code>.await</code> ç‚¹æŠ›å‡º <code>Cancelled</code>ï¼Œæ³¨æ„æ•è·ä¸æ¸…ç†ï¼ˆ<code>drop</code> è¯­ä¹‰ï¼‰ã€‚</li>
</ul>
<h3 id="ä¸é˜»å¡-x2F-CPU-å¯†é›†å‹ä»£ç çš„æ•´åˆ"><a href="#ä¸é˜»å¡-x2F-CPU-å¯†é›†å‹ä»£ç çš„æ•´åˆ" class="headerlink" title="ä¸é˜»å¡&#x2F;CPU å¯†é›†å‹ä»£ç çš„æ•´åˆ"></a>ä¸é˜»å¡&#x2F;CPU å¯†é›†å‹ä»£ç çš„æ•´åˆ</h3><ul>
<li>å¯¹äº CPU å¯†é›†ä»»åŠ¡ï¼Œä½¿ç”¨ <code>spawn_blocking</code> æˆ–ç§»åŠ¨åˆ°ä¸“é—¨çš„çº¿ç¨‹æ± ã€‚</li>
<li>å°½é‡å°†åŒæ­¥ I&#x2F;O æ”¾åˆ°ç‹¬ç«‹çº¿ç¨‹æˆ–ä½¿ç”¨ async-compatible åº“ã€‚</li>
</ul>
<h3 id="ç½‘ç»œæ€§èƒ½ä¸-Tunables"><a href="#ç½‘ç»œæ€§èƒ½ä¸-Tunables" class="headerlink" title="ç½‘ç»œæ€§èƒ½ä¸ Tunables"></a>ç½‘ç»œæ€§èƒ½ä¸ Tunables</h3><ul>
<li>ä½¿ç”¨å¤šçº¿ç¨‹ runtime æå‡å¹¶å‘ååã€‚</li>
<li>å‡å°‘é¢‘ç¹åˆ†é…ã€é¿å…è¿‡å¤š await ç‚¹å¯¼è‡´ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</li>
<li>é€šè¿‡ <code>tokio::sync::Semaphore</code> æ§åˆ¶å¹¶å‘è¿æ¥æ•°æˆ–å¹¶å‘ä»»åŠ¡æ•°ã€‚</li>
</ul>
<h3 id="ä¸ç¬¬ä¸‰æ–¹ç”Ÿæ€"><a href="#ä¸ç¬¬ä¸‰æ–¹ç”Ÿæ€" class="headerlink" title="ä¸ç¬¬ä¸‰æ–¹ç”Ÿæ€"></a>ä¸ç¬¬ä¸‰æ–¹ç”Ÿæ€</h3><ul>
<li>ä¸ <code>hyper</code>ï¼ˆHTTPï¼‰ã€<code>reqwest</code>ï¼ˆHTTP å®¢æˆ·ç«¯ï¼‰ã€<code>tokio-postgres</code>ã€<code>sqlx</code> ç­‰é›†æˆè‰¯å¥½ã€‚</li>
<li><code>tracing</code> ä¸ <code>tokio-console</code> å¯å¸®åŠ©è°ƒè¯•è¿è¡Œæ—¶æ€§èƒ½å’Œä»»åŠ¡è¡Œä¸ºã€‚</li>
</ul>
<h3 id="å¸¸è§é™·é˜±"><a href="#å¸¸è§é™·é˜±" class="headerlink" title="å¸¸è§é™·é˜±"></a>å¸¸è§é™·é˜±</h3><ul>
<li>åœ¨ async ä¸­ä½¿ç”¨åŒæ­¥é”ï¼ˆå¦‚ std::sync::Mutexï¼‰ä¼šé˜»å¡çº¿ç¨‹æ± ï¼Œå¯¼è‡´æ­»é”æˆ–æ€§èƒ½ä¸‹é™ã€‚</li>
<li>å¿½ç•¥ <code>spawn_blocking</code> å¯¼è‡´ runtime çº¿ç¨‹è¢«é˜»å¡ã€‚</li>
<li>åœ¨å¤šçº¿ç¨‹ runtime ä¸­å…±äº«éçº¿ç¨‹å®‰å…¨æ•°æ®ï¼ˆæœªåŠ  Arc&#x2F;é”ï¼‰ä¼šå‡ºé”™ã€‚</li>
<li>å¿½è§†ä»»åŠ¡æ•°é‡ä¸ç³»ç»Ÿèµ„æºï¼ˆæ–‡ä»¶æè¿°ç¬¦ã€è¿æ¥æ•°ï¼‰é™åˆ¶ã€‚</li>
</ul>
<h3 id="å®æˆ˜å»ºè®®"><a href="#å®æˆ˜å»ºè®®" class="headerlink" title="å®æˆ˜å»ºè®®"></a>å®æˆ˜å»ºè®®</h3><ul>
<li>ä» <code>tokio::main</code> å¿«é€Ÿä¸Šæ‰‹ï¼Œé€æ­¥ä½¿ç”¨ <code>spawn</code> å°†å¹¶å‘å·¥ä½œåˆ†ç¦»ã€‚</li>
<li>æŠŠçŸ­å°çš„å¼‚æ­¥ä»»åŠ¡æ”¾åˆ° async executorï¼Œé•¿æ—¶é—´æˆ–é˜»å¡å·¥ä½œæ”¾åˆ° <code>spawn_blocking</code>ã€‚</li>
<li>ä½¿ç”¨ <code>tokio::sync</code> ç³»åˆ—åŸè¯­åšå¼‚æ­¥å†…éƒ¨åŒæ­¥ã€‚</li>
<li>ç”¨ <code>tokio-console</code> æˆ– <code>tracing</code> åˆ†æçƒ­ç‚¹ä¸é˜»å¡ç‚¹ã€‚</li>
<li>ä¹¦å†™å¯å–æ¶ˆã€å¥å£®çš„ä»»åŠ¡å¹¶æ³¨æ„èµ„æºæ¸…ç†ï¼ˆDrop ä¸ finally æ¨¡å¼ï¼‰ã€‚</li>
</ul>
<h3 id="å‚è€ƒèµ„æ–™ä¸æ·±å…¥å­¦ä¹ "><a href="#å‚è€ƒèµ„æ–™ä¸æ·±å…¥å­¦ä¹ " class="headerlink" title="å‚è€ƒèµ„æ–™ä¸æ·±å…¥å­¦ä¹ "></a>å‚è€ƒèµ„æ–™ä¸æ·±å…¥å­¦ä¹ </h3><ul>
<li>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://tokio.rs/">https://tokio.rs/</a></li>
<li>Tokio Tutorial ä¸ Examplesï¼ˆå®˜æ–¹ GitHubï¼‰</li>
<li>å­¦ä¹ æ–¹å‘ï¼šä»»åŠ¡æ¨¡å‹åŸç†ï¼ˆWaker&#x2F;Contextï¼‰ã€å¼‚æ­¥ I&#x2F;O çš„åº•å±‚å®ç°ã€æ€§èƒ½è°ƒä¼˜ä¸è°ƒè¯•å·¥å…·</li>
</ul>
]]></content>
      <tags>
        <tag>Rust</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¾è®¡æ¨¡å¼ç³»åˆ— â€” å•ä¾‹æ¨¡å¼</title>
    <url>/2022/12/12/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97-%E2%80%94-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[<p>å¼€ç¯‡ç»™å¤§å®¶ä¸€ä¸ªæ€è€ƒé¢˜ï¼šä¸ºä»€ä¹ˆä¸ç”¨é™æ€æ–¹æ³•è€Œç”¨å•ä¾‹æ¨¡å¼ï¼Ÿ</p>
<span id="more"></span>

<p>å•ä¾‹çš„å®šä¹‰ï¼šåœ¨å½“å‰è¿›ç¨‹ä¸­ï¼Œé€šè¿‡å•ä¾‹æ¨¡å¼åˆ›å»ºçš„ç±»æœ‰ä¸”åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚</p>
<p>å•ä¾‹æœ‰å¦‚ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š<br>1.åœ¨Javaåº”ç”¨ä¸­ï¼Œå•ä¾‹æ¨¡å¼èƒ½ä¿è¯åœ¨ä¸€ä¸ªJVMä¸­ï¼Œè¯¥å¯¹è±¡åªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨<br>2.æ„é€ å™¨å¿…é¡»æ˜¯ç§æœ‰çš„ï¼Œå¤–éƒ¨ç±»æ— æ³•é€šè¿‡è°ƒç”¨æ„é€ å™¨åˆ›å»ºè¯¥å®ä¾‹<br>3.æ²¡æœ‰å…¬å¼€çš„setæ–¹æ³•ï¼Œå¤–éƒ¨ç±»æ— æ³•è°ƒç”¨setæ–¹æ³•åˆ›å»ºè¯¥å®ä¾‹<br>4.æä¾›ä¸€ä¸ªå…¬å¼€çš„getæ–¹æ³•è·å–å”¯ä¸€çš„è¿™ä¸ªå®ä¾‹</p>
<p>é‚£å•ä¾‹æ¨¡å¼æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ<br>1.æŸäº›ç±»åˆ›å»ºæ¯”è¾ƒé¢‘ç¹ï¼Œå¯¹äºä¸€äº›å¤§å‹çš„å¯¹è±¡ï¼Œè¿™æ˜¯ä¸€ç¬”å¾ˆå¤§çš„ç³»ç»Ÿå¼€é”€<br>2.çœå»äº†newæ“ä½œç¬¦ï¼Œé™ä½äº†ç³»ç»Ÿå†…å­˜çš„ä½¿ç”¨é¢‘ç‡ï¼Œå‡è½»GCå‹åŠ›<br>3.ç³»ç»Ÿä¸­æŸäº›ç±»ï¼Œå¦‚Springé‡Œçš„controllerï¼Œæ§åˆ¶ç€å¤„ç†æµç¨‹ï¼Œå¦‚æœè¯¥ç±»å¯ä»¥åˆ›å»ºå¤šä¸ªçš„è¯ï¼Œç³»ç»Ÿå°±å…¨ä¹±äº†<br>4.é¿å…äº†å¯¹èµ„æºçš„é‡å¤å ç”¨</p>
<p>å¥½äº†ï¼Œå•ä¾‹æ¨¡å¼çš„å®šä¹‰ä¹Ÿæ¸…æ¥šäº†ï¼Œå¥½å¤„ä¹Ÿäº†è§£äº†ï¼Œå…ˆçœ‹ä¸€ä¸ªé¥¿æ±‰å¼çš„å†™æ³•ï¼š</p>
<h2 id="é¥¿æ±‰å¼"><a href="#é¥¿æ±‰å¼" class="headerlink" title="é¥¿æ±‰å¼"></a>é¥¿æ±‰å¼</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class Singleton &#123;</span><br><span class="line">  // åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡</span><br><span class="line">    private static Singleton instance = new Singleton();</span><br><span class="line">    /**</span><br><span class="line">     * ç§æœ‰æ„é€ æ–¹æ³•ï¼Œé˜²æ­¢è¢«å®ä¾‹åŒ–</span><br><span class="line">     */</span><br><span class="line">    private Singleton()&#123;&#125;</span><br><span class="line">    /**</span><br><span class="line">     * é™æ€getæ–¹æ³•</span><br><span class="line">     */</span><br><span class="line">    public static Singleton getInstance()&#123;</span><br><span class="line">        return instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹‹æ‰€ä»¥å«é¥¿æ±‰å¼å¤§å®¶å¯ä»¥ç†è§£ä¸ºå®ƒé¥¿ï¼Œä»–æƒ³æå‰æŠŠå¯¹è±¡newå‡ºæ¥ï¼Œè¿™æ ·åˆ«äººå“ªæ€•æ˜¯ç¬¬ä¸€æ¬¡è·å–è¿™ä¸ªç±»å¯¹è±¡çš„æ—¶å€™ç›´æ¥å°±å­˜åœ¨è¿™ä¸ªç±»äº†ï¼Œçœå»äº†åˆ›å»ºç±»è¿™ä¸€æ­¥å¼€é”€ã€‚</p>
<p>ä¸‹é¢ä»‹ç»æ‡’æ±‰å¼</p>
<h2 id="æ‡’æ±‰å¼"><a href="#æ‡’æ±‰å¼" class="headerlink" title="æ‡’æ±‰å¼"></a>æ‡’æ±‰å¼</h2><p>çº¿ç¨‹ä¸å®‰å…¨çš„æ¨¡å¼</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class Singleton &#123;  </span><br><span class="line">    private static Singleton instance;  </span><br><span class="line">    private Singleton ()&#123;&#125;  </span><br><span class="line">  </span><br><span class="line">    public static Singleton getInstance() &#123;  </span><br><span class="line">    if (instance == null) &#123;  </span><br><span class="line">        instance = new Singleton();  </span><br><span class="line">    &#125;  </span><br><span class="line">    return instance;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‡’æ±‰å¼å¤§å®¶å¯ä»¥ç†è§£ä¸ºå®ƒæ‡’ï¼Œåˆ«äººç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™ä»–å‘ç°è‡ªå·±çš„å®ä¾‹æ˜¯ç©ºçš„ï¼Œç„¶åå»åˆå§‹åŒ–äº†ï¼Œå†èµ‹å€¼ï¼Œåé¢çš„è°ƒç”¨å°±å’Œé¥¿æ±‰æ²¡åŒºåˆ«äº†ã€‚</p>
<p>æ‡’æ±‰å’Œé¥¿æ±‰çš„å¯¹æ¯”ï¼šå¤§å®¶å¯ä»¥å‘ç°ä¸¤è€…çš„åŒºåˆ«åŸºæœ¬ä¸Šå°±æ˜¯ç¬¬ä¸€æ¬¡åˆ›ä½œæ—¶å€™çš„å¼€é”€é—®é¢˜ï¼Œä»¥åŠçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ˆçº¿ç¨‹ä¸å®‰å…¨æ¨¡å¼çš„æ‡’æ±‰ï¼‰ã€‚<br>é‚£æœ‰äº†è¿™ä¸ªå¯¹æ¯”ï¼Œé‚£ä»–ä»¬çš„åœºæ™¯å°±å¥½ç†è§£äº†ï¼Œåœ¨å¾ˆå¤šç”µå•†åœºæ™¯ï¼Œå¦‚æœè¿™ä¸ªæ•°æ®æ˜¯ç»å¸¸è®¿é—®çš„çƒ­ç‚¹æ•°æ®ï¼Œé‚£æˆ‘å°±å¯ä»¥å†ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™ä½¿ç”¨é¥¿æ±‰æ¨¡å¼æå‰åŠ è½½ï¼ˆç±»ä¼¼ç¼“å­˜çš„é¢„çƒ­ï¼‰è¿™æ ·å“ªæ€•æ˜¯ç¬¬ä¸€ä¸ªç”¨æˆ·è°ƒç”¨éƒ½ä¸ä¼šå­˜åœ¨åˆ›å»ºå¼€é”€ï¼Œè€Œä¸”è°ƒç”¨é¢‘ç¹ä¹Ÿä¸å­˜åœ¨å†…å­˜æµªè´¹äº†ã€‚</p>
<p>è€Œæ‡’æ±‰å¼å‘¢æˆ‘ä»¬å¯ä»¥ç”¨åœ¨ä¸æ€ä¹ˆçƒ­çš„åœ°æ–¹ï¼Œæ¯”å¦‚é‚£ä¸ªæ•°æ®ä½ ä¸ç¡®å®šå¾ˆé•¿ä¸€æ®µæ—¶é—´æ˜¯ä¸æ˜¯æœ‰äººè°ƒç”¨ï¼Œé‚£å°±ç”¨æ‡’æ±‰ï¼Œå¦‚æœä½ ä½¿ç”¨äº†é¥¿æ±‰ï¼Œä½†æ˜¯è¿‡äº†å‡ ä¸ªæœˆè¿˜æ²¡æœ‰äººè°ƒç”¨ï¼Œæå‰åŠ è½½çš„ç±»å†å†…å­˜ä¸­æ˜¯ç”±èµ„æºæµªè´¹çš„ã€‚</p>
<h2 id="çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>çº¿ç¨‹å®‰å…¨é—®é¢˜</h2><p>ä¸Šé¢çš„æ‡’æ±‰æˆ‘æ˜¯æ•…æ„æ²¡æœ‰åŠ é”çš„ï¼Œå¤§å®¶è‚¯å®šéƒ½çŸ¥é“æ‡’æ±‰çš„çº¿ç¨‹å®‰å…¨é—®é¢˜<br><a href="https://imgse.com/i/z4IcQK"><img src="https://s1.ax1x.com/2022/12/13/z4IcQK.jpg" alt="z4IcQK.jpg"></a><br>åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å¯èƒ½å­˜åœ¨è¿™ä¹ˆä¸€ç§æƒ…å†µï¼šå¤šä¸ªçº¿ç¨‹å»è°ƒç”¨getInstanceæ–¹æ³•æ¥è·å–Singletonçš„å®ä¾‹ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å‘ç”Ÿä¸€ç§æƒ…å†µï¼Œå½“ç¬¬ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œif(instance &#x3D;&#x3D; null)æ—¶ï¼Œæ­¤æ—¶instanceæ˜¯ä¸ºnullçš„è¿›å…¥è¯­å¥ã€‚</p>
<p>åœ¨è¿˜æ²¡æœ‰æ‰§è¡Œinstance &#x3D; new Singleton()æ—¶ï¼ˆæ­¤æ—¶instanceæ˜¯ä¸ºnullçš„ï¼‰ç¬¬äºŒä¸ªçº¿ç¨‹ä¹Ÿè¿›å…¥äº†if(instance &#x3D;&#x3D; null)è¿™ä¸ªè¯­å¥ï¼Œå› ä¸ºä¹‹å‰è¿›å…¥è¿™ä¸ªè¯­å¥çš„çº¿ç¨‹ä¸­è¿˜æ²¡æœ‰æ‰§è¡Œinstance &#x3D; new Singleton()ï¼Œæ‰€ä»¥å®ƒä¼šæ‰§è¡Œinstance &#x3D; new Singleton()æ¥å®ä¾‹åŒ–Singletonå¯¹è±¡ï¼Œå› ä¸ºç¬¬äºŒä¸ªçº¿ç¨‹ä¹Ÿè¿›å…¥äº†ifè¯­å¥æ‰€ä»¥å®ƒä¼šå®ä¾‹åŒ–Singletonå¯¹è±¡ã€‚</p>
<p>è¿™æ ·å°±å¯¼è‡´äº†å®ä¾‹åŒ–ä¸¤ä¸ªSingletonå¯¹è±¡ï¼Œé‚£æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p>
<p>ç®€å•ç²—æš´ï¼ŒåŠ é”å°±å¥½äº†ï¼Œè¿™æ˜¯åŠ é”ä¹‹åçš„ä»£ç ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class Singleton &#123;</span><br><span class="line">    private static Singleton instance = null;</span><br><span class="line">    /**</span><br><span class="line">     * ç§æœ‰æ„é€ æ–¹æ³•ï¼Œé˜²æ­¢è¢«å®ä¾‹åŒ–</span><br><span class="line">     */</span><br><span class="line">    private Singleton()&#123;&#125;</span><br><span class="line">    /**</span><br><span class="line">     * é™æ€getæ–¹æ³•</span><br><span class="line">     */</span><br><span class="line">    public static synchronized Singleton getInstance()&#123;</span><br><span class="line">        if(instance == null)&#123;</span><br><span class="line">            instance = new Singleton();</span><br><span class="line">        &#125;</span><br><span class="line">        return instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸€ç§å…¸å‹çš„æ—¶é—´æ¢ç©ºé—´çš„å†™æ³•ï¼Œä¸ç®¡ä¸‰ä¸ƒäºŒåä¸€ï¼Œæ¯æ¬¡åˆ›å»ºå®ä¾‹æ—¶å…ˆé”èµ·æ¥ï¼Œåœ¨è¿›è¡Œåˆ¤æ–­ï¼Œä¸¥é‡é™ä½äº†ç³»ç»Ÿçš„å¤„ç†é€Ÿåº¦ã€‚</p>
<p>æœ‰æ²¡æœ‰æ›´å¥½çš„å¤„ç†æ–¹å¼å‘¢ï¼Ÿ<br>æœ‰ï¼Œé€šè¿‡åŒæ£€é”åšä¸¤æ¬¡åˆ¤æ–­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class Singleton &#123;</span><br><span class="line">    private static Singleton instance = null;</span><br><span class="line">    private Singleton()&#123;&#125;</span><br><span class="line">    public static Singleton getInstance()&#123;</span><br><span class="line">        //å…ˆæ£€æŸ¥å®ä¾‹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨æ‰è¿›å…¥ä¸‹é¢çš„åŒæ­¥å—</span><br><span class="line">        if(instance == null)&#123;</span><br><span class="line">            //åŒæ­¥å—ï¼Œçº¿ç¨‹å®‰å…¨çš„åˆ›å»ºå®ä¾‹</span><br><span class="line">            synchronized (Singleton.class) &#123;</span><br><span class="line">                //å†æ¬¡æ£€æŸ¥å®ä¾‹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨æ‰çœŸæ­£çš„åˆ›å»ºå®ä¾‹</span><br><span class="line">                if(instance == null)&#123;</span><br><span class="line">                    instance = new Singleton();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å°†synchronizedå…³é”®å­—åŠ åœ¨äº†å†…éƒ¨ï¼Œä¹Ÿå°±æ˜¯è¯´å½“è°ƒç”¨çš„æ—¶å€™æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œåªæœ‰åœ¨instanceä¸ºnullï¼Œå¹¶åˆ›å»ºå¯¹è±¡çš„æ—¶å€™æ‰éœ€è¦åŠ é”ï¼Œæ€§èƒ½æœ‰ä¸€å®šçš„æå‡ã€‚</p>
<p>ä½†æ˜¯ï¼Œè¿™æ ·å°±æ²¡æœ‰é—®é¢˜äº†å—ï¼Ÿ</p>
<p>çœ‹ä¸‹é¢çš„æƒ…å†µï¼šåœ¨JavaæŒ‡ä»¤ä¸­åˆ›å»ºå¯¹è±¡å’Œèµ‹å€¼æ“ä½œæ˜¯åˆ†å¼€è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´instance &#x3D; new Singleton();è¯­å¥æ˜¯åˆ†ä¸¤éƒ¨æ‰§è¡Œçš„ã€‚</p>
<p>ä½†æ˜¯JVMå¹¶ä¸ä¿è¯è¿™ä¸¤ä¸ªæ“ä½œçš„å…ˆåé¡ºåºï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰å¯èƒ½JVMä¼šä¸ºæ–°çš„Singletonå®ä¾‹åˆ†é…ç©ºé—´ï¼Œç„¶åç›´æ¥èµ‹å€¼ç»™instanceæˆå‘˜ï¼Œç„¶åå†å»åˆå§‹åŒ–è¿™ä¸ªSingletonå®ä¾‹ã€‚</p>
<p>è¿™æ ·å°±å¯èƒ½å‡ºé”™äº†ï¼Œæˆ‘ä»¬ä»¥Aã€Bä¸¤ä¸ªçº¿ç¨‹ä¸ºä¾‹ï¼š<br>1.Aã€Bçº¿ç¨‹åŒæ—¶è¿›å…¥äº†ç¬¬ä¸€ä¸ªifåˆ¤æ–­<br>2.Aé¦–å…ˆè¿›å…¥synchronizedå—ï¼Œç”±äºinstanceä¸ºnullï¼Œæ‰€ä»¥å®ƒæ‰§è¡Œinstance &#x3D; new Singleton();<br>3.ç”±äºJVMå†…éƒ¨çš„ä¼˜åŒ–æœºåˆ¶ï¼ŒJVMå…ˆç”»äº†ä¸€äº›åˆ†é…ç»™Singletonå®ä¾‹çš„ç©ºç™½å†…å­˜ï¼Œå¹¶èµ‹å€¼ç»™instanceæˆå‘˜ï¼ˆæ³¨æ„æ­¤æ—¶JVMæ²¡æœ‰å¼€å§‹åˆå§‹åŒ–è¿™ä¸ªå®ä¾‹ï¼‰ï¼Œç„¶åAç¦»å¼€äº†synchronizedå—ã€‚<br><a href="https://imgse.com/i/z4oQOO"><img src="https://s1.ax1x.com/2022/12/13/z4oQOO.jpg" alt="z4oQOO.jpg"></a><br>4.Bè¿›å…¥synchronizedå—ï¼Œç”±äºinstanceæ­¤æ—¶ä¸æ˜¯nullï¼Œå› æ­¤å®ƒé©¬ä¸Šç¦»å¼€äº†synchronizedå—å¹¶å°†ç»“æœè¿”å›ç»™è°ƒç”¨è¯¥æ–¹æ³•çš„ç¨‹åºã€‚<br>5.æ­¤æ—¶Bçº¿ç¨‹æ‰“ç®—ä½¿ç”¨singletonå®ä¾‹ï¼Œå´å‘ç°å®ƒå¹¶æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œäºæ˜¯å‡ºç°äº†é”™è¯¯ã€‚<br>åŠ ä¸Švolatileä¿®é¥°Singletonï¼Œå†åšä¸€æ¬¡ä¼˜åŒ–ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class Singleton &#123;</span><br><span class="line">    private volatile static Singleton instance = null;</span><br><span class="line">    private Singleton()&#123;&#125;</span><br><span class="line">    public static Singleton getInstance()&#123;</span><br><span class="line">        //å…ˆæ£€æŸ¥å®ä¾‹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨æ‰è¿›å…¥ä¸‹é¢çš„åŒæ­¥å—</span><br><span class="line">        if(instance == null)&#123;</span><br><span class="line">            //åŒæ­¥å—ï¼Œçº¿ç¨‹å®‰å…¨çš„åˆ›å»ºå®ä¾‹</span><br><span class="line">            synchronized (Singleton.class) &#123;</span><br><span class="line">                //å†æ¬¡æ£€æŸ¥å®ä¾‹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨æ‰çœŸæ­£çš„åˆ›å»ºå®ä¾‹</span><br><span class="line">                if(instance == null)&#123;</span><br><span class="line">                    instance = new Singleton();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡volatileä¿®é¥°çš„å˜é‡ï¼Œä¸ä¼šè¢«çº¿ç¨‹æœ¬åœ°ç¼“å­˜ï¼Œæ‰€æœ‰çº¿ç¨‹å¯¹è¯¥å¯¹è±¡çš„è¯»å†™éƒ½ä¼šç¬¬ä¸€æ—¶é—´åŒæ­¥åˆ°ä¸»å†…å­˜ï¼Œä»è€Œä¿è¯å¤šä¸ªçº¿ç¨‹é—´å¯¹è¯¥å¯¹è±¡çš„å‡†ç¡®æ€§</p>
<h2 id="volatileçš„ä½œç”¨"><a href="#volatileçš„ä½œç”¨" class="headerlink" title="volatileçš„ä½œç”¨"></a>volatileçš„ä½œç”¨</h2><p>é˜²æ­¢æŒ‡ä»¤é‡æ’åºï¼Œå› ä¸ºinstance &#x3D; new Singleton()ä¸æ˜¯åŸå­æ“ä½œ<br>ä¿è¯å†…å­˜å¯è§</p>
<p>è¿™ä¸ªæ˜¯æ¯”è¾ƒå®Œç¾çš„å†™æ³•äº†ï¼Œè¿™ç§æ–¹å¼èƒ½å¤Ÿå®‰å…¨çš„åˆ›å»ºå”¯ä¸€çš„ä¸€ä¸ªå®ä¾‹ï¼Œåˆä¸ä¼šå¯¹æ€§èƒ½æœ‰å¤ªå¤§çš„å½±å“ã€‚</p>
<p>ä½†æ˜¯ç”±äºvolatileå…³é”®å­—å¯èƒ½ä¼šå±è”½æ‰è™šæ‹Ÿæœºä¸­ä¸€äº›å¿…è¦çš„ä»£ç ä¼˜åŒ–ï¼Œæ‰€ä»¥è¿è¡Œæ•ˆç‡å¹¶ä¸æ˜¯å¾ˆé«˜ï¼Œè¿˜æœ‰æ›´ä¼˜çš„å†™æ³•å—ï¼Ÿ</p>
<p>é€šè¿‡é™æ€å†…éƒ¨ç±»</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class Singleton &#123;  </span><br><span class="line">  </span><br><span class="line">    /* ç§æœ‰æ„é€ æ–¹æ³•ï¼Œé˜²æ­¢è¢«å®ä¾‹åŒ– */  </span><br><span class="line">    private Singleton() &#123;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    /* æ­¤å¤„ä½¿ç”¨ä¸€ä¸ªå†…éƒ¨ç±»æ¥ç»´æŠ¤å•ä¾‹ */  </span><br><span class="line">    private static class SingletonFactory &#123;  </span><br><span class="line">        private static Singleton instance = new Singleton();  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    /* è·å–å®ä¾‹ */  </span><br><span class="line">    public static Singleton getInstance() &#123;  </span><br><span class="line">        return SingletonFactory.instance;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    /* å¦‚æœè¯¥å¯¹è±¡è¢«ç”¨äºåºåˆ—åŒ–ï¼Œå¯ä»¥ä¿è¯å¯¹è±¡åœ¨åºåˆ—åŒ–å‰åä¿æŒä¸€è‡´ */  </span><br><span class="line">    public Object readResolve() &#123;  </span><br><span class="line">        return getInstance();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨å†…éƒ¨ç±»æ¥ç»´æŠ¤å•ä¾‹çš„å®ç°ï¼ŒJVMå†…éƒ¨çš„æœºåˆ¶èƒ½å¤Ÿä¿è¯å½“ä¸€ä¸ªç±»åŠ è½½çš„æ—¶å€™ï¼Œè¿™ä¸ªç±»çš„åŠ è½½è¿‡ç¨‹æ˜¯çº¿ç¨‹äº’æ–¥çš„ã€‚</p>
<p>è¿™æ ·å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡è°ƒç”¨getInstanceçš„æ—¶å€™ï¼ŒJVMèƒ½å¤Ÿå¸®æˆ‘ä»¬ä¿è¯instanceåªè¢«åˆ›å»ºä¸€æ¬¡ï¼Œå¹¶ä¸”ä¼šä¿è¯æŠŠèµ‹å€¼ç»™instanceçš„å†…å­˜åˆå§‹åŒ–å®Œæ¯•ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨æ‹…å¿ƒä¸Šé¢çš„é—®é¢˜ã€‚</p>
<p>åŒæ—¶è¯¥æ–¹æ³•ä¹Ÿåªä¼šåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™ä½¿ç”¨äº’æ–¥æœºåˆ¶ï¼Œè¿™æ ·å°±è§£å†³äº†ä½æ€§èƒ½é—®é¢˜ã€‚è¿™æ ·æˆ‘ä»¬æš‚æ—¶æ€»ç»“ä¸€ä¸ªå®Œç¾çš„å•ä¾‹æ¨¡å¼ã€‚</p>
<p>è¿˜æœ‰æ›´å®Œç¾çš„å†™æ³•å—ï¼Ÿé€šè¿‡æšä¸¾</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public enum Singleton &#123;</span><br><span class="line">    /**</span><br><span class="line">     * å®šä¹‰ä¸€ä¸ªæšä¸¾çš„å…ƒç´ ï¼Œå®ƒå°±ä»£è¡¨äº†Singletonçš„ä¸€ä¸ªå®ä¾‹ã€‚</span><br><span class="line">     */</span><br><span class="line">    Instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨æšä¸¾æ¥å®ç°å•å®ä¾‹æ§åˆ¶ä¼šæ›´åŠ ç®€æ´ï¼Œè€Œä¸”JVMä»æ ¹æœ¬ä¸Šæä¾›ä¿éšœï¼Œç»å¯¹é˜²æ­¢å¤šæ¬¡å®ä¾‹åŒ–ï¼Œæ˜¯æ›´ç®€æ´ï¼Œé«˜æ•ˆï¼Œå®‰å…¨çš„å®ç°å•ä¾‹çš„æ–¹å¼ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ€åå¤§å®¶åº”è¯¥éƒ½çŸ¥é“å•ä¾‹æ¨¡å¼çš„å†™æ³•äº†ï¼Œä¹ŸçŸ¥é“ä¼˜åŠ£åŠ¿å’Œä½¿ç”¨åœºæ™¯äº†ï¼Œé‚£å¼€å¤´çš„é‚£ä¸ªé—®é¢˜å¤§å®¶å¿ƒé‡Œæœ‰ç­”æ¡ˆäº†ä¹ˆï¼Ÿ</p>
<p>ä»€ä¹ˆï¼Ÿè¿é—®é¢˜éƒ½å¿˜äº†ï¼Ÿé—®é¢˜ï¼šä¸ºä»€ä¹ˆä¸ç”¨é™æ€æ–¹æ³•è€Œç”¨å•ä¾‹æ¨¡å¼ï¼Ÿ</p>
<p>ä¸¤è€…å…¶å®éƒ½èƒ½å®ç°æˆ‘ä»¬åŠ è½½çš„æœ€ç»ˆç›®çš„ï¼Œä½†æ˜¯ä»–ä»¬ä¸€ä¸ªæ˜¯åŸºäºå¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯é¢å‘å¯¹è±¡çš„ï¼Œå°±åƒæˆ‘ä»¬ä¸é¢å‘å¯¹è±¡ä¹Ÿèƒ½è§£å†³é—®é¢˜ä¸€æ ·ï¼Œé¢å‘å¯¹è±¡çš„ä»£ç æä¾›ä¸€ä¸ªæ›´å¥½çš„ç¼–ç¨‹æ€æƒ³ã€‚</p>
<p>å¦‚æœä¸€ä¸ªæ–¹æ³•å’Œä»–æ‰€åœ¨ç±»çš„å®ä¾‹å¯¹è±¡æ— å…³ï¼Œé‚£ä¹ˆå®ƒå°±åº”è¯¥æ˜¯é™æ€çš„ï¼Œåä¹‹ä»–å°±åº”è¯¥æ˜¯éé™æ€çš„ã€‚å¦‚æœæˆ‘ä»¬ç¡®å®åº”è¯¥ä½¿ç”¨éé™æ€çš„æ–¹æ³•ï¼Œä½†æ˜¯åœ¨åˆ›å»ºç±»æ—¶åˆç¡®å®åªéœ€è¦ç»´æŠ¤ä¸€ä»½å®ä¾‹æ—¶ï¼Œå°±éœ€è¦ç”¨å•ä¾‹æ¨¡å¼äº†ã€‚</p>
<p>æˆ‘ä»¬çš„ç”µå•†ç³»ç»Ÿä¸­å°±æœ‰å¾ˆå¤šç±»ï¼Œæœ‰å¾ˆå¤šé…ç½®å’Œå±æ€§ï¼Œè¿™äº›é…ç½®å’Œå±æ€§æ˜¯ä¸€å®šå­˜åœ¨äº†ï¼Œåˆæ˜¯å…¬å…±çš„ï¼ŒåŒæ—¶éœ€è¦åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­éƒ½å­˜åœ¨ï¼Œæ‰€ä»¥åªéœ€è¦ä¸€ä»½å°±è¡Œï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœéœ€è¦æˆ‘å†éœ€è¦çš„æ—¶å€™newä¸€ä¸ªï¼Œå†ç»™ä»–åˆ†é…å€¼ï¼Œæ˜¾ç„¶æ˜¯æµªè´¹å†…å­˜å¹¶ä¸”å†èµ‹å€¼æ²¡ä»€ä¹ˆæ„ä¹‰ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬ç”¨å•ä¾‹æ¨¡å¼æˆ–é™æ€æ–¹æ³•å»ç»´æŒä¸€ä»½è¿™äº›å€¼æœ‰ä¸”åªæœ‰è¿™ä¸€ä»½å€¼ï¼Œä½†æ­¤æ—¶è¿™äº›é…ç½®å’Œå±æ€§åˆæ˜¯é€šè¿‡é¢å‘å¯¹è±¡çš„ç¼–ç æ–¹å¼å¾—åˆ°çš„ï¼Œæˆ‘ä»¬å°±åº”è¯¥ä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼Œæˆ–è€…ä¸æ˜¯é¢å‘å¯¹è±¡çš„ï¼Œä½†ä»–æœ¬èº«çš„å±æ€§åº”è¯¥æ˜¯é¢å¯¹å¯¹è±¡çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨é™æ€æ–¹æ³•è™½ç„¶èƒ½åŒæ ·è§£å†³é—®é¢˜ï¼Œä½†æ˜¯æœ€å¥½çš„è§£å†³æ–¹æ¡ˆä¹Ÿåº”è¯¥æ˜¯ä½¿ç”¨å•ä¾‹æ¨¡å¼ã€‚</p>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¾è®¡æ¨¡å¼ç³»åˆ—â€”â€”å·¥å‚æ¨¡å¼</title>
    <url>/2022/12/21/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E2%80%94%E2%80%94%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[<p>å­¦ä¹ æŠ€æœ¯æ·±åº¦çš„æ—¶å€™ï¼ˆçœ‹ä¸€äº›æ¡†æ¶çš„æºç ï¼‰æ€»æ„Ÿè§‰åªç†è§£äº†è¡¨é¢ï¼Œè€Œæ²¡æœ‰ç†è§£é‡Œé¢çš„æ€æƒ³ã€‚<br>è¿™é‡Œå¤§å®¶åº”è¯¥éƒ½çŸ¥é“æˆ‘æƒ³è¯´ä»€ä¹ˆï¼Œå°±æ˜¯è®¾è®¡æ¨¡å¼ã€‚</p>
<span id="more"></span>

<p>ä»Šå¤©èŠä¸€ä¸‹å·¥å‚æ¨¡å¼ï¼Œå·¥å‚æ¨¡å¼åœ¨æˆ‘ä»¬çš„ç”µå•†é¢†åŸŸçš„åº”ç”¨æ˜¯éå¸¸å¹¿æ³›çš„ï¼Œå†™ä¹‹å‰æˆ‘çœ‹äº†è‡ªå·±ç”µè„‘é¡¹ç›®çš„ä»£ç ï¼Œç¡®å®éšå¤„å¯è§ã€‚<br>å·¥å‚æ¨¡å¼ä¸»è¦å¯ä»¥åˆ†ä¸ºä¸‰å¤§ç±»ï¼š<br>ç®€å•å·¥å‚æ¨¡å¼<br>å·¥å‚æ–¹æ³•æ¨¡å¼<br>æŠ½è±¡å·¥å‚æ¨¡å¼</p>
<p>ä»Šå¤©æˆ‘ä¹Ÿä¸»è¦å›´ç»•è¿™ä¸‰ç§æ¨¡å¼æ¥ä¸¾ä¾‹äº†è§£ä¸€ä¸‹</p>
<h2 id="ç®€å•å·¥å‚æ¨¡å¼"><a href="#ç®€å•å·¥å‚æ¨¡å¼" class="headerlink" title="ç®€å•å·¥å‚æ¨¡å¼"></a>ç®€å•å·¥å‚æ¨¡å¼</h2><p>å·¥å‚æ¨¡å¼ä¸»è¦æ˜¯ç”¨äºå¯¹å®ç°é€»è¾‘çš„å°è£…ï¼Œå¹¶ä¸”é€šè¿‡å¯¹å…¬å…±çš„æ¥å£æä¾›å¯¹è±¡çš„å®ä¾‹åŒ–çš„æœåŠ¡ï¼Œåœ¨æˆ‘æ·»åŠ æ–°çš„ç±»æ—¶ä¸éœ€è¦å¤§åŠ¨å¹²æˆˆï¼Œåªè¦ä¿®æ”¹ä¸€ç‚¹å°±å¥½ã€‚</p>
<p>ä¸¾ä¸ªç”µå•†ä¸šåŠ¡æ˜¯æ€ä¹ˆåˆ›å»ºå•†å“çš„ï¼š<br><a href="https://imgse.com/i/zXVPc8"><img src="https://s1.ax1x.com/2022/12/21/zXVPc8.jpg" alt="zXVPc8.jpg"></a><br>åœ¨è¿™ä¸ªç®€å•å·¥å‚é‡Œé¢ï¼Œå¦‚æœè¦åˆ›å»ºæ´»åŠ¨å•†å“1ä»¥åŠæ´»åŠ¨å•†å“2ï¼Œæˆ‘ä»¬è¦åˆ›å»ºå•†å“çš„æ—¶å€™åªè¦è°ƒç”¨ç®€å•å·¥å‚é‡Œé¢çš„åˆ›å»ºå•†å“æ–¹æ³•ï¼Œæ ¹æ®ç±»å‹åˆ›å»ºå‡ºä¸åŒçš„å•†å“ç„¶åå®ä¾‹åŒ–è¿”å›å°±å¯ä»¥äº†ã€‚</p>
<p>ç®€å•å·¥å‚å‡ ç§å®ç°æ–¹å¼ï¼š</p>
<h3 id="é™æ€å·¥å‚æ¨¡å¼"><a href="#é™æ€å·¥å‚æ¨¡å¼" class="headerlink" title="é™æ€å·¥å‚æ¨¡å¼"></a>é™æ€å·¥å‚æ¨¡å¼</h3><p>æˆ‘ä»¬è¿˜æ˜¯ä»¥åˆ›å»ºå•†å“ä¸ºä¾‹å­</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class SimpleFacttory &#123;</span><br><span class="line">	public static Share createProduct(EnumProdutType type) &#123;</span><br><span class="line">		if (EnumProductType.activityone.equals(type)) &#123;</span><br><span class="line">			return new ProductOne();</span><br><span class="line">		&#125; else if (EnumProductType.acctivityTwo.equals(type)) &#123;</span><br><span class="line">			return new ProductTwo();</span><br><span class="line">		&#125;</span><br><span class="line">		return null;</span><br><span class="line">	&#125;</span><br><span class="line">	public enum EnumProductType &#123;</span><br><span class="line">		activituOne, activityTwo;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹å¼åˆ›å»ºçœ‹èµ·æ¥å…¶å®ä¹Ÿæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œæ ¹æ®ç±»å‹åˆ›å»ºä¸åŒçš„å•†å“ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ä¸çŸ¥é“å¤§å®¶å‘ç°æ²¡æœ‰ï¼Ÿ</p>
<p>æ˜¯ä¸æ˜¯æˆ‘æ²¡å¢åŠ ä¸€ç§ç±»å‹è¿˜è¦å»createProductæ–¹æ³•ä¸Šä¿®æ”¹if elseï¼Ÿè¿™ä¸æ˜¯è¿èƒŒæˆ‘ä»¬çš„å¼€é—­åŸåˆ™å—ï¼Ÿ</p>
<p>æ‰€ä»¥è¿™ç§æ–¹å¼ä¸å¥½ï¼Œæˆ‘ä»¬è¿˜æœ‰æ¥ä¸‹æ¥çš„ä¸¤ç§ï¼š<br>ä½¿ç”¨åå°„æœºåˆ¶<br>ç›´æ¥æ³¨å†Œå•†å“å¯¹è±¡ï¼Œæ·»åŠ ä¸€ä¸ªTypeç±»å‹æ–¹æ³•ï¼Œæ ¹æ®typeç±»å‹è¿”å›è‡ªèº«ç›¸åŒç±»å‹çš„æ–¹æ³•ã€‚åŒæ ·çš„æˆ‘ä»¬è¿˜æ˜¯ä»¥åˆ›å»ºå•†å“ä¸ºä¾‹ï¼šåå°„å®ç°<br>åŒæ ·çš„æˆ‘ä»¬è¿˜æ˜¯ä»¥åˆ›å»ºå•†å“ä¸ºä¾‹ï¼šåå°„å®ç°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class SimpleFactoryReflection &#123;</span><br><span class="line"></span><br><span class="line">    private static final Map&lt;EnumProductType, Class&gt; activityIdMap = new HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    public  static void addProductKey(EnumProductType EnumProduct, Class product) &#123;</span><br><span class="line">        activityIdMap.put(EnumProduct, product);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static activityOne product(EnumProductType type) throws IllegalAccessException, InstantiationException &#123;</span><br><span class="line">        Class productClass = activityIdMap.get(type);</span><br><span class="line">        return (activityOne) productClass.newInstance();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws InstantiationException, IllegalAccessException &#123;</span><br><span class="line">        addProductKey(EnumProductType.activityOne, activityOne.class);</span><br><span class="line">        activityOne product = product(EnumProductType.activityOne);</span><br><span class="line">        System.out.println(product.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static class Producet&#123;</span><br><span class="line">        private String name;</span><br><span class="line">        public String getName() &#123;</span><br><span class="line">            return name;</span><br><span class="line">        &#125;</span><br><span class="line">        public void setName(String name) &#123;</span><br><span class="line">            this.name = name;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static class activityOne extends Producet &#123;</span><br><span class="line">        private String stock;</span><br><span class="line">        @Override</span><br><span class="line">        public String toString() &#123;</span><br><span class="line">            return &quot;activityOne&#123;&quot; +</span><br><span class="line">                    &quot;stock=&#x27;&quot; + stock + &#x27;\&#x27;&#x27; +</span><br><span class="line">                    &#x27;&#125;&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public class activityTwo extends Producet &#123;</span><br><span class="line">        private String stock;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public enum EnumProductType &#123;</span><br><span class="line">        activityOne, activityTwo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>çœ‹ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘å‘ç°åå°„å…¶å®ä¹Ÿå¾ˆå®¹æ˜“å°±å®ç°äº†ï¼Œä½†æ˜¯åœ¨ä¸€äº›ç‰¹å®šçš„æƒ…å†µä¸‹ï¼Œå¹¶ä¸é€‚ç”¨ï¼Œè€Œä¸”åœ¨æŸäº›ç‰¹å®šçš„æƒ…å†µä¸‹æ˜¯æ— æ³•å®ç°çš„ï¼Œè€Œä¸”åå°„æœºåˆ¶ä¹Ÿä¼šé™ä½ç¨‹åºçš„è¿è¡Œæ•ˆæœï¼Œåœ¨å¯¹æƒ³èƒ½è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ä¸‹åº”è¯¥é¿å…è¿™ç§å®ç°ã€‚</p>
<p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ä½¿ç”¨åå°„ä¸å½“æ˜¯å¾ˆå®¹æ˜“å¯¼è‡´çº¿ä¸Šæœºå™¨å‡ºé—®é¢˜çš„ï¼Œå› ä¸ºæˆ‘ä»¬åå°„åˆ›å»ºçš„å¯¹è±¡å±æ€§æ˜¯è¢«SoftReferenceè½¯å¼•ç”¨çš„ï¼Œæ‰€ä»¥å½“**-XX:SoftRefLRUPolicyMSPerMB**æ²¡æœ‰è®¾ç½®å¥½çš„è¯ï¼Œä¼šè®©æœºå™¨çš„CPUä¸€ç›´å¾ˆé«˜ã€‚å½“ç„¶å®ƒçš„é»˜è®¤å€¼æ˜¯1000ï¼Œä¹Ÿå°±æ ¹æ®å¤§å®¶çš„æƒ…å†µè€Œå®šå§ã€‚</p>
<p>å‰©ä¸‹çš„ä¸€ç§å…¶å®è·Ÿåå°„å®ç°å¾ˆåƒï¼Œå°±æ˜¯ä¸ºäº†é¿å…ä½¿ç”¨åå°„ï¼Œåœ¨Mapçš„å¯¹è±¡ä¸­ä¸æ˜¯å­˜çš„è¦æ·»åŠ çš„ç±»ï¼Œè€Œæ˜¯å°†è¦æ·»åŠ çš„æ¯ç§ç±»å¯¹è±¡å®ä¾‹ï¼Œè¿™ä¸ªå°±ä¸å†™demoäº†ã€‚</p>
<h3 id="å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="å·¥å‚æ–¹æ³•æ¨¡å¼"></a>å·¥å‚æ–¹æ³•æ¨¡å¼</h3><p>å·¥å‚æ–¹æ³•æ¨¡å¼æ˜¯å¯¹é™æ€å·¥å‚æ¨¡å¼ä¸Šçš„ä¸€ç§æ”¹è¿›ï¼Œæˆ‘ä»¬å·¥å‚ç±»ç›´æ¥è¢«æŠ½è±¡åŒ–ï¼Œéœ€è¦å…·ä½“ç‰¹å®šåŒ–çš„é€»è¾‘ä»£ç è½¬ç§»åˆ°å®ç°æŠ½è±¡æ–¹æ³•çš„å­ç±»ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸è¦å†å»ä¿®æ”¹å·¥å‚ç±»ï¼ˆå³ï¼šä¸ç”¨å†å»åšä»€ä¹ˆif elseä¿®æ”¹ï¼‰è¿™ä¹Ÿæ˜¯æˆ‘ä»¬å½“å‰æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§æ–¹å¼ã€‚<br>è¿˜æ˜¯ä»¥æˆ‘ä»¬åˆ›å»ºå•†å“ä¸ºä¾‹ï¼š<br><a href="https://imgse.com/i/zxHvsP"><img src="https://s1.ax1x.com/2022/12/26/zxHvsP.jpg" alt="zxHvsP.jpg"></a><br>çœ‹è¿™å¼ å›¾ï¼Œå…¶å®è¯´ç™½äº†å°±æ˜¯å†åˆ›å»ºä¸€ä¸ªå·¥å‚ï¼Œç”¨æ¥åˆ›å»ºå·¥å‚ç±»å¯¹è±¡<br>æ¥ä¸‹æ¥çœ‹ä»£ç å®ç°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public abstract class FactoryMethod &#123;</span><br><span class="line"></span><br><span class="line">    protected abstract Product createProduct(String name);</span><br><span class="line"></span><br><span class="line">    public Product product(String activity, String name) &#123;</span><br><span class="line">        Product product = createProduct(activity);</span><br><span class="line">        product.setProductName(name);</span><br><span class="line">        return product;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static class Product &#123;</span><br><span class="line">        public String productName;</span><br><span class="line"></span><br><span class="line">        public String getProductName() &#123;</span><br><span class="line">            return productName;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setProductName(String productName) &#123;</span><br><span class="line">            this.productName = productName;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public enum EnumProductType &#123;</span><br><span class="line">        activityOne(&quot;one&quot;),</span><br><span class="line">        activityTwo(&quot;two&quot;);</span><br><span class="line"></span><br><span class="line">        private String name;</span><br><span class="line"></span><br><span class="line">        EnumProductType(String name) &#123;</span><br><span class="line">            this.name = name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public String getName() &#123;</span><br><span class="line">            return name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setName(String name) &#123;</span><br><span class="line">            this.name = name;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå…ˆåˆ›å»ºä¸€ä¸ªæŠ½è±¡å·¥å‚æ–¹æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class ProductFactory extends FactoryMethod&#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected Product createProduct(String activityId) &#123;</span><br><span class="line">        if (EnumProductType.activityOne.getName().equals(activityId)) &#123;</span><br><span class="line">            //è¿™é‡Œå¯ä»¥å¤„ç†æˆ‘ä»¬è‡ªå·±çš„æƒ³è¦çš„ä¸šåŠ¡é€»è¾‘ä»£ç </span><br><span class="line">            return new OneProduct();</span><br><span class="line">        &#125; else if (EnumProductType.activityTwo.getName().equals(activityId)) &#123;</span><br><span class="line">            return new TwoProduct();</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static class OneProduct extends Product &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static class TwoProduct extends Product &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        FactoryMethod factoryMethod = new ProductFactory();</span><br><span class="line">        Product product = factoryMethod.product(&quot;one&quot;, &quot;one&quot;);</span><br><span class="line">        System.out.println(product.getProductName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†åˆ›å»ºä¸€ä¸ªå•†å“å·¥å‚å»ç»§æ‰¿æŠ½è±¡å·¥å‚æ–¹æ³•ã€‚</p>
<p>å½“è¿˜æœ‰å…¶ä»–ç±»å‹çš„æ—¶å€™æˆ‘ä»¬åªéœ€è¦å»ç»§æ‰¿æˆ‘ä»¬åˆ›å»ºçš„å·¥å‚æ–¹æ³•å°±å¯ä»¥äº†ã€‚<br>è¿™ä¸ªä»£ç å¤§å®¶è‚¯å®šéƒ½èƒ½å®ç°å‡ºæ¥ï¼Œä½†æ˜¯æˆ‘ä»¬çœŸæ­£éœ€è¦å­¦ä¹ çš„æ˜¯å‰è¾ˆä»¬è¿™ç§å·¥å‚æ¨¡å¼çš„æ€æƒ³ã€‚æŠŠè¿™ç§æ€æƒ³è¿ç”¨åˆ°æˆ‘ä»¬çœŸå®çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå­¦ä»¥è‡´ç”¨æ‰èƒ½å¯¹æˆ‘ä»¬æœ‰çœŸæ­£çš„æå‡ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­</p>
<p>å‡è®¾ç°åœ¨éœ€è¦åšä¸€ä¸ªåˆ†äº«å•†å“å›¾ç‰‡ï¼Œæˆ‘ä»¬çŸ¥é“å•†å“çš„ç±»å‹æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚æ— SKUå•†å“ï¼Œæœ‰SKUå•†å“ï¼Œä¸‹å•åˆ†äº«ï¼Œé‚€è¯·åˆ†äº«â€¦ç­‰ä¸€ä¸‹åˆ—çš„åœºæ™¯ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆå»è®¾è®¡è¿™ä¸ªä»£ç åšåˆ°æ›´åŠ çš„æ˜“æ‡‚ï¼Œæ˜“è¯»ï¼Œä»Šåæ‰©å±•æ€§å¥½å‘¢ï¼Ÿ<br>æ³¨ï¼šskuå’Œspuæ˜¯ç”µå•†é‡Œé¢çš„åè¯ï¼Œspuå·®ä¸å¤šè·Ÿitemä¹Ÿå°±æ˜¯å•†å“æ˜¯ä¸€ä¸ªç»´åº¦ï¼Œä¸€ä¸ªå•†å“itemæœ‰å¾ˆå¤šskuï¼Œæ¯”å¦‚ï¼šiphoneæ˜¯ä¸€ä¸ªå•†å“æ˜¯itemä¹Ÿæ˜¯spuï¼Œç™½è‰²çš„iphone 12 64Gå°±æ˜¯ä¸€ä¸ªå…·ä½“çš„sku</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public interface Share &#123;</span><br><span class="line">    //è·å–åˆ†äº«ç±»å‹</span><br><span class="line"></span><br><span class="line">    String getShareFunctionType();</span><br><span class="line"></span><br><span class="line">    String mainProcess(String shareName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€æ­¥æˆ‘ä»¬åº”è¯¥éƒ½æ˜¯å®šä¹‰ä¸€ä¸ªåˆ›å»ºåˆ†äº«æ¨¡æ¿</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class ShareFactory &#123;</span><br><span class="line">    private List&lt;Share&gt; shareFunctionList;</span><br><span class="line"></span><br><span class="line">    //æ ¹æ®åˆ†äº«ç±»å‹è·å–å¯¹åº”çš„åˆ†äº«å¤„ç†æ–¹å¼</span><br><span class="line">    public Share getShareFunction(String type) &#123;</span><br><span class="line">        for(Share shareFunction : shareFunctionList) &#123;</span><br><span class="line">            if (shareFunction.getShareFunctionType().equals(type)) &#123;</span><br><span class="line">                return shareFunction;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public enum EnumShareType &#123;</span><br><span class="line">        SUCCESS_ORDER(&quot;successOrder&quot;);</span><br><span class="line">        private String name;</span><br><span class="line"></span><br><span class="line">        EnumShareType(String name) &#123;</span><br><span class="line">            this.name = name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public String getName() &#123;</span><br><span class="line">            return name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setName(String name) &#123;</span><br><span class="line">            this.name = name;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒæ­¥æˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªåˆ†äº«å·¥å‚æ ¹æ®æˆ‘ä»¬çš„ç±»å‹è·å–æˆ‘ä»¬é¢„å…ˆåŠ è½½åœ¨Springå®¹å™¨ä¸­çš„beanå®ä¾‹<br>public class SuccessOrderShare implements Share {<br>    public String getShareFunctionType() {<br>        return ShareFactory.EnumShareType.SUCCESS_ORDER.getName();<br>    }</p>
<pre><code>public String mainProcess(String shareName) &#123;
    return shareNmae;
&#125;
</code></pre>
<p>}<br><a href="https://imgse.com/i/pSCBWPf"><img src="https://s1.ax1x.com/2023/01/01/pSCBWPf.jpg" alt="pSCBWPf.jpg"></a></p>
<p>æœ€åå°±æ˜¯å®šä¹‰æˆ‘ä»¬ä¸åŒçš„ç±»å‹æ¥å®ç°åˆ†äº«å›¾ç‰‡ã€‚<br>å…¶å®æˆ‘ä»¬å­¦ä¹ è®¾è®¡æ¨¡å¼å°±æ˜¯è¿™ç§æ€æƒ³ï¼Œæœ‰äº†è¿™ç§æ€æƒ³ä¸Šé¢æåˆ°çš„ä¸‰ç‚¹åˆæ˜¯æ‰èƒ½ä½“ç°å‡ºæ¥å¯¹æˆ‘ä»¬ä»Šåçš„æˆé•¿ï¼Œé¢å¯¹å¤æ‚ä¸šåŠ¡è®¾è®¡ä»¥åŠæ€è€ƒèƒ½åŠ›æ‰èƒ½æå‡ã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä»€ä¹ˆæ—¶å€™æ”¹ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œè€Œéç®€å•å·¥å‚æ¨¡å¼å‘¢ï¼Ÿ<br>è¿™é‡Œå¼•ç”¨è®¾è®¡æ¨¡å¼ä¹‹ç¾é‡Œé¢çš„ä¸€å¥è¯ï¼šå½“å¯¹è±¡çš„åˆ›å»ºé€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œä¸åªæ˜¯ç®€å•çš„newä¸€ä¸‹å°±å¯ä»¥ï¼Œè€Œæ˜¯è¦ç»„åˆå…¶ä»–ç±»å¯¹è±¡ï¼Œåšå„ç§åˆå§‹åŒ–æ“ä½œçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œå°†å¤æ‚çš„åˆ›å»ºé€»è¾‘æ‹†åˆ†åˆ°å¤šä¸ªå·¥å‚ç±»ä¸­ï¼Œè®©æ¯ä¸ªå·¥å‚ç±»éƒ½ä¸è‡³äºè¿‡äºå¤æ‚ã€‚<br>è€Œä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼ï¼Œå°†æ‰€æœ‰çš„åˆ›å»ºé€»è¾‘éƒ½æ”¾åˆ°ä¸€ä¸ªå·¥å‚ç±»ä¸­ï¼Œä¼šå¯¼è‡´è¿™ä¸ªå·¥å‚ç±»å˜å¾—å¾ˆå¤æ‚ã€‚</p>
<h2 id="æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="æŠ½è±¡å·¥å‚æ¨¡å¼"></a>æŠ½è±¡å·¥å‚æ¨¡å¼</h2><p>çœ‹å®Œå·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œåœ¨ç†è§£æŠ½è±¡å·¥å‚æ¨¡å¼å°±æ›´åŠ ç®€å•ï¼Œå› ä¸ºå®ƒå…¶å®å°±æ˜¯å·¥å‚æ–¹æ³•çš„ä¸€ä¸ªå»¶ä¼¸ã€‚<br>å·¥å‚æ–¹æ³•ç±»ä¸­åªæœ‰ä¸€ä¸ªå”±å“æ–¹æ³•ï¼Œè¦æƒ³å®ç°å¤šç§ä¸åŒçš„ç±»å¯¹è±¡ï¼Œåªèƒ½å»åˆ›å»ºä¸åŒçš„å…·ä½“å·¥å‚æ–¹æ³•çš„å­ç±»æ¥å®ä¾‹åŒ–ï¼Œè€ŒæŠ½è±¡å·¥å‚åˆ™æ˜¯è®©ä¸€ä¸ªå·¥å‚è´Ÿè´£åˆ›å»ºå¤šä¸ªä¸åŒç±»å‹çš„å¯¹è±¡ã€‚<br><a href="https://imgse.com/i/pSCDpL9"><img src="https://s1.ax1x.com/2023/01/01/pSCDpL9.jpg" alt="pSCDpL9.jpg"></a><br>æ ·å­å¯èƒ½æœ‰ç‚¹ä¸‘ï¼Œä½†æ˜¯èƒ½è¯´æ˜é—®é¢˜ï¼Œå…¶å®çœ‹ä¸Šå»å¯ä»¥åˆ†ä¸ºä»¥ä¸Šå‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š<br>æŠ½è±¡å·¥å‚ç±»<br>å…·ä½“å·¥å‚ç±»<br>æŠ½è±¡ç±»<br>æŠ½è±¡å·¥å‚ç±»æˆ‘ä¸ªäººå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªåˆšå‡ºå‚çš„æ‰‹æœºï¼Œå…·ä½“æŠ½è±¡å·¥å‚åˆ™æ˜¯è®¤ä¸ºæ˜¯æˆ‘ä»¬æ¯ä¸ªäººå¯¹è¿™ä¸ªæ‰‹æœºå£çº¸è‡ªå®šä¹‰è®¾ç½®ï¼Œæœ€åæŠ½è±¡ç±»æˆ‘ç†è§£å°±æ˜¯æ‰‹æœºå£çº¸ã€‚<br>æˆ‘ä»¬æ¯ä¸ªäººå¯ä»¥è‡ªå®šä¹‰ä¸åŒçš„å£çº¸ï¼šä¾‹å¦‚åŠ¨å›¾ï¼Œé™å›¾é£æ™¯ç­‰ç­‰ã€‚</p>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¾è®¡æ¨¡å¼ç³»åˆ—â€”â€”æµç¨‹å¼•æ“</title>
    <url>/2023/01/01/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%B3%BB%E5%88%97%E2%80%94%E2%80%94%E6%B5%81%E7%A8%8B%E5%BC%95%E6%93%8E/</url>
    <content><![CDATA[<p>åœ¨ç”µå•†é‡Œé¢å¤„ç†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘åœºæ™¯æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬è¿˜æ˜¯ä»¥åˆ›å»ºå•†å“ä¸ºä¾‹å­ã€‚å¾ˆå¤šäººå¯èƒ½ä¼šé—®åˆ›å»ºå•†å“å¾ˆå¤æ‚å—ï¼Ÿ</p>
<span id="more"></span>

<p>åˆ›å»ºå•†å“çš„æµç¨‹ï¼š<br>å‚æ•°å¿…å¡«æ€§æ ¡éªŒ<br>å‚æ•°æ•°æ®è½¬æ¢<br>å•†å“åŸºç¡€ä¿¡æ¯æ ¡éªŒ<br>å•†å“ä¸å•†å®¶ä¹‹é—´çš„æ ¡éªŒ<br>ç±»ç›®ä¿¡æ¯æ ¡éªŒ<br>å•†å“äº¤æ˜“ä¿¡æ¯æ ¡éªŒï¼ˆè¿™ä¸ªçœ‹å…¬å¸ä¸šåŠ¡å†³å®šï¼‰<br>SKUç›¸å…³ä¿¡æ¯æ ¡éªŒ<br>å•†å“æ˜¯å¦éœ€è¦æœ‰ç‰¹å®šæ ‡ç­¾æ ¡éªŒï¼ˆçœ‹å…¬å¸ä¸šåŠ¡å†³å®šï¼‰<br>å•†å“ç±»å‹æ ¡éªŒï¼ˆæ™®é€šï¼Œå¡ç‰‡ï¼Œè§†é¢‘â€¦â€¦.ï¼‰<br>å•†å“é£æ§æ ¡éªŒ<br>ä¿å­˜å•†å“ä¿¡æ¯<br>ä¿å­˜SKUä¿¡æ¯<br>ä¿å­˜å•†å“è¯¦æƒ…ä¿¡æ¯<br>é‡é‡æ¨¡ç‰ˆ<br>è¿è´¹<br>é…é€åŒºåŸŸ<br>ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚<br>è¿™é‡Œå•†å“ç±»å‹é‡Œé¢è¿˜æ¶‰åŠåˆ°å„ä¸ªä¸šåŠ¡åœºæ™¯æ ¡éªŒï¼Œæˆ‘ä»¬å°±å…ˆä¸è°ˆäº†ã€‚é’ˆå¯¹è¿™æ ·çš„æƒ…å†µæˆ‘ä»¬åº”è¯¥æ€ä¹ˆå»å†™è¿™ä¸ªä»£ç å‘¢ï¼Ÿæˆ‘ç¿»çœ‹äº†ä¸€ä¸‹ä»¥å‰å¤§å­¦å†™çš„ä¸€äº›ä»£ç æ•´ä½“çš„ä»£ç æ ¼å¼å¤§æ¦‚ä¹Ÿå°±æ˜¯è¿™ä¸ªæ ·å­<br><a href="https://imgse.com/i/pSCrA7n"><img src="https://s1.ax1x.com/2023/01/01/pSCrA7n.jpg" alt="pSCrA7n.jpg"></a><br>è¿™ä¹ˆå†™å…¶å®ä¹Ÿæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼ŒåŠŸèƒ½ä¹Ÿèƒ½å®ç°ã€‚ä½†æ˜¯è¿™ä¹ˆå†™å…¶å®æœ‰å¾ˆå¤šå¼Šç«¯ï¼š<br>1.ä»£ç å¯è¯»æ€§ä¸é«˜<br>2.ä»£ç æ‰©å±•æ€§ä¸é«˜<br>3.è€¦åˆæ€§å¤ªå¼ºï¼Œæœ‰äº›ä¸œè¥¿ä¸å¥½å…¬ç”¨<br>4.æ•´ä½“åˆ›å»ºæ‰§è¡Œæµç¨‹äº‹ä»¶å¤ªé•¿ï¼Œä¸²è¡Œè°ƒç”¨ä¸‹æ¸¸æœåŠ¡</p>
<p> çœ‹åˆ°è¿™æ ·ä»£ç æˆ‘ä»¬é¦–å…ˆéƒ½æ˜¯åæ§½ä¸€ç•ªï¼Œç„¶åè¿˜æ˜¯è€è€å®å®å»æ”¹ï¼Œæœ‰åŠ¨æ‰‹èƒ½åŠ›å¼ºçš„ä¼šæƒ³ç€å»ä¼˜åŒ–ä¸€ä¸‹ã€‚å†çœ‹çœ‹è¿™ä¸ªæµç¨‹ï¼Œå…¶å®åœ¨åˆ›å»ºå•†å“çš„æ—¶å€™æˆ‘ä»¬å¾ˆå¤šæ ¡éªŒå’Œä¿å­˜æ•°æ®æ˜¯æ²¡æœ‰ä¾èµ–ä¸”äº’ä¸å½±å“çš„ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥å»å¹¶è¡Œæ‰§è¡Œã€‚</p>
<p>èŠ‚çœåˆ›å»ºå•†å“çš„æµç¨‹æ—¶é—´ï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€‚ï¼ˆPSï¼šå°±å¥½æ¯”ä¸¤æ¡å‘Šè¯‰ä¸€æ¡å µè½¦ï¼Œä¸€æ¡ç•…é€šæ— é˜»ï¼Œé€‰å“ªæ¡ï¼Ÿï¼‰<br>æ‰€ä»¥é’ˆå¯¹è¿™ä¹ˆå¹¶è¡Œé—®é¢˜æˆ‘è¿˜æ˜¯ç»™å¤§å®¶ç”»äº†ä¸€ä¸ªæµç¨‹å›¾ï¼š<br><a href="https://imgse.com/i/pSCsXJP"><img src="https://s1.ax1x.com/2023/01/01/pSCsXJP.jpg" alt="pSCsXJP.jpg"></a><br>é€šè¿‡è¿™å¼ å›¾æˆ‘ä»¬çœ‹åˆ°åˆ›å»ºä¸€ä¸ªå•†å“æµç¨‹ï¼Œæˆ‘ä»¬è°ƒç”¨çš„ä¸‹æ¸¸æœåŠ¡å¯èƒ½æ˜¯æœ‰åå‡ äºŒåå‡ æˆ–è€…æ›´å¤šï¼Œå‡è®¾æˆ‘ä»¬ä¸€æ¬¡RPCè°ƒç”¨çš„å¹³å‡è¿”å›æ—¶é—´æ˜¯50æ¯«ç§’ï¼Œä¸²è¡Œæ‰§è¡Œæ—¶é—´å¯èƒ½å°±1-2ç§’äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¹¶è¡Œæ‰§è¡Œçš„è¯ä¹Ÿå°±200åˆ°300æ¯«ç§’äº†ã€‚</p>
<p>æ‰€ä»¥æœ¬ç€è¿™ç§æ€æƒ³å¯èƒ½ä¼šæœ‰äººé—®ï¼Œä¸ºä»€ä¹ˆæˆ‘ä¸èƒ½å¼‚æ­¥ï¼Œä¸èƒ½ç”¨æ¶ˆæ¯ï¼Ÿåˆ›å»ºå•†å“å‡è®¾ç”¨å¼‚æ­¥æ¶ˆæ¯çš„è¯ï¼Œå¦‚æœæ¶ˆè´¹å¤±è´¥é‚£ç”¨æˆ·åˆ›å»ºå•†å“æˆåŠŸä¿å­˜å…¶ä»–ä¿¡æ¯å¤±è´¥äº†ï¼Œé‚£å¯¹ç”¨æˆ·æ¥è¯´ä¸æ˜¯ä½“éªŒæ›´åŠ ä¸å¥½äº†</p>
<p>è¯´äº†è¿™ä¹ˆå¤šå¼€å§‹æ’¸ä»£ç ï¼š<br><a href="https://imgse.com/i/pSCykiq"><img src="https://s1.ax1x.com/2023/01/01/pSCykiq.jpg" alt="pSCykiq.jpg"></a><br>å…ˆåˆ›å»ºä¸€ä¸ªContextä¸Šä¸‹æ–‡ï¼Œä½œä¸ºæˆ‘ä»¬è°ƒç”¨ä¸‹æ¸¸æœåŠ¡çš„è¿”å›ç»“æœ<br><a href="https://imgse.com/i/pSCyAJ0"><img src="https://s1.ax1x.com/2023/01/01/pSCyAJ0.jpg" alt="pSCyAJ0.jpg"></a><br>ç¬¬äºŒæ­¥åˆ›å»ºæˆ‘ä»¬çš„æµç¨‹èŠ‚ç‚¹ï¼Œè¿™ç›¸å½“äºå°±æ˜¯ä¿å­˜æˆ‘ä»¬æ•´ä¸ªæµç¨‹ä¸­éœ€è¦æ‰§è¡Œä¸‹æ¸¸æœåŠ¡çš„èŠ‚ç‚¹ï¼Œä»¥Mapä½œä¸ºä¿å­˜æ•°æ®ï¼ŒNodeConfèŠ‚ç‚¹è®¾ç½®å‚æ•°ï¼Œè‡ªå®šä¹‰è¯·æ±‚æœåŠ¡å™¨è¶…æ—¶æ—¶é—´ï¼ˆå› ä¸ºå¹¶è¡Œæˆ‘ä»¬ç”¨çš„çº¿ç¨‹æ± æˆ–è€…é€šè¿‡getè®¾ç½®æ—¶é—´getè¿”å›å€¼ç»“æœï¼‰<br><a href="https://imgse.com/i/pSPnMDJ"><img src="https://s1.ax1x.com/2023/01/02/pSPnMDJ.jpg" alt="pSPnMDJ.jpg"></a><br>ç¬¬ä¸‰æ­¥å¼•æ“ç±»ï¼Œè¿™ä¸ªä¹Ÿæ˜¯æˆ‘ä»¬çš„æ ¸å¿ƒç±»ã€‚é€šè¿‡æˆ‘ä»¬æ·»åŠ çš„nodeèŠ‚ç‚¹åˆ¤æ–­æˆ‘ä»¬å“ªäº›æµç¨‹æ˜¯éœ€è¦ä¸²è¡Œçš„å“ªäº›æ˜¯éœ€è¦å¹¶è¡Œçš„ï¼Œé€šè¿‡çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹æ”¾å…¥Featureä¸­ï¼Œæ¥1è¾¾åˆ°åŒæ­¥æ‰§è¡Œçš„æ•ˆæœ</p>
<p>åœ¨ä½¿ç”¨çº¿ç¨‹æ± çš„æ—¶å€™æˆ‘ä»¬éœ€è¦è€ƒè™‘ä¸è¦è®¾ç½®çš„å‚æ•°è¿‡å¤§ï¼Œå¼€å¯å¦å¤–çš„çº¿ç¨‹ä¹Ÿæ˜¯ä¼šå ç”¨æœºå™¨å†…å­˜çš„ï¼Œä¸€ä¸ªçº¿ç¨‹æŒ‰ç…§1å…†æ¥ç®—çš„è¯ï¼Œä½ å¼€å¯å‡ ç™¾ä¸Šåƒä¸ªï¼Œä¹Ÿä¼šå ç”¨å¾ˆå¤§ä¸€éƒ¨åˆ†å†…å­˜ã€‚å°½å¯èƒ½çš„å»é‡‡ç”¨æ± åŒ–çš„æ€æƒ³ï¼Œè¿™é‡Œå°±æŒ‰å¤§å®¶å®é™…åœºæ™¯å»åšæµ‹è¯•äº†ã€‚</p>
<p><a href="https://imgse.com/i/pSPnJC6"><img src="https://s1.ax1x.com/2023/01/02/pSPnJC6.jpg" alt="pSPnJC6.jpg"></a><br>ç¬¬å››æ­¥æ‰§è¡Œcallæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œæˆ‘ä»¬çš„nodeèŠ‚ç‚¹</p>
<p><a href="https://imgse.com/i/pSPnY8K"><img src="https://s1.ax1x.com/2023/01/02/pSPnY8K.jpg" alt="pSPnY8K.jpg"></a><br>ç¬¬äº”æ­¥åˆ›å»ºèŠ‚ç‚¹æ¥å£ï¼Œè¿™é‡Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªResultKeyï¼Œè¿™ä¸ªKeyä¹Ÿå°±æ˜¯è·Ÿæˆ‘æµç¨‹ä¸­çš„è¿™ä¸ªèŠ‚ç‚¹ç»‘å®šï¼Œåœ¨è·å–æ•°æ®çš„æ—¶å€™ä¹Ÿå°±æ˜¯é€šè¿‡è¿™ä¸ªkeyæ¥æ ‡è¯†</p>
<p><a href="https://imgse.com/i/pSPnNvD"><img src="https://s1.ax1x.com/2023/01/02/pSPnNvD.jpg" alt="pSPnNvD.jpg"></a><br>ç¬¬å…­æ­¥å› ä¸ºæˆ‘ä»¬åœ¨èŠ‚ç‚¹é‡Œé¢å­˜çš„Classç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—é€šè¿‡å®ç°ApplicationContextAwareç±»æ¥è·å–Springå®¹å™¨ä¸­å¾—beanå®ä¾‹</p>
<p><a href="https://imgse.com/i/pSPn68f"><img src="https://s1.ax1x.com/2023/01/02/pSPn68f.jpg" alt="pSPn68f.jpg"></a><br>ç¬¬ä¸ƒæ­¥é‚£å°±æ˜¯æ¥åˆ›å»ºä¸¤ä¸ªæµ‹è¯•nodeèŠ‚ç‚¹</p>
<p><a href="https://imgse.com/i/pSPRVmT"><img src="https://s1.ax1x.com/2023/01/02/pSPRVmT.jpg" alt="pSPRVmT.jpg"></a><br><a href="https://imgse.com/i/pSPRZ0U"><img src="https://s1.ax1x.com/2023/01/02/pSPRZ0U.jpg" alt="pSPRZ0U.jpg"></a><br>æœ€åå½“ç„¶å°±æ˜¯æˆ‘ä»¬å¾—æµ‹è¯•ç»“æœäº†ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªèŠ‚ç‚¹NodeOneå’ŒNodeTwoä½œä¸ºæ¨¡æ‹ŸçœŸå®ä¸šåŠ¡åœºæ™¯å¾—èŠ‚ç‚¹ï¼Œé€šè¿‡ä¸€ä¸ªåé¢å¾—threeä½œä¸ºä¸€ä¸ªgroupéœ€è¦å¹¶æ‰§è¡Œçš„èŠ‚ç‚¹ã€‚<br>çœ‹å®Œä»£ç æœ€åå†ç»™å¤§å®¶æ¥ä¸€ä¸ªæ€»ä½“çš„æµç¨‹å›¾å§<br><a href="https://imgse.com/i/pSPRutJ"><img src="https://s1.ax1x.com/2023/01/02/pSPRutJ.jpg" alt="pSPRutJ.jpg"></a><br>çœ‹å®Œæ˜¯ä¸æ˜¯è§‰å¾—æ„Ÿè§‰è‡ªå·±é¡¿æ‚Ÿï¼Œä»¥åé¢å¯¹å†å¤æ‚çš„æµç¨‹ä¸šåŠ¡ä¹Ÿèƒ½æ‹¿ä¸‹äº†ã€‚</p>
<p>æ€è€ƒï¼š<br>å…¶å®è¿™é‡Œè¿˜æœ‰å¾ˆå¤šä¼˜åŒ–ç‚¹ï¼Œæ¯ä¸ªäººé‡åˆ°çš„å¤æ‚çš„åœºæ™¯å¯èƒ½ä¹Ÿä¸ä¸€æ ·ï¼Œåªèƒ½è¯´ç»™å¤§å®¶æä¾›ä¸€ä¸ªæ€æƒ³å§ï¼Œé’ˆå¯¹ä¸åŒçš„åœºæ™¯å¤§å®¶å†å»åšæ”¹é€ å§</p>
<p>æ‰©å±•ï¼š<br>ç»†å¿ƒçš„åŒå­¦å¯èƒ½éƒ½ä¼šå‘ç°è¿™éƒ½æ˜¯å¼ºä¾èµ–æ€§ï¼Œèƒ½ä¸èƒ½æœ‰å¼±ä¾èµ–åœ¨é‡Œé¢å‘¢ï¼Ÿ<br>ç­”æ¡ˆï¼š<br>å½“ç„¶å¯ä»¥æœ‰å¼±ä¾èµ–äº†ï¼Œåœ¨FlowNode.NodeConfä¸­æˆ‘ä»¬æ—¢ç„¶å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å†æ·»åŠ ä¸€ä¸ªå‚æ•°æ¥ç¡®å®šæ˜¯éƒ½æ˜¯å¼±ä¾èµ–ã€‚åœ¨æˆ‘ä»¬çš„future.getè·å–ç»“æœçš„æ—¶å€™å½“å‡ºç°å¼‚å¸¸å¯ä»¥catchä½ï¼Œå¼ºä¾èµ–åˆ™ç»ˆæ­¢æµç¨‹è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå¦åˆ™è®°å½•é”™è¯¯æ—¥å¿—ï¼Œæµç¨‹continue</p>
<p>æˆ‘ä»¬æµç¨‹ä¿å­˜ç°åœ¨æ˜¯ç”¨çš„é™æ€ä»£ç å—ï¼Œå¯ä¸å¯ä»¥æ¢å…¶ä»–çš„æ–¹å¼ä¿å­˜èŠ‚ç‚¹å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆï¼šè¿™ä¸ªå½“ç„¶ä¹Ÿå¯ä»¥ï¼Œæˆ‘ä»¬ä¿å­˜åœ¨æ•°æ®åº“ï¼ŒACMï¼ŒApolloç­‰ç­‰éƒ½æ˜¯å¯ä»¥çš„ã€‚è¿™ä¸ªå–å†³äºä½ ä»¬è‡ªå·±çš„ä¸šåŠ¡å’Œæˆæœ¬é—®é¢˜ã€‚å› ä¸ºæµç¨‹æˆ‘ä»¬ä¸€èˆ¬æ˜¯ä¸ä¼šç»å¸¸æ¢çš„ï¼Œæ‰€ä»¥æˆ‘è¿˜æ˜¯å»ºè®®ä»£ç å†™æ­»å°±å¯ä»¥äº†</p>
<p>é‡‡ç”¨çº¿ç¨‹æ± å»è°ƒç”¨ä¸‹æ¸¸æœåŠ¡ï¼Œä¼šä¸ä¼šé€ æˆæœåŠ¡é“¾è·¯è¿½è¸ªå¤±è´¥å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆï¼šè¿™ä¸ªä¸èƒ½è¯´ç»å¯¹ï¼Œä½†æ˜¯å¦‚æœæ˜¯ä¿å­˜å†ThreadLocalä¸­é‚£è‚¯å®šä¼šå¤±æ•ˆçš„ï¼ŒThreadLocalä¸­çš„KEYä¹Ÿå°±æ˜¯è·Ÿå½“å‰çº¿ç¨‹çš„IDæœ‰å…³ï¼Œéƒ½å¼€å¯æ–°çš„çº¿ç¨‹äº†ï¼Œé‚£è‚¯å®šä¹Ÿå°±æ˜¯ä¸¢å¤±äº†</p>
<p>å¦‚æœé‡‡ç”¨ThreadLocalåœ¨èŠ‚ç‚¹ä¸­æ˜¯ä¸æ˜¯å°±å¤±æ•ˆäº†</p>
<p>ç­”æ¡ˆï¼šç¬¬ä¸‰ç‚¹å·²ç»ç»™å‡ºç­”æ¡ˆäº†</p>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
</search>
